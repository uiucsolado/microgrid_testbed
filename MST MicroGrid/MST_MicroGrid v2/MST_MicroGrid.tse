version = 4.2

//
// Saved by sw version: 2020.1 SP2
// Save timestamp: 19-Aug-2020 @ 12:26:22 PM
//

model "MST_MicroGrid" {
    configuration {
        hil_device = "HIL603"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = 4e-6
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = True
        cpl_stb = True
        enb_dep_sw_detect = False
        code_section = "external memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 5e-05
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
    }

    component Subsystem Root {
        component Subsystem Load {
            layout = dynamic
            component pas_inductor La {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8136
            ]

            component pas_inductor Lc {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8248
            ]

            component pas_resistor Rb {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8192
            ]

            component pas_resistor Ra {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8136
            ]

            component pas_inductor Lb {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8192
            ]

            component pas_resistor Rc {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8248
            ]

            port A {
                label = "A"
                position = left:1
                kind = pe
            }
            [
                position = 8056, 8136
            ]

            port B {
                label = "B"
                position = left:2
                kind = pe
            }
            [
                position = 8056, 8192
            ]

            port C {
                label = "C"
                position = left:3
                kind = pe
            }
            [
                position = 8056, 8248
            ]

            junction Junction1 pe
            [
                position = 8288, 8192
            ]

            connect Junction1 Lc.n_node as Connection17
            connect La.n_node Junction1 as Connection16
            connect Lb.n_node Junction1 as Connection18
            connect Lb.p_node Rb.n_node as Connection13
            connect Ra.p_node A as Connection8
            connect Ra.n_node La.p_node as Connection12
            connect Rb.p_node B as Connection1
            connect Rc.p_node C as Connection10
            connect Rc.n_node Lc.p_node as Connection14

            S = "10e3"

            mask {
                description = "Constant Impedance Load
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Three-phase Y connected RL load.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                R and L values are calculated using the input parameters:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - V: Rated line-to-line voltage
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - S: Rated three-phase power
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - f: Rated frequency
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - pf: Rated power factor
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                None of the parameters can be set to 0."

                V {
                    label = "Voltage"
                    widget = edit
                    type = generic
                    default_value = "480"
                    unit = "V"
                    group = "General"
                }

                S {
                    label = "Power"
                    widget = edit
                    type = generic
                    default_value = "1000e3"
                    unit = "VA"
                    group = "General"
                }

                f {
                    label = "Frequency"
                    widget = edit
                    type = generic
                    default_value = "60"
                    unit = "Hz"
                    group = "General"
                }

                pf {
                    label = "Power Factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                    group = "General"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 6568, 7864
            size = 48, 72
        ]

        component "core/Voltage RMS" Vrms_ess {
            feed_forward = "true"
            frequency = "sys_f"
        }
        [
            position = 5984, 7952
            rotation = right
            size = 64, 32
        ]

        component src_ground gnd2 {
        }
        [
            position = 6400, 7112
            rotation = down
            hide_name = True
        ]

        component "core/Three Phase Voltage Source" Vs1 {
            init_frequency = "60.0"
        }
        [
            position = 6400, 7240
            rotation = right
            scale = -1, 1
            size = 62, 256
        ]

        component Subsystem PCC {
            layout = dynamic
            component "core/Triple Pole Single Throw Contactor" S1 {
                ctrl_src = "Model"
            }
            [
                position = 8136, 8184
                rotation = left
                size = 64, 256
            ]

            component gen_sr_ff "SR Flip Flop1" {
            }
            [
                position = 7712, 8392
            ]

            component src_digital_input "Digital Input Close" {
                addr = "8"
                execution_rate = "Ts"
                invert = "true"
            }
            [
                position = 7592, 8376
            ]

            component src_digital_input "Digital Input Trip" {
                addr = "9"
                execution_rate = "Ts"
                invert = "true"
            }
            [
                position = 7592, 8440
            ]

            component gen_data_type_conversion "Data Type Conversion1" {
            }
            [
                position = 7880, 8184
                hide_name = True
                scale = -1, 1
            ]

            component gen_probe P {
            }
            [
                position = 7536, 7928
                scale = -1, 1
            ]

            component gen_probe Q {
            }
            [
                position = 7536, 7872
                scale = -1, 1
            ]

            component gen_gain Gain3 {
                gain = "100"
            }
            [
                position = 7600, 8024
                hide_name = True
                scale = -1, 1
            ]

            component gen_gain Gain2 {
                gain = "10"
            }
            [
                position = 7624, 8000
                hide_name = True
                scale = -1, 1
            ]

            component gen_gain Gain1 {
                gain = "10"
            }
            [
                position = 7664, 7976
                hide_name = True
                scale = -1, -1
            ]

            component gen_gain "W -> kW" {
                gain = ".001"
            }
            [
                position = 7752, 7976
                scale = -1, 1
            ]

            component gen_gain "var -> kvar" {
                gain = ".001"
            }
            [
                position = 7704, 8000
                scale = -1, 1
            ]

            component gen_gain Gain4 {
                gain = "100"
            }
            [
                position = 7648, 8048
                hide_name = True
                scale = -1, 1
            ]

            component Subsystem Meas2 {
                layout = dynamic
                component gen_bus_join "Bus Join1" {
                    inputs = "3"
                }
                [
                    position = 7960, 8120
                    rotation = left
                ]

                component "core/Voltage Measurement" VB {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7648, 8256
                    rotation = right
                ]

                component "core/Voltage Measurement" VC {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7568, 8320
                    rotation = right
                ]

                component "core/Voltage Measurement" VA {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7728, 8192
                    rotation = right
                ]

                port Ground {
                    position = bottom:auto
                    kind = pe
                }
                [
                    position = 7648, 8504
                    rotation = left
                ]

                port A {
                    position = left:1
                    kind = pe
                }
                [
                    position = 7400, 7928
                ]

                port B {
                    position = left:2
                    kind = pe
                }
                [
                    position = 7400, 8024
                ]

                port C {
                    position = left:3
                    kind = pe
                }
                [
                    position = 7400, 8120
                ]

                port a {
                    label = "a"
                    position = right:1
                    kind = pe
                }
                [
                    position = 7800, 7928
                    rotation = down
                ]

                port b {
                    label = "b"
                    position = right:2
                    kind = pe
                }
                [
                    position = 7800, 8024
                    rotation = down
                ]

                port c {
                    label = "c"
                    position = right:3
                    kind = pe
                }
                [
                    position = 7800, 8120
                    rotation = down
                ]

                port V {
                    label = "V"
                    position = top:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7960, 8064
                    rotation = left
                ]

                junction Junction1421 pe
                [
                    position = 7648, 8432
                ]

                junction Junction1469 pe
                [
                    position = 7648, 8432
                ]

                junction Junction1470 pe
                [
                    position = 7728, 7928
                ]

                junction Junction1471 pe
                [
                    position = 7648, 8024
                ]

                junction Junction1472 pe
                [
                    position = 7568, 8120
                ]

                connect A Junction1470 as Connection390
                connect B Junction1471 as Connection393
                connect C Junction1472 as Connection396
                connect Ground Junction1469 as Connection384
                connect Junction1421 Junction1469 as Connection382
                connect Junction1469 VC.n_node as Connection383
                connect Junction1470 VA.p_node as Connection389
                connect Junction1471 b as Connection392
                connect Junction1472 VC.p_node as Connection395
                connect V "Bus Join1.out" as Connection385
                connect VA.out "Bus Join1.in" as Connection397
                connect VA.n_node Junction1421 as Connection237
                connect VB.out "Bus Join1.in1" as Connection398
                connect VB.n_node Junction1421 as Connection203
                connect VB.p_node Junction1471 as Connection391
                connect VC.out "Bus Join1.in2" as Connection399
                connect a Junction1470 as Connection388
                connect c Junction1472 as Connection394
            }
            [
                position = 8136, 8312
                rotation = right
                scale = -1, 1
                size = 112, 232
            ]

            component Subsystem "PCC Measurements" {
                layout = dynamic
                component gen_terminator Termination3 {
                }
                [
                    position = 8008, 8088
                    hide_name = True
                    scale = -1, 1
                ]

                component "core/Three phase PLL" "Three phase PLL1" {
                }
                [
                    position = 8088, 8096
                    scale = -1, 1
                    size = 64, 128
                ]

                component gen_terminator Termination5 {
                }
                [
                    position = 8008, 8136
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_PQ_transform "Power Meter1" {
                }
                [
                    position = 8088, 8360
                    scale = -1, 1
                ]

                component gen_terminator Termination6 {
                }
                [
                    position = 8016, 8352
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_rms_value "RMS value1" {
                }
                [
                    position = 8088, 8192
                    scale = -1, 1
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "3"
                }
                [
                    position = 8416, 8256
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_comparator Comparator1 {
                }
                [
                    position = 7912, 8272
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_comparator Comparator2 {
                }
                [
                    position = 7912, 8464
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination7 {
                }
                [
                    position = 7976, 8368
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination4 {
                }
                [
                    position = 7968, 8120
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 7968, 8072
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination8 {
                }
                [
                    position = 8016, 8384
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8008, 8056
                    hide_name = True
                    scale = -1, 1
                ]

                component src_constant Constant1 {
                    execution_rate = "Ts"
                }
                [
                    position = 8040, 8264
                    hide_name = True
                    scale = -1, 1
                ]

                component src_constant Constant2 {
                    execution_rate = "Ts"
                }
                [
                    position = 8040, 8472
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_bus_split "Bus Split2" {
                    outputs = "3"
                }
                [
                    position = 8416, 8184
                    hide_name = True
                    scale = -1, 1
                ]

                port f {
                    label = "Frequency"
                    position = left:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7920, 8104
                    scale = -1, 1
                ]

                port P {
                    label = "Real Power"
                    position = left:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7976, 8320
                    scale = -1, 1
                ]

                port Q {
                    label = "Reactive Power"
                    position = left:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7936, 8336
                    scale = -1, 1
                ]

                port pf {
                    label = "Power Factor"
                    position = left:6
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7936, 8400
                    scale = -1, 1
                ]

                port I {
                    label = "I"
                    position = right:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8488, 8184
                    rotation = down
                ]

                port Vrms {
                    label = "Voltage"
                    position = left:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7984, 8192
                    scale = -1, 1
                ]

                port V {
                    label = "V"
                    position = right:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8488, 8256
                    rotation = down
                ]

                port "P direction" {
                    label = "P Import/Exprot"
                    position = left:9
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7848, 8272
                    scale = -1, 1
                ]

                port "pf lead lag" {
                    label = "pf lead/lag"
                    position = left:10
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7848, 8464
                    scale = -1, 1
                ]

                tag Goto2 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8184
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto1 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8160
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto4 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8232
                    hide_name = True
                    scale = -1, 1
                ]

                tag From1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8192, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                tag From2 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8192, 8096
                    hide_name = True
                    scale = -1, 1
                ]

                tag From9 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8400
                    hide_name = True
                    scale = -1, 1
                ]

                tag From8 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8240, 8384
                    hide_name = True
                    scale = -1, 1
                ]

                tag From3 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8192, 8128
                    hide_name = True
                    scale = -1, 1
                ]

                tag From4 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8240, 8352
                    hide_name = True
                    scale = -1, 1
                ]

                tag From10 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8192, 8192
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto6 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8280
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto5 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8256
                    hide_name = True
                    scale = -1, 1
                ]

                tag From5 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8240, 8320
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto3 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8208
                    hide_name = True
                    scale = -1, 1
                ]

                tag From6 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8336
                    hide_name = True
                    scale = -1, 1
                ]

                tag From7 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8368
                    hide_name = True
                    scale = -1, 1
                ]

                junction Junction1 sp
                [
                    position = 8016, 8320
                ]

                junction Junction2 sp
                [
                    position = 7976, 8400
                ]

                connect "Bus Split1.out" Goto4 as Connection27
                connect "Bus Split1.out1" Goto5 as Connection26
                connect "Bus Split1.out2" Goto6 as Connection28
                connect "Bus Split1.in" V as Connection47
                connect "Bus Split2.out" Goto1 as Connection25
                connect "Bus Split2.out2" Goto3 as Connection24
                connect "Bus Split2.in" I as Connection48
                connect Comparator1.in1 Junction1 as Connection57
                connect Comparator2.in1 Junction2 as Connection60
                connect Constant1.out Comparator1.in2 as Connection54
                connect Constant2.out Comparator2.in2 as Connection61
                connect From1 "Three phase PLL1.va" as Connection29
                connect From10 "RMS value1.in" as Connection46
                connect From2 "Three phase PLL1.vb" as Connection30
                connect From3 "Three phase PLL1.vc" as Connection31
                connect From4 "Power Meter1.vc" as Connection37
                connect From5 "Power Meter1.va" as Connection39
                connect From6 "Power Meter1.vb" as Connection38
                connect From7 "Power Meter1.ia" as Connection41
                connect From9 "Power Meter1.ic" as Connection40
                connect Goto2 "Bus Split2.out1" as Connection23
                connect Junction1 P as Connection56
                connect Junction2 pf as Connection59
                connect "P direction" Comparator1.out as Connection62
                connect "Power Meter1.ib" From8 as Connection42
                connect "Power Meter1.Pdc" Junction1 as Connection55
                connect "Power Meter1.k_factor" Junction2 as Connection58
                connect "Power Meter1.Qdc" Q as Connection53
                connect "RMS value1.out" Vrms as Connection50
                connect Termination1.in "Three phase PLL1.d_axis" as Connection32
                connect Termination2.in "Three phase PLL1.q_axis" as Connection33
                connect Termination3.in "Three phase PLL1.zero_axis" as Connection34
                connect Termination4.in "Three phase PLL1.theta" as Connection35
                connect Termination5.in "Three phase PLL1.sin_theta" as Connection36
                connect Termination6.in "Power Meter1.Pac" as Connection43
                connect Termination7.in "Power Meter1.Qac" as Connection44
                connect Termination8.in "Power Meter1.apparent" as Connection45
                connect "Three phase PLL1.freq" f as Connection52
                connect "pf lead lag" Comparator2.out as Connection63
            }
            [
                position = 7864, 8048
                size = 96, 184
            ]

            component Subsystem Meas1 {
                layout = dynamic
                component gen_bus_join "Bus Join1" {
                    inputs = "3"
                }
                [
                    position = 7936, 8168
                    rotation = left
                ]

                component "core/Voltage Measurement" VC {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7568, 8352
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" IA {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7368, 7928
                    size = 64, 32
                ]

                component gen_bus_join "Bus Join2" {
                    inputs = "3"
                }
                [
                    position = 7576, 7784
                ]

                component "core/Current Measurement" IB {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7432, 8024
                    size = 64, 32
                ]

                component "core/Voltage Measurement" VA {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7728, 8224
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" VB {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7648, 8288
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" IC {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7496, 8120
                    size = 64, 32
                ]

                port Ground {
                    position = bottom:auto
                    kind = pe
                }
                [
                    position = 7648, 8504
                    rotation = left
                ]

                port A {
                    position = left:1
                    kind = pe
                }
                [
                    position = 7288, 7928
                ]

                port B {
                    position = left:2
                    kind = pe
                }
                [
                    position = 7288, 8024
                ]

                port C {
                    position = left:3
                    kind = pe
                }
                [
                    position = 7288, 8120
                ]

                port a {
                    label = "a"
                    position = right:1
                    kind = pe
                }
                [
                    position = 7800, 7928
                    rotation = down
                ]

                port b {
                    label = "b"
                    position = right:2
                    kind = pe
                }
                [
                    position = 7800, 8024
                    rotation = down
                ]

                port c {
                    label = "c"
                    position = right:3
                    kind = pe
                }
                [
                    position = 7800, 8120
                    rotation = down
                ]

                port V {
                    label = "V"
                    position = top:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7936, 8112
                    rotation = left
                ]

                port I {
                    position = top:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7648, 7784
                ]

                junction Junction1421 pe
                [
                    position = 7648, 8432
                ]

                junction Junction1466 pe
                [
                    position = 7728, 7928
                ]

                junction Junction1467 pe
                [
                    position = 7648, 8024
                ]

                junction Junction1468 pe
                [
                    position = 7568, 8120
                ]

                junction Junction1469 pe
                [
                    position = 7648, 8432
                ]

                connect A IA.p_node as Connection379
                connect B IB.p_node as Connection380
                connect "Bus Join1.in1" VB.out as Connection387
                connect "Bus Join1.in2" VC.out as Connection388
                connect "Bus Join2.out" I as Connection393
                connect "Bus Join2.in1" IB.out as Connection391
                connect "Bus Join2.in2" IC.out as Connection392
                connect C IC.p_node as Connection381
                connect Ground Junction1469 as Connection384
                connect IA.out "Bus Join2.in" as Connection390
                connect IA.n_node Junction1466 as Connection377
                connect Junction1421 Junction1469 as Connection382
                connect Junction1466 a as Connection299
                connect Junction1467 IB.n_node as Connection375
                connect Junction1467 b as Connection301
                connect Junction1468 IC.n_node as Connection376
                connect Junction1468 c as Connection302
                connect Junction1469 VC.n_node as Connection383
                connect V "Bus Join1.out" as Connection385
                connect V "Bus Join1.out" as Connection389
                connect VA.out "Bus Join1.in" as Connection386
                connect VA.n_node Junction1421 as Connection237
                connect VA.p_node Junction1466 as Connection240
                connect VB.n_node Junction1421 as Connection203
                connect VB.p_node Junction1467 as Connection243
                connect VC.p_node Junction1468 as Connection246
            }
            [
                position = 8136, 8048
                rotation = right
                scale = -1, 1
                size = 112, 232
            ]

            component src_scada_input Grid_Connect {
                execution_rate = "Ts"
                format = "int"
                max = "1"
                min = "0"
                signal_type = "int"
                unit = ""
            }
            [
                position = 7672, 8248
            ]

            component gen_logic_op "Logical operator2" {
            }
            [
                position = 7840, 8288
                hide_name = True
            ]

            port A {
                label = "A"
                position = top:1
                kind = pe
            }
            [
                position = 8040, 7944
                rotation = right
            ]

            port B {
                label = "B"
                position = top:2
                kind = pe
            }
            [
                position = 8136, 7944
                rotation = right
            ]

            port C {
                label = "C"
                position = top:3
                kind = pe
            }
            [
                position = 8232, 7944
                rotation = right
            ]

            port a {
                label = "a"
                position = bottom:1
                kind = pe
            }
            [
                position = 8040, 8424
                rotation = left
            ]

            port b {
                label = "b"
                position = bottom:2
                kind = pe
            }
            [
                position = 8136, 8424
                rotation = left
            ]

            port c {
                label = "c"
                position = bottom:3
                kind = pe
            }
            [
                position = 8232, 8424
                rotation = left
            ]

            port G {
                label = "G"
                position = right:1
                kind = pe
            }
            [
                position = 8424, 8192
                rotation = down
            ]

            tag Goto2 {
                value = "Q"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8000
                hide_name = True
                scale = -1, 1
            ]

            tag Goto1 {
                value = "P"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 7976
                hide_name = True
                scale = -1, 1
            ]

            tag Goto5 {
                value = "pf"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8072
                hide_name = True
                scale = -1, 1
            ]

            tag Goto4 {
                value = "f"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8048
                hide_name = True
                scale = -1, 1
            ]

            tag Goto6 {
                value = "P sign"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8096
                hide_name = True
                scale = -1, 1
            ]

            tag Goto8 {
                value = "CB Status"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7800, 8184
                hide_name = True
                scale = -1, 1
            ]

            tag Goto7 {
                value = "pf lead/lag"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8120
                hide_name = True
                scale = -1, 1
            ]

            tag Goto3 {
                value = "V"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8024
                hide_name = True
                scale = -1, 1
            ]

            tag Goto9 {
                value = "PCC_status"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 7640, 8320
                hide_name = True
                scale = -1, 1
            ]

            junction Junction1 pe
            [
                position = 8392, 8192
            ]

            junction Junction1506 sp
            [
                position = 7784, 7976
            ]

            junction Junction1507 sp
            [
                position = 7800, 8000
            ]

            junction Junction1508 sp
            [
                position = 7952, 8184
            ]

            junction Junction1509 sp
            [
                position = 7760, 8248
            ]

            connect A Meas1.A as Connection45
            connect "Digital Input Close.out" "SR Flip Flop1.s_in" as Connection1075
            [
                breakpoints = 7664, 8376
            ]
            connect "Digital Input Trip.out" "SR Flip Flop1.r_in" as Connection1066
            connect Gain1.in "W -> kW.out" as Connection1085
            connect Gain2.in "var -> kvar.out" as Connection1088
            connect Gain3.in "PCC Measurements.Vrms" as Connection1091
            connect Gain4.out Goto4 as Connection1093
            connect Goto1 Gain1.out as Connection1094
            [
                breakpoints = 7472, 7976; 7568, 7976
            ]
            connect Goto2 Gain2.out as Connection1095
            [
                breakpoints = 7472, 8000; 7584, 8000
            ]
            connect Goto3 Gain3.out as Connection1090
            connect Goto5 "PCC Measurements.pf" as Connection27
            connect Goto6 "PCC Measurements.P direction" as Connection28
            connect Goto7 "PCC Measurements.pf lead lag" as Connection29
            connect Goto8 "Data Type Conversion1.out" as Connection1076
            connect Junction1 G as Connection19
            connect Junction1506 "PCC Measurements.P" as Connection1101
            connect Junction1507 "PCC Measurements.Q" as Connection1104
            connect Meas1.B B as Connection44
            connect Meas1.C C as Connection43
            connect Meas1.Ground Junction1 as Connection20
            connect Meas1.I "PCC Measurements.I" as Connection52
            connect Meas1.b S1.b_out as Connection41
            connect Meas1.a S1.a_out as Connection40
            connect Meas2.Ground Junction1 as Connection18
            connect Meas2.C S1.c_in as Connection48
            connect Meas2.b b as Connection50
            connect Meas2.c c as Connection49
            connect P.in Junction1506 as Connection1102
            connect "PCC Measurements.f" Gain4.in as Connection1092
            connect "PCC Measurements.V" Meas1.V as Connection53
            connect Q.in Junction1507 as Connection1105
            connect S1.c_out Meas1.c as Connection42
            connect S1.b_in Meas2.B as Connection47
            connect S1.a_in Meas2.A as Connection46
            connect "W -> kW.in" Junction1506 as Connection1100
            connect a Meas2.a as Connection51
            connect "var -> kvar.in" Junction1507 as Connection1103
            [
                breakpoints = 7784, 8000
            ]
            connect "SR Flip Flop1.out" "Logical operator2.in1" as Connection1941
            connect "Data Type Conversion1.in" Junction1508 as Connection1942
            connect Junction1508 S1.ctrl_in as Connection1943
            [
                breakpoints = 7944, 8184; 7944, 8184
            ]
            connect "Logical operator2.out" Junction1508 as Connection1944
            connect Grid_Connect.out Junction1509 as Connection1945
            connect Junction1509 "Logical operator2.in" as Connection1946
            connect Goto9 Junction1509 as Connection1947
        }
        [
            position = 6400, 7712
            size = 80, 48
        ]

        component "core/Voltage RMS" Vrms_grid {
            feed_forward = "true"
            frequency = "sys_f"
        }
        [
            position = 6336, 7368
            size = 64, 32
        ]

        component "core/Voltage RMS" Vrms_pv {
            frequency = "sys_f"
        }
        [
            position = 5968, 8160
            rotation = right
            size = 64, 32
        ]

        component Subsystem PV1 {
            layout = dynamic
            component src_constant Constant1 {
                execution_rate = "Ts_pv"
            }
            [
                position = 7472, 7904
                hide_name = True
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "6"
            }
            [
                position = 7616, 7992
            ]

            component Subsystem "PV Plant" {
                layout = static
                component pas_inductor L2 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8248
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8248, 8504
                    rotation = right
                ]

                component pas_resistor R8 {
                    resistance = "Rres"
                }
                [
                    position = 8328, 8416
                    rotation = right
                ]

                component pas_resistor R0b {
                    resistance = "R0"
                }
                [
                    position = 8024, 8248
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 7544, 8040
                    hide_name = True
                ]

                component pas_inductor L6 {
                    inductance = "L"
                }
                [
                    position = 8824, 8248
                ]

                component pas_resistor R0a {
                    resistance = "R0"
                }
                [
                    position = 8024, 8152
                ]

                component pas_inductor L1 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8152
                ]

                component pas_resistor R0c1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8344
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8416, 8504
                    rotation = right
                ]

                component pas_resistor R4 {
                    resistance = "1e-3"
                }
                [
                    position = 7392, 8152
                ]

                component gen_digital_probe On {
                }
                [
                    position = 7608, 8088
                    rotation = right
                ]

                component gen_c_function delay {
                    global_variables = "real counter;"
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "in inherit"
                    in_terminal_labels = "False;"
                    init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "False;"
                    output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                    parameters = "real Delay;"
                }
                [
                    position = 7448, 8080
                    size = 48, 48
                ]

                component pas_inductor L3 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8344
                ]

                component pas_resistor R7 {
                    resistance = "Rres"
                }
                [
                    position = 8248, 8416
                    rotation = right
                ]

                component pas_capacitor Ca1 {
                    capacitance = "18.8e-2"
                }
                [
                    position = 7472, 8248
                    rotation = right
                ]

                component pas_inductor L4 {
                    inductance = "L"
                }
                [
                    position = 8824, 8344
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8328, 8504
                    rotation = right
                ]

                component gen_digital_probe enable {
                }
                [
                    position = 7432, 7992
                    rotation = left
                ]

                component pas_resistor R0a1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8152
                ]

                component pas_resistor R0b1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8248
                ]

                component pas_inductor L5 {
                    inductance = "L"
                }
                [
                    position = 8824, 8152
                ]

                component pas_resistor R0c {
                    resistance = "R0"
                }
                [
                    position = 8024, 8344
                ]

                component pas_resistor R9 {
                    resistance = "Rres"
                }
                [
                    position = 8416, 8416
                    rotation = right
                ]

                component src_constant VDC {
                    execution_rate = "Ts"
                    value = "Vn_dc"
                }
                [
                    position = 7232, 8248
                ]

                component "core/Voltage Measurement" Vab {
                }
                [
                    position = 7848, 8200
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vdc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7544, 8256
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Va {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8480, 8416
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ia {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8152
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8592, 8520
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vb {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8536, 8472
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8248
                    size = 64, 32
                ]

                component "core/Triple Pole Single Throw Contactor" S1 {
                    ctrl_src = "Model"
                }
                [
                    position = 9160, 8248
                    size = 64, 256
                ]

                component "core/Current Measurement" Ic {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8344
                    size = 64, 32
                ]

                component "core/Current Measurement" Iinv_in {
                }
                [
                    position = 7600, 8152
                    size = 64, 32
                ]

                component Subsystem Input {
                    layout = dynamic
                    component gen_bus_split "Bus Split2" {
                        outputs = "6"
                    }
                    [
                        position = 8136, 8104
                        rotation = right
                        hide_name = True
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8136, 8032
                        rotation = right
                    ]

                    tag Goto27 {
                        value = "Irradiation"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "V_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "Q_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Enable"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8184
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "Q_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8280
                        hide_name = True
                        size = 0, 0
                    ]

                    connect "Bus Split2.out2" Goto27 as Connection757
                    connect "Bus Split2.out3" Goto28 as Connection758
                    connect "Bus Split2.out5" Goto29 as Connection760
                    connect "Bus Split2.out4" Goto30 as Connection759
                    connect "Bus Split2.out1" Goto31 as Connection756
                    connect "Bus Split2.out" Goto32 as Connection755
                    connect "Bus Split2.in" Inputs as Connection761
                }
                [
                    position = 7968, 7672
                    size = 72, 72
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem Grid_follow {
                        layout = dynamic
                        component gen_probe id {
                            addr = "8968"
                        }
                        [
                            position = 9480, 8376
                            rotation = right
                        ]

                        component gen_gain PV_eff {
                            gain = "PV_eff/100.0"
                        }
                        [
                            position = 8216, 8160
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8344, 8192
                            hide_name = True
                        ]

                        component gen_probe Vq {
                        }
                        [
                            position = 8920, 8176
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "NOT"
                        }
                        [
                            position = 8024, 8344
                            rotation = right
                            hide_name = True
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8136, 8160
                            hide_name = True
                        ]

                        component gen_logic_op "Logical operator2" {
                        }
                        [
                            position = 8728, 7928
                            hide_name = True
                        ]

                        component gen_c_function delay {
                            global_variables = "real counter;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "in inherit"
                            in_terminal_labels = "False;"
                            init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "False;"
                            output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                            parameters = "real Delay;"
                        }
                        [
                            position = 8624, 7920
                            size = 48, 48
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn_dc)"
                        }
                        [
                            position = 9696, 7912
                            rotation = right
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_gain Gain2 {
                            gain = "1000.0/Sn"
                        }
                        [
                            position = 8224, 8360
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/Vn"
                        }
                        [
                            position = 7696, 8368
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 7808, 8384
                            hide_name = True
                        ]

                        component gen_probe S {
                        }
                        [
                            position = 9304, 7776
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain to_pu {
                            gain = "1.0/Sn"
                        }
                        [
                            position = 8288, 8160
                        ]

                        component gen_probe Q {
                        }
                        [
                            position = 9304, 7712
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Pref {
                        }
                        [
                            position = 8528, 8136
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Ud_c {
                        }
                        [
                            position = 9816, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8336, 8376
                            hide_name = True
                        ]

                        component src_constant PV_Area_m2 {
                            execution_rate = "Ts"
                            value = "PV_area"
                        }
                        [
                            position = 8024, 8184
                        ]

                        component gen_probe pf {
                        }
                        [
                            position = 9304, 7840
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Id_ref {
                        }
                        [
                            position = 9488, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant Constant2 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8264, 8392
                            hide_name = True
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 7912, 8432
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8408, 8176
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8472, 8416
                            hide_name = True
                        ]

                        component gen_probe P {
                        }
                        [
                            position = 9304, 7648
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Vt_pu {
                        }
                        [
                            position = 8912, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Uq_c {
                        }
                        [
                            position = 9816, 8440
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe wt_pll {
                            addr = "8966"
                        }
                        [
                            position = 9112, 8520
                            rotation = right
                        ]

                        component gen_probe Vd {
                        }
                        [
                            position = 8920, 8096
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_digital_probe Qmode {
                        }
                        [
                            position = 8512, 8320
                        ]

                        component gen_probe w_pu {
                        }
                        [
                            position = 8912, 8336
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe irr_in {
                        }
                        [
                            position = 8000, 8112
                            rotation = left
                        ]

                        component gen_probe Qref {
                        }
                        [
                            position = 8624, 8464
                            rotation = right
                            scale = -1, 1
                        ]

                        component gen_probe iq {
                            addr = "8965"
                        }
                        [
                            position = 9480, 8520
                            rotation = right
                        ]

                        component gen_probe Iq_ref {
                        }
                        [
                            position = 9488, 8168
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant Constant3 {
                            execution_rate = "inherit"
                        }
                        [
                            position = 9128, 7952
                            hide_name = True
                        ]

                        component Subsystem ControlSignal_Calculation {
                            layout = dynamic
                            component gen_product Product1 {
                            }
                            [
                                position = 6984, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8280
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_product Product8 {
                                signs = "*/"
                            }
                            [
                                position = 7488, 8088
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 7144, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum9 {
                            }
                            [
                                position = 7816, 8288
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 6968, 8376
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 7392, 8288
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6880, 8176
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8072
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum8 {
                            }
                            [
                                position = 7816, 8096
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6872, 8384
                                hide_name = True
                            ]

                            component gen_probe Vdc {
                            }
                            [
                                position = 7136, 8424
                            ]

                            component gen_z_domain_transfer LPF_dc {
                                a_coeff = "[1.0/(2*np.pi*1),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 6856, 8472
                            ]

                            component src_constant Damp {
                                execution_rate = "Ts"
                                value = "Damp"
                            }
                            [
                                position = 7616, 8184
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7704, 8216
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 7392, 8080
                                hide_name = True
                            ]

                            component gen_product Product7 {
                                signs = "*/"
                            }
                            [
                                position = 7504, 8296
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7704, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                            }
                            [
                                position = 7136, 8368
                                hide_name = True
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7608, 8088
                                hide_name = True
                            ]

                            component gen_gain Gain11 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7616, 8296
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 6944, 8472
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "0.5"
                            }
                            [
                                position = 7192, 8472
                                hide_name = True
                            ]

                            component Subsystem PI_q {
                                layout = dynamic
                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_gain Kp {
                                    gain = "Iq_Kp"
                                }
                                [
                                    position = 8136, 8176
                                ]

                                component gen_gain Ki {
                                    gain = "Iq_Ki"
                                }
                                [
                                    position = 8008, 8240
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Iq_lowLim"
                                    upper_limit = "Iq_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8208
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8120, 8296
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7968, 8208
                                ]

                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection69
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection70
                                connect Ki.out Sum7.in as Connection66
                                connect Kp.in Junction74 as Connection68
                                connect Kp.out Sum5.in as Connection65
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6936, 8280
                                size = 64, 48
                            ]

                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "Id_lowLim"
                                    upper_limit = "Id_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Id_Kp"
                                }
                                [
                                    position = 8168, 8176
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Id_Ki"
                                }
                                [
                                    position = 7992, 8240
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7848, 8200
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8296
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7912, 8200
                                ]

                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection73
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection74
                                connect Ki.out Sum7.in as Connection71
                                connect Kp.in Junction74 as Connection72
                                connect Kp.out Sum5.in as Connection66
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6904, 8072
                                size = 64, 48
                            ]

                            port Uq {
                                label = "Uq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ud {
                                label = "Ud"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port VDC {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6792, 8472
                                rotation = down
                                scale = -1, 1
                            ]

                            port w {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6496, 8512
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8024
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_meas {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8232
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_meas {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8360
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8152
                                rotation = down
                                scale = -1, 1
                            ]

                            port Reset {
                                position = top:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6848, 8008
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From26 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6816, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From27 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8144
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto3 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6608, 8056
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6600, 8512
                                size = 0, 0
                            ]

                            tag From28 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto4 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6592, 8312
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From23 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6888, 8136
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto2 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6984, 8008
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From25 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6872, 8344
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction145 sp
                            [
                                position = 6592, 8288
                            ]

                            junction Junction146 sp
                            [
                                position = 6640, 8080
                            ]

                            junction Junction150 sp
                            [
                                position = 6544, 8080
                            ]

                            junction Junction151 sp
                            [
                                position = 6536, 8288
                            ]

                            junction Junction155 sp
                            [
                                position = 7440, 8304
                            ]

                            junction Junction164 sp
                            [
                                position = 6904, 8008
                            ]

                            junction Junction165 sp
                            [
                                position = 7656, 8184
                            ]

                            junction Junction166 sp
                            [
                                position = 7072, 8472
                            ]

                            connect Damp.out Junction165 as Connection182
                            connect From23 Product1.in as Connection1
                            connect From25 Product2.in as Connection2
                            connect From26 PI_q.Reset as Connection169
                            connect Gain1.in Junction145 as Connection5
                            connect Gain1.out Product1.in1 as Connection6
                            connect Gain10.out Sum8.in as Connection184
                            connect Gain11.in Product7.out as Connection186
                            connect Gain2.in Junction146 as Connection7
                            connect Gain2.out Product2.in1 as Connection8
                            connect Gain5.in Junction166 as Connection193
                            connect Goto1 w as Connection34
                            connect Goto2 Junction164 as Connection170
                            connect Goto3 Junction150 as Connection66
                            connect Goto4 Junction151 as Connection69
                            connect Junction145 Junction151 as Connection67
                            connect Junction146 Junction150 as Connection64
                            connect Junction146 Sum1.in as Connection11
                            connect Junction150 Id_meas as Connection65
                            connect Junction151 Iq_meas as Connection68
                            connect Junction155 Gain5.out as Connection192
                            connect Junction155 Product7.in1 as Connection116
                            connect Junction164 Reset as Connection171
                            connect Junction165 Product5.in1 as Connection181
                            connect Junction166 Vdc.in as Connection190
                            [
                                position = 0, 0
                            ]
                            connect Limit3.out Junction166 as Connection191
                            connect Limit3.in LPF_dc.out as Connection188
                            connect PI_d.Reset Junction164 as Connection172
                            connect PI_d.In Sum1.out as Connection55
                            connect PI_q.In Sum2.out as Connection165
                            connect Product5.in From27 as Connection101
                            connect Product5.out Sum8.in1 as Connection95
                            connect Product6.in1 From28 as Connection102
                            connect Product6.in Junction165 as Connection180
                            connect Product6.out Sum9.in as Connection96
                            connect Product7.in Sum7.out as Connection145
                            connect Product8.out Gain10.in as Connection183
                            connect Product8.in1 Junction155 as Connection115
                            connect Product8.in Sum3.out as Connection143
                            connect Sum1.in1 Id_ref as Connection20
                            connect Sum2.in1 Iq_ref as Connection22
                            connect Sum2.in Junction145 as Connection21
                            connect Sum3.in PI_d.Out as Connection178
                            connect Sum5.in1 Product1.out as Connection24
                            connect Sum5.out Sum3.in1 as Connection177
                            connect Sum6.in1 Product2.out as Connection26
                            connect Sum7.in PI_q.Out as Connection175
                            connect Sum7.in1 Sum6.out as Connection176
                            connect Sum8.out Ud as Connection173
                            connect Sum9.in1 Gain11.out as Connection185
                            connect Uq Sum9.out as Connection174
                            connect VDC LPF_dc.in as Connection124
                            connect Vd Sum5.in as Connection31
                            connect Vq Sum6.in as Connection32
                        }
                        [
                            position = 9696, 8272
                            scale = -1, 1
                            size = 168, 448
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 9632, 7936
                            rotation = right
                            hide_name = True
                            size = 32, 32
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_product Product7 {
                            }
                            [
                                position = 7512, 8328
                                hide_name = True
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8080
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 7680, 8008
                                hide_name = True
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 7680, 8080
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7680, 8152
                                hide_name = True
                            ]

                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 7792, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7792, 8072
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7680, 8224
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7648, 8328
                                hide_name = True
                            ]

                            port P_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Q_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8216
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8000
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8072
                                rotation = down
                                scale = -1, 1
                            ]

                            port Irq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ird {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8168
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vt {
                                position = right:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8320
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction142 sp
                            [
                                position = 7520, 8072
                            ]

                            junction Junction143 sp
                            [
                                position = 7536, 8000
                            ]

                            junction Junction145 sp
                            [
                                position = 7448, 8320
                            ]

                            junction Junction146 sp
                            [
                                position = 7864, 8176
                            ]

                            junction Junction147 sp
                            [
                                position = 7584, 8144
                            ]

                            junction Junction148 sp
                            [
                                position = 7552, 8216
                            ]

                            connect Irq Product1.out as Connection86
                            connect Junction142 Vd as Connection12
                            connect Junction143 Product3.in as Connection13
                            connect Junction145 Product7.in as Connection64
                            connect Junction146 Product1.in1 as Connection76
                            [
                                position = 0, 0
                                breakpoints = 7864, 8176
                            ]
                            connect Junction147 Product5.in as Connection81
                            [
                                position = 0, 0
                                breakpoints = 7584, 8144
                            ]
                            connect Junction148 Product6.in as Connection84
                            [
                                position = 0, 0
                                breakpoints = 7552, 8216
                            ]
                            connect Limit3.out Junction146 as Connection77
                            connect Limit3.in Product7.out as Connection74
                            connect P_ref Junction147 as Connection82
                            connect Product1.in Sum3.out as Connection23
                            connect Product2.out Ird as Connection87
                            connect Product2.in1 Junction146 as Connection75
                            connect Product2.in Sum4.out as Connection26
                            connect Product3.in1 Junction147 as Connection80
                            connect Product3.out Sum3.in as Connection28
                            connect Product4.in Junction142 as Connection30
                            connect Product4.in1 Junction148 as Connection83
                            connect Product4.out Sum3.in1 as Connection31
                            connect Product5.in1 Junction142 as Connection33
                            connect Product5.out Sum4.in as Connection34
                            connect Product6.in1 Junction143 as Connection36
                            connect Product6.out Sum4.in1 as Connection37
                            connect Product7.in1 Junction145 as Connection65
                            connect Q_ref Junction148 as Connection85
                            connect Vq Junction143 as Connection3
                            connect Vt Junction145 as Connection63
                        }
                        [
                            position = 9352, 8136
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component Subsystem PI_Vt {
                            layout = dynamic
                            component gen_sum Sum7 {
                            }
                            [
                                position = 8080, 8288
                                hide_name = True
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[-1.15]"
                                limit_upper = "[1.15]"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8304
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8312, 8208
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8456, 8208
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7992, 8280
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8256, 8384
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8112, 8200
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8360, 8384
                                hide_name = True
                                scale = -1, 1
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8312
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7880, 8232
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8208
                            ]

                            junction Junction72 sp
                            [
                                position = 8416, 8208
                            ]

                            junction Junction73 sp
                            [
                                position = 8488, 8208
                            ]

                            junction Junction74 sp
                            [
                                position = 7944, 8232
                            ]

                            connect Integrator1.reset Reset as Connection2
                            connect Junction72 Sum6.in as Connection64
                            connect Junction73 Limit1.out as Connection67
                            connect Junction74 In as Connection80
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction74 as Connection81
                            connect Ki.out Sum7.in as Connection78
                            connect Kp.in Junction74 as Connection79
                            connect Kp.out Sum5.in as Connection72
                            connect Limit1.in Junction72 as Connection63
                            connect Out Junction73 as Connection68
                            connect Sum5.in1 Integrator1.out as Connection6
                            connect Sum5.out Junction72 as Connection65
                            connect Sum6.in1 Junction73 as Connection66
                            connect Sum7.out Integrator1.in as Connection69
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 8024, 8432
                            size = 64, 48
                        ]

                        component Subsystem Power_Meas {
                            layout = dynamic
                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_c_function S_and_pf {
                                    in_terminal_dimensions = "inherit;inherit"
                                    in_terminal_dimensions_str = "P inherit;Q inherit"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real P;inherit Q;"
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "S inherit;pf inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit S;inherit pf;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect Junction1 Id as Connection49
                                connect Junction1 Product4.in1 as Connection24
                                connect Junction2 Iq as Connection52
                                connect Junction2 Product3.in1 as Connection27
                                connect Junction3 Product2.in as Connection32
                                connect Junction3 Vq as Connection53
                                connect Junction4 Product1.in as Connection35
                                connect Junction4 Vd as Connection50
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction5 P as Connection55
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction6 Q as Connection56
                                connect LPF_P.in Sum1.out as Connection39
                                connect LPF_Q.in Sum2.out as Connection40
                                connect Product1.in1 Junction1 as Connection25
                                connect Product2.in1 Junction2 as Connection28
                                connect Product3.in Junction4 as Connection36
                                connect Product4.in Junction3 as Connection33
                                connect S_and_pf.P Junction5 as Connection45
                                connect S_and_pf.Q Junction6 as Connection48
                                connect S_and_pf.S S as Connection51
                                connect S_and_pf.pf pf as Connection54
                                connect Sum1.in Product1.out as Connection29
                                connect Sum1.in1 Product2.out as Connection30
                                connect Sum2.in1 Product3.out as Connection38
                                connect Sum2.in Product4.out as Connection37

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                    
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                            connect Gain5.out Q as Connection11
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Gain6.out S as Connection13
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect pf Power_Meas_DQpu.pf as Connection19
                        }
                        [
                            position = 9112, 7744
                            size = 96, 232
                        ]

                        component Subsystem Current_abc_to_dq {
                            layout = dynamic
                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8008
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7864, 8008
                                size = 48, 80
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8008
                            ]

                            connect Gain1.out Id as Connection24
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.q_axis" Gain2.in as Connection27
                            connect "abc to dq1.d_axis" Gain1.in as Connection28
                            connect "abc to dq1.zero_axis" Termination1.in as Connection29
                            connect "abc to dq1.va" Ia as Connection30
                            connect Ib "abc to dq1.vb" as Connection31
                            connect "abc to dq1.vc" Ic as Connection32
                            connect "abc to dq1.wt" wt as Connection33
                        }
                        [
                            position = 9352, 8408
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component Subsystem Limit_PQref {
                            layout = dynamic
                            component tm_delay "Unit Delay2" {
                            }
                            [
                                position = 8200, 8336
                                hide_name = True
                            ]

                            component gen_rate_limiter "S rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8336
                            ]

                            component gen_rate_limiter "Q rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8264
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8200, 8192
                                hide_name = True
                            ]

                            component gen_rate_limiter "P rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8192
                            ]

                            component Subsystem priority_PQlim {
                                layout = dynamic
                                component gen_c_function "PQ limiting with priority" {
                                    global_variables = "real signQ;real signP;real Sref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Smax inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Smax;"
                                    init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit;S inherit"
                                    out_terminal_labels = "False;False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;inherit S;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                    parameters = "real type;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8128
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8192
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8272
                                    rotation = left
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8128
                                    rotation = left
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8192
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8272
                                    rotation = right
                                ]

                                connect "PQ limiting with priority.P" P as Connection5
                                connect "PQ limiting with priority.Pref" Pref as Connection2
                                connect "PQ limiting with priority.Q" Q as Connection6
                                connect "PQ limiting with priority.Qref" Qref as Connection3
                                connect "PQ limiting with priority.S" S as Connection4
                                connect "PQ limiting with priority.Smax" Smax as Connection1
                            }
                            [
                                position = 7872, 8264
                                size = 56, 184
                            ]

                            component Subsystem limS_overPQ {
                                layout = dynamic
                                component gen_c_function "S limiting over PQ" {
                                    global_variables = "real S_PQref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Sref inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Sref;"
                                    init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8112
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8192
                                ]

                                port Sref {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8272
                                    rotation = left
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8120
                                    rotation = left
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8272
                                    rotation = right
                                ]

                                connect "S limiting over PQ.P" P as Connection3
                                connect "S limiting over PQ.Pref" Pref as Connection5
                                connect "S limiting over PQ.Q" Q as Connection2
                                connect "S limiting over PQ.Qref" Qref as Connection1
                                connect "S limiting over PQ.Sref" Sref as Connection4
                            }
                            [
                                position = 8096, 8264
                                size = 56, 184
                            ]

                            port Qlim {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8336
                            ]

                            port Plim {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8192
                            ]

                            port Pref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8192
                            ]

                            port Qref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8264
                            ]

                            port Smax {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8336
                            ]

                            connect "P rate limit.out" limS_overPQ.Pref as Connection166
                            connect "P rate limit.in" priority_PQlim.P as Connection158
                            connect Plim "Unit Delay1.out" as Connection161
                            connect Pref priority_PQlim.Pref as Connection155
                            connect "Q rate limit.out" limS_overPQ.Qref as Connection162
                            connect "Q rate limit.in" priority_PQlim.Q as Connection159
                            connect Qref priority_PQlim.Qref as Connection156
                            connect "S rate limit.out" limS_overPQ.Sref as Connection165
                            connect "S rate limit.in" priority_PQlim.S as Connection157
                            connect Smax priority_PQlim.Smax as Connection154
                            connect "Unit Delay1.in" limS_overPQ.P as Connection164
                            connect "Unit Delay2.out" Qlim as Connection160
                            connect "Unit Delay2.in" limS_overPQ.Q as Connection163

                            type = "1.0"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                type {
                                    label = "Priority type"
                                    widget = edit
                                    type = generic
                                    default_value = "2.0"
                                }

                                ratemax {
                                    label = "Max power rate"
                                    widget = edit
                                    type = generic
                                    default_value = "powerRate"
                                    unit = "pu/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                
                                ENDCODE
                            }
                        }
                        [
                            position = 9240, 8016
                            rotation = right
                            size = 64, 96
                        ]

                        component Subsystem Current_abc_to_dq1 {
                            layout = dynamic
                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8008
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7864, 8008
                                size = 48, 80
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8008
                            ]

                            connect Gain1.out Id as Connection24
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.q_axis" Gain2.in as Connection27
                            connect "abc to dq1.d_axis" Gain1.in as Connection28
                            connect "abc to dq1.zero_axis" Termination1.in as Connection29
                            connect "abc to dq1.va" Ia as Connection30
                            connect Ib "abc to dq1.vb" as Connection31
                            connect "abc to dq1.vc" Ic as Connection32
                            connect "abc to dq1.wt" wt as Connection33
                        }
                        [
                            position = 9360, 8680
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component Subsystem Power_Meas1 {
                            layout = dynamic
                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_c_function S_and_pf {
                                    in_terminal_dimensions = "inherit;inherit"
                                    in_terminal_dimensions_str = "P inherit;Q inherit"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real P;inherit Q;"
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "S inherit;pf inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit S;inherit pf;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect Junction1 Id as Connection49
                                connect Junction1 Product4.in1 as Connection24
                                connect Junction2 Iq as Connection52
                                connect Junction2 Product3.in1 as Connection27
                                connect Junction3 Product2.in as Connection32
                                connect Junction3 Vq as Connection53
                                connect Junction4 Product1.in as Connection35
                                connect Junction4 Vd as Connection50
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction5 P as Connection55
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction6 Q as Connection56
                                connect LPF_P.in Sum1.out as Connection39
                                connect LPF_Q.in Sum2.out as Connection40
                                connect Product1.in1 Junction1 as Connection25
                                connect Product2.in1 Junction2 as Connection28
                                connect Product3.in Junction4 as Connection36
                                connect Product4.in Junction3 as Connection33
                                connect S_and_pf.P Junction5 as Connection45
                                connect S_and_pf.Q Junction6 as Connection48
                                connect S_and_pf.S S as Connection51
                                connect S_and_pf.pf pf as Connection54
                                connect Sum1.in Product1.out as Connection29
                                connect Sum1.in1 Product2.out as Connection30
                                connect Sum2.in1 Product3.out as Connection38
                                connect Sum2.in Product4.out as Connection37

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                    
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                            connect Gain5.out Q as Connection11
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Gain6.out S as Connection13
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect pf Power_Meas_DQpu.pf as Connection19
                        }
                        [
                            position = 8704, 8712
                            size = 96, 232
                        ]

                        port Ia {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9208, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ic {
                            position = right:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8432
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_d {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8136
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_q {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port w {
                            position = right:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8376
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vt {
                            position = right:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8296
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9696, 7856
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt_in {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8480
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8552
                        ]

                        port Enable {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9632, 7824
                            rotation = right
                            scale = -1, 1
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 7872
                            rotation = right
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9872, 8064
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8480
                        ]

                        tag Goto22 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9488, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From23 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9664, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9224, 8520
                            hide_name = True
                            size = 54, 25
                        ]

                        tag From44 {
                            value = "Irradiation"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7912, 8152
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto18 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8680, 8416
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From45 {
                            value = "V_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7600, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8216
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto33 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7688
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7624
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From27 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9192, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto24 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9568, 7880
                            rotation = down
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From26 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9760, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From43 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From30 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9192, 7896
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto25 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8824, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto35 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7816
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From31 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7712
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From42 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8200
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From47 {
                            value = "Q_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8408, 8320
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto17 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8376
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7960, 8288
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9704, 8552
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag From25 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9728, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto19 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8296
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto34 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7752
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From28 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7656, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From46 {
                            value = "Q_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From38 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto26 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8656, 7872
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From40 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8112
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From34 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7776
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From37 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8600, 7984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto21 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8592, 8176
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto23 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8456
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From32 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7648
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From35 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7840
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From48 {
                            value = "Ia1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9232, 8608
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag From49 {
                            value = "Ib1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9232, 8656
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag From50 {
                            value = "Ic1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9232, 8704
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag Goto36 {
                            value = "Id1"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9472, 8608
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto37 {
                            value = "Iq1"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8752
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto38 {
                            value = "Q1"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8888, 8680
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto39 {
                            value = "P1"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8888, 8616
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From51 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8576, 8680
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From52 {
                            value = "Id1"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8576, 8744
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From53 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8576, 8616
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From54 {
                            value = "Iq1"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8576, 8808
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction123 sp
                        [
                            position = 9480, 8336
                        ]

                        junction Junction124 sp
                        [
                            position = 9480, 8480
                        ]

                        junction Junction164 sp
                        [
                            position = 9816, 8064
                        ]

                        junction Junction165 sp
                        [
                            position = 9816, 8480
                        ]

                        junction Junction167 sp
                        [
                            position = 9176, 8480
                        ]

                        junction Junction173 sp
                        [
                            position = 9432, 8336
                        ]

                        junction Junction174 sp
                        [
                            position = 9432, 8480
                        ]

                        junction Junction176 sp
                        [
                            position = 9632, 7880
                        ]

                        junction Junction177 sp
                        [
                            position = 7728, 8464
                        ]

                        junction Junction179 sp
                        [
                            position = 9488, 8064
                        ]

                        junction Junction180 sp
                        [
                            position = 9488, 8208
                        ]

                        junction Junction181 sp
                        [
                            position = 8920, 8136
                        ]

                        junction Junction182 sp
                        [
                            position = 8920, 8216
                        ]

                        junction Junction183 sp
                        [
                            position = 9112, 8480
                        ]

                        junction Junction184 sp
                        [
                            position = 8576, 7920
                        ]

                        junction Junction186 sp
                        [
                            position = 8000, 8152
                        ]

                        junction Junction187 sp
                        [
                            position = 8472, 8320
                        ]

                        junction Junction188 sp
                        [
                            position = 9192, 7648
                        ]

                        junction Junction189 sp
                        [
                            position = 9192, 7712
                        ]

                        junction Junction190 sp
                        [
                            position = 9192, 7776
                        ]

                        junction Junction191 sp
                        [
                            position = 9192, 7840
                        ]

                        junction Junction192 sp
                        [
                            position = 8912, 8376
                        ]

                        junction Junction193 sp
                        [
                            position = 8912, 8296
                        ]

                        junction Junction194 sp
                        [
                            position = 8528, 8176
                        ]

                        junction Junction195 sp
                        [
                            position = 8624, 8416
                        ]

                        junction Junction196 sp
                        [
                            position = 9176, 8520
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Apv = P/(n*G)</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">A_pv = area in m²</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = power in W</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">n = efficiency</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">G = W/m²    </p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Example: A PV Area can be calculated</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">to have a generation of 5MVA with a</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">PV efficiency of 20% and average </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">insolation of 4.5kWh/m²/day</p></body></html> ENDCOMMENT 
                        [
                            position = 7976, 7760
                        ]

                        connect Constant1.out "Signal switch2.in1" as Connection423
                        connect Constant2.out "Signal switch3.in1" as Connection424
                        connect Constant3.out Limit_PQref.Smax as Connection571
                        connect ControlSignal_Calculation.VDC Gain3.out as Connection297
                        connect ControlSignal_Calculation.Id_ref Junction179 as Connection463
                        connect ControlSignal_Calculation.Iq_ref Junction180 as Connection466
                        connect Current_abc_to_dq.wt Junction167 as Connection370
                        connect Current_abc_to_dq.Id Junction173 as Connection396
                        connect Current_ref.Vq From3 as Connection475
                        connect Current_ref.Vd From4 as Connection474
                        connect Current_ref.Ird Junction179 as Connection465
                        connect Current_ref.Irq Junction180 as Connection468
                        connect Current_ref.Q_ref Limit_PQref.Qlim as Connection573
                        connect "Edge Detection1.Out1" ControlSignal_Calculation.Reset as Connection410
                        connect "Edge Detection1.In1" Junction176 as Connection427
                        connect From23 ControlSignal_Calculation.w as Connection246
                        connect From25 ControlSignal_Calculation.Vq as Connection248
                        connect From26 ControlSignal_Calculation.Vd as Connection249
                        connect From28 Junction177 as Connection431
                        connect From30 Limit_PQref.Pref as Connection574
                        connect From31 Power_Meas.Vq as Connection403
                        connect From32 Power_Meas.Vd as Connection402
                        connect From34 Power_Meas.Id as Connection404
                        connect From37 "Logical operator2.in1" as Connection470
                        connect From38 "Signal switch3.in2" as Connection422
                        connect From39 "Logical operator1.in" as Connection439
                        connect From40 "Signal switch2.in2" as Connection471
                        connect From42 Current_ref.Vt as Connection487
                        connect From44 Junction186 as Connection529
                        connect From45 Gain4.in as Connection531
                        connect From46 Gain2.in as Connection533
                        connect From47 Junction187 as Connection538
                        connect Gain3.in VDC as Connection298
                        connect Goto21 Junction194 as Connection560
                        connect Goto22 Junction173 as Connection398
                        connect Goto23 Junction174 as Connection401
                        connect Goto24 Junction176 as Connection425
                        connect Goto25 "Logical operator2.out" as Connection472
                        connect Goto26 Junction184 as Connection494
                        connect Goto32 Junction188 as Connection541
                        connect Goto33 Junction189 as Connection544
                        connect Goto34 Junction190 as Connection547
                        connect Goto35 Junction191 as Connection550
                        connect Ia Current_abc_to_dq.Ia as Connection282
                        connect Ib Current_abc_to_dq.Ib as Connection283
                        connect Ic Current_abc_to_dq.Ic as Connection284
                        connect Junction123 ControlSignal_Calculation.Id_meas as Connection74
                        connect Junction124 ControlSignal_Calculation.Iq_meas as Connection76
                        connect Junction124 Junction174 as Connection399
                        connect Junction164 ControlSignal_Calculation.Ud as Connection359
                        connect Junction165 ControlSignal_Calculation.Uq as Connection363
                        connect Junction167 Junction183 as Connection484
                        connect Junction173 Junction123 as Connection397
                        connect Junction174 Current_abc_to_dq.Iq as Connection400
                        connect Junction176 Enable as Connection426
                        connect Junction177 Sum1.in1 as Connection432
                        connect Junction179 Id_ref.in as Connection464
                        connect Junction180 Iq_ref.in as Connection467
                        connect Junction181 Goto4 as Connection477
                        connect Junction182 Goto3 as Connection481
                        connect Junction183 wt_in as Connection485
                        connect Junction184 Connected as Connection493
                        connect Junction186 irr_in.in as Connection528
                        connect Junction187 Qmode.in as Connection537
                        connect Junction188 Power_Meas.P as Connection540
                        connect Junction189 Power_Meas.Q as Connection543
                        connect Junction190 Power_Meas.S as Connection546
                        connect Junction191 Power_Meas.pf as Connection549
                        connect Junction192 Goto17 as Connection554
                        connect Junction193 Goto19 as Connection557
                        connect Junction194 Pref.in as Connection561
                        connect Junction195 Goto18 as Connection565
                        connect Limit_PQref.Plim Current_ref.P_ref as Connection572
                        connect Limit_PQref.Qref From27 as Connection575
                        connect "Logical operator1.out" PI_Vt.Reset as Connection521
                        connect "Logical operator2.in" delay.out as Connection505
                        connect P.in Junction188 as Connection539
                        connect PI_Vt.Out "Signal switch1.in1" as Connection519
                        connect PV_Area_m2.out Product2.in1 as Connection379
                        connect PV_eff.out to_pu.in as Connection390
                        connect Power_Meas.Iq From35 as Connection405
                        connect Product2.in Junction186 as Connection527
                        connect Product2.out PV_eff.in as Connection376
                        connect Q.in Junction189 as Connection542
                        connect Qref.in Junction195 as Connection564
                        connect S.in Junction190 as Connection545
                        connect "Signal switch1.in2" Junction187 as Connection536
                        connect "Signal switch1.out" Junction195 as Connection566
                        connect "Signal switch2.out" Junction194 as Connection562
                        connect "Signal switch2.in" to_pu.out as Connection413
                        connect "Signal switch3.in" Gain2.out as Connection419
                        connect "Signal switch3.out" "Signal switch1.in" as Connection420
                        connect "Signal switch4.in2" From43 as Connection518
                        connect "Signal switch4.in" Gain4.out as Connection429
                        connect "Signal switch4.in1" Junction177 as Connection433
                        connect "Signal switch4.out" Sum1.in as Connection430
                        connect Sum1.out PI_Vt.In as Connection330
                        connect Ud_c.in Junction164 as Connection358
                        connect Uq_c.in Junction165 as Connection362
                        connect V_d Junction181 as Connection476
                        connect V_q Junction182 as Connection480
                        connect Vd.in Junction181 as Connection478
                        connect Vq.in Junction182 as Connection482
                        connect Vt Junction193 as Connection556
                        connect Vt_pu.in Junction193 as Connection558
                        connect delay.in Junction184 as Connection506
                        connect id.in Junction123 as Connection186
                        connect iq.in Junction124 as Connection187
                        connect md Junction164 as Connection360
                        connect mq Junction165 as Connection364
                        connect pf.in Junction191 as Connection548
                        connect w Junction192 as Connection553
                        connect w_pu.in Junction192 as Connection555
                        connect wt From1 as Connection392
                        connect wt_pll.in Junction183 as Connection486
                        connect Junction167 Junction196 as Connection576
                        connect Junction196 Goto1 as Connection577
                        connect Current_abc_to_dq1.wt Junction196 as Connection578
                        connect From48 Current_abc_to_dq1.Ia as Connection579
                        connect From49 Current_abc_to_dq1.Ib as Connection580
                        connect From50 Current_abc_to_dq1.Ic as Connection581
                        connect Goto36 Current_abc_to_dq1.Id as Connection582
                        connect Goto37 Current_abc_to_dq1.Iq as Connection583
                        connect From51 Power_Meas1.Vq as Connection584
                        connect From53 Power_Meas1.Vd as Connection585
                        connect From52 Power_Meas1.Id as Connection586
                        connect Power_Meas1.Iq From54 as Connection596
                        connect Goto39 Power_Meas1.P as Connection597
                        connect Goto38 Power_Meas1.Q as Connection598
                    }
                    [
                        position = 7936, 7576
                        scale = -1, 1
                        size = 216, 264
                    ]

                    component Subsystem duty_cycle {
                        layout = dynamic
                        component gen_probe Da {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8112
                            rotation = left
                        ]

                        component gen_probe Db {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8184
                            rotation = left
                        ]

                        component gen_probe Dc {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8248
                            rotation = left
                        ]

                        component gen_probe Dz_A {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8112
                            rotation = left
                        ]

                        component gen_probe Dz_C {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8248
                            rotation = left
                        ]

                        component gen_probe Dz_B {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8184
                            rotation = left
                        ]

                        component Subsystem ZSM {
                            layout = dynamic
                            component src_constant Constant1 {
                                execution_rate = "inherit"
                                value = "k"
                            }
                            [
                                position = 7336, 8080
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "0"
                                upper_limit = "1"
                            }
                            [
                                position = 7408, 8080
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 7848, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8120
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8176
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "--+"
                            }
                            [
                                position = 7984, 8152
                                hide_name = True
                            ]

                            component gen_probe Z0 {
                            }
                            [
                                position = 8048, 8088
                                rotation = left
                            ]

                            component src_constant Constant3 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7672, 8128
                                hide_name = True
                            ]

                            component gen_minmax "Min Max1" {
                                inputs = "3"
                            }
                            [
                                position = 7584, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 7848, 8152
                                hide_name = True
                            ]

                            component gen_minmax "Min Max2" {
                                inputs = "3"
                                operation = "max"
                            }
                            [
                                position = 7584, 8256
                                hide_name = True
                            ]

                            component src_constant Constant2 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7656, 8288
                                hide_name = True
                            ]

                            component gen_sum Sum8 {
                                signs = "-+"
                            }
                            [
                                position = 7864, 8048
                                hide_name = True
                            ]

                            component src_constant Constant4 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7784, 8064
                                hide_name = True
                            ]

                            port Da {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Db {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dc {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_A {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_B {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8176
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_C {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8264
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From4 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8088
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From2 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7736, 8208
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From5 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8120, 8152
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From3 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From8 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8288
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From6 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8200
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7648, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto4 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8304
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From7 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8256
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8240
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From9 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7760, 8016
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction254 sp
                            [
                                position = 7480, 8144
                            ]

                            junction Junction255 sp
                            [
                                position = 7496, 8208
                            ]

                            junction Junction256 sp
                            [
                                position = 7512, 8272
                            ]

                            junction Junction257 sp
                            [
                                position = 7344, 8144
                            ]

                            junction Junction258 sp
                            [
                                position = 7344, 8208
                            ]

                            junction Junction259 sp
                            [
                                position = 7344, 8272
                            ]

                            junction Junction260 sp
                            [
                                position = 8048, 8152
                            ]

                            connect Constant1.out Limit1.in as Connection1425
                            connect Constant2.out Sum1.in1 as Connection1427
                            connect Constant3.out Sum2.in1 as Connection1434
                            connect Da Junction257 as Connection1474
                            connect Db Junction258 as Connection1477
                            connect Dc Junction259 as Connection1480
                            connect From1 Sum2.in as Connection1440
                            connect From2 Product1.in as Connection1441
                            connect From3 Sum5.in1 as Connection1446
                            connect From4 Sum5.in as Connection1487
                            connect From5 Sum6.in as Connection1489
                            connect From6 Sum6.in1 as Connection1488
                            connect From7 Sum7.in as Connection1493
                            connect From8 Sum7.in1 as Connection1492
                            connect Goto1 Limit1.out as Connection1439
                            connect Goto2 Junction257 as Connection1476
                            connect Goto3 Junction258 as Connection1479
                            connect Goto4 Junction259 as Connection1482
                            connect Goto5 Junction260 as Connection1486
                            connect Junction254 "Min Max2.in" as Connection1466
                            connect Junction255 "Min Max1.in1" as Connection1469
                            connect Junction256 "Min Max1.in2" as Connection1472
                            connect Junction257 Junction254 as Connection1475
                            connect Junction258 Junction255 as Connection1478
                            connect Junction259 Junction256 as Connection1481
                            connect Junction260 Sum3.out as Connection1485
                            connect "Min Max1.in" Junction254 as Connection1465
                            connect "Min Max2.in1" Junction255 as Connection1468
                            connect "Min Max2.in2" Junction256 as Connection1471
                            connect Product1.in1 Sum1.out as Connection1428
                            connect Product1.out Sum3.in2 as Connection1451
                            connect Product2.in1 "Min Max1.out" as Connection1430
                            connect Product2.out Sum3.in1 as Connection1450
                            connect Sum1.in "Min Max2.out" as Connection1426
                            connect Sum2.out Product2.in as Connection1435
                            connect Sum5.out Dz_A as Connection1447
                            connect Sum6.out Dz_B as Connection1490
                            connect Sum7.out Dz_C as Connection1491
                            connect Z0.in Junction260 as Connection1484
                            connect Constant4.out Sum8.in1 as Connection1495
                            connect From9 Sum8.in as Connection1496
                            connect Sum8.out Sum3.in as Connection1497

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                k {
                                    label = "Modulation type coefficent k"
                                    widget = edit
                                    type = generic
                                    default_value = "0.5"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                
                                ENDCODE
                            }
                        }
                        [
                            position = 7776, 8216
                            scale = -1, 1
                            size = 88, 168
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7560, 8088
                            rotation = right
                            size = 48, 80
                        ]

                        component gen_probe m_d {
                            addr = "8969"
                        }
                        [
                            position = 7512, 7888
                            rotation = right
                            scale = 1, -1
                        ]

                        component gen_probe m_q {
                            addr = "8967"
                        }
                        [
                            position = 7552, 7888
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant o_ref {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7512, 8008
                            hide_name = True
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "mod_lowLim"
                            upper_limit = "mod_upLim"
                        }
                        [
                            position = 7464, 7936
                            hide_name = True
                        ]

                        component gen_limiter Limit3 {
                            lower_limit = "-1.1546"
                            upper_limit = "1.1546"
                        }
                        [
                            position = 7464, 7984
                            hide_name = True
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 8032
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 7984
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 7936
                        ]

                        port m_a {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8152
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_b {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_c {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8280
                            rotation = down
                            scale = -1, 1
                        ]

                        junction Junction6 sp
                        [
                            position = 7856, 8280
                        ]

                        junction Junction7 sp
                        [
                            position = 7856, 8216
                        ]

                        junction Junction8 sp
                        [
                            position = 7856, 8152
                        ]

                        junction Junction9 sp
                        [
                            position = 7512, 7936
                        ]

                        junction Junction10 sp
                        [
                            position = 7552, 7984
                        ]

                        junction Junction11 sp
                        [
                            position = 7664, 8152
                        ]

                        junction Junction12 sp
                        [
                            position = 7664, 8216
                        ]

                        junction Junction13 sp
                        [
                            position = 7664, 8280
                        ]

                        connect Dz_A.in Junction8 as Connection2320
                        connect Dz_B.in Junction7 as Connection2317
                        connect Dz_C.in Junction6 as Connection2314
                        connect Junction6 ZSM.Dz_C as Connection2313
                        connect Junction7 m_b as Connection2316
                        connect Junction8 ZSM.Dz_A as Connection2319
                        connect ZSM.Dz_B Junction7 as Connection2315
                        connect m_a Junction8 as Connection2318
                        connect m_c Junction6 as Connection2312
                        connect "dq to abc1.d_input" Junction9 as Connection2328
                        connect Junction10 m_q.in as Connection2330
                        connect o_ref.out "dq to abc1.zero_input" as Connection2332
                        connect Limit3.out Junction10 as Connection2329
                        connect Junction9 Limit2.out as Connection2327
                        connect m_d.in Junction9 as Connection2326
                        connect "dq to abc1.q_input" Junction10 as Connection2331
                        connect ZSM.Da Junction11 as Connection2333
                        connect Junction11 Da.in as Connection2334
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_a" Junction11 as Connection2335
                        connect Db.in Junction12 as Connection2336
                        connect Junction12 ZSM.Db as Connection2337
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_b" Junction12 as Connection2338
                        connect Dc.in Junction13 as Connection2339
                        connect Junction13 ZSM.Dc as Connection2340
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_c" Junction13 as Connection2341
                        connect md Limit2.in as Connection2342
                        connect Limit3.in mq as Connection2343
                        connect wt "dq to abc1.wt" as Connection2344
                    }
                    [
                        position = 8216, 7576
                        scale = -1, 1
                        size = 96, 272
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8184
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8088
                            hide_name = True
                        ]

                        component gen_probe Vt_meas {
                        }
                        [
                            position = 8520, 8160
                            scale = 1, -1
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8160, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain5 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8168, 8320
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 8208, 8088
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8112, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8280
                            hide_name = True
                        ]

                        component gen_probe f_meas {
                        }
                        [
                            position = 8520, 8224
                        ]

                        component "core/Three phase PLL" PLL {
                            enable_pk = "True"
                            enable_sin = "False"
                            enable_zero = "False"
                            low_lim = "0"
                            rate_high = "5*fn"
                            rate_low = "-5*fn"
                            up_lim = "1.4*2*np.pi*fn"
                        }
                        [
                            position = 8064, 8184
                            size = 64, 128
                        ]

                        component src_constant Constant1 {
                            execution_rate = "inherit"
                            value = "0"
                        }
                        [
                            position = 7832, 8336
                            hide_name = True
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8016
                        ]

                        port Vd {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7920
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8168
                        ]

                        port Vq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7968
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8072
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8264
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8200
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7920, 7968
                            rotation = right
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8360
                        ]

                        tag Goto33 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8264, 8136
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8232, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8232
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From3 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8136
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From2 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto34 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7984, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8296
                        ]

                        junction Junction1 sp
                        [
                            position = 8208, 8136
                        ]

                        junction Junction5 sp
                        [
                            position = 7920, 8024
                        ]

                        junction Junction3 sp
                        [
                            position = 7888, 8200
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8272
                        ]

                        connect Goto34 Junction5 as Connection112
                        connect Junction1 Gain1.in as Connection83
                        connect Junction2 Goto32 as Connection87
                        connect PLL.peak Junction2 as Connection88
                        connect Junction3 "Signal switch1.in1" as Connection98
                        connect From4 "Signal switch3.in2" as Connection115
                        connect "Signal switch2.in1" Junction3 as Connection99
                        connect Vt Gain5.out as Connection56
                        connect From2 Vt_meas.in as Connection74
                        connect From1 f_meas.in as Connection73
                        connect PLL.vb "Signal switch2.out" as Connection92
                        connect Gain3.out Vq as Connection54
                        connect "Signal switch1.in" A as Connection89
                        connect Constant1.out Junction4 as Connection100
                        connect "Signal switch3.in1" Junction4 as Connection102
                        connect Gain5.in Junction2 as Connection86
                        connect Vd Gain4.out as Connection55
                        connect From3 "Signal switch2.in2" as Connection113
                        connect Gain1.out f as Connection27
                        connect Gain3.in PLL.q_axis as Connection81
                        connect Junction5 Connected as Connection111
                        connect Goto33 Junction1 as Connection82
                        connect "Signal switch3.out" PLL.vc as Connection114
                        connect "Signal switch1.in2" Junction5 as Connection110
                        connect "Signal switch3.in" C as Connection94
                        connect "Signal switch1.out" PLL.va as Connection91
                        connect PLL.theta wt as Connection85
                        connect B "Signal switch2.in" as Connection95
                        connect Junction4 Junction3 as Connection101
                        connect PLL.freq Junction1 as Connection84
                        connect PLL.d_axis Gain4.in as Connection80
                    }
                    [
                        position = 7432, 7568
                        size = 64, 176
                    ]

                    port Va {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7504
                    ]

                    port Vb {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7568
                    ]

                    port Vc {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7632
                    ]

                    port VDC {
                        position = top:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8024, 7392
                        rotation = right
                    ]

                    port Ic {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7688
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ib {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7712, 7656
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ia {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7624
                        rotation = down
                        scale = -1, 1
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7848, 7392
                        rotation = right
                    ]

                    port Connected {
                        position = top:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 7280
                        rotation = right
                    ]

                    port mc {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7688
                    ]

                    port mb {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7576
                    ]

                    port ma {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7464
                    ]

                    tag Goto14 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From16 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7528
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From17 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7560
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From18 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7592
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto13 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto10 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7568
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7504
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From14 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From15 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7496
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto15 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From19 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7360, 7440
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto16 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8008, 7320
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction1 sp
                    [
                        position = 7936, 7320
                    ]

                    connect Enable Grid_follow.Enable as Connection532
                    connect From14 Grid_follow.V_d as Connection480
                    connect From15 Grid_follow.V_q as Connection481
                    connect From16 Grid_follow.Vt as Connection482
                    connect From17 Grid_follow.w as Connection502
                    connect From18 Grid_follow.wt_in as Connection485
                    connect Goto16 Junction1 as Connection541
                    connect Grid_follow.Connected Junction1 as Connection543
                    connect Ia Grid_follow.Ia as Connection495
                    connect Ib Grid_follow.Ib as Connection496
                    connect Ic Grid_follow.Ic as Connection497
                    connect Junction1 Connected as Connection542
                    connect VDC Grid_follow.VDC as Connection487
                    connect duty_cycle.md Grid_follow.md as Connection544
                    connect duty_cycle.mq Grid_follow.mq as Connection545
                    connect duty_cycle.wt Grid_follow.wt as Connection546
                    connect ma duty_cycle.m_a as Connection547
                    connect mb duty_cycle.m_b as Connection548
                    connect mc duty_cycle.m_c as Connection549
                    connect PLL.A Va as Connection550
                    connect PLL.B Vb as Connection551
                    connect PLL.C Vc as Connection552
                    connect PLL.Vd Goto12 as Connection553
                    connect Goto13 PLL.Vq as Connection554
                    connect PLL.Vt Goto10 as Connection555
                    connect Goto14 PLL.f as Connection556
                    connect PLL.wt Goto15 as Connection557
                    connect PLL.Connected From19 as Connection558
                }
                [
                    position = 8176, 7888
                    size = 128, 208
                ]

                component "core/Three Phase Inverter" "3ph_inverter 1" {
                    carrier_freq = "fsw"
                    ctrl_src = "Internal modulator"
                    d_time = "1e-6"
                }
                [
                    position = 7736, 8248
                    size = 127, 256
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "12"
                    }
                    [
                        position = 8192, 8192
                        rotation = left
                        hide_name = True
                    ]

                    port Outputs {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8192, 8120
                        rotation = left
                    ]

                    port Connected {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8248
                    ]

                    port Inv_On {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8288
                    ]

                    port Va {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8328
                    ]

                    port Vb {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8368
                    ]

                    port Vc {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8408
                    ]

                    port Ia {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8496
                    ]

                    port Ib {
                        position = left:8
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8536
                    ]

                    port Ic {
                        position = left:9
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8576
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8648
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8456
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8624
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From31 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8672
                        hide_name = True
                        size = 60, 20
                    ]

                    connect "Bus Join1.in" Connected as Connection5
                    connect "Bus Join1.in6" Ia as Connection2
                    connect "Bus Join1.in7" Ib as Connection4
                    connect "Bus Join1.in8" Ic as Connection1
                    connect "Bus Join1.in1" Inv_On as Connection9
                    connect "Bus Join1.out" Outputs as Connection6
                    connect "Bus Join1.in2" Va as Connection8
                    connect "Bus Join1.in3" Vb as Connection3
                    connect "Bus Join1.in4" Vc as Connection7
                    connect From29 "Bus Join1.in5" as Connection10
                    connect From30 "Bus Join1.in10" as Connection12
                    connect From31 "Bus Join1.in11" as Connection13
                    connect From34 "Bus Join1.in9" as Connection11
                }
                [
                    position = 8584, 7728
                    rotation = left
                    size = 96, 152
                ]

                component "core/Signal Controlled Voltage Source" Vs2 {
                }
                [
                    position = 7320, 8248
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Current Measurement" Ia1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8960, 8152
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8960, 8248
                    size = 64, 32
                ]

                component "core/Current Measurement" Ic1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8960, 8344
                    size = 64, 32
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                }
                [
                    position = 9256, 8152
                    rotation = down
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                }
                [
                    position = 9256, 8248
                    rotation = down
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                }
                [
                    position = 9256, 8344
                    rotation = down
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7968, 7584
                    rotation = right
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8584, 7632
                    rotation = left
                ]

                tag From20 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7936
                    hide_name = True
                    size = 60, 20
                ]

                tag From9 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7840
                    hide_name = True
                    size = 60, 20
                ]

                tag From19 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7904
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto12 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8112
                    hide_name = True
                    size = 60, 20
                ]

                tag From29 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag From27 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From26 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 9072, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag From32 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7880
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto14 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag From34 {
                    value = "Ib1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7952
                    hide_name = True
                    size = 60, 20
                ]

                tag From30 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7904
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto5 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8520
                    hide_name = True
                    size = 60, 20
                ]

                tag From8 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag From31 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7856
                    hide_name = True
                    size = 60, 20
                ]

                tag From35 {
                    value = "Ia1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7928
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto15 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7624, 8256
                    hide_name = True
                    size = 60, 20
                ]

                tag From18 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "Ic1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7976
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag From10 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7872
                    hide_name = True
                    size = 60, 20
                ]

                tag From24 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7336, 8032
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto4 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8472
                    hide_name = True
                    size = 60, 20
                ]

                tag From23 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7336, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag From21 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto16 {
                    value = "Inv_On"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7664, 8000
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto13 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8208
                    hide_name = True
                    size = 60, 20
                ]

                tag From25 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8136, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From28 {
                    value = "Inv_On"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto17 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7888
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto3 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto18 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag From37 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7912
                    hide_name = True
                    size = 60, 20
                ]

                tag From38 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7888
                    hide_name = True
                    size = 60, 20
                ]

                tag From36 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7936
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto20 {
                    value = "Ia1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9032, 8104
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto21 {
                    value = "Ic1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9024, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto22 {
                    value = "Ib1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9032, 8208
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction70 pe
                [
                    position = 8328, 8624
                ]

                junction Junction78 pe
                [
                    position = 8536, 8624
                ]

                junction Junction88 pe
                [
                    position = 7544, 8152
                ]

                junction Junction89 pe
                [
                    position = 7544, 8344
                ]

                junction Junction115 pe
                [
                    position = 8416, 8624
                ]

                junction Junction116 pe
                [
                    position = 8480, 8624
                ]

                junction Junction119 pe
                [
                    position = 7848, 8152
                ]

                junction Junction120 pe
                [
                    position = 7848, 8248
                ]

                junction Junction121 pe
                [
                    position = 8248, 8152
                ]

                junction Junction123 pe
                [
                    position = 8328, 8248
                ]

                junction Junction125 pe
                [
                    position = 8416, 8344
                ]

                junction Junction127 pe
                [
                    position = 7472, 8152
                ]

                junction Junction132 sp
                [
                    position = 7608, 8040
                ]

                junction Junction134 sp
                [
                    position = 7432, 8032
                ]

                junction Junction135 sp
                [
                    position = 7584, 8040
                ]

                junction Junction136 pe
                [
                    position = 8480, 8152
                ]

                junction Junction138 pe
                [
                    position = 8536, 8248
                ]

                junction Junction140 pe
                [
                    position = 8592, 8344
                ]

                junction Junction142 pe
                [
                    position = 7472, 8344
                ]

                connect "3ph_inverter 1.InB" From37 as Connection793
                connect "3ph_inverter 1.a_in" Junction119 as Connection634
                connect "3ph_inverter 1.b_in" Junction120 as Connection637
                connect "3ph_inverter 1.c_in" L3.p_node as Connection640
                connect A S1.a_out as Connection694
                connect B S1.b_out as Connection698
                connect C S1.c_out as Connection696
                connect C1.p_node R7.n_node as Connection139
                connect C2.p_node R8.n_node as Connection144
                connect C3.n_node Junction115 as Connection618
                connect Ca1.n_node Junction142 as Connection797
                connect Control.Ic From21 as Connection493
                connect From10 Control.Vc as Connection487
                connect From18 Control.VDC as Connection489
                connect From19 Control.Ia as Connection491
                connect From20 Control.Ib as Connection492
                connect From23 delay.in as Connection734
                connect From24 Junction134 as Connection748
                connect From25 Control.Enable as Connection750
                connect From26 S1.ctrl_in as Connection753
                connect From27 Control.Connected as Connection754
                connect From28 Output.Inv_On as Connection761
                connect From30 Output.Vc as Connection764
                connect From31 Output.Va as Connection762
                connect From32 Output.Vb as Connection763
                connect From33 Output.Ic as Connection767
                connect From34 Output.Ib as Connection766
                connect From35 Output.Ia as Connection765
                connect From36 "3ph_inverter 1.InA" as Connection792
                connect From38 "3ph_inverter 1.InC" as Connection794
                connect From8 Control.Va as Connection485
                connect From9 Control.Vb as Connection486
                connect Goto1 Va.out as Connection367
                connect Goto12 Ia.out as Connection668
                connect Goto13 Ib.out as Connection669
                connect Goto14 Ic.out as Connection670
                connect Goto15 Vdc.out as Connection484
                connect Goto16 Junction135 as Connection758
                connect Goto17 Control.mb as Connection790
                connect Goto18 Control.mc as Connection791
                connect Goto3 Control.ma as Connection789
                connect Goto4 Vb.out as Connection368
                connect Goto5 Vc.out as Connection369
                connect Ia.n_node Junction121 as Connection671
                connect Ib.n_node Junction123 as Connection676
                connect Ic.p_node R0c.n_node as Connection667
                connect Iinv_in.n_node "3ph_inverter 1.pos_out" as Connection28
                connect Iinv_in.p_node Junction88 as Connection470
                connect Inputs Input.Inputs as Connection755
                connect Junction115 Junction116 as Connection622
                connect Junction115 Junction70 as Connection619
                connect Junction116 Va.n_node as Connection621
                connect Junction119 Vab.p_node as Connection635
                connect Junction120 Vab.n_node as Connection638
                connect Junction123 R8.p_node as Connection677
                connect Junction125 Ic.n_node as Connection682
                connect Junction127 Ca1.p_node as Connection689
                connect Junction132 "3ph_inverter 1.En" as Connection738
                connect Junction134 "Logical operator1.in" as Connection747
                connect Junction135 Junction132 as Connection757
                connect Junction140 Junction125 as Connection785
                connect Junction142 Junction89 as Connection798
                [
                    position = 0, 0
                ]
                connect Junction70 C2.n_node as Connection143
                connect Junction78 Junction116 as Connection620
                connect Junction88 Junction127 as Connection688
                connect Junction88 Vdc.p_node as Connection471
                connect Junction89 "3ph_inverter 1.neg_out" as Connection474
                connect L1.p_node Junction119 as Connection636
                connect L2.p_node Junction120 as Connection639
                connect L3.n_node R0c.p_node as Connection614
                connect L5.p_node R0a1.n_node as Connection652
                connect L6.p_node R0b1.n_node as Connection650
                connect "Logical operator1.out" Junction135 as Connection756
                connect On.in Junction132 as Connection739
                connect Output.Connected From29 as Connection760
                connect Outputs Output.Outputs as Connection759
                connect R0a.n_node Ia.p_node as Connection664
                connect R0a.p_node L1.n_node as Connection611
                connect R0b.n_node Ib.p_node as Connection662
                connect R0b.p_node L2.n_node as Connection613
                connect R0c1.n_node L4.p_node as Connection655
                connect R4.n_node Junction127 as Connection690
                connect R9.n_node C3.p_node as Connection145
                connect R9.p_node Junction125 as Connection681
                connect VDC.out Vs2.in as Connection800
                connect Va.p_node Junction136 as Connection774
                connect Vb.p_node Junction138 as Connection779
                connect Vb.n_node Junction78 as Connection363
                connect Vc.p_node Junction140 as Connection784
                connect Vc.n_node Junction78 as Connection617
                connect Vdc.n_node Junction89 as Connection473
                connect Vs2.n_node Junction142 as Connection799
                connect Vs2.p_node R4.p_node as Connection796
                connect delay.out "Logical operator1.in1" as Connection735
                connect enable.in Junction134 as Connection749
                connect C1.n_node Junction70 as Connection808
                [
                    breakpoints = 8248, 8624
                ]
                connect Junction121 R7.p_node as Connection809
                [
                    breakpoints = 8248, 8152; 8248, 8368
                ]
                connect S1.a_in Ia1.n_node as Connection816
                connect Ia1.p_node L5.n_node as Connection817
                connect Goto20 Ia1.out as Connection818
                connect S1.b_in Ib1.n_node as Connection821
                connect Ib1.p_node L6.n_node as Connection822
                connect S1.c_in Ic1.n_node as Connection823
                connect Ic1.p_node L4.n_node as Connection824
                connect Goto21 Ic1.out as Connection825
                connect Goto22 Ib1.out as Connection826
                connect R0c1.p_node Junction140 as Connection827
                [
                    breakpoints = 8632, 8344
                ]
                connect R0a1.p_node Junction136 as Connection829
                [
                    breakpoints = 8632, 8152
                ]
                connect R0b1.p_node Junction138 as Connection830
                [
                    breakpoints = 8632, 8248
                ]
                connect Junction136 Junction121 as Connection831
                [
                    breakpoints = 8480, 8152; 8424, 8152
                ]
                connect Junction123 Junction138 as Connection832
                [
                    breakpoints = 8328, 8248; 8424, 8248
                ]

                C = "5e-6"
                Id_Ki = "4"
                Id_Kp = "0.6079"
                Iq_Ki = "4"
                Iq_Kp = "0.6079"
                L = "3.04e-4 - L"
                L0 = "0.0333"
                R0 = "2e-3 - R"
                Rres = "2.5872"
                V_Ki = "0.7493"
                V_Kp = "0.0033"

                mask {
                    icon = "image(\'pv_plant.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">PV plant switching model. </p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Active power output is based on irradiation input. Reactive power output is based on terminal voltage control or direct reactive power setpoints. If the input \"Q_mode\" is high, the reactive power output will be set by the reference given in the input \"Q_ref\", else, the reactive power reference is based on the reference given in the input \"V_ref\".</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The number of inputs is 6 and of outputs is 12 and they are configured in the following order:</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Inputs: 0 - Connect; 1 - Enable; 2 - Irradiation; 3 - V_ref; 4 - Q_mode; 5 - Q_ref;</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q;</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                    help_file = "pv_plant.html"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    Sn {
                        label = "Nominal power"
                        widget = edit
                        type = generic
                        default_value = "10e3"
                        unit = "VA"
                        group = "1 - General"
                    }

                    fn {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    fsw {
                        label = "Inverter switching frequency"
                        widget = edit
                        type = generic
                        default_value = "10000.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    Vn_dc {
                        label = "Nominal DC voltage"
                        widget = edit
                        type = generic
                        default_value = "1000.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    PV_area {
                        label = "PV plant area"
                        widget = edit
                        type = generic
                        default_value = "100"
                        unit = "m²"
                        group = "1 - General"
                    }

                    PV_eff {
                        label = "PV plant efficiency"
                        widget = edit
                        type = generic
                        default_value = "15.0"
                        unit = "%"
                        group = "1 - General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts_pv"
                        unit = "s"
                        group = "1 - General"
                    }

                    L0 {
                        label = "Inverter side inductor"
                        widget = edit
                        type = generic
                        default_value = "6e-3"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    R0 {
                        label = "Inductors series resistors"
                        widget = edit
                        type = generic
                        default_value = "0.03"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    L {
                        label = "Grid side inductor"
                        widget = edit
                        type = generic
                        default_value = "0.3e-3"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    Rres {
                        label = "Shunt resistance"
                        widget = edit
                        type = generic
                        default_value = "15e-3"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    C {
                        label = "Shunt capacitor"
                        widget = edit
                        type = generic
                        default_value = "150e-6"
                        unit = "F"
                        group = "2 - Filter"
                    }

                    V_Kp {
                        label = "Voltage PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "0.1004"
                        group = "3 - Adv. 1"
                    }

                    V_Ki {
                        label = "Voltage PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "22.4784"
                        group = "3 - Adv. 1"
                    }

                    V_upLim {
                        label = "Voltage PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "4.0"
                        group = "3 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Voltage PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-4.0"
                        group = "3 - Adv. 1"
                    }

                    Id_Kp {
                        label = "d current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "0.6"
                        group = "4 - Adv. 2"
                    }

                    Id_Ki {
                        label = "d current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "60"
                        group = "4 - Adv. 2"
                    }

                    Id_upLim {
                        label = "d current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Adv. 2"
                    }

                    Id_lowLim {
                        label = "d current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "4 - Adv. 2"
                    }

                    Iq_Kp {
                        label = "q current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "0.6"
                        group = "5 - Adv. 3"
                    }

                    Iq_Ki {
                        label = "q current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "60"
                        group = "5 - Adv. 3"
                    }

                    Iq_upLim {
                        label = "q current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_lowLim {
                        label = "q current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "5 - Adv. 3"
                    }

                    Damp {
                        label = "d and q currents damping"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "6 - Adv. 4"
                    }

                    mod_upLim {
                        label = "Modulation signals upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.1546"
                        group = "6 - Adv. 4"
                    }

                    mod_lowLim {
                        label = "Modulation signals lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.1546"
                        group = "6 - Adv. 4"
                    }

                    Delay {
                        label = "Time delay to turn on after grid connection"
                        widget = edit
                        type = generic
                        default_value = "0.125"
                        unit = "s"
                        group = "6 - Adv. 4"
                    }

                    powerRate {
                        label = "Maximum power reference change rate"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "pu/s"
                        group = "6 - Adv. 4"
                    }

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, "pv_plant.svg")
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7968, 8152
                size = 353, 239
            ]

            component src_constant Constant2 {
                execution_rate = "Ts_pv"
                value = "480"
            }
            [
                position = 7472, 8000
                hide_name = True
            ]

            component gen_bus_split "Bus Split1" {
                outputs = "12"
            }
            [
                position = 8272, 7792
                hide_name = True
            ]

            component gen_probe P {
            }
            [
                position = 8392, 7864
            ]

            component gen_probe Q {
            }
            [
                position = 8392, 7920
            ]

            component gen_probe SI {
            }
            [
                position = 7320, 8144
                scale = -1, 1
            ]

            component Subsystem "Solar irradiance" {
                layout = dynamic
                component gen_c_function "C function2" {
                    global_variables = "real k;"
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "GHI inherit;ETR inherit"
                    in_terminal_labels = "[(\'GHI\', True), (\'ETR\', True)]"
                    in_terminal_properties = "real GHI;real ETR;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit;inherit"
                    out_terminal_dimensions_str = "f inherit;Gdh inherit"
                    out_terminal_labels = "[(\'f\', True), (\'Gdh\', True)]"
                    out_terminal_properties = "real f;real Gdh;"
                    output_fnc = "/*Begin code section*/
if (k<=0.21) f = 0.995-0.081*k;
else if (k>0.76) f = 0.18;
else f = 0.724 + 2.738*k - 8.321*k*k + 4.967*k*k*k;
Gdh = f*GHI;
/*End code section*/"
                    update_fnc = "/*Begin code section*/
k = GHI/ETR;
/*End code section*/"
                }
                [
                    position = 7480, 7976
                    hide_name = True
                    size = 56, 72
                ]

                component src_constant Constant9 {
                    execution_rate = "Ts_pv"
                    value = "GHI"
                }
                [
                    position = 7024, 7920
                    hide_name = True
                ]

                component src_constant Constant10 {
                    execution_rate = "Ts_pv"
                    value = "ETR"
                }
                [
                    position = 7024, 7960
                    hide_name = True
                ]

                component src_constant Constant11 {
                    execution_rate = "Ts_pv"
                    value = "ang"
                }
                [
                    position = 7024, 8000
                    hide_name = True
                ]

                component src_constant Constant12 {
                    execution_rate = "Ts_pv"
                    value = "ang_z"
                }
                [
                    position = 7024, 8040
                    hide_name = True
                ]

                component src_constant Constant13 {
                    execution_rate = "Ts_pv"
                    value = "ang_t"
                }
                [
                    position = 6888, 8016
                    hide_name = True
                ]

                component src_constant Constant14 {
                    execution_rate = "Ts_pv"
                    value = "rho"
                }
                [
                    position = 7024, 8128
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function1" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7904, 7960
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function2" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7904, 8016
                    hide_name = True
                ]

                component gen_sum Sum3 {
                    signs = "+-"
                }
                [
                    position = 7792, 7888
                    hide_name = True
                ]

                component gen_product Product2 {
                    signs = "**/"
                }
                [
                    position = 8040, 7920
                    hide_name = True
                ]

                component gen_sum Sum4 {
                    signs = "+-"
                }
                [
                    position = 7480, 8144
                    hide_name = True
                ]

                component gen_product Product3 {
                    signs = "***"
                }
                [
                    position = 7632, 8160
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function3" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7344, 8152
                    hide_name = True
                ]

                component src_constant Constant15 {
                    execution_rate = "Ts_pv"
                }
                [
                    position = 7336, 8096
                    hide_name = True
                ]

                component gen_product Product4 {
                }
                [
                    position = 7984, 8192
                    hide_name = True
                ]

                component gen_sum Sum5 {
                    signs = "+-"
                }
                [
                    position = 8088, 8168
                    hide_name = True
                ]

                component src_constant Constant17 {
                    execution_rate = "Ts_pv"
                }
                [
                    position = 7944, 8120
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function4" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7408, 8400
                    hide_name = True
                ]

                component gen_gain Gain1 {
                    gain = "0.5"
                }
                [
                    position = 7320, 8400
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function5" {
                }
                [
                    position = 7408, 8464
                    hide_name = True
                ]

                component gen_gain Gain2 {
                    gain = "0.5"
                }
                [
                    position = 7320, 8464
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function6" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7408, 8528
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function7" {
                }
                [
                    position = 7408, 8584
                    hide_name = True
                ]

                component gen_c_function "C function3" {
                    in_terminal_dimensions = "1;1;4"
                    in_terminal_dimensions_str = "Gdh 1;fk 1;x 4"
                    in_terminal_labels = "[(\'Gdh\', True), (\'fk\', True), (\'x\', True)]"
                    in_terminal_properties = "real Gdh;real fk;real x;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "1"
                    out_terminal_dimensions_str = "Gd 1"
                    out_terminal_labels = "[(\'Gd\', True)]"
                    out_terminal_properties = "real Gd;"
                    output_fnc = "/*Begin code section*/
Gd = Gdh*0.5*(1+x[0])*(1+fk*x[1]*x[1]*x[1])*(1+fk*x[2]*x[2]*x[3]*x[3]*x[3]);
/*End code section*/"
                }
                [
                    position = 7736, 8432
                    hide_name = True
                    size = 104, 128
                ]

                component gen_bus_join "Bus Join1" {
                    inputs = "4"
                }
                [
                    position = 7544, 8480
                ]

                component gen_sum Sum6 {
                    signs = "+++"
                }
                [
                    position = 8016, 8416
                    hide_name = True
                ]

                component gen_gain Gain3 {
                    gain = "0.5"
                }
                [
                    position = 7712, 8160
                    hide_name = True
                ]

                component src_scada_input ang_t {
                    def_value = "30"
                    execution_rate = "Ts_pv"
                    unit = "kVAr"
                }
                [
                    position = 6920, 8080
                ]

                component gen_gain Gain4 {
                    gain = "np.pi/180"
                }
                [
                    position = 7000, 8080
                    hide_name = True
                ]

                port SI {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8176, 8416
                ]

                tag From66 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 7960
                    hide_name = True
                    size = 37, 20
                ]

                tag From67 {
                    value = "ETR"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 7992
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto35 {
                    value = "f"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7608, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto36 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7608, 7992
                    hide_name = True
                    size = 60, 20
                ]

                tag From68 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7784, 7960
                    hide_name = True
                    size = 37, 20
                ]

                tag From69 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7784, 8016
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto37 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto38 {
                    value = "ETR"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto39 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8000
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto40 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8040
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto41 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto42 {
                    value = "rho"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8128
                    hide_name = True
                    size = 60, 20
                ]

                tag From70 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7696, 7880
                    hide_name = True
                    size = 37, 20
                ]

                tag From71 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7696, 7912
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto43 {
                    value = "Gb"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8152, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto44 {
                    value = "Gr"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7800, 8160
                    hide_name = True
                    size = 60, 20
                ]

                tag From74 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7480, 8200
                    hide_name = True
                    size = 37, 20
                ]

                tag From72 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7224, 8152
                    hide_name = True
                    size = 37, 20
                ]

                tag From75 {
                    value = "rho"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7480, 8232
                    hide_name = True
                    size = 37, 20
                ]

                tag From76 {
                    value = "f"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7864, 8184
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto45 {
                    value = "fk"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8216, 8168
                    hide_name = True
                    size = 60, 20
                ]

                tag From78 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7240, 8400
                    hide_name = True
                    size = 37, 20
                ]

                tag From79 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7288, 8528
                    hide_name = True
                    size = 37, 20
                ]

                tag From80 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7288, 8584
                    hide_name = True
                    size = 37, 20
                ]

                tag From81 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7544, 8368
                    hide_name = True
                    size = 37, 20
                ]

                tag From82 {
                    value = "fk"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7544, 8408
                    hide_name = True
                    size = 37, 20
                ]

                tag From83 {
                    value = "Gb"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7920, 8376
                    hide_name = True
                    size = 37, 20
                ]

                tag From84 {
                    value = "Gr"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7920, 8416
                    hide_name = True
                    size = 37, 20
                ]

                junction Junction1 sp
                [
                    position = 7920, 8184
                ]

                junction Junction2 sp
                [
                    position = 7272, 8400
                ]

                connect From66 "C function2.GHI" as Connection61
                connect From67 "C function2.ETR" as Connection62
                connect "C function2.f" Goto35 as Connection63
                connect "C function2.Gdh" Goto36 as Connection64
                connect Goto37 Constant9.out as Connection65
                connect Constant10.out Goto38 as Connection66
                connect Constant11.out Goto39 as Connection67
                connect Constant12.out Goto40 as Connection68
                connect Constant14.out Goto42 as Connection70
                connect From68 "Trigonometric function1.in" as Connection71
                connect From69 "Trigonometric function2.in" as Connection72
                connect From70 Sum3.in as Connection73
                connect From71 Sum3.in1 as Connection74
                connect Product2.in Sum3.out as Connection75
                connect Product2.in1 "Trigonometric function1.out" as Connection76
                connect "Trigonometric function2.out" Product2.in2 as Connection77
                connect Product2.out Goto43 as Connection78
                connect Product3.in Sum4.out as Connection83
                connect From72 "Trigonometric function3.in" as Connection79
                connect "Trigonometric function3.out" Sum4.in1 as Connection87
                connect Constant15.out Sum4.in as Connection88
                connect From74 Product3.in1 as Connection90
                [
                    breakpoints = 7528, 8200; 7528, 8160
                ]
                connect From75 Product3.in2 as Connection91
                [
                    breakpoints = 7560, 8232; 7560, 8176
                ]
                connect Constant17.out Sum5.in as Connection92
                connect From76 Junction1 as Connection94
                connect Junction1 Product4.in as Connection95
                connect Product4.in1 Junction1 as Connection96
                connect Product4.out Sum5.in1 as Connection97
                connect Sum5.out Goto45 as Connection98
                connect Gain1.out "Trigonometric function4.in" as Connection103
                connect Gain2.out "Trigonometric function5.in" as Connection104
                connect From79 "Trigonometric function6.in" as Connection105
                connect From80 "Trigonometric function7.in" as Connection106
                connect From78 Junction2 as Connection107
                connect Junction2 Gain1.in as Connection108
                connect Gain2.in Junction2 as Connection109
                connect "Trigonometric function4.out" "Bus Join1.in" as Connection110
                connect "Trigonometric function5.out" "Bus Join1.in1" as Connection111
                connect "Trigonometric function6.out" "Bus Join1.in2" as Connection112
                connect "Trigonometric function7.out" "Bus Join1.in3" as Connection113
                [
                    breakpoints = 7472, 8584; 7472, 8504
                ]
                connect From81 "C function3.Gdh" as Connection114
                connect From82 "C function3.fk" as Connection115
                connect "Bus Join1.out" "C function3.x" as Connection116
                connect "C function3.Gd" Sum6.in2 as Connection117
                connect From83 Sum6.in as Connection118
                connect From84 Sum6.in1 as Connection119
                connect SI Sum6.out as Connection120
                connect Product3.out Gain3.in as Connection121
                connect Gain3.out Goto44 as Connection122
                connect ang_t.out Gain4.in as Connection123
                connect Gain4.out Goto41 as Connection124
            }
            [
                position = 7136, 8048
                size = 96, 216
            ]

            component src_scada_input Q_ref_pv {
                def_value = "30"
                execution_rate = "Ts_pv"
                unit = "kVAr"
            }
            [
                position = 7472, 8048
            ]

            port A {
                position = right:1
                kind = pe
            }
            [
                position = 8384, 8056
                scale = -1, 1
            ]

            port B {
                position = right:2
                kind = pe
            }
            [
                position = 8384, 8152
                scale = -1, 1
            ]

            port C {
                position = right:3
                kind = pe
            }
            [
                position = 8384, 8248
                scale = -1, 1
            ]

            junction Junction1 sp
            [
                position = 7576, 7952
            ]

            junction Junction2 sp
            [
                position = 7576, 7968
            ]

            junction Junction4 sp
            [
                position = 7312, 8048
            ]

            connect "Bus Join1.out" "PV Plant.Inputs" as Connection4337
            connect Constant1.out Junction1 as Connection4339
            connect Junction1 "Bus Join1.in" as Connection4340
            connect "Bus Join1.in3" Constant2.out as Connection4342
            connect "Bus Join1.in1" Junction2 as Connection4343
            connect Junction2 Junction1 as Connection4344
            connect "Bus Join1.in4" Junction2 as Connection4345
            connect "Bus Split1.in" "PV Plant.Outputs" as Connection4347
            connect "Bus Join1.in2" Junction4 as Connection4354
            [
                breakpoints = 7504, 7960; 7312, 7960
            ]
            connect "Solar irradiance.SI" Junction4 as Connection4356
            connect Junction4 SI.in as Connection4357
            [
                breakpoints = 7312, 8048; 7312, 8048; 7408, 8048
            ]
            connect "Bus Split1.out10" P.in as Connection4364
            connect Q.in "Bus Split1.out11" as Connection4365
            connect Q_ref_pv.out "Bus Join1.in5" as Connection4366
            connect "PV Plant.A" A as Connection4367
            connect "PV Plant.B" B as Connection4368
            connect "PV Plant.C" C as Connection4369
        }
        [
            position = 5768, 8072
            size = 56, 64
        ]

        component "core/RL Section" "RL Section" {
            length_mile = "0.5"
            resistance_per_l_mile = "1e-2"
        }
        [
            position = 6400, 7512
            rotation = left
            scale = -1, 1
            size = 256, 56
        ]

        component Subsystem ESS1 {
            layout = dynamic
            component pas_capacitor Cc1 {
                capacitance = "C_s"
            }
            [
                position = 8320, 8352
                rotation = right
            ]

            component pas_resistor Rt0a1 {
                resistance = "R_s"
            }
            [
                position = 8160, 8256
                rotation = left
                scale = -1, 1
            ]

            component pas_resistor Ra1 {
                resistance = "R_o"
            }
            [
                position = 8920, 7904
            ]

            component "core/Current Measurement" Ia1 {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 9168, 7904
                size = 64, 32
            ]

            component gen_probe Ea_1 {
            }
            [
                position = 8496, 8176
            ]

            component pas_inductor L0b1 {
                inductance = "L_i"
            }
            [
                position = 7888, 8000
                rotation = down
            ]

            component "core/Voltage Measurement" Vc2 {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8000, 8480
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component pas_capacitor Cb1 {
                capacitance = "C_s"
            }
            [
                position = 8240, 8352
                rotation = right
            ]

            component Subsystem Controller {
                layout = dynamic
                component gen_product Product13 {
                }
                [
                    position = 7368, 8464
                    scale = -1, 1
                ]

                component gen_gain Gain4 {
                    gain = "1/T_m"
                }
                [
                    position = 6992, 8232
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_gain Gain15 {
                    gain = "S"
                }
                [
                    position = 7136, 8168
                    rotation = right
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_probe Q1 {
                }
                [
                    position = 7072, 8488
                    rotation = down
                ]

                component gen_gain Gain6 {
                    gain = "1/I_DQ"
                }
                [
                    position = 7856, 7816
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_integrator Integrator2 {
                }
                [
                    position = 6896, 8232
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_sum Sum1 {
                }
                [
                    position = 7192, 8224
                    scale = -1, 1
                ]

                component gen_gain Gain1 {
                    gain = "1/(2*np.pi)"
                }
                [
                    position = 8416, 8328
                    scale = -1, 1
                ]

                component gen_gain Gain13 {
                    gain = "1/T_m"
                }
                [
                    position = 7000, 8376
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_product Product12 {
                }
                [
                    position = 7368, 8376
                    scale = -1, 1
                ]

                component gen_gain Gain10 {
                    gain = "1/V_DQ"
                }
                [
                    position = 7864, 8520
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_gain Gain14 {
                    gain = "S"
                }
                [
                    position = 7136, 8456
                    rotation = right
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_bus_join "Bus Join1" {
                    inputs = "3"
                }
                [
                    position = 7200, 7952
                    scale = -1, 1
                ]

                component gen_gain Gain9 {
                    gain = "1/V_DQ"
                }
                [
                    position = 7856, 8392
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_integrator Integrator3 {
                }
                [
                    position = 6904, 8376
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_probe E_dREF1 {
                }
                [
                    position = 7568, 7848
                ]

                component src_constant Constant1 {
                    execution_rate = "Ts"
                    value = "0"
                }
                [
                    position = 7912, 8776
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_sum Sum2 {
                    signs = "+-"
                }
                [
                    position = 7192, 8368
                    scale = -1, 1
                ]

                component gen_product Product10 {
                }
                [
                    position = 7368, 8296
                    scale = -1, 1
                ]

                component Subsystem Current_abc_to_dq {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7856, 8008
                        size = 48, 80
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7952, 8064
                    ]

                    port Xi_d2 {
                        label = "Xi_d2"
                        position = left:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 7976
                    ]

                    port Xi_c2 {
                        label = "Xi_c2"
                        position = right:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8040
                    ]

                    port wt2 {
                        label = "wt2"
                        position = right:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8088
                    ]

                    port Xi_a2 {
                        label = "Xi_a2"
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 7960
                    ]

                    port Xi_q2 {
                        label = "Xi_q2"
                        position = left:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 8016
                    ]

                    port Xi_b2 {
                        label = "Xi_b2"
                        position = right:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8000
                    ]

                    connect Xi_c2 "abc to dq1.vc" as Connection3
                    connect "abc to dq1.q_axis" Xi_q2 as Connection6
                    connect "abc to dq1.d_axis" Xi_d2 as Connection5
                    connect wt2 "abc to dq1.wt" as Connection7
                    connect Xi_a2 "abc to dq1.va" as Connection1
                    connect Xi_b2 "abc to dq1.vb" as Connection2
                    connect Termination1.in "abc to dq1.zero_axis" as Connection4
                }
                [
                    position = 7936, 7880
                    size = 80, 168
                ]

                component gen_gain Gain7 {
                    gain = "1/I_DQ"
                }
                [
                    position = 7856, 7944
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_gain Gain12 {
                    gain = "1/I_DQ"
                }
                [
                    position = 7384, 8744
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_product Product111 {
                }
                [
                    position = 7368, 8216
                    scale = -1, 1
                ]

                component gen_sum Sum4 {
                    signs = "+-"
                }
                [
                    position = 7072, 8232
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_gain Gain11 {
                    gain = "1/I_DQ"
                }
                [
                    position = 7384, 8616
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_probe E_qREF1 {
                }
                [
                    position = 7568, 8056
                ]

                component Subsystem Current_abc_to_dq3 {
                    layout = dynamic
                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7952, 8064
                    ]

                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7856, 8008
                        size = 48, 80
                    ]

                    port "^Ec2" {
                        label = "^Ec2"
                        position = right:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8040
                    ]

                    port "^Ed2" {
                        label = "^Ed2"
                        position = left:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 7976
                    ]

                    port "^Eb2" {
                        label = "^Eb2"
                        position = right:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8000
                    ]

                    port "^Ea2" {
                        label = "^Ea2"
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 7960
                    ]

                    port wt2 {
                        label = "wt2"
                        position = right:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8088
                    ]

                    port "^Eq2" {
                        label = "^Eq2"
                        position = left:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 8016
                    ]

                    connect Termination1.in "abc to dq1.zero_axis" as Connection4
                    connect "abc to dq1.q_axis" "^Eq2" as Connection6
                    connect wt2 "abc to dq1.wt" as Connection7
                    connect "abc to dq1.d_axis" "^Ed2" as Connection5
                    connect "^Eb2" "abc to dq1.vb" as Connection2
                    connect "^Ea2" "abc to dq1.va" as Connection1
                    connect "^Ec2" "abc to dq1.vc" as Connection3
                }
                [
                    position = 7936, 8456
                    size = 80, 168
                ]

                component gen_probe f1 {
                }
                [
                    position = 8328, 8328
                    rotation = down
                ]

                component Subsystem Current_abc_to_dq4 {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7856, 8008
                        size = 48, 80
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7952, 8064
                    ]

                    port wt2 {
                        label = "wt2"
                        position = right:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8088
                    ]

                    port "^Eq2" {
                        label = "^Eq2"
                        position = left:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 8016
                    ]

                    port "^Ea2" {
                        label = "^Ea2"
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 7960
                    ]

                    port "^Eb2" {
                        label = "^Eb2"
                        position = right:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8000
                    ]

                    port "^Ec2" {
                        label = "^Ec2"
                        position = right:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8040
                    ]

                    port "^Ed2" {
                        label = "^Ed2"
                        position = left:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 7976
                    ]

                    connect "abc to dq1.q_axis" "^Eq2" as Connection6
                    connect wt2 "abc to dq1.wt" as Connection7
                    connect "abc to dq1.d_axis" "^Ed2" as Connection5
                    connect "^Ea2" "abc to dq1.va" as Connection1
                    connect "^Ec2" "abc to dq1.vc" as Connection3
                    connect Termination1.in "abc to dq1.zero_axis" as Connection4
                    connect "^Eb2" "abc to dq1.vb" as Connection2
                }
                [
                    position = 7480, 8680
                    size = 80, 168
                ]

                component gen_sum Sum5 {
                    signs = "+-"
                }
                [
                    position = 7080, 8376
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_probe P1 {
                }
                [
                    position = 7080, 8136
                    rotation = down
                ]

                component Subsystem "Outer Voltage Loop + Inner Current Loop" {
                    layout = dynamic
                    component Subsystem "Outer voltage control loop" {
                        layout = dynamic
                        component gen_sum Sum12 {
                            signs = "++"
                        }
                        [
                            position = 7792, 8512
                            scale = -1, 1
                        ]

                        component gen_gain Gain4 {
                            gain = "C_s*Z_DQ"
                        }
                        [
                            position = 8248, 8352
                            scale = -1, 1
                        ]

                        component gen_sum Sum8 {
                            signs = "+-"
                        }
                        [
                            position = 8376, 8168
                            scale = -1, 1
                        ]

                        component gen_product Product8 {
                        }
                        [
                            position = 8144, 8808
                            scale = -1, 1
                        ]

                        component gen_sum Sum10 {
                            signs = "+-"
                        }
                        [
                            position = 7952, 8248
                            scale = -1, 1
                        ]

                        component gen_product Product6 {
                        }
                        [
                            position = 8152, 8320
                            scale = -1, 1
                        ]

                        component gen_sum Sum11 {
                            signs = "+-"
                        }
                        [
                            position = 8376, 8504
                            scale = -1, 1
                        ]

                        component gen_probe Ed_err {
                        }
                        [
                            position = 8376, 8104
                        ]

                        component gen_gain Gain6 {
                            gain = "C_s*Z_DQ"
                        }
                        [
                            position = 8248, 8840
                            scale = -1, 1
                        ]

                        component gen_pid_controller "PID controller4" {
                            controller_type = "PI"
                            enb_anti_windup_out = "True"
                            enb_output_limit_out = "True"
                            ki = "Ki_V"
                            kp = "Kp_V"
                            lower_sat_lim = "Vmin"
                            upper_sat_lim = "Vmax"
                        }
                        [
                            position = 8088, 8504
                            scale = -1, 1
                        ]

                        component gen_sum Sum13 {
                            signs = "++"
                        }
                        [
                            position = 7936, 8712
                            scale = -1, 1
                        ]

                        component gen_sum Sum9 {
                            signs = "++"
                        }
                        [
                            position = 7800, 8176
                            scale = -1, 1
                        ]

                        component gen_pid_controller "PID controller3" {
                            controller_type = "PI"
                            enb_anti_windup_out = "True"
                            enb_output_limit_out = "True"
                            execution_rate = "Ts"
                            ki = "Ki_V"
                            kp = "Kp_V"
                            lower_sat_lim = "Vmin"
                            upper_sat_lim = "Vmax"
                        }
                        [
                            position = 8112, 8104
                            scale = -1, 1
                        ]

                        component gen_probe Eq_err {
                        }
                        [
                            position = 8376, 8440
                        ]

                        component gen_probe ED_ctrl {
                        }
                        [
                            position = 8040, 8048
                        ]

                        component gen_probe EQ_ctrl {
                        }
                        [
                            position = 8000, 8456
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "[-1]"
                            upper_limit = "[1]"
                        }
                        [
                            position = 8200, 8104
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "[-1]"
                            upper_limit = "[1]"
                        }
                        [
                            position = 8168, 8504
                            hide_name = True
                            scale = -1, 1
                        ]

                        port Xi_rd {
                            position = auto:auto
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7696, 8176
                            scale = -1, 1
                        ]

                        port Xi_rq {
                            position = auto:auto
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7688, 8512
                            scale = -1, 1
                        ]

                        port "^E_q_ref" {
                            label = "^E_q_ref1"
                            position = auto:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8552, 8440
                            scale = -1, 1
                        ]

                        port "^E_d_ref" {
                            label = "^E_d_ref1"
                            position = auto:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 8104
                            scale = -1, 1
                        ]

                        port "^E_q" {
                            label = "^E_q1"
                            position = auto:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8600, 8512
                            scale = -1, 1
                        ]

                        port "^E_d" {
                            label = "^E_d1"
                            position = auto:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8616, 8176
                            scale = -1, 1
                        ]

                        tag From33 {
                            value = "w"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8280
                            scale = -1, 1
                        ]

                        tag From35 {
                            value = "w"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8768
                            scale = -1, 1
                        ]

                        tag From32 {
                            value = "Id"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8384, 8240
                            scale = -1, 1
                        ]

                        tag From36 {
                            value = "Iq"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8376, 8688
                            scale = -1, 1
                        ]

                        junction Junction174 sp
                        [
                            position = 7968, 8104
                        ]

                        junction Junction175 sp
                        [
                            position = 7960, 8496
                        ]

                        junction Junction176 sp
                        [
                            position = 8480, 8176
                        ]

                        junction Junction177 sp
                        [
                            position = 8448, 8512
                        ]

                        junction Junction178 sp
                        [
                            position = 8336, 8104
                        ]

                        junction Junction179 sp
                        [
                            position = 8336, 8504
                        ]

                        connect "^E_d_ref" Sum8.in as Connection215
                        connect Sum11.in "^E_q_ref" as Connection217
                        connect Sum13.in1 Product8.out as Connection233
                        connect From32 Sum10.in as Connection259
                        connect Gain6.out Product8.in1 as Connection84
                        connect From33 Product6.in as Connection68
                        connect Sum10.in1 Product6.out as Connection67
                        connect From36 Sum13.in as Connection260
                        connect From35 Product8.in as Connection79
                        connect Gain4.out Product6.in1 as Connection69
                        connect "PID controller3.out" Junction174 as Connection311
                        [
                            breakpoints = 8072, 8104
                        ]
                        connect Junction174 ED_ctrl.in as Connection312
                        [
                            breakpoints = 7968, 8104
                        ]
                        connect Sum9.in Junction174 as Connection313
                        connect EQ_ctrl.in Junction175 as Connection320
                        connect Junction175 "PID controller4.out" as Connection321
                        [
                            breakpoints = 7960, 8504; 7960, 8504; 8024, 8504
                        ]
                        connect Sum12.in Junction175 as Connection322
                        connect "PID controller3.in" Limit1.out as Connection331
                        connect Limit2.out "PID controller4.in" as Connection334
                        connect Gain6.in Junction176 as Connection340
                        connect Junction176 Sum8.in1 as Connection341
                        [
                            breakpoints = 8480, 8176
                        ]
                        connect "^E_d" Junction176 as Connection342
                        connect Gain4.in Junction177 as Connection344
                        connect Junction177 Sum11.in1 as Connection345
                        [
                            breakpoints = 8448, 8512
                        ]
                        connect "^E_q" Junction177 as Connection346
                        connect Ed_err.in Junction178 as Connection348
                        connect Junction178 Sum8.out as Connection349
                        [
                            breakpoints = 8336, 8168; 8336, 8168
                        ]
                        connect Limit1.in Junction178 as Connection350
                        connect Sum11.out Junction179 as Connection352
                        connect Junction179 Eq_err.in as Connection353
                        [
                            breakpoints = 8336, 8504
                        ]
                        connect Limit2.in Junction179 as Connection354
                        connect Xi_rq Sum12.out as Connection355
                        connect Xi_rd Sum9.out as Connection356
                        connect Sum9.in1 Sum10.out as Connection357
                        connect Sum12.in1 Sum13.out as Connection358
                    }
                    [
                        position = 8808, 8400
                        scale = -1, 1
                        size = 152, 168
                    ]

                    component gen_gain Gain5 {
                        gain = "V_DQ"
                    }
                    [
                        position = 8032, 8560
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_sum Sum7 {
                    }
                    [
                        position = 9176, 8552
                        scale = -1, 1
                    ]

                    component gen_sum Sum10 {
                        signs = "+-"
                    }
                    [
                        position = 9416, 8496
                        scale = -1, 1
                    ]

                    component gen_sum Sum11 {
                        signs = "+-"
                    }
                    [
                        position = 9424, 8192
                        scale = -1, 1
                    ]

                    component gen_gain Gain6 {
                        gain = "V_DQ"
                    }
                    [
                        position = 8064, 8624
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_gain Gain3 {
                        gain = "R_s/Z_DQ"
                    }
                    [
                        position = 9320, 8496
                        scale = -1, 1
                    ]

                    component gen_sum Sum8 {
                    }
                    [
                        position = 9208, 8232
                        scale = -1, 1
                    ]

                    component Subsystem "dq to abc" {
                        layout = dynamic
                        component src_constant o_ref {
                            execution_rate = "Ts"
                            value = "[0]"
                        }
                        [
                            position = 7520, 8200
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7744, 8184
                            size = 48, 80
                        ]

                        port c {
                            label = "c"
                            position = left:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8216
                        ]

                        port d {
                            label = "Ud1"
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7520, 8136
                        ]

                        port alpha {
                            label = "alpha1"
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7600, 8232
                        ]

                        port a {
                            label = "a"
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8152
                        ]

                        port q {
                            label = "Uq1"
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7472, 8168
                        ]

                        port b {
                            label = "b"
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7896, 8184
                        ]

                        connect q "dq to abc1.q_input" as Connection6
                        connect d "dq to abc1.d_input" as Connection3
                        connect "dq to abc1.phase_b" b as Connection4
                        connect c "dq to abc1.phase_c" as Connection2
                        connect a "dq to abc1.phase_a" as Connection1
                        connect o_ref.out "dq to abc1.zero_input" as Connection5
                        connect alpha "dq to abc1.wt" as Connection7
                    }
                    [
                        position = 7912, 8624
                        size = 80, 168
                    ]

                    component gen_gain Gain4 {
                        gain = "R_s/Z_DQ"
                    }
                    [
                        position = 9328, 8192
                        scale = -1, 1
                    ]

                    component Subsystem "inner current control loop" {
                        layout = dynamic
                        component gen_gain Gain7 {
                            gain = "L_i/Z_DQ"
                        }
                        [
                            position = 8272, 8592
                            scale = -1, 1
                        ]

                        component gen_sum Sum3 {
                        }
                        [
                            position = 7760, 8048
                            scale = -1, 1
                        ]

                        component gen_sum Sum5 {
                            signs = "+-"
                        }
                        [
                            position = 8024, 8104
                            scale = -1, 1
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 7760, 8400
                            scale = -1, 1
                        ]

                        component gen_sum Sum6 {
                        }
                        [
                            position = 8032, 8408
                            scale = -1, 1
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8168, 8560
                            scale = -1, 1
                        ]

                        component gen_gain Gain6 {
                            gain = "L_i/Z_DQ"
                        }
                        [
                            position = 8256, 8240
                            scale = -1, 1
                        ]

                        component gen_sum Sum8 {
                            signs = "+-"
                        }
                        [
                            position = 8432, 8040
                            scale = -1, 1
                        ]

                        component gen_sum Sum9 {
                            signs = "+-"
                        }
                        [
                            position = 8424, 8360
                            scale = -1, 1
                        ]

                        component gen_gain Gain5 {
                            gain = "[0.5]"
                        }
                        [
                            position = 7720, 8600
                            scale = -1, 1
                        ]

                        component gen_pid_controller "PID controller1" {
                            controller_type = "PI"
                            enb_output_limit_out = "True"
                            ki = "Ki_I/Z_DQ"
                            kp = "Kp_I/Z_DQ"
                            lower_sat_lim = "Imin"
                            upper_sat_lim = "Imax"
                        }
                        [
                            position = 8200, 8040
                            scale = -1, 1
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8168, 8208
                            scale = -1, 1
                        ]

                        component gen_probe id_err {
                        }
                        [
                            position = 8544, 7960
                        ]

                        component gen_probe iq_err {
                        }
                        [
                            position = 8560, 8272
                        ]

                        component gen_z_domain_transfer "Discrete Transfer Function1" {
                            a_coeff = "[1e-6,1]"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8144, 7920
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_z_domain_transfer "Discrete Transfer Function2" {
                            a_coeff = "[1e-6,1]"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8120, 8296
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_product Product5 {
                            signs = "*/"
                        }
                        [
                            position = 7600, 8056
                            scale = -1, 1
                        ]

                        component gen_product Product6 {
                            signs = "*/"
                        }
                        [
                            position = 7600, 8408
                            scale = -1, 1
                        ]

                        component gen_pid_controller "PID controller2" {
                            controller_type = "PI"
                            enb_output_limit_out = "True"
                            ki = "Ki_I/Z_DQ"
                            kp = "Kp_I/Z_DQ"
                            lower_sat_lim = "Imin"
                            upper_sat_lim = "Imax"
                        }
                        [
                            position = 8200, 8376
                            scale = -1, 1
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "[-1]"
                            upper_limit = "[1]"
                        }
                        [
                            position = 7488, 8056
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "[-1]"
                            upper_limit = "[1]"
                        }
                        [
                            position = 7472, 8408
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_z_domain_transfer LPF_dc {
                            a_coeff = "[1.0/(2*np.pi*1),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 7920, 8600
                            scale = -1, 1
                        ]

                        component gen_limiter Limit3 {
                            lower_limit = "10"
                        }
                        [
                            position = 7840, 8600
                            hide_name = True
                            scale = -1, 1
                        ]

                        port Uq1 {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7376, 8408
                            rotation = down
                        ]

                        port Xi_q_meas1 {
                            label = "Xi_q_meas1"
                            position = right:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8560, 8400
                            rotation = down
                        ]

                        port Xi_q_ref1 {
                            label = "Xi_q_ref1"
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8560, 8352
                            rotation = down
                        ]

                        port Ud1 {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7376, 8056
                            rotation = down
                        ]

                        port Xi_d_ref1 {
                            label = "Xi_d_ref1"
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 8032
                            rotation = down
                        ]

                        port Xi_d_meas1 {
                            label = "Xi_d_meas1"
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 8128
                            rotation = down
                        ]

                        tag From23 {
                            value = "w"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8272, 8176
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag From24 {
                            value = "Ed"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8240, 7920
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag From26 {
                            value = "Eq"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8208, 8296
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag From27 {
                            value = "VDC"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8016, 8600
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag From25 {
                            value = "w"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8288, 8536
                            scale = -1, 1
                            size = 60, 20
                        ]

                        junction Junction177 sp
                        [
                            position = 8504, 8128
                        ]

                        junction Junction176 sp
                        [
                            position = 8504, 8368
                        ]

                        junction Junction181 sp
                        [
                            position = 8288, 8040
                        ]

                        junction Junction182 sp
                        [
                            position = 7640, 8416
                        ]

                        junction Junction183 sp
                        [
                            position = 8288, 8360
                        ]

                        connect From23 Product1.in as Connection1
                        connect Sum5.in1 Product1.out as Connection24
                        connect Gain6.out Product1.in1 as Connection289
                        connect Junction177 Gain7.in as Connection300
                        connect Gain7.out Product2.in1 as Connection293
                        connect Xi_q_meas1 Junction176 as Connection290
                        connect Sum6.in1 Product2.out as Connection26
                        connect Junction176 Sum9.in1 as Connection291
                        connect Sum8.in1 Junction177 as Connection301
                        connect From25 Product2.in as Connection2
                        connect Sum8.in Xi_d_ref1 as Connection297
                        connect Sum9.in Xi_q_ref1 as Connection283
                        connect Gain6.in Junction176 as Connection292
                        connect Xi_d_meas1 Junction177 as Connection299
                        connect Sum8.out Junction181 as Connection313
                        connect Junction181 "PID controller1.in" as Connection314
                        [
                            breakpoints = 8288, 8040; 8240, 8040
                        ]
                        connect id_err.in Junction181 as Connection315
                        connect Sum3.in "PID controller1.out" as Connection316
                        [
                            breakpoints = 7896, 8040; 8160, 8040; 8160, 8040
                        ]
                        connect Sum5.in "Discrete Transfer Function1.out" as Connection318
                        [
                            breakpoints = 8088, 8096; 8088, 7920
                        ]
                        connect "Discrete Transfer Function1.in" From24 as Connection319
                        connect From26 "Discrete Transfer Function2.in" as Connection320
                        connect "Discrete Transfer Function2.out" Sum6.in as Connection321
                        connect Product5.in Sum3.out as Connection322
                        connect Product6.in Sum7.out as Connection324
                        connect Sum7.in1 Sum6.out as Connection326
                        connect Sum5.out Sum3.in1 as Connection327
                        connect Gain5.out Junction182 as Connection329
                        connect Junction182 Product6.in1 as Connection330
                        connect Product5.in1 Junction182 as Connection331
                        connect "PID controller2.out" Sum7.in as Connection346
                        connect Sum9.out Junction183 as Connection349
                        connect Junction183 iq_err.in as Connection350
                        [
                            breakpoints = 8288, 8360
                        ]
                        connect "PID controller2.in" Junction183 as Connection351
                        connect Product5.out Limit1.in as Connection352
                        connect Limit1.out Ud1 as Connection353
                        connect Product6.out Limit2.in as Connection354
                        connect Limit2.out Uq1 as Connection355
                        connect From27 LPF_dc.in as Connection356
                        connect LPF_dc.out Limit3.in as Connection357
                        connect Limit3.out Gain5.in as Connection358
                    }
                    [
                        position = 8176, 8592
                        size = 96, 184
                    ]

                    component gen_probe Xi_d_ref {
                    }
                    [
                        position = 8216, 8416
                        rotation = down
                    ]

                    component gen_probe Xi_q_ref {
                    }
                    [
                        position = 8256, 8768
                        rotation = down
                    ]

                    component gen_probe Ud {
                    }
                    [
                        position = 7912, 8456
                        scale = -1, 1
                    ]

                    component gen_probe Uq {
                    }
                    [
                        position = 7984, 8672
                        scale = -1, 1
                    ]

                    component gen_probe Eq_ref {
                    }
                    [
                        position = 9032, 8176
                        rotation = down
                    ]

                    component gen_probe Ed_ref {
                    }
                    [
                        position = 9016, 8544
                        rotation = down
                    ]

                    component gen_probe alpha {
                    }
                    [
                        position = 7984, 8768
                        scale = -1, 1
                    ]

                    component Subsystem "outer power loop" {
                        layout = dynamic
                        component sys_signal_switch "Signal switch1" {
                            threshold = "0.5"
                        }
                        [
                            position = 8256, 8328
                            scale = -1, -1
                        ]

                        component gen_comparator Comparator1 {
                        }
                        [
                            position = 8352, 8368
                            scale = -1, 1
                        ]

                        component gen_sum Sum3 {
                            signs = "+-"
                        }
                        [
                            position = 8232, 8072
                            scale = -1, 1
                        ]

                        component gen_product Product1 {
                            signs = "*/"
                        }
                        [
                            position = 8120, 8080
                            scale = -1, 1
                        ]

                        component gen_probe Et_sqr_res {
                        }
                        [
                            position = 8224, 8256
                        ]

                        component gen_product Product2 {
                            signs = "*/"
                        }
                        [
                            position = 8120, 8168
                            scale = -1, 1
                        ]

                        component gen_product Product4 {
                        }
                        [
                            position = 8440, 8080
                            scale = -1, 1
                        ]

                        component gen_sum Sum4 {
                        }
                        [
                            position = 8232, 8160
                            scale = -1, 1
                        ]

                        component gen_product Product5 {
                        }
                        [
                            position = 8440, 8152
                            scale = -1, 1
                        ]

                        component gen_product Product3 {
                        }
                        [
                            position = 8440, 8008
                            scale = -1, 1
                        ]

                        component src_constant Limit_zero {
                            execution_rate = "Ts"
                            value = "[0.1]"
                        }
                        [
                            position = 8464, 8408
                            scale = -1, 1
                        ]

                        component gen_product Product6 {
                        }
                        [
                            position = 8440, 8224
                            scale = -1, 1
                        ]

                        component src_constant one {
                            execution_rate = "Ts"
                            value = "[1]"
                        }
                        [
                            position = 8344, 8312
                            scale = -1, 1
                        ]

                        port Q_ref {
                            label = "Q_ref"
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8648, 8216
                            rotation = down
                        ]

                        port Eq {
                            label = "Eq"
                            position = right:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8648, 8000
                            rotation = down
                        ]

                        port Xi_rq {
                            label = "Xi_rq"
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8080
                            rotation = down
                        ]

                        port Et_p2 {
                            label = "Et^2"
                            position = right:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8600, 8360
                            rotation = down
                        ]

                        port Ed {
                            label = "Ed"
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8648, 8072
                            rotation = down
                        ]

                        port P_ref {
                            label = "P_ref"
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8648, 8144
                            rotation = down
                        ]

                        port Xi_rd {
                            label = "Xi_rd"
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8168
                            rotation = down
                        ]

                        junction Junction142 sp
                        [
                            position = 8528, 8072
                        ]

                        junction Junction143 sp
                        [
                            position = 8544, 8000
                        ]

                        junction Junction144 sp
                        [
                            position = 8408, 8360
                        ]

                        junction Junction147 sp
                        [
                            position = 8184, 8328
                        ]

                        junction Junction138 sp
                        [
                            position = 8160, 8176
                        ]

                        junction Junction139 sp
                        [
                            position = 8568, 8144
                        ]

                        junction Junction141 sp
                        [
                            position = 8560, 8216
                        ]

                        connect Product1.in Sum3.out as Connection23
                        connect Product6.in1 Junction143 as Connection36
                        connect Et_sqr_res.in Junction147 as Connection5
                        connect Product2.in1 Junction138 as Connection25
                        connect Product3.out Sum3.in as Connection28
                        connect Junction138 Product1.in1 as Connection9
                        connect Comparator1.in1 Junction144 as Connection1
                        connect Product6.out Sum4.in1 as Connection37
                        connect Product4.in1 Junction141 as Connection29
                        connect Limit_zero.out Comparator1.in2 as Connection19
                        connect Product4.in Junction142 as Connection30
                        connect Comparator1.out "Signal switch1.in2" as Connection2
                        connect Junction141 Q_ref as Connection11
                        connect "Signal switch1.in" Junction144 as Connection38
                        connect Product4.out Sum3.in1 as Connection31
                        connect Junction142 Ed as Connection12
                        connect Eq Junction143 as Connection3
                        connect Junction143 Product3.in as Connection13
                        connect "Signal switch1.out" Junction147 as Connection39
                        connect Product5.in Junction139 as Connection32
                        connect Product5.in1 Junction142 as Connection33
                        connect Product5.out Sum4.in as Connection34
                        connect one.out "Signal switch1.in1" as Connection40
                        connect Product6.in Junction141 as Connection35
                        connect Product2.in Sum4.out as Connection26
                        connect Product3.in1 Junction139 as Connection27
                        connect Junction138 Junction147 as Connection47
                        [
                            breakpoints = 8160, 8176; 8160, 8264
                        ]
                        connect P_ref Junction139 as Connection48
                        [
                            breakpoints = 8600, 8144
                        ]
                        connect Et_p2 Junction144 as Connection49
                        [
                            breakpoints = 8424, 8360
                        ]
                        connect Xi_rq Product1.out as Connection270
                        connect Xi_rd Product2.out as Connection271
                    }
                    [
                        position = 8840, 8784
                        size = 176, 128
                    ]

                    component Subsystem squared_Vt2 {
                        layout = dynamic
                        component gen_product Product1 {
                        }
                        [
                            position = 8208, 8160
                            scale = -1, 1
                        ]

                        component gen_sum Sum3 {
                        }
                        [
                            position = 8104, 8192
                            scale = -1, 1
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8208, 8232
                            scale = -1, 1
                        ]

                        port Et_p2 {
                            label = "Et^2"
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8032, 8192
                            rotation = down
                        ]

                        port Eq {
                            label = "Eq"
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8328, 8224
                            rotation = down
                        ]

                        port Ed {
                            label = "Ed"
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8328, 8152
                            rotation = down
                        ]

                        junction Junction137 sp
                        [
                            position = 8280, 8224
                        ]

                        junction Junction136 sp
                        [
                            position = 8280, 8152
                        ]

                        connect Junction137 Eq as Connection3
                        connect Product2.in Junction137 as Connection6
                        connect Sum3.in Product1.out as Connection8
                        connect Junction136 Ed as Connection1
                        connect Product1.in1 Junction136 as Connection4
                        connect Sum3.in1 Product2.out as Connection9
                        connect Product2.in1 Junction137 as Connection5
                        connect Sum3.out Et_p2 as Connection7
                        connect Junction136 Product1.in as Connection2
                    }
                    [
                        position = 8992, 8848
                        size = 48, 56
                    ]

                    component sys_signal_switch "Signal switch2" {
                        criterion = "ctrl != threshold"
                        threshold = "1"
                    }
                    [
                        position = 8496, 8576
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_bus_join "Bus Join1" {
                    }
                    [
                        position = 8616, 8400
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_bus_split "Bus Split1" {
                    }
                    [
                        position = 8392, 8576
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_bus_join "Bus Join2" {
                    }
                    [
                        position = 8616, 8776
                        hide_name = True
                        scale = -1, 1
                    ]

                    component src_scada_input GFM_mode {
                        execution_rate = "Ts"
                        format = "int"
                        max = "1"
                        min = "0"
                        signal_type = "int"
                        unit = ""
                    }
                    [
                        position = 8536, 8856
                        rotation = left
                    ]

                    component gen_logic_op "Logical operator1" {
                        operator = "OR"
                    }
                    [
                        position = 8496, 8720
                        rotation = left
                        hide_name = True
                    ]

                    port Ua {
                        position = left:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7824, 8560
                        rotation = down
                    ]

                    port E_q_ref1 {
                        label = "E_q_ref1"
                        position = right:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 9472, 8304
                        rotation = down
                    ]

                    port Uc {
                        position = left:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7824, 8688
                        rotation = down
                    ]

                    port E_d_ref1 {
                        label = "E_d_ref1"
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 9456, 8632
                        rotation = down
                    ]

                    port Ub {
                        position = left:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7824, 8624
                        rotation = down
                    ]

                    tag From36 {
                        value = "E_q1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8992, 8416
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Xi_d1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8288, 8568
                        scale = -1, 1
                    ]

                    tag From40 {
                        value = "Xi_q1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9536, 8232
                        rotation = down
                    ]

                    tag From38 {
                        value = "Id"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9536, 8448
                        rotation = down
                        size = 56, 20
                    ]

                    tag From1 {
                        value = "wt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8176, 8728
                        scale = -1, 1
                        size = 63, 25
                    ]

                    tag From30 {
                        value = "Xi_q1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8288, 8664
                        scale = -1, 1
                    ]

                    tag From31 {
                        value = "Iq"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9536, 8152
                        rotation = down
                    ]

                    tag From39 {
                        value = "Xi_d1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9536, 8544
                        rotation = down
                    ]

                    tag From37 {
                        value = "E_d1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8992, 8464
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From20 {
                        value = "Ed"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9152, 8784
                        hide_name = True
                        scale = -1, 1
                        size = 67, 20
                    ]

                    tag From41 {
                        value = "Eq"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9152, 8816
                        hide_name = True
                        scale = -1, 1
                        size = 67, 20
                    ]

                    tag From42 {
                        value = "Pref"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9064, 8728
                        hide_name = True
                        scale = -1, 1
                        size = 67, 20
                    ]

                    tag From43 {
                        value = "Qref"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9064, 8760
                        hide_name = True
                        scale = -1, 1
                        size = 67, 20
                    ]

                    tag From44 {
                        value = "Island"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8480, 8864
                        rotation = left
                        hide_name = True
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag Goto21 {
                        value = "GFM_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8400, 8664
                        scale = -1, 1
                    ]

                    junction Junction3 sp
                    [
                        position = 7984, 8560
                    ]

                    junction Junction4 sp
                    [
                        position = 8032, 8624
                    ]

                    junction Junction7 sp
                    [
                        position = 9112, 8232
                    ]

                    junction Junction9 sp
                    [
                        position = 8080, 8728
                    ]

                    junction Junction10 sp
                    [
                        position = 8296, 8520
                    ]

                    junction Junction11 sp
                    [
                        position = 8336, 8616
                    ]

                    junction Junction12 sp
                    [
                        position = 9136, 8544
                    ]

                    junction Junction13 sp
                    [
                        position = 9064, 8784
                    ]

                    junction Junction14 sp
                    [
                        position = 9088, 8816
                    ]

                    junction Junction15 sp
                    [
                        position = 8496, 8664
                    ]

                    connect Sum11.out Gain4.in as Connection290
                    connect From31 Sum11.in as Connection293
                    connect From29 "inner current control loop.Xi_d_meas1" as Connection253
                    connect Sum7.in1 E_d_ref1 as Connection324
                    connect From30 "inner current control loop.Xi_q_meas1" as Connection257
                    connect Sum10.out Gain3.in as Connection287
                    connect "dq to abc.c" Uc as Connection284
                    connect "dq to abc.b" Ub as Connection282
                    connect Gain6.in "inner current control loop.Uq1" as Connection346
                    [
                        breakpoints = 8112, 8664
                    ]
                    connect From40 Sum11.in1 as Connection294
                    connect From39 Sum10.in1 as Connection286
                    connect E_q_ref1 Sum8.in1 as Connection344
                    connect "dq to abc.a" Ua as Connection283
                    connect Gain5.in "inner current control loop.Ud1" as Connection345
                    [
                        breakpoints = 8112, 8520
                    ]
                    connect Gain3.out Sum7.in as Connection289
                    connect Gain4.out Sum8.in as Connection343
                    connect From38 Sum10.in as Connection285
                    connect "dq to abc.d" Junction3 as Connection374
                    connect Junction3 Gain5.out as Connection375
                    connect Ud.in Junction3 as Connection376
                    connect "dq to abc.q" Junction4 as Connection377
                    connect Junction4 Gain6.out as Connection378
                    connect Uq.in Junction4 as Connection379
                    connect Sum8.out Junction7 as Connection398
                    connect Junction7 "Outer voltage control loop.^E_q_ref" as Connection399
                    [
                        breakpoints = 9112, 8232
                    ]
                    connect Eq_ref.in Junction7 as Connection400
                    connect From36 "Outer voltage control loop.^E_q" as Connection404
                    connect From37 "Outer voltage control loop.^E_d" as Connection405
                    connect "dq to abc.alpha" Junction9 as Connection406
                    [
                        breakpoints = 7968, 8728
                    ]
                    connect Junction9 From1 as Connection407
                    [
                        breakpoints = 8112, 8728
                    ]
                    connect alpha.in Junction9 as Connection408
                    connect squared_Vt2.Et_p2 "outer power loop.Et_p2" as Connection359
                    connect "Bus Join1.in" "Outer voltage control loop.Xi_rd" as Connection412
                    connect "Bus Join1.in1" "Outer voltage control loop.Xi_rq" as Connection413
                    connect Xi_d_ref.in Junction10 as Connection414
                    [
                        breakpoints = 8296, 8504
                    ]
                    connect Junction10 "inner current control loop.Xi_d_ref1" as Connection415
                    [
                        breakpoints = 8288, 8520
                    ]
                    connect "Bus Split1.out" Junction10 as Connection416
                    [
                        breakpoints = 8344, 8568; 8344, 8520
                    ]
                    connect "inner current control loop.Xi_q_ref1" Junction11 as Connection417
                    connect Junction11 Xi_q_ref.in as Connection418
                    [
                        breakpoints = 8336, 8632; 8336, 8632
                    ]
                    connect "Bus Split1.out1" Junction11 as Connection419
                    connect "Bus Join2.in" "outer power loop.Xi_rd" as Connection420
                    connect "Bus Join2.in1" "outer power loop.Xi_rq" as Connection421
                    connect "Signal switch2.in1" "Bus Join1.out" as Connection422
                    connect "Signal switch2.in" "Bus Join2.out" as Connection423
                    connect "Bus Split1.in" "Signal switch2.out" as Connection424
                    connect "Outer voltage control loop.^E_d_ref" Junction12 as Connection426
                    [
                        breakpoints = 9136, 8384; 9136, 8384
                    ]
                    connect Junction12 Sum7.out as Connection427
                    connect Ed_ref.in Junction12 as Connection428
                    connect From42 "outer power loop.P_ref" as Connection431
                    connect From43 "outer power loop.Q_ref" as Connection432
                    connect From20 Junction13 as Connection433
                    connect Junction13 "outer power loop.Ed" as Connection434
                    connect squared_Vt2.Ed Junction13 as Connection435
                    connect From41 Junction14 as Connection436
                    connect Junction14 "outer power loop.Eq" as Connection437
                    [
                        breakpoints = 9088, 8816; 9032, 8816
                    ]
                    connect squared_Vt2.Eq Junction14 as Connection438
                    connect "Logical operator1.in" From44 as Connection440
                    connect "Logical operator1.in1" GFM_mode.out as Connection441
                    connect "Logical operator1.out" Junction15 as Connection442
                    connect Junction15 "Signal switch2.in2" as Connection443
                    connect Goto21 Junction15 as Connection444
                }
                [
                    position = 7360, 7952
                    size = 128, 152
                ]

                component gen_limiter Limit1 {
                    lower_limit = "[-1]"
                    upper_limit = "[1]"
                }
                [
                    position = 7136, 7952
                    hide_name = True
                    scale = -1, 1
                ]

                component Subsystem "Frequency droop" {
                    layout = dynamic
                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 8160, 8120
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_sum Sum4 {
                        signs = "++"
                    }
                    [
                        position = 7880, 8216
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_gain Gain3 {
                        gain = "1/D_f"
                    }
                    [
                        position = 8088, 8120
                        hide_name = True
                        scale = -1, 1
                    ]

                    component src_clock Clock1 {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8112, 8168
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_c_function "C function1" {
                        in_terminal_dimensions = "1;1"
                        in_terminal_dimensions_str = "in 1;clk 1"
                        in_terminal_labels = "[(\'in\', True), (\'clk\', True)]"
                        in_terminal_properties = "real in;inherit clk;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', False)]"
                        output_fnc = "/*Begin code section*/
if (clk>120){
    out = in;
}
else{out=0;}
out = in;
/*End code section*/"
                    }
                    [
                        position = 8000, 8128
                        hide_name = True
                        scale = -1, 1
                        size = 48, 48
                    ]

                    component gen_c_function "C function2" {
                        global_variables = "real time;int connected;"
                        in_terminal_dimensions = "1;1;1"
                        in_terminal_dimensions_str = "in 1;clk 1;cnt 1"
                        in_terminal_labels = "[(\'in\', True), (\'clk\', True), (\'cnt\', True)]"
                        in_terminal_properties = "real in;inherit clk;inherit cnt;"
                        init_fnc = "/*Begin code section*/
connected = 0;
time = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', False)]"
                        output_fnc = "/*Begin code section*/
/*
if (connected>0 && clk<time+60){
    out = out + 0.001*(in-out);
}
else{out=in;}
*/
if (cnt>0) out = in;
else out = 2*3.14159265359*60;
/*End code section*/"
                        update_fnc = "/*Begin code section*/
if (connected<1 && cnt>0){
    time = clk;
}
if (cnt>0){connected = 1;}
/*End code section*/"
                    }
                    [
                        position = 7752, 8224
                        hide_name = True
                        scale = -1, 1
                        size = 48, 64
                    ]

                    component src_clock Clock2 {
                        execution_rate = "Ts"
                    }
                    [
                        position = 7880, 8272
                        hide_name = True
                        scale = -1, 1
                    ]

                    component "core/Rate Transition" "Rate Transition12" {
                        execution_rate = "Ts"
                        init_value = "0"
                    }
                    [
                        position = 8008, 8264
                        hide_name = True
                        scale = -1, 1
                        size = 32, 32
                    ]

                    component gen_c_function "C function3" {
                        execution_rate = "Tsync"
                        in_terminal_dimensions = "1;1;inherit"
                        in_terminal_dimensions_str = "del_w 1;INV_sync 1;Connect inherit"
                        in_terminal_labels = "[(\'del_w\', True), (\'INV_sync\', True), (\'Connect\', True)]"
                        in_terminal_properties = "real del_w;inherit INV_sync;inherit Connect;"
                        init_fnc = "/*Begin code section*/
wref = w_0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "wref inherit"
                        out_terminal_labels = "[(\'wref\', False)]"
                        out_terminal_properties = "real wref;"
                        output_fnc = "/*Begin code section*/
if (INV_sync) wref = wref + del_w;
if (Connect) wref = w_0;
/*End code section*/"
                        parameters = "real w_0;"
                    }
                    [
                        position = 8128, 8264
                        hide_name = True
                        scale = -1, 1
                        size = 64, 96
                    ]

                    port w1 {
                        label = "w1"
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7680, 8216
                        scale = -1, 1
                    ]

                    port U_P {
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8248, 8096
                        scale = -1, 1
                    ]

                    tag From17 {
                        value = "P1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8248, 8144
                        hide_name = True
                        scale = -1, 1
                    ]

                    tag theta_bus7 {
                        value = "del_w"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8256, 8240
                        hide_name = True
                        scale = -1, 1
                    ]

                    tag MT_ON2 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8256, 8288
                        hide_name = True
                        scale = -1, 1
                    ]

                    tag From44 {
                        value = "GFM_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7872, 8328
                        hide_name = True
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag MT_ON3 {
                        value = "INV_sync"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8256, 8264
                        hide_name = True
                        scale = -1, 1
                    ]

                    connect U_P Sum1.in as Connection368
                    connect From17 Sum1.in1 as Connection316
                    connect Gain3.in Sum1.out as Connection392
                    connect Clock1.out "C function1.clk" as Connection413
                    connect Sum4.in "C function1.out" as Connection414
                    connect Gain3.out "C function1.in" as Connection415
                    connect "C function2.in" Sum4.out as Connection416
                    connect "C function2.out" w1 as Connection417
                    connect Clock2.out "C function2.clk" as Connection418
                    [
                        breakpoints = 7832, 8272; 7832, 8224
                    ]
                    connect From44 "C function2.cnt" as Connection423
                    connect "Rate Transition12.out" Sum4.in1 as Connection424
                    connect "C function3.wref" "Rate Transition12.in" as Connection425
                    connect theta_bus7 "C function3.del_w" as Connection426
                    connect MT_ON3 "C function3.INV_sync" as Connection427
                    connect MT_ON2 "C function3.Connect" as Connection428
                }
                [
                    position = 8352, 8184
                    size = 96, 120
                ]

                component Subsystem "Voltage droop" {
                    layout = dynamic
                    component gen_sum Sum2 {
                        signs = "+-"
                    }
                    [
                        position = 8208, 8104
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_probe E_1 {
                    }
                    [
                        position = 7872, 8104
                    ]

                    component gen_gain Gain3 {
                        gain = "1/D_V"
                    }
                    [
                        position = 8128, 8104
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_sum Sum4 {
                    }
                    [
                        position = 7872, 8208
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_probe dQ {
                    }
                    [
                        position = 8216, 8040
                    ]

                    component gen_c_function "C function1" {
                        in_terminal_dimensions = "1;1"
                        in_terminal_dimensions_str = "in 1;clk 1"
                        in_terminal_labels = "[(\'in\', True), (\'clk\', True)]"
                        in_terminal_properties = "real in;inherit clk;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', False)]"
                        output_fnc = "/*Begin code section*/
if (clk>120){
    out = in;
}
else{out=0;}
out = in;
/*End code section*/"
                    }
                    [
                        position = 8016, 8112
                        hide_name = True
                        scale = -1, 1
                        size = 48, 48
                    ]

                    component src_clock Clock1 {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8128, 8152
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_c_function "C function2" {
                        global_variables = "real time;int connected;"
                        in_terminal_dimensions = "1;1;1"
                        in_terminal_dimensions_str = "in 1;clk 1;GFM 1"
                        in_terminal_labels = "[(\'in\', True), (\'clk\', True), (\'GFM\', True)]"
                        in_terminal_properties = "real in;inherit clk;inherit GFM;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', False)]"
                        output_fnc = "/*Begin code section*/
if (GFM>0) out = in;
else out = 1;
/*End code section*/"
                    }
                    [
                        position = 7640, 8224
                        hide_name = True
                        scale = -1, 1
                        size = 48, 64
                    ]

                    component src_clock Clock2 {
                        execution_rate = "Ts"
                    }
                    [
                        position = 7776, 8280
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_c_function "C function3" {
                        execution_rate = "Tsync"
                        in_terminal_dimensions = "1;1;inherit"
                        in_terminal_dimensions_str = "del_V 1;INV_sync 1;Connect inherit"
                        in_terminal_labels = "[(\'del_V\', True), (\'INV_sync\', True), (\'Connect\', True)]"
                        in_terminal_properties = "real del_V;inherit INV_sync;inherit Connect;"
                        init_fnc = "/*Begin code section*/
Vref = 1;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "Vref inherit"
                        out_terminal_labels = "[(\'Vref\', False)]"
                        out_terminal_properties = "real Vref;"
                        output_fnc = "/*Begin code section*/
if (INV_sync) Vref = Vref + del_V;
if (Connect) Vref = 1;
/*End code section*/"
                    }
                    [
                        position = 8048, 8280
                        hide_name = True
                        scale = -1, 1
                        size = 64, 96
                    ]

                    component "core/Rate Transition" "Rate Transition13" {
                        execution_rate = "Ts"
                    }
                    [
                        position = 7944, 8216
                        hide_name = True
                        scale = -1, 1
                        size = 32, 32
                    ]

                    port E_magnitude1 {
                        label = "E_magnitude1"
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7536, 8224
                        scale = -1, 1
                    ]

                    port Q_ref1 {
                        label = "Q_ref1"
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8352, 8080
                        scale = -1, 1
                    ]

                    tag From18 {
                        value = "Q1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8352, 8128
                        hide_name = True
                        scale = -1, 1
                    ]

                    tag MT_ON1 {
                        value = "INV_sync"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8184, 8280
                        hide_name = True
                        scale = -1, 1
                    ]

                    tag From44 {
                        value = "GFM_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7776, 8312
                        hide_name = True
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag MT_ON2 {
                        value = "del_V"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8184, 8256
                        hide_name = True
                        scale = -1, 1
                    ]

                    tag MT_ON3 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8184, 8304
                        hide_name = True
                        scale = -1, 1
                    ]

                    junction Junction2 sp
                    [
                        position = 8160, 8104
                    ]

                    junction Junction3 sp
                    [
                        position = 7808, 8208
                    ]

                    connect From18 Sum2.in1 as Connection323
                    connect Q_ref1 Sum2.in as Connection360
                    connect Gain3.in Junction2 as Connection406
                    connect Junction2 Sum2.out as Connection407
                    connect dQ.in Junction2 as Connection408
                    connect Clock1.out "C function1.clk" as Connection413
                    connect Sum4.in "C function1.out" as Connection414
                    connect "C function1.in" Gain3.out as Connection415
                    connect Clock2.out "C function2.clk" as Connection418
                    [
                        breakpoints = 7728, 8280; 7728, 8232
                    ]
                    connect "C function2.out" E_magnitude1 as Connection420
                    connect E_1.in Junction3 as Connection421
                    connect Junction3 Sum4.out as Connection422
                    [
                        breakpoints = 7808, 8208
                    ]
                    connect "C function2.in" Junction3 as Connection423
                    connect From44 "C function2.GFM" as Connection425
                    connect MT_ON2 "C function3.del_V" as Connection427
                    connect MT_ON1 "C function3.INV_sync" as Connection428
                    connect MT_ON3 "C function3.Connect" as Connection429
                    connect "C function3.Vref" "Rate Transition13.in" as Connection430
                    connect "Rate Transition13.out" Sum4.in1 as Connection431
                }
                [
                    position = 8352, 7944
                    size = 120, 96
                ]

                component Subsystem PLL {
                    layout = dynamic
                    component gen_gain Gain3 {
                        gain = "1/V_DQ"
                    }
                    [
                        position = 8160, 8080
                        rotation = left
                        hide_name = True
                    ]

                    component gen_gain Gain4 {
                        gain = "1/V_DQ"
                    }
                    [
                        position = 8112, 8080
                        rotation = left
                        hide_name = True
                    ]

                    component gen_probe f_meas {
                    }
                    [
                        position = 8520, 8224
                    ]

                    component "core/Three phase PLL" PLL {
                        enable_sin = "False"
                        enable_zero = "False"
                        low_lim = "0"
                        rate_high = "5*60"
                        rate_low = "-5*60"
                        up_lim = "1.4*2*np.pi*60"
                    }
                    [
                        position = 8064, 8184
                        size = 64, 128
                    ]

                    component gen_gain Gain5 {
                        gain = "2*np.pi"
                    }
                    [
                        position = 8208, 8080
                        rotation = left
                        hide_name = True
                    ]

                    port w {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8280, 8016
                    ]

                    port Vd {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8280, 7920
                    ]

                    port B {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7880, 8184
                    ]

                    port Vq {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8280, 7968
                    ]

                    port A {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7880, 8096
                    ]

                    port C {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7880, 8288
                    ]

                    port wt {
                        position = right:5
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8280, 8200
                    ]

                    tag Goto33 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8320, 8136
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From1 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8432, 8224
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction3 sp
                    [
                        position = 8208, 8136
                    ]

                    connect From1 f_meas.in as Connection73
                    connect Gain3.out Vq as Connection54
                    connect Vd Gain4.out as Connection55
                    connect Gain3.in PLL.q_axis as Connection81
                    connect PLL.theta wt as Connection85
                    connect PLL.d_axis Gain4.in as Connection80
                    connect A PLL.va as Connection89
                    connect B PLL.vb as Connection90
                    connect C PLL.vc as Connection91
                    connect Goto33 Junction3 as Connection93
                    [
                        breakpoints = 8264, 8136
                    ]
                    connect Junction3 PLL.freq as Connection94
                    [
                        breakpoints = 8208, 8136
                    ]
                    connect w Gain5.out as Connection95
                    connect Gain5.in Junction3 as Connection96
                }
                [
                    position = 7952, 8184
                    size = 64, 176
                ]

                port U_P {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8600, 8144
                    scale = -1, 1
                ]

                port U_Q {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8528, 7912
                    scale = -1, 1
                ]

                tag Goto29 {
                    value = "E_d1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7760, 8392
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From6 {
                    value = "Xi_b1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8088, 7856
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto19 {
                    value = "Id"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7304, 8616
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto37 {
                    value = "P1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 6808, 8232
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From24 {
                    value = "Ib1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7592, 8656
                    scale = -1, 1
                ]

                tag Goto47 {
                    value = "E_mag"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8512, 7976
                    hide_name = True
                ]

                tag From28 {
                    value = "wt"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8088, 7904
                    scale = -1, 1
                ]

                tag From42 {
                    value = "E_qR"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7568, 8008
                    scale = -1, 1
                ]

                tag Goto22 {
                    value = "Xi_d1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7744, 7816
                    scale = -1, 1
                ]

                tag From37 {
                    value = "Xi_d1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7568, 8256
                    scale = -1, 1
                ]

                tag From7 {
                    value = "Xi_c1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8088, 7944
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto28 {
                    value = "E_q1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7760, 8520
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto23 {
                    value = "Xi_q1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7744, 7944
                    scale = -1, 1
                ]

                tag From34 {
                    value = "E_c1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8064, 8520
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From36 {
                    value = "Ed"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7568, 8208
                    scale = -1, 1
                ]

                tag From26 {
                    value = "wt"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7592, 8704
                    scale = -1, 1
                ]

                tag From5 {
                    value = "Xi_a1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8088, 7816
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto20 {
                    value = "Iq"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7304, 8744
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From23 {
                    value = "Ia1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7592, 8616
                    scale = -1, 1
                ]

                tag From20 {
                    value = "E_dR"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7568, 7896
                    scale = -1, 1
                    size = 67, 20
                ]

                tag Goto45 {
                    value = "E_dR"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7760, 8648
                    scale = -1, 1
                    size = 64, 20
                ]

                tag Goto2 {
                    value = "modulator"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7064, 7952
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From33 {
                    value = "E_a1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8064, 8392
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From25 {
                    value = "Ic1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7592, 8744
                    scale = -1, 1
                ]

                tag From43 {
                    value = "E_mag"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7920, 8648
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto36 {
                    value = "Q1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 6808, 8376
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From32 {
                    value = "wt"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8064, 8480
                    scale = -1, 1
                ]

                tag Goto46 {
                    value = "E_qR"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7784, 8776
                    scale = -1, 1
                ]

                tag From35 {
                    value = "E_b1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8064, 8432
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From38 {
                    value = "Xi_q1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7568, 8472
                    scale = -1, 1
                ]

                tag From39 {
                    value = "Eq"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7568, 8400
                    scale = -1, 1
                ]

                tag Goto48 {
                    value = "w_e"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8672, 8328
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto49 {
                    value = "Pref"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8488, 8088
                    scale = -1, 1
                ]

                tag Goto50 {
                    value = "Qref"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8400, 7840
                    scale = -1, 1
                ]

                tag Goto14 {
                    value = "w"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8056, 8200
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto13 {
                    value = "Eq"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8056, 8168
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto12 {
                    value = "Ed"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8056, 8120
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto15 {
                    value = "wt"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8056, 8248
                    hide_name = True
                    size = 60, 20
                ]

                tag From44 {
                    value = "Eb1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7760, 8184
                    size = 60, 20
                ]

                tag From45 {
                    value = "Ea1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7760, 8144
                    size = 60, 20
                ]

                tag From46 {
                    value = "Ec1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7760, 8232
                    size = 60, 20
                ]

                junction Junction228 sp
                [
                    position = 7520, 8400
                ]

                junction Junction230 sp
                [
                    position = 7472, 8472
                ]

                junction Junction231 sp
                [
                    position = 7520, 7896
                ]

                junction Junction258 sp
                [
                    position = 7520, 8008
                ]

                junction Junction267 sp
                [
                    position = 7136, 8368
                ]

                junction Junction268 sp
                [
                    position = 7136, 8224
                ]

                junction Junction159 sp
                [
                    position = 7472, 8208
                ]

                junction Junction229 sp
                [
                    position = 7520, 8256
                ]

                junction Junction274 sp
                [
                    position = 6856, 8376
                ]

                junction Junction275 sp
                [
                    position = 6856, 8232
                ]

                junction Junction277 sp
                [
                    position = 8552, 8144
                ]

                junction Junction278 sp
                [
                    position = 8472, 7912
                ]

                junction Junction279 sp
                [
                    position = 8544, 8328
                ]

                connect From25 "Current_abc_to_dq4.^Ec2" as Connection699
                connect Gain10.in "Current_abc_to_dq3.^Eq2" as Connection875
                connect Junction231 From20 as Connection728
                connect Current_abc_to_dq4.wt2 From26 as Connection702
                connect Product111.in Junction159 as Connection703
                connect Sum4.in Junction268 as Connection955
                connect Junction228 From39 as Connection680
                connect Gain11.out Goto19 as Connection877
                connect Current_abc_to_dq.Xi_d2 Gain6.in as Connection864
                connect Gain13.out Integrator3.in as Connection925
                connect From7 Current_abc_to_dq.Xi_c2 as Connection40
                connect Sum1.in1 Product13.out as Connection719
                connect From6 Current_abc_to_dq.Xi_b2 as Connection39
                connect Junction231 "Outer Voltage Loop + Inner Current Loop.E_d_ref1" as Connection736
                connect "Current_abc_to_dq4.^Ea2" From23 as Connection701
                connect "Outer Voltage Loop + Inner Current Loop.Ua" "Bus Join1.in" as Connection839
                connect Goto23 Gain7.out as Connection962
                connect Product12.out Sum2.in1 as Connection721
                connect Sum5.in Junction267 as Connection952
                connect f1.in Gain1.out as Connection318
                connect E_dREF1.in Junction231 as Connection729
                [
                    breakpoints = 7520, 7848; 7520, 7896
                ]
                connect E_qREF1.in Junction258 as Connection861
                connect Product111.out Sum1.in as Connection684
                connect Product13.in Junction228 as Connection679
                connect Product12.in Junction159 as Connection720
                connect "Current_abc_to_dq4.^Eb2" From24 as Connection700
                connect "Outer Voltage Loop + Inner Current Loop.Uc" "Bus Join1.in2" as Connection840
                connect From43 Goto45 as Connection881
                connect Junction159 From36 as Connection698
                connect P1.in Gain15.out as Connection966
                connect Product10.out Sum2.in as Connection672
                connect Gain15.in Junction268 as Connection967
                connect Sum5.out Gain13.in as Connection926
                connect Q1.in Gain14.out as Connection968
                connect Product10.in Junction229 as Connection723
                connect "Current_abc_to_dq4.^Ed2" Gain11.in as Connection876
                connect Product12.in1 Junction230 as Connection678
                connect Junction229 From37 as Connection683
                connect Gain14.in Junction267 as Connection969
                connect Current_abc_to_dq.wt2 From28 as Connection247
                [
                    breakpoints = 8000, 7904; 8040, 7904
                ]
                connect Product10.in1 Junction228 as Connection681
                connect From35 "Current_abc_to_dq3.^Eb2" as Connection276
                connect "Bus Join1.in1" "Outer Voltage Loop + Inner Current Loop.Ub" as Connection838
                connect Gain6.out Goto22 as Connection961
                connect From42 Junction258 as Connection859
                connect From34 "Current_abc_to_dq3.^Ec2" as Connection279
                connect "Current_abc_to_dq3.^Ea2" From33 as Connection278
                connect Junction258 "Outer Voltage Loop + Inner Current Loop.E_q_ref1" as Connection860
                connect Junction230 From38 as Connection677
                connect Product13.in1 Junction230 as Connection676
                connect Sum4.out Gain4.in as Connection330
                connect Constant1.out Goto46 as Connection882
                connect From5 Current_abc_to_dq.Xi_a2 as Connection38
                connect Gain12.in "Current_abc_to_dq4.^Eq2" as Connection879
                connect Gain4.out Integrator2.in as Connection335
                connect From32 Current_abc_to_dq3.wt2 as Connection275
                connect Product111.in1 Junction229 as Connection682
                connect Goto20 Gain12.out as Connection878
                connect "Current_abc_to_dq3.^Ed2" Gain9.in as Connection872
                connect Goto28 Gain10.out as Connection874
                connect Current_abc_to_dq.Xi_q2 Gain7.in as Connection866
                connect Integrator3.out Junction274 as Connection1003
                connect Junction274 Sum5.in1 as Connection1004
                [
                    breakpoints = 6856, 8376; 6856, 8376; 6856, 8376; 6856, 8376; 6856, 8376; 6856, 8424; 7120, 8424
                ]
                connect Goto36 Junction274 as Connection1005
                connect Integrator2.out Junction275 as Connection1006
                connect Junction275 Sum4.in1 as Connection1007
                [
                    breakpoints = 6856, 8232; 6856, 8232; 6856, 8232; 6856, 8280; 7112, 8280
                ]
                connect Goto37 Junction275 as Connection1008
                connect Junction267 Sum2.out as Connection1014
                [
                    breakpoints = 7136, 8368; 7152, 8368
                ]
                connect Junction268 Sum1.out as Connection1013
                [
                    breakpoints = 7136, 8224; 7152, 8224
                ]
                connect Goto2 Limit1.out as Connection1017
                connect Limit1.in "Bus Join1.out" as Connection1018
                connect "Voltage droop.E_magnitude1" Goto47 as Connection1028
                connect "Frequency droop.U_P" Junction277 as Connection1033
                connect Junction277 U_P as Connection1034
                connect Goto49 Junction277 as Connection1035
                connect "Voltage droop.Q_ref1" Junction278 as Connection1036
                connect Junction278 U_Q as Connection1037
                connect Goto50 Junction278 as Connection1038
                connect Gain1.in Junction279 as Connection1044
                connect Junction279 Goto48 as Connection1045
                [
                    breakpoints = 8624, 8328
                ]
                connect "Frequency droop.w1" Junction279 as Connection1046
                connect Gain9.out Goto29 as Connection1047
                [
                    breakpoints = 7816, 8392
                ]
                connect PLL.Vd Goto12 as Connection553
                connect Goto13 PLL.Vq as Connection554
                connect Goto14 PLL.w as Connection556
                connect PLL.wt Goto15 as Connection557
                connect From45 PLL.A as Connection1041
                connect From44 PLL.B as Connection1042
                connect From46 PLL.C as Connection1043
            }
            [
                position = 6888, 7576
                size = 152, 144
            ]

            component pas_inductor L0c1 {
                inductance = "L_i"
            }
            [
                position = 7888, 8096
                rotation = down
            ]

            component pas_inductor L0a1 {
                inductance = "L_i"
            }
            [
                position = 7888, 7904
                rotation = down
            ]

            component pas_resistor Rt0b1 {
                resistance = "R_s"
            }
            [
                position = 8240, 8256
                rotation = left
                scale = -1, 1
            ]

            component "core/Voltage Measurement" Va2 {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7744, 8384
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component pas_inductor La1 {
                inductance = "L_o"
            }
            [
                position = 9016, 7904
                rotation = down
            ]

            component gen_bus_split "Bus Split1" {
                outputs = "3"
            }
            [
                position = 7384, 7776
                hide_name = True
            ]

            component gen_probe Ec_1 {
            }
            [
                position = 8656, 8400
            ]

            component "core/Signal Controlled Voltage Source" Vdc {
            }
            [
                position = 7104, 8000
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component pas_resistor Rt0c1 {
                resistance = "R_s"
            }
            [
                position = 8320, 8256
                rotation = left
                scale = -1, 1
            ]

            component pas_resistor R0b1 {
                resistance = "R_i"
            }
            [
                position = 7776, 8000
            ]

            component gen_probe Eb_1 {
            }
            [
                position = 8544, 8288
            ]

            component "core/Voltage Measurement" Vb2 {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7872, 8432
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Voltage Measurement" VaG {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 9336, 8216
                rotation = right
                size = 64, 32
            ]

            component pas_resistor Rc1 {
                resistance = "R_o"
            }
            [
                position = 8920, 8096
            ]

            component "core/Voltage Measurement" VbG {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 9464, 8288
                rotation = right
                size = 64, 32
            ]

            component pas_resistor R0c1 {
                resistance = "R_i"
            }
            [
                position = 7776, 8096
            ]

            component pas_inductor Lb1 {
                inductance = "L_o"
            }
            [
                position = 9016, 8000
                rotation = down
            ]

            component pas_resistor R0a1 {
                resistance = "R_i"
            }
            [
                position = 7776, 7904
            ]

            component "core/Current Measurement" Ic1 {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 9168, 8096
                size = 64, 32
            ]

            component "core/Voltage Measurement" Eb1 {
                addr = "9"
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8608, 8208
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Voltage Measurement" Ea1 {
                addr = "7"
                execution_rate = "Ts"
                feed_forward = "true"
                sig_output = "True"
            }
            [
                position = 8544, 8144
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" Xi_b1 {
                addr = "15"
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8032, 8000
                scale = 1, -1
                size = 64, 32
            ]

            component "core/Current Measurement" Ib1 {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 9168, 8000
                size = 64, 32
            ]

            component "core/Current Measurement" Xi_a1 {
                addr = "14"
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7984, 7904
                scale = 1, -1
                size = 64, 32
            ]

            component pas_capacitor Ca1 {
                capacitance = "C_s"
            }
            [
                position = 8160, 8352
                rotation = right
            ]

            component "core/Voltage Measurement" VcG {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 9584, 8408
                rotation = right
                size = 64, 32
            ]

            component "core/Voltage Measurement" Ec1 {
                addr = "11"
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8688, 8272
                rotation = right
                scale = -1, 1
                size = 64, 32
            ]

            component "core/Current Measurement" Xi_c1 {
                addr = "16"
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8096, 8096
                scale = 1, -1
                size = 64, 32
            ]

            component pas_inductor Lc1 {
                inductance = "L_o"
            }
            [
                position = 9016, 8096
                rotation = down
            ]

            component pas_resistor Rb1 {
                resistance = "R_o"
            }
            [
                position = 8920, 8000
            ]

            component Subsystem "BE1-25A Synchronizer" {
                layout = dynamic
                component gen_trigonometric "Trigonometric function2" {
                    trigonometric_fn = "atan2"
                }
                [
                    position = 7456, 8088
                    hide_name = True
                ]

                component gen_math_fnc "Mathematical function1" {
                    mathematical_fn = "sqrt"
                }
                [
                    position = 8312, 8224
                    hide_name = True
                ]

                component gen_limiter Limit2 {
                    lower_limit = "1e-12"
                }
                [
                    position = 7384, 8104
                    hide_name = True
                ]

                component src_constant Constant9 {
                    execution_rate = "Ts"
                    value = "3e-3"
                }
                [
                    position = 8456, 8224
                    hide_name = True
                ]

                component gen_c_function "BE1-25A Synchronizer1" {
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "dV inherit"
                    in_terminal_labels = "[(\'dV\', True)]"
                    in_terminal_properties = "real dV;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "del_V inherit"
                    out_terminal_labels = "[(\'del_V\', True)]"
                    out_terminal_properties = "real del_V;"
                    output_fnc = "/*Begin code section*/
del_V =0.01*dV;
/*End code section*/"
                    parameters = "real Ts;real maxV_slip;real minV_slip;real maxV_pds;"
                }
                [
                    position = 8488, 8616
                    hide_name = True
                    size = 96, 96
                ]

                component gen_abs Abs2 {
                }
                [
                    position = 8456, 8192
                    hide_name = True
                ]

                component src_scada_input "Connect INV" {
                    def_value = "1"
                    execution_rate = "Tsync"
                    format = "int"
                    max = "1"
                    min = "0"
                    signal_type = "int"
                    unit = ""
                }
                [
                    position = 8680, 8184
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 7440, 8600
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function1" {
                    trigonometric_fn = "atan2"
                }
                [
                    position = 7456, 8000
                    hide_name = True
                ]

                component gen_c_function "BE1-25A Synchronizer" {
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "df inherit;dAng inherit"
                    in_terminal_labels = "[(\'df\', True), (\'dAng\', True)]"
                    in_terminal_properties = "real df;real dAng;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "del_w inherit"
                    out_terminal_labels = "[(\'del_w\', True)]"
                    out_terminal_properties = "real del_w;"
                    output_fnc = "/*Begin code section*/
if (dAng>3.14159265359) dAng -= 2*3.14159265359;
if (dAng<-3.14159265359) dAng += 2*3.14159265359;
del_w = 0.01*dAng/Tsync+df;
if (del_w>0.1) del_w = 0.1;
else if (del_w<-0.1) del_w = -0.1;
/*End code section*/"
                    parameters = "real Ts;real maxw_pds;real maxw_slip;real minw_slip;real Tsync;"
                }
                [
                    position = 8184, 8392
                    hide_name = True
                    scale = 1, -1
                    size = 128, 112
                ]

                component gen_product Product1 {
                }
                [
                    position = 8160, 8192
                    hide_name = True
                ]

                component gen_sum Sum4 {
                }
                [
                    position = 8240, 8224
                    hide_name = True
                ]

                component gen_c_function "confine phase" {
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "in inherit"
                    in_terminal_labels = "[(\'in\', True)]"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "[(\'out\', True)]"
                    output_fnc = "/*Begin code section*/
if (in > 0)
{
    if (in > (6.283185307179586/2))
        out = in - 6.283185307179586;
    else
        out = in;
}
if (in < 0)
{
    if (in < (-6.283185307179586/2))
        out = in + 6.283185307179586;
    else
        out = in;
}
/*End code section*/"
                }
                [
                    position = 7824, 8048
                    size = 56, 48
                ]

                component gen_sum Sum5 {
                }
                [
                    position = 7344, 8352
                    hide_name = True
                ]

                component gen_probe frequency_diff3 {
                }
                [
                    position = 7920, 8128
                    scale = -1, 1
                ]

                component gen_product Product4 {
                }
                [
                    position = 7264, 8384
                    hide_name = True
                ]

                component gen_digital_probe "Digital Probe3" {
                    override_signal_name = "True"
                    signal_name = "ang_sync3"
                }
                [
                    position = 8616, 8040
                    hide_name = True
                ]

                component src_constant Constant7 {
                    execution_rate = "Ts"
                }
                [
                    position = 8088, 8112
                    hide_name = True
                ]

                component gen_sum Sum1 {
                    signs = "-+"
                }
                [
                    position = 7736, 8048
                    hide_name = True
                ]

                component gen_c_function "confine phase2" {
                    global_variables = "real x;real floor_in;"
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "in inherit"
                    in_terminal_labels = "[(\'in\', True)]"
                    init_fnc = "/*Begin code section*/
floor_in = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "[(\'out\', True)]"
                    output_fnc = "/*Begin code section*/
x = in/6.283185307179586;
floor_in = floor(x);
out = in - (6.283185307179586*floor_in);
/*End code section*/"
                }
                [
                    position = 7640, 8088
                    hide_name = True
                    size = 56, 48
                ]

                component gen_product Product3 {
                }
                [
                    position = 7264, 8320
                    hide_name = True
                ]

                component tm_delay "Unit Delay2" {
                }
                [
                    position = 7608, 8624
                    rotation = right
                    hide_name = True
                ]

                component gen_sum Sum2 {
                    signs = "-+"
                }
                [
                    position = 7824, 8200
                    hide_name = True
                ]

                component gen_rel_op "Relational operator1" {
                    relational_op = ">"
                }
                [
                    position = 8160, 8040
                    hide_name = True
                ]

                component gen_rel_op "Relational operator4" {
                    relational_op = "<"
                }
                [
                    position = 8520, 8208
                    hide_name = True
                ]

                component gen_abs Abs4 {
                }
                [
                    position = 8056, 8072
                    hide_name = True
                ]

                component gen_probe volt_diff3 {
                }
                [
                    position = 8448, 8512
                ]

                component src_constant Constant6 {
                    execution_rate = "Ts"
                    value = "1e-2"
                }
                [
                    position = 8056, 8032
                    hide_name = True
                ]

                component gen_digital_probe "Digital Probe1" {
                    override_signal_name = "True"
                    signal_name = "gridconnect2"
                }
                [
                    position = 9072, 8184
                    hide_name = True
                ]

                component gen_logic_op "Logical operator2" {
                    inputs = "4"
                    operator = "NOT"
                }
                [
                    position = 9008, 8224
                    rotation = right
                    hide_name = True
                ]

                component gen_product Product2 {
                }
                [
                    position = 8160, 8256
                    hide_name = True
                ]

                component gen_gain Gain6 {
                    gain = "1/V_DQ"
                }
                [
                    position = 7376, 8576
                    hide_name = True
                ]

                component gen_digital_probe "Digital Probe4" {
                    override_signal_name = "True"
                    signal_name = "freq_sync3"
                }
                [
                    position = 8616, 8008
                    hide_name = True
                ]

                component gen_digital_probe "Digital Probe5" {
                    override_signal_name = "True"
                    signal_name = "volt_sync3"
                }
                [
                    position = 8616, 8072
                    hide_name = True
                ]

                component gen_logic_op "Logical operator1" {
                    inputs = "3"
                }
                [
                    position = 8616, 8120
                    hide_name = True
                ]

                component gen_abs Abs5 {
                }
                [
                    position = 8056, 8128
                    hide_name = True
                ]

                component gen_probe angle_diff3 {
                }
                [
                    position = 8056, 7952
                ]

                component gen_sum Sum3 {
                    signs = "-+"
                }
                [
                    position = 8392, 8192
                    hide_name = True
                    scale = 1, -1
                ]

                component gen_gain Gain5 {
                    gain = "1/V_DQ"
                }
                [
                    position = 7336, 8552
                    hide_name = True
                ]

                component gen_rel_op "Relational operator2" {
                    relational_op = ">"
                }
                [
                    position = 8160, 8120
                    hide_name = True
                ]

                component gen_c_function "confine phase1" {
                    global_variables = "real x;real floor_in;"
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "in inherit"
                    in_terminal_labels = "[(\'in\', True)]"
                    init_fnc = "/*Begin code section*/
floor_in = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "[(\'out\', True)]"
                    output_fnc = "/*Begin code section*/
x = in/6.283185307179586;
floor_in = floor(x);
out = in - (6.283185307179586*floor_in);
/*End code section*/"
                }
                [
                    position = 7640, 8000
                    hide_name = True
                    size = 56, 48
                ]

                component Subsystem PLL {
                    layout = dynamic
                    component gen_pid_controller "PID controller1" {
                        controller_type = "PI"
                        enb_anti_windup_out = "True"
                        enb_output_limit_out = "True"
                        int_init_value = "2*np.pi*60"
                        ki = "2"
                        lower_sat_lim = "2*np.pi*59.5"
                        upper_sat_lim = "2*np.pi*60.5"
                    }
                    [
                        position = 8192, 8152
                        hide_name = True
                    ]

                    component gen_c_function "C function1" {
                        global_variables = "real var;"
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "in inherit"
                        in_terminal_labels = "[(\'in\', True)]"
                        init_fnc = "/*Begin code section*/
var = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', True)]"
                        output_fnc = "/*Begin code section*/
out = var;
/*End code section*/"
                        parameters = "real Ts;"
                        update_fnc = "/*Begin code section*/
var += (Ts*in);
/*End code section*/"
                    }
                    [
                        position = 8304, 8152
                        hide_name = True
                        size = 80, 48
                    ]

                    component gen_c_function "confine phase" {
                        global_variables = "real x;real floor_in;"
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "in inherit"
                        in_terminal_labels = "[(\'in\', True)]"
                        init_fnc = "/*Begin code section*/
floor_in = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', True)]"
                        output_fnc = "/*Begin code section*/
x = in/6.283185307179586;
floor_in = floor(x);
out = in - (6.283185307179586*floor_in);
/*End code section*/"
                    }
                    [
                        position = 8408, 8152
                        size = 56, 48
                    ]

                    port wt {
                        label = "wt"
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8496, 8152
                    ]

                    port w {
                        label = "w"
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8304, 8208
                    ]

                    port q {
                        label = "q"
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8064, 8152
                    ]

                    junction Junction1 sp
                    [
                        position = 8240, 8152
                    ]

                    connect w Junction1 as Connection19
                    connect "C function1.in" Junction1 as Connection17
                    connect wt "confine phase.out" as Connection14
                    connect "confine phase.in" "C function1.out" as Connection16
                    connect Junction1 "PID controller1.out" as Connection18
                    connect q "PID controller1.in" as Connection20
                }
                [
                    position = 7544, 8576
                    scale = 1, -1
                    size = 96, 56
                ]

                component gen_limiter Limit1 {
                    lower_limit = "1e-12"
                }
                [
                    position = 7384, 8016
                    hide_name = True
                ]

                component gen_digital_probe "Digital Probe6" {
                    override_signal_name = "True"
                    signal_name = "griddisconnect2"
                }
                [
                    position = 9072, 8256
                    hide_name = True
                ]

                component "core/abc to dq" "abc to dq1" {
                }
                [
                    position = 7264, 8576
                    size = 48, 80
                ]

                component gen_math_fnc "Mathematical function2" {
                    mathematical_fn = "sqrt"
                }
                [
                    position = 7416, 8352
                    hide_name = True
                ]

                component gen_probe Vd_G {
                }
                [
                    position = 7328, 8480
                    scale = -1, 1
                ]

                component gen_probe Vq_G {
                }
                [
                    position = 7432, 8472
                    scale = -1, 1
                ]

                component gen_probe del_w {
                }
                [
                    position = 8744, 8376
                ]

                component gen_probe del_V {
                }
                [
                    position = 9048, 8584
                ]

                component gen_c_function "stay connected1" {
                    global_variables = "real connect;"
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "ready inherit;connectINV inherit"
                    in_terminal_labels = "[(\'ready\', True), (\'connectINV\', True)]"
                    in_terminal_properties = "inherit ready;inherit connectINV;"
                    init_fnc = "/*Begin code section*/
connect = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "[(\'out\', True)]"
                    out_terminal_properties = "int out;"
                    output_fnc = "/*Begin code section*/
out = connect;
/*End code section*/"
                    parameters = "real Ts;"
                    update_fnc = "/*Begin code section*/
if ((ready==1)&&(connectINV==1)){
    connect = 1;
}
else if(connectINV==0){
    connect = 0;
}
/*End code section*/"
                }
                [
                    position = 8848, 8152
                    hide_name = True
                    size = 160, 104
                ]

                component gen_probe "|V|" {
                }
                [
                    position = 7512, 8304
                ]

                component gen_probe w_G {
                }
                [
                    position = 7824, 8160
                    rotation = down
                    scale = -1, 1
                ]

                component gen_probe w_bus {
                }
                [
                    position = 7824, 8240
                ]

                component gen_sum Sum6 {
                    signs = "+-"
                }
                [
                    position = 7752, 8336
                    hide_name = True
                ]

                component gen_sum Sum7 {
                    signs = "+-"
                }
                [
                    position = 7752, 8408
                    hide_name = True
                ]

                component gen_sum Sum8 {
                    signs = "+-"
                }
                [
                    position = 7752, 8480
                    hide_name = True
                ]

                component gen_probe Ea-Va {
                }
                [
                    position = 7848, 8336
                ]

                component gen_probe Eb-Vb {
                }
                [
                    position = 7848, 8408
                ]

                component gen_probe Ec-Vc {
                }
                [
                    position = 7848, 8480
                ]

                component "core/abc to dq" "abc to dq2" {
                }
                [
                    position = 7984, 8592
                    size = 48, 80
                ]

                component gen_probe Ed-Vd {
                }
                [
                    position = 8072, 8552
                ]

                component gen_probe Eq-Vq {
                }
                [
                    position = 8120, 8592
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 8072, 8632
                    hide_name = True
                ]

                component gen_probe E_d {
                }
                [
                    position = 7616, 8704
                ]

                component gen_probe E_q {
                }
                [
                    position = 7616, 8856
                    rotation = down
                    scale = -1, 1
                ]

                component gen_gain Gain7 {
                    gain = "1/V_DQ"
                }
                [
                    position = 7336, 8736
                    hide_name = True
                ]

                component Subsystem Current_abc_to_dq3 {
                    layout = dynamic
                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7856, 8008
                        size = 48, 80
                    ]

                    component gen_terminator Termination {
                    }
                    [
                        position = 7952, 8064
                    ]

                    port wt {
                        position = right:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8088
                    ]

                    port Ec {
                        position = right:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8040
                    ]

                    port Eq {
                        position = left:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 8016
                    ]

                    port Ea {
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 7960
                    ]

                    port Ed {
                        position = left:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 7976
                    ]

                    port Eb {
                        position = right:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7704, 8000
                    ]

                    connect Termination.in "abc to dq1.zero_axis" as Connection4
                    connect "abc to dq1.q_axis" Eq as Connection6
                    connect Ec "abc to dq1.vc" as Connection3
                    connect Ea "abc to dq1.va" as Connection1
                    connect Eb "abc to dq1.vb" as Connection2
                    connect "abc to dq1.d_axis" Ed as Connection5
                    connect wt "abc to dq1.wt" as Connection7
                }
                [
                    position = 7256, 8784
                    hide_name = True
                    scale = -1, 1
                    size = 64, 144
                ]

                component gen_gain Gain12 {
                    gain = "1/V_DQ"
                }
                [
                    position = 7336, 8832
                    hide_name = True
                ]

                component gen_c_function "Hold after connect2" {
                    global_variables = "real var;"
                    in_terminal_dimensions = "inherit;inherit;inherit"
                    in_terminal_dimensions_str = "in inherit;connect inherit;INV_sync inherit"
                    in_terminal_labels = "[(\'in\', True), (\'connect\', True), (\'INV_sync\', True)]"
                    in_terminal_properties = "real in;int connect;inherit INV_sync;"
                    init_fnc = "/*Begin code section*/
var = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "[(\'out\', True)]"
                    output_fnc = "/*Begin code section*/
out = var;
/*End code section*/"
                    update_fnc = "/*Begin code section*/
if ((connect==0)&&(INV_sync==1))
    var = in;
else if (connect==1)
    var =0;
/*End code section*/"
                }
                [
                    position = 8488, 8432
                    hide_name = True
                    size = 96, 96
                ]

                component gen_c_function "Hold after connect3" {
                    global_variables = "real var;"
                    in_terminal_dimensions = "inherit;inherit;inherit"
                    in_terminal_dimensions_str = "in inherit;connect inherit;INV_sync inherit"
                    in_terminal_labels = "[(\'in\', True), (\'connect\', True), (\'INV_sync\', True)]"
                    in_terminal_properties = "real in;int connect;inherit INV_sync;"
                    init_fnc = "/*Begin code section*/
var = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "[(\'out\', True)]"
                    output_fnc = "/*Begin code section*/
out = var;
/*End code section*/"
                    update_fnc = "/*Begin code section*/
if ((connect==0)&&(INV_sync==1))
    var = in;
else if (connect==1)
    var =0;
/*End code section*/"
                }
                [
                    position = 8784, 8648
                    hide_name = True
                    size = 96, 96
                ]

                component gen_probe "|E|" {
                }
                [
                    position = 8392, 8248
                ]

                component gen_probe Connect {
                }
                [
                    position = 9072, 8024
                ]

                component "core/Rate Transition" "Rate Transition2" {
                    execution_rate = "Tsync"
                }
                [
                    position = 8056, 8360
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Rate Transition" "Rate Transition4" {
                    execution_rate = "Tsync"
                }
                [
                    position = 8056, 8424
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Rate Transition" "Rate Transition6" {
                    execution_rate = "Tsync"
                }
                [
                    position = 8320, 8616
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Rate Transition" "Rate Transition12" {
                    execution_rate = "Tsync"
                    init_value = "0"
                }
                [
                    position = 8704, 8120
                    hide_name = True
                    size = 32, 32
                ]

                tag From39 {
                    value = "E_q"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8072, 8264
                    hide_name = True
                ]

                tag From43 {
                    value = "Vd_G"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7176, 8312
                    hide_name = True
                ]

                tag w_bus1 {
                    value = "w_bus"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7656, 8568
                    hide_name = True
                ]

                tag Vb_G1 {
                    value = "VbG"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7176, 8560
                    hide_name = True
                ]

                tag "|V|1" {
                    value = "|V| bus"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7512, 8352
                    hide_name = True
                ]

                tag theta_bus {
                    value = "theta_bus"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7656, 8656
                    hide_name = True
                ]

                tag theta_bus5 {
                    value = "dV"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8240, 8616
                    hide_name = True
                ]

                tag Goto2 {
                    value = "del_w"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8744, 8432
                    hide_name = True
                ]

                tag From42 {
                    value = "Vq_G"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7176, 8392
                    hide_name = True
                ]

                tag Goto32 {
                    value = "Vq_G"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7544, 8536
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto31 {
                    value = "del_V"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9040, 8648
                    hide_name = True
                ]

                tag Connect2 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8296, 8432
                    hide_name = True
                    size = 42, 20
                ]

                tag From44 {
                    value = "Vd_G"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 8104
                    hide_name = True
                ]

                tag From45 {
                    value = "Vq_G"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 8072
                    hide_name = True
                ]

                tag Goto30 {
                    value = "dV"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8504, 8160
                    hide_name = True
                ]

                tag Goto33 {
                    value = "Vd_G"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7440, 8552
                    hide_name = True
                    size = 60, 20
                ]

                tag Vc_G1 {
                    value = "VcG"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7176, 8584
                    hide_name = True
                ]

                tag From41 {
                    value = "E_d"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 8016
                    hide_name = True
                ]

                tag Va_G1 {
                    value = "VaG"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7176, 8536
                    hide_name = True
                ]

                tag From36 {
                    value = "E_d"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8072, 8184
                    hide_name = True
                ]

                tag theta_bus2 {
                    value = "w_bus"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 8224
                    hide_name = True
                ]

                tag Connect1 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9072, 8152
                    hide_name = True
                ]

                tag From1 {
                    value = "|V| bus"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8240, 8152
                    hide_name = True
                ]

                tag From40 {
                    value = "E_q"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 7984
                    hide_name = True
                ]

                tag w_e7 {
                    value = "w_e"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 8176
                    hide_name = True
                ]

                tag From46 {
                    value = "Ec1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 8464
                    hide_name = True
                    size = 60, 20
                ]

                tag From37 {
                    value = "Ea1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 8320
                    hide_name = True
                    size = 60, 20
                ]

                tag From38 {
                    value = "Eb1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 8392
                    hide_name = True
                    size = 60, 20
                ]

                tag Vb_G2 {
                    value = "VbG"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 8424
                    hide_name = True
                ]

                tag Vc_G2 {
                    value = "VcG"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 8496
                    hide_name = True
                ]

                tag Va_G2 {
                    value = "VaG"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7664, 8352
                    hide_name = True
                ]

                tag Goto28 {
                    value = "E_q"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7432, 8832
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto29 {
                    value = "E_d"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7432, 8736
                    hide_name = True
                    size = 60, 20
                ]

                tag From34 {
                    value = "Ec1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7160, 8800
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "Ea1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7160, 8736
                    hide_name = True
                    size = 60, 20
                ]

                tag From35 {
                    value = "Eb1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7160, 8768
                    hide_name = True
                    size = 60, 20
                ]

                tag theta_bus1 {
                    value = "theta_bus"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7160, 8832
                    hide_name = True
                ]

                tag Connect4 {
                    value = "INV_sync"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8296, 8472
                    hide_name = True
                    size = 42, 20
                ]

                tag Connect5 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8600, 8656
                    hide_name = True
                    size = 42, 20
                ]

                tag Connect6 {
                    value = "INV_sync"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8600, 8704
                    hide_name = True
                    size = 42, 20
                ]

                junction Junction41 sp
                [
                    position = 7480, 8576
                ]

                junction Junction38 sp
                [
                    position = 8304, 8120
                ]

                junction Junction26 sp
                [
                    position = 8112, 8184
                ]

                junction Junction42 sp
                [
                    position = 7216, 8392
                ]

                junction Junction43 sp
                [
                    position = 7216, 8312
                ]

                junction Junction28 sp
                [
                    position = 8112, 8264
                ]

                junction Junction45 sp
                [
                    position = 7608, 8656
                ]

                junction Junction49 sp
                [
                    position = 7872, 8048
                ]

                junction Junction35 sp
                [
                    position = 8424, 8192
                ]

                junction Junction57 sp
                [
                    position = 7480, 8536
                ]

                junction Junction58 sp
                [
                    position = 7368, 8552
                ]

                junction Junction63 sp
                [
                    position = 9008, 8152
                ]

                junction Junction66 sp
                [
                    position = 8552, 8136
                ]

                junction Junction67 sp
                [
                    position = 8576, 8040
                ]

                junction Junction69 sp
                [
                    position = 7456, 8352
                ]

                junction Junction72 sp
                [
                    position = 7968, 8200
                ]

                junction Junction73 sp
                [
                    position = 7968, 8128
                ]

                junction Junction74 sp
                [
                    position = 7800, 8336
                ]

                junction Junction75 sp
                [
                    position = 7800, 8480
                ]

                junction Junction76 sp
                [
                    position = 7800, 8408
                ]

                junction Junction77 sp
                [
                    position = 7608, 8656
                ]

                junction Junction78 sp
                [
                    position = 9008, 8184
                ]

                junction Junction61 sp
                [
                    position = 7376, 8736
                ]

                junction Junction80 sp
                [
                    position = 7376, 8832
                ]

                junction Junction81 sp
                [
                    position = 8352, 8224
                ]

                junction Junction83 sp
                [
                    position = 8376, 8616
                ]

                junction Junction84 sp
                [
                    position = 7992, 8048
                ]

                junction Junction85 sp
                [
                    position = 9000, 8152
                ]

                junction Junction86 sp
                [
                    position = 8680, 8432
                ]

                junction Junction87 sp
                [
                    position = 8952, 8648
                ]

                junction Junction88 sp
                [
                    position = 7784, 8176
                ]

                junction Junction89 sp
                [
                    position = 7784, 8224
                ]

                connect "Digital Probe4.in" Junction38 as Connection366
                connect "confine phase2.out" Sum1.in1 as Connection399
                connect From39 Junction28 as Connection259
                connect "abc to dq1.q_axis" Gain6.in as Connection319
                connect From41 Limit1.in as Connection285
                connect Sum3.in1 From1 as Connection81
                connect Vc_G1 "abc to dq1.vc" as Connection222
                connect angle_diff3.in Junction49 as Connection430
                connect Product2.out Sum4.in1 as Connection251
                connect Abs2.out "Relational operator4.in" as Connection84
                connect Goto30 Junction35 as Connection308
                connect Va_G1 "abc to dq1.va" as Connection224
                connect theta_bus Junction45 as Connection404
                connect Termination1.in "abc to dq1.zero_axis" as Connection29
                connect From45 "Trigonometric function2.in" as Connection401
                connect Sum4.out "Mathematical function1.in" as Connection252
                connect Product2.in Junction28 as Connection261
                connect Junction28 Product2.in1 as Connection260
                connect Constant7.out "Relational operator2.in" as Connection70
                connect Abs2.in Junction35 as Connection306
                connect From44 Limit2.in as Connection402
                connect "Digital Probe6.in" "Logical operator2.out" as Connection454
                connect Junction26 From36 as Connection248
                connect Product1.in Junction26 as Connection247
                connect Limit2.out "Trigonometric function2.in1" as Connection398
                connect Product3.out Sum5.in as Connection390
                connect Junction38 "Relational operator2.out" as Connection365
                [
                    breakpoints = 8288, 8120; 8288, 8120
                ]
                connect Product3.in Junction43 as Connection386
                connect Limit1.out "Trigonometric function1.in1" as Connection286
                connect From40 "Trigonometric function1.in" as Connection284
                connect Vb_G1 "abc to dq1.vb" as Connection223
                connect "Relational operator2.in1" Abs5.out as Connection357
                connect From42 Junction42 as Connection384
                connect Junction43 From43 as Connection389
                connect Sum5.out "Mathematical function2.in" as Connection387
                connect Product3.in1 Junction43 as Connection391
                connect Gain6.out Junction41 as Connection381
                connect Junction35 Sum3.out as Connection307
                connect "confine phase.in" Sum1.out as Connection146
                connect Product4.out Sum5.in1 as Connection388
                connect "confine phase1.out" Sum1.in as Connection400
                connect Constant9.out "Relational operator4.in1" as Connection85
                connect PLL.w w_bus1 as Connection233
                connect Product4.in Junction42 as Connection385
                connect "confine phase.out" Junction49 as Connection428
                connect Junction45 "abc to dq1.wt" as Connection405
                connect Product1.in1 Junction26 as Connection249
                connect Junction41 PLL.q as Connection382
                connect Constant6.out "Relational operator1.in" as Connection69
                connect Product1.out Sum4.in as Connection250
                connect Junction42 Product4.in1 as Connection392
                connect "Logical operator1.in1" Junction38 as Connection364
                [
                    breakpoints = 8576, 8120
                ]
                connect Gain5.in "abc to dq1.d_axis" as Connection318
                connect Goto32 Junction57 as Connection468
                connect Junction57 Junction41 as Connection469
                connect Vq_G.in Junction57 as Connection470
                connect Goto33 Junction58 as Connection471
                connect Junction58 Gain5.out as Connection472
                connect Vd_G.in Junction58 as Connection473
                connect PLL.wt "Unit Delay2.in" as Connection474
                connect "Connect INV.out" "stay connected1.connectINV" as Connection504
                connect Connect1 Junction63 as Connection508
                connect "Logical operator1.in2" Junction66 as Connection530
                connect Junction66 "Relational operator4.out" as Connection531
                connect "Digital Probe5.in" Junction66 as Connection532
                connect "Relational operator1.out" Junction67 as Connection534
                connect Junction67 "Logical operator1.in" as Connection535
                connect "Digital Probe3.in" Junction67 as Connection536
                connect "Trigonometric function2.out" "confine phase2.in" as Connection542
                connect "Trigonometric function1.out" "confine phase1.in" as Connection543
                connect "Mathematical function2.out" Junction69 as Connection544
                connect Junction69 "|V|1" as Connection545
                [
                    breakpoints = 7456, 8352
                ]
                connect "|V|.in" Junction69 as Connection546
                connect Sum2.out Junction72 as Connection554
                connect Abs5.in Junction73 as Connection557
                connect Junction73 Junction72 as Connection558
                connect frequency_diff3.in Junction73 as Connection559
                connect Vc_G2 Sum8.in1 as Connection560
                connect From46 Sum8.in as Connection561
                connect Vb_G2 Sum7.in1 as Connection562
                connect From38 Sum7.in as Connection563
                connect Va_G2 Sum6.in1 as Connection564
                connect From37 Sum6.in as Connection565
                connect Ea-Va.in Junction74 as Connection569
                connect Junction74 Sum6.out as Connection570
                connect "abc to dq2.va" Junction74 as Connection571
                [
                    breakpoints = 7944, 8536; 7944, 8296; 7800, 8296
                ]
                connect Ec-Vc.in Junction75 as Connection580
                connect Junction75 Sum8.out as Connection581
                connect "abc to dq2.vc" Junction75 as Connection582
                connect Eb-Vb.in Junction76 as Connection599
                connect Junction76 Sum7.out as Connection600
                [
                    breakpoints = 7800, 8408; 7800, 8408; 7800, 8408; 7800, 8408; 7800, 8408
                ]
                connect "abc to dq2.vb" Junction76 as Connection601
                [
                    breakpoints = 7944, 8584; 7904, 8584; 7904, 8384; 7880, 8384; 7880, 8384; 7800, 8384
                ]
                connect "Unit Delay2.out" Junction77 as Connection602
                connect Junction77 Junction45 as Connection603
                connect "abc to dq2.wt" Junction77 as Connection604
                [
                    breakpoints = 7944, 8680; 7608, 8680; 7608, 8656
                ]
                connect Ed-Vd.in "abc to dq2.d_axis" as Connection605
                connect Eq-Vq.in "abc to dq2.q_axis" as Connection606
                connect Termination2.in "abc to dq2.zero_axis" as Connection607
                connect Junction63 Junction78 as Connection609
                [
                    breakpoints = 9008, 8152
                ]
                connect Junction78 "Logical operator2.in" as Connection610
                [
                    breakpoints = 9008, 8184
                ]
                connect "Digital Probe1.in" Junction78 as Connection611
                connect From34 Current_abc_to_dq3.Ec as Connection421
                connect From33 Current_abc_to_dq3.Ea as Connection278
                connect From35 Current_abc_to_dq3.Eb as Connection422
                connect Gain7.in Current_abc_to_dq3.Ed as Connection438
                [
                    breakpoints = 7304, 8736
                ]
                connect Current_abc_to_dq3.Eq Gain12.in as Connection439
                [
                    breakpoints = 7304, 8832
                ]
                connect Goto29 Junction61 as Connection444
                connect Junction61 Gain7.out as Connection445
                connect Current_abc_to_dq3.wt theta_bus1 as Connection616
                connect E_d.in Junction61 as Connection618
                [
                    breakpoints = 7472, 8760; 7376, 8760; 7376, 8736
                ]
                connect Goto28 Junction80 as Connection620
                connect Junction80 Gain12.out as Connection621
                connect E_q.in Junction80 as Connection622
                [
                    breakpoints = 7584, 8808; 7376, 8808
                ]
                connect "Mathematical function1.out" Junction81 as Connection633
                connect Junction81 Sum3.in as Connection634
                connect "|E|.in" Junction81 as Connection635
                connect Junction72 "Rate Transition4.in" as Connection641
                connect "Rate Transition4.out" "BE1-25A Synchronizer.df" as Connection642
                connect "BE1-25A Synchronizer.del_w" "Hold after connect2.in" as Connection649
                connect theta_bus5 "Rate Transition6.in" as Connection650
                connect "BE1-25A Synchronizer1.dV" Junction83 as Connection659
                connect Junction83 volt_diff3.in as Connection660
                [
                    breakpoints = 8376, 8616; 8376, 8616; 8376, 8512
                ]
                connect "Rate Transition6.out" Junction83 as Connection661
                connect "Logical operator1.out" "Rate Transition12.in" as Connection662
                connect "Rate Transition12.out" "stay connected1.ready" as Connection663
                connect "Rate Transition2.out" "BE1-25A Synchronizer.dAng" as Connection664
                connect "BE1-25A Synchronizer1.del_V" "Hold after connect3.in" as Connection671
                connect Abs4.out "Relational operator1.in1" as Connection672
                connect Junction49 Junction84 as Connection673
                connect Junction84 Abs4.in as Connection674
                connect "Rate Transition2.in" Junction84 as Connection675
                connect Connect4 "Hold after connect2.INV_sync" as Connection676
                connect Connect6 "Hold after connect3.INV_sync" as Connection677
                connect Junction63 Junction85 as Connection683
                connect Junction85 Connect.in as Connection684
                [
                    breakpoints = 9008, 8152; 9000, 8152; 9008, 8152; 9016, 8152
                ]
                connect "stay connected1.out" Junction85 as Connection685
                connect "Hold after connect2.out" Junction86 as Connection691
                connect Junction86 del_w.in as Connection692
                [
                    breakpoints = 8680, 8432; 8680, 8432
                ]
                connect Goto2 Junction86 as Connection693
                connect Connect2 "Hold after connect2.connect" as Connection694
                connect Connect5 "Hold after connect3.connect" as Connection695
                connect "Hold after connect3.out" Junction87 as Connection701
                connect Junction87 Goto31 as Connection702
                [
                    breakpoints = 8992, 8648
                ]
                connect del_V.in Junction87 as Connection703
                connect w_G.in Junction88 as Connection706
                connect Junction88 Sum2.in as Connection707
                [
                    breakpoints = 7784, 8176
                ]
                connect w_e7 Junction88 as Connection708
                connect w_bus.in Junction89 as Connection709
                connect Junction89 Sum2.in1 as Connection710
                [
                    breakpoints = 7784, 8224
                ]
                connect theta_bus2 Junction89 as Connection711
            }
            [
                position = 7600, 7552
                size = 112, 144
            ]

            component gen_logic_op "Logical operator1" {
                operator = "NOT"
            }
            [
                position = 7864, 7592
                rotation = right
                hide_name = True
            ]

            component gen_digital_probe "INV_sync OFF" {
            }
            [
                position = 7936, 7624
            ]

            component gen_digital_probe "INV_sync ON" {
            }
            [
                position = 7936, 7520
                rotation = down
                scale = -1, 1
            ]

            component src_scada_input INV_sync {
                execution_rate = "Tsync"
                format = "int"
                max = "1"
                min = "0"
                signal_type = "int"
                unit = ""
            }
            [
                position = 7808, 7552
            ]

            component gen_gain Gain17 {
                gain = "1000/S"
            }
            [
                position = 6736, 7624
                hide_name = True
            ]

            component gen_gain Gain18 {
                gain = "1000/S"
            }
            [
                position = 6736, 7528
                hide_name = True
            ]

            component "core/Voltage RMS" Vrms {
                frequency = "sys_f"
            }
            [
                position = 9424, 7952
                rotation = right
                size = 64, 32
            ]

            component gen_logic_op "Logical operator3" {
                operator = "NOT"
            }
            [
                position = 6912, 8336
                hide_name = True
            ]

            component "core/Three Phase Inverter" "Three Phase Inverter" {
                ctrl_src = "Internal modulator"
            }
            [
                position = 7528, 8000
                size = 127, 256
            ]

            component src_constant Constant2 {
                execution_rate = "Ts"
            }
            [
                position = 7384, 7832
                hide_name = True
            ]

            component gen_PQ_transform "Power Meter" {
                enable_inst_ports = "False"
                filter_cutoff_Hz = "1"
            }
            [
                position = 9008, 7504
            ]

            component gen_probe P {
            }
            [
                position = 9112, 7432
            ]

            component gen_probe Q {
            }
            [
                position = 9112, 7488
            ]

            component Subsystem Battery {
                layout = dynamic
                component gen_abs Abs1 {
                }
                [
                    position = 7368, 8144
                    hide_name = True
                ]

                component gen_math_fnc "Mathematical function1" {
                    mathematical_fn = "power"
                }
                [
                    position = 7608, 8160
                    hide_name = True
                ]

                component src_constant Constant1 {
                    execution_rate = "Ts"
                    value = "Inom"
                }
                [
                    position = 7280, 8184
                    hide_name = True
                ]

                component gen_product Product1 {
                    signs = "*/"
                }
                [
                    position = 7472, 8152
                    hide_name = True
                ]

                component src_constant Constant2 {
                    execution_rate = "Ts"
                    value = "0.9"
                }
                [
                    position = 7512, 8208
                    hide_name = True
                ]

                component gen_abs Abs2 {
                }
                [
                    position = 7368, 8264
                    hide_name = True
                ]

                component gen_math_fnc "Mathematical function2" {
                    mathematical_fn = "power"
                }
                [
                    position = 7496, 8272
                    hide_name = True
                ]

                component src_constant Constant3 {
                    execution_rate = "Ts"
                    value = "0.86"
                }
                [
                    position = 7400, 8312
                    hide_name = True
                ]

                component gen_abs Abs4 {
                }
                [
                    position = 7376, 8616
                    hide_name = True
                ]

                component gen_math_fnc "Mathematical function4" {
                    mathematical_fn = "power"
                }
                [
                    position = 7504, 8624
                    hide_name = True
                ]

                component src_constant Constant5 {
                    execution_rate = "Ts"
                    value = "1.5"
                }
                [
                    position = 7408, 8672
                    hide_name = True
                ]

                component gen_sum Sum1 {
                    signs = "+-"
                }
                [
                    position = 7352, 8376
                    hide_name = True
                ]

                component src_constant Constant6 {
                    execution_rate = "Ts"
                }
                [
                    position = 7272, 8352
                    hide_name = True
                ]

                component gen_abs Abs5 {
                }
                [
                    position = 7448, 8376
                    hide_name = True
                ]

                component gen_math_fnc "Mathematical function5" {
                    mathematical_fn = "power"
                }
                [
                    position = 7576, 8384
                    hide_name = True
                ]

                component src_constant Constant7 {
                    execution_rate = "Ts"
                    value = "1.2"
                }
                [
                    position = 7480, 8432
                    hide_name = True
                ]

                component gen_bus_join "Bus Join1" {
                    inputs = "6"
                }
                [
                    position = 7792, 8360
                ]

                component gen_c_function "C function" {
                    execution_rate = "1e-3"
                    global_variables = "real Cbat;real Vbat;"
                    in_terminal_dimensions = "1;6;1;1"
                    in_terminal_dimensions_str = "Ibat 1;x 6;Ceff 1;charge 1"
                    in_terminal_labels = "[(\'Ibat\', True), (\'x\', True), (\'Ceff\', True), (\'charge\', True)]"
                    in_terminal_properties = "real Ibat;real x;real Ceff;int charge;"
                    init_fnc = "/*Begin code section*/
SOC = 0.5;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "1;1;1"
                    out_terminal_dimensions_str = "Vdc 1;SOC 1;Vbtt 1"
                    out_terminal_labels = "[(\'Vdc\', True), (\'SOC\', True), (\'Vbtt\', True)]"
                    out_terminal_properties = "real Vdc;real SOC;real Vbtt;"
                    output_fnc = "/*Begin code section*/
if (Ibat>0){
    Vbat = Nb*(2+0.16*SOC)+Nb*Ibat/Cnom*(6/(1+x[1])+0.48/x[2]+0.036)*(1-0.025*(Tamb-25));
    SOC = SOC +(Ibat/Cbat)*1e-3/3600.0;
}
else{
    Vbat = Nb*(1.965+0.12*SOC)-Nb*x[3]/Cnom*(4/(1+x[4])+0.27/x[5]+0.02)*(1-0.007*(Tamb-25));
    SOC = SOC + (Ibat/Cbat)*1e-3/3600.0;
}
if (SOC<0.001) SOC = 0.001;
if (SOC>1) SOC = 1;
if (Vbat<1) Vbat = 1;  
if (Vbat>1.5e3) Vbat = 1.5e3;
Vbtt = Vbat+Ri*Ibat;
if (charge>0) Vdc = Vch;
else Vdc = Vdisch;
/*End code section*/"
                    parameters = "real Nb;real Cnom;real Inom;real Tamb;real Ts;real Ri;real Vdisch;real Vch;"
                    update_fnc = "/*Begin code section*/
Cbat = 1.67*Cnom*(1+0.005*(Tamb-25))/(1+0.67*x[0]);
/*End code section*/"
                }
                [
                    position = 8192, 8328
                    size = 88, 152
                ]

                component gen_abs Abs3 {
                }
                [
                    position = 7368, 8496
                    hide_name = True
                ]

                component gen_math_fnc "Mathematical function3" {
                    mathematical_fn = "power"
                }
                [
                    position = 7496, 8504
                    hide_name = True
                ]

                component src_constant Constant4 {
                    execution_rate = "Ts"
                    value = "1.3"
                }
                [
                    position = 7400, 8552
                    hide_name = True
                ]

                component gen_c_function "C function1" {
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "SOC inherit;Ibat inherit"
                    in_terminal_labels = "[(\'SOC\', True), (\'Ibat\', True)]"
                    in_terminal_properties = "real SOC;inherit Ibat;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "[(\'out\', False)]"
                    output_fnc = "/*Begin code section*/
if (Ibat>0) out = 20.73*(SOC-1)/(Ibat/Inom+0.55);
else out = 20.73*(SOC-1)/(-Ibat/Inom+0.55);
/*End code section*/"
                    parameters = "real Inom;"
                }
                [
                    position = 7816, 8544
                    hide_name = True
                    size = 56, 72
                ]

                component gen_math_fnc "Mathematical function6" {
                }
                [
                    position = 7936, 8544
                    hide_name = True
                ]

                component gen_sum Sum2 {
                    signs = "+-"
                }
                [
                    position = 8024, 8472
                    hide_name = True
                ]

                component src_constant Constant8 {
                    execution_rate = "Ts"
                }
                [
                    position = 7936, 8464
                    hide_name = True
                ]

                component tm_delay "Unit Delay1" {
                    init_value = "0.5"
                }
                [
                    position = 8416, 8328
                    hide_name = True
                ]

                component gen_probe SOC {
                }
                [
                    position = 8392, 8376
                    scale = -1, 1
                ]

                component gen_z_domain_transfer LPF_dc {
                    a_coeff = "[1.0/(2*np.pi*1),1]"
                    b_coeff = "1"
                    domain = "S-domain"
                    method = "Bilinear"
                }
                [
                    position = 7992, 8280
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "1e-3"
                }
                [
                    position = 8064, 8280
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Rate Transition" "Rate Transition2" {
                    execution_rate = "1e-3"
                }
                [
                    position = 8032, 8328
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Rate Transition" "Rate Transition3" {
                    execution_rate = "Ts"
                    init_value = "0.5"
                }
                [
                    position = 8488, 8328
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Rate Transition" "Rate Transition4" {
                    execution_rate = "1e-3"
                    init_value = "1"
                }
                [
                    position = 8096, 8472
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Rate Transition" "Rate Transition5" {
                    execution_rate = "1e-3"
                }
                [
                    position = 8016, 8376
                    hide_name = True
                    size = 32, 32
                ]

                component gen_probe Ibat {
                }
                [
                    position = 7432, 8936
                    scale = -1, 1
                ]

                component src_scada_input charge {
                    execution_rate = "Ts"
                    format = "int"
                    max = "1"
                    min = "0"
                    signal_type = "int"
                    unit = ""
                }
                [
                    position = 7344, 8784
                ]

                component gen_c_function "C function2" {
                    in_terminal_dimensions = "1;1;1"
                    in_terminal_dimensions_str = "Idc 1;charge 1;Vbtt 1"
                    in_terminal_labels = "[(\'Idc\', True), (\'charge\', True), (\'Vbtt\', True)]"
                    in_terminal_properties = "real Idc;int charge;real Vbtt;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "1"
                    out_terminal_dimensions_str = "Ibat 1"
                    out_terminal_labels = "[(\'Ibat\', True)]"
                    out_terminal_properties = "real Ibat;"
                    output_fnc = "/*Begin code section*/
if (charge>0) Ibat = Idc*Vch/Vbtt;
else Ibat = Idc*Vdisch/Vbtt;
/*End code section*/"
                    parameters = "real Vdisch;real Vch;"
                }
                [
                    position = 7456, 8768
                    size = 72, 64
                ]

                component tm_delay "Unit Delay2" {
                    init_value = "0.5"
                }
                [
                    position = 8328, 8440
                    hide_name = True
                ]

                component "core/Rate Transition" "Rate Transition6" {
                    execution_rate = "Ts"
                    init_value = "2*Nb"
                }
                [
                    position = 8400, 8440
                    hide_name = True
                    size = 32, 32
                ]

                component gen_digital_probe Charging {
                }
                [
                    position = 7328, 8944
                    scale = -1, 1
                ]

                port Vdc {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8320, 8272
                ]

                tag From57 {
                    value = "Ibat"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7280, 8144
                    hide_name = True
                    size = 37, 20
                ]

                tag From58 {
                    value = "Ibat"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7280, 8264
                    hide_name = True
                    size = 37, 20
                ]

                tag From60 {
                    value = "SOC"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7288, 8616
                    hide_name = True
                    size = 37, 20
                ]

                tag From61 {
                    value = "SOC"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7272, 8408
                    hide_name = True
                    size = 37, 20
                ]

                tag From62 {
                    value = "Ibat"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7896, 8280
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto34 {
                    value = "SOC"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8560, 8328
                    hide_name = True
                    size = 60, 20
                ]

                tag From59 {
                    value = "Ibat"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7280, 8496
                    hide_name = True
                    size = 37, 20
                ]

                tag From64 {
                    value = "SOC"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8528
                    hide_name = True
                    size = 37, 20
                ]

                tag From65 {
                    value = "Ibat"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7736, 8560
                    hide_name = True
                    size = 37, 20
                ]

                tag From66 {
                    value = "charge"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7904, 8376
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto46 {
                    value = "Ibat"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7432, 8872
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto53 {
                    value = "charge"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7320, 8872
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From67 {
                    value = "Idc"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7304, 8752
                    hide_name = True
                    size = 37, 20
                ]

                tag From68 {
                    value = "Vbtt"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7272, 8824
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto54 {
                    value = "Vbtt"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8472, 8440
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction1 sp
                [
                    position = 7424, 8496
                ]

                junction Junction2 sp
                [
                    position = 8448, 8328
                ]

                junction Junction366 sp
                [
                    position = 7512, 8872
                ]

                junction Junction368 sp
                [
                    position = 7392, 8784
                ]

                junction Junction369 sp
                [
                    position = 8360, 8440
                ]

                junction Junction370 sp
                [
                    position = 7392, 8872
                ]

                connect From57 Abs1.in as Connection1
                connect Abs1.out Product1.in as Connection2
                connect Constant1.out Product1.in1 as Connection3
                connect Product1.out "Mathematical function1.in" as Connection4
                connect Constant2.out "Mathematical function1.in1" as Connection5
                connect From58 Abs2.in as Connection6
                connect Constant3.out "Mathematical function2.in1" as Connection7
                connect Abs2.out "Mathematical function2.in" as Connection8
                connect Constant5.out "Mathematical function4.in1" as Connection12
                connect Abs4.out "Mathematical function4.in" as Connection13
                connect From60 Abs4.in as Connection14
                connect From61 Sum1.in1 as Connection15
                connect Constant6.out Sum1.in as Connection16
                connect Constant7.out "Mathematical function5.in1" as Connection17
                connect Abs5.out "Mathematical function5.in" as Connection18
                connect Sum1.out Abs5.in as Connection19
                connect From59 Abs3.in as Connection9
                connect Constant4.out "Mathematical function3.in1" as Connection10
                connect "Bus Join1.in" "Mathematical function1.out" as Connection30
                connect "Bus Join1.in1" "Mathematical function2.out" as Connection31
                connect "Bus Join1.in2" "Mathematical function5.out" as Connection32
                connect Abs3.out Junction1 as Connection39
                connect Junction1 "Mathematical function3.in" as Connection40
                [
                    breakpoints = 7424, 8496
                ]
                connect "Bus Join1.in3" Junction1 as Connection41
                [
                    breakpoints = 7624, 8368; 7624, 8472
                ]
                connect "Mathematical function3.out" "Bus Join1.in4" as Connection42
                [
                    breakpoints = 7648, 8504; 7648, 8384
                ]
                connect "Mathematical function4.out" "Bus Join1.in5" as Connection43
                [
                    breakpoints = 7672, 8624; 7672, 8400
                ]
                connect From64 "C function1.SOC" as Connection45
                connect From65 "C function1.Ibat" as Connection46
                connect "C function1.out" "Mathematical function6.in" as Connection47
                connect Constant8.out Sum2.in as Connection48
                connect "Mathematical function6.out" Sum2.in1 as Connection49
                connect "C function.SOC" "Unit Delay1.in" as Connection51
                connect "Unit Delay1.out" Junction2 as Connection57
                connect SOC.in Junction2 as Connection59
                connect "C function.Vdc" Vdc as Connection60
                connect From62 LPF_dc.in as Connection62
                connect LPF_dc.out "Rate Transition1.in" as Connection63
                connect "Rate Transition1.out" "C function.Ibat" as Connection64
                connect "C function.x" "Rate Transition2.out" as Connection65
                connect "Rate Transition2.in" "Bus Join1.out" as Connection66
                connect Junction2 "Rate Transition3.in" as Connection67
                connect "Rate Transition3.out" Goto34 as Connection68
                connect Sum2.out "Rate Transition4.in" as Connection69
                connect "Rate Transition4.out" "C function.Ceff" as Connection70
                connect From66 "Rate Transition5.in" as Connection71
                connect "Rate Transition5.out" "C function.charge" as Connection72
                connect Goto46 Junction366 as Connection4362
                connect Junction366 "C function2.Ibat" as Connection4363
                connect Ibat.in Junction366 as Connection4364
                connect charge.out Junction368 as Connection4369
                connect Junction368 "C function2.charge" as Connection4370
                connect From67 "C function2.Idc" as Connection4372
                connect From68 "C function2.Vbtt" as Connection4373
                connect "Unit Delay2.out" Junction369 as Connection4374
                connect Junction369 "Rate Transition6.in" as Connection4375
                connect "Rate Transition6.out" Goto54 as Connection4376
                connect "Unit Delay2.in" "C function.Vbtt" as Connection4377
                connect Goto53 Junction370 as Connection4378
                connect Junction370 Junction368 as Connection4379
                connect Charging.in Junction370 as Connection4380
            }
            [
                position = 6912, 8000
                size = 96, 216
            ]

            component "core/Current Measurement" Idc {
                addr = "14"
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 7248, 7904
                scale = -1, -1
                size = 64, 32
            ]

            component gen_probe S {
            }
            [
                position = 8648, 7552
                rotation = down
                scale = -1, 1
            ]

            component gen_probe Q1 {
            }
            [
                position = 8648, 7488
                rotation = down
                scale = -1, 1
            ]

            component gen_probe pf {
            }
            [
                position = 8648, 7616
                rotation = down
                scale = -1, 1
            ]

            component gen_probe P1 {
            }
            [
                position = 8648, 7424
                rotation = down
                scale = -1, 1
            ]

            component Subsystem Power_Meas {
                layout = dynamic
                component gen_gain Gain6 {
                    gain = "S"
                }
                [
                    position = 8048, 8232
                    rotation = right
                    hide_name = True
                ]

                component gen_gain Gain4 {
                    gain = "S"
                }
                [
                    position = 7952, 8056
                    rotation = left
                    hide_name = True
                ]

                component gen_gain Gain5 {
                    gain = "S"
                }
                [
                    position = 8048, 8056
                    rotation = left
                    hide_name = True
                ]

                component Subsystem Power_Meas_DQpu {
                    layout = dynamic
                    component gen_c_function S_and_pf {
                        in_terminal_dimensions = "inherit;inherit"
                        in_terminal_dimensions_str = "P inherit;Q inherit"
                        in_terminal_labels = "False;False;"
                        in_terminal_properties = "real P;inherit Q;"
                        init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                        no_feed_inputs = "[u\'\']"
                        no_feed_outputs = "[u\'\']"
                        out_terminal_dimensions = "inherit;inherit"
                        out_terminal_dimensions_str = "S inherit;pf inherit"
                        out_terminal_labels = "False;False;"
                        out_terminal_properties = "inherit S;inherit pf;"
                        output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                    }
                    [
                        position = 8392, 8192
                        size = 0, 0
                    ]

                    component gen_product Product4 {
                    }
                    [
                        position = 8024, 8232
                        hide_name = True
                    ]

                    component gen_product Product3 {
                    }
                    [
                        position = 8024, 8320
                        hide_name = True
                    ]

                    component gen_z_domain_transfer LPF_Q {
                        a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8208, 8272
                    ]

                    component gen_product Product1 {
                    }
                    [
                        position = 8024, 8064
                        hide_name = True
                    ]

                    component gen_sum Sum1 {
                    }
                    [
                        position = 8128, 8112
                        hide_name = True
                    ]

                    component gen_z_domain_transfer LPF_P {
                        a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                        b_coeff = "1"
                        domain = "S-domain"
                        method = "Bilinear"
                    }
                    [
                        position = 8208, 8112
                    ]

                    component gen_product Product2 {
                    }
                    [
                        position = 8024, 8152
                        hide_name = True
                    ]

                    component gen_sum Sum2 {
                        signs = "+-"
                    }
                    [
                        position = 8128, 8272
                        hide_name = True
                    ]

                    port Vd {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7808, 8056
                    ]

                    port Vq {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7808, 8144
                    ]

                    port Id {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7808, 8240
                    ]

                    port Iq {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7808, 8328
                    ]

                    port P {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8312, 8112
                    ]

                    port Q {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8312, 8272
                    ]

                    port S {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8464, 8144
                    ]

                    port pf {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8464, 8240
                    ]

                    junction Junction1 sp
                    [
                        position = 7920, 8240
                    ]

                    junction Junction2 sp
                    [
                        position = 7928, 8328
                    ]

                    junction Junction3 sp
                    [
                        position = 7944, 8144
                    ]

                    junction Junction4 sp
                    [
                        position = 7960, 8056
                    ]

                    junction Junction5 sp
                    [
                        position = 8264, 8112
                    ]

                    junction Junction6 sp
                    [
                        position = 8264, 8272
                    ]

                    comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                    [
                        position = 8000, 7976
                    ]

                    connect Junction1 Id as Connection49
                    connect Junction1 Product4.in1 as Connection24
                    connect Junction2 Iq as Connection52
                    connect Junction2 Product3.in1 as Connection27
                    connect Junction3 Product2.in as Connection32
                    connect Junction3 Vq as Connection53
                    connect Junction4 Product1.in as Connection35
                    connect Junction4 Vd as Connection50
                    connect Junction5 LPF_P.out as Connection44
                    connect Junction5 P as Connection55
                    connect Junction6 LPF_Q.out as Connection47
                    connect Junction6 Q as Connection56
                    connect LPF_P.in Sum1.out as Connection39
                    connect LPF_Q.in Sum2.out as Connection40
                    connect Product1.in1 Junction1 as Connection25
                    connect Product2.in1 Junction2 as Connection28
                    connect Product3.in Junction4 as Connection36
                    connect Product4.in Junction3 as Connection33
                    connect S_and_pf.P Junction5 as Connection45
                    connect S_and_pf.Q Junction6 as Connection48
                    connect S_and_pf.S S as Connection51
                    connect S_and_pf.pf pf as Connection54
                    connect Sum1.in Product1.out as Connection29
                    connect Sum1.in1 Product2.out as Connection30
                    connect Sum2.in1 Product3.out as Connection38
                    connect Sum2.in Product4.out as Connection37

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                        fc_P {
                            label = "Active power low pass filter cut-off freq."
                            widget = edit
                            type = generic
                            default_value = "1.0"
                            unit = "Hz"
                        }

                        fc_Q {
                            label = "Reactive power low pass filter cut-off freq."
                            widget = edit
                            type = generic
                            default_value = "1.0"
                            unit = "Hz"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                        
                        ENDCODE
                    }
                }
                [
                    position = 7864, 8160
                    size = 72, 128
                ]

                port Vd {
                    position = left:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7760, 8048
                    rotation = right
                ]

                port Vq {
                    position = left:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7696, 8048
                    rotation = right
                ]

                port Id {
                    position = left:3
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7696, 8248
                    rotation = left
                ]

                port Iq {
                    position = left:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7760, 8248
                    rotation = left
                ]

                port P {
                    position = right:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7952, 8000
                    rotation = left
                ]

                port Q {
                    position = right:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8048, 8000
                    rotation = left
                ]

                port S {
                    position = right:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8048, 8288
                    rotation = right
                ]

                port pf {
                    position = right:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7992, 8288
                    rotation = right
                ]

                connect Gain4.out P as Connection10
                connect Gain4.in Power_Meas_DQpu.P as Connection20
                connect Gain5.in Power_Meas_DQpu.Q as Connection21
                connect Gain5.out Q as Connection11
                connect Gain6.in Power_Meas_DQpu.S as Connection16
                connect Gain6.out S as Connection13
                connect Id Power_Meas_DQpu.Id as Connection14
                connect Iq Power_Meas_DQpu.Iq as Connection17
                connect Vd Power_Meas_DQpu.Vd as Connection15
                connect Vq Power_Meas_DQpu.Vq as Connection18
                connect pf Power_Meas_DQpu.pf as Connection19
            }
            [
                position = 8456, 7520
                size = 96, 232
            ]

            component gen_probe VDC {
            }
            [
                position = 7088, 8208
            ]

            component pas_capacitor Cdc {
                capacitance = "300e-6"
                initial_voltage = "1000"
            }
            [
                position = 7376, 8000
                rotation = right
            ]

            component "core/Triple Pole Single Throw Contactor" S2 {
                ctrl_src = "Model"
            }
            [
                position = 9816, 8000
                size = 64, 256
            ]

            component src_scada_input CONNECT {
                execution_rate = "Ts"
                format = "int"
                max = "1"
                min = "0"
                signal_type = "int"
                unit = ""
            }
            [
                position = 9608, 7736
            ]

            component gen_logic_op "Logical operator2" {
                operator = "OR"
            }
            [
                position = 9736, 7776
                hide_name = True
            ]

            component "core/Rate Transition" "Rate Transition6" {
                execution_rate = "Ts"
            }
            [
                position = 9656, 7808
                hide_name = True
                size = 32, 32
            ]

            component src_scada_input P_ref_ess {
                def_value = "50"
                execution_rate = "20e-6"
                unit = "kW"
            }
            [
                position = 6512, 7488
            ]

            component src_scada_input Q_ref_ess {
                def_value = "30"
                execution_rate = "20e-6"
                unit = "kVAr"
            }
            [
                position = 6504, 7616
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts_ess"
                init_value = "1"
            }
            [
                position = 6808, 8336
                hide_name = True
                size = 32, 32
            ]

            component "core/Rate Transition" "Rate Transition7" {
                execution_rate = "Ts"
                init_value = "Vch"
            }
            [
                position = 7072, 8136
                hide_name = True
                size = 32, 32
            ]

            component gen_c_function "C function1" {
                in_terminal_dimensions = "1;1"
                in_terminal_dimensions_str = "ref 1;charge 1"
                in_terminal_labels = "[(\'ref\', True), (\'charge\', True)]"
                in_terminal_properties = "real ref;int charge;"
                no_feed_inputs = "[\'\']"
                no_feed_outputs = "[\'\']"
                out_terminal_dimensions = "inherit"
                out_terminal_dimensions_str = "out inherit"
                out_terminal_labels = "[(\'out\', False)]"
                output_fnc = "/*Begin code section*/
if (charge>0) out = -1;
else out = ref;
/*End code section*/"
            }
            [
                position = 6648, 7528
                hide_name = True
                size = 48, 48
            ]

            component gen_c_function "C function2" {
                in_terminal_dimensions = "1;1"
                in_terminal_dimensions_str = "ref 1;charge 1"
                in_terminal_labels = "[(\'ref\', True), (\'charge\', True)]"
                in_terminal_properties = "real ref;int charge;"
                no_feed_inputs = "[\'\']"
                no_feed_outputs = "[\'\']"
                out_terminal_dimensions = "inherit"
                out_terminal_dimensions_str = "out inherit"
                out_terminal_labels = "[(\'out\', False)]"
                output_fnc = "/*Begin code section*/
if (charge>0) out = 0;
else out = ref;
/*End code section*/"
            }
            [
                position = 6656, 7624
                hide_name = True
                size = 48, 48
            ]

            port C {
                label = "C"
                position = right:3
                kind = pe
            }
            [
                position = 9992, 8096
                scale = -1, 1
            ]

            port B {
                label = "B"
                position = right:2
                kind = pe
            }
            [
                position = 9992, 8000
                scale = -1, 1
            ]

            port A {
                label = "A"
                position = right:1
                kind = pe
            }
            [
                position = 9992, 7904
                scale = -1, 1
            ]

            tag Goto39 {
                value = "Ib1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 9112, 7968
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto18 {
                value = "VDC"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7168, 8136
                size = 60, 20
            ]

            tag Goto31 {
                value = "Ic1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 9112, 8064
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto35 {
                value = "Xi_a1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7888, 8160
                scale = -1, 1
                size = 60, 20
            ]

            tag Vb_G {
                value = "VbG"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 9536, 8288
            ]

            tag Goto41 {
                value = "Ea1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 8400, 8144
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto44 {
                value = "Xi_b1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7888, 8208
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto30 {
                value = "Ec1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 8496, 8352
                scale = -1, 1
                size = 60, 20
            ]

            tag Vc_G {
                value = "VcG"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 9656, 8408
            ]

            tag From2 {
                value = "modulator"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 7272, 7776
                hide_name = True
                size = 60, 20
            ]

            tag Goto38 {
                value = "Xi_c1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7888, 8256
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto33 {
                value = "E_c1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7920, 8480
                scale = -1, 1
                size = 60, 20
            ]

            tag Va_G {
                value = "VaG"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 9416, 8216
            ]

            tag Goto32 {
                value = "Ia1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 9112, 7872
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto40 {
                value = "Eb1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 8464, 8256
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto42 {
                value = "E_b1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7792, 8432
                scale = -1, 1
                size = 60, 20
            ]

            tag Goto34 {
                value = "E_a1"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7648, 8384
                scale = -1, 1
                size = 60, 20
            ]

            tag Connect6 {
                value = "INV_sync"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7936, 7552
                hide_name = True
            ]

            tag Goto45 {
                value = "Island"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7024, 8336
                size = 60, 20
            ]

            tag From58 {
                value = "Ea1"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8872, 7440
                hide_name = True
                size = 37, 20
            ]

            tag From59 {
                value = "Eb1"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8848, 7464
                hide_name = True
                size = 37, 20
            ]

            tag From60 {
                value = "Ec1"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8824, 7488
                hide_name = True
                size = 37, 20
            ]

            tag From61 {
                value = "Ia1"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8824, 7512
                hide_name = True
                size = 37, 20
            ]

            tag From62 {
                value = "Ib1"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8824, 7536
                hide_name = True
                size = 37, 20
            ]

            tag From63 {
                value = "Ic1"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8824, 7560
                hide_name = True
                size = 37, 20
            ]

            tag Goto49 {
                value = "Q"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 8584, 7464
                hide_name = True
                size = 0, 0
            ]

            tag Goto50 {
                value = "P"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 8584, 7400
                hide_name = True
                size = 0, 0
            ]

            tag Goto51 {
                value = "pf"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 8584, 7592
                hide_name = True
                size = 0, 0
            ]

            tag From31 {
                value = "Eq"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8328, 7488
                hide_name = True
                size = 60, 20
            ]

            tag Goto52 {
                value = "S"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 8584, 7528
                hide_name = True
                size = 0, 0
            ]

            tag From34 {
                value = "Xi_d1"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8328, 7552
                hide_name = True
                size = 60, 20
            ]

            tag From32 {
                value = "Ed"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8328, 7424
                hide_name = True
                size = 60, 20
            ]

            tag From35 {
                value = "Xi_q1"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 8328, 7616
                hide_name = True
                size = 60, 20
            ]

            tag Connect2 {
                value = "Connect"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 9592, 7808
                hide_name = True
            ]

            tag From7 {
                value = "PCC_status"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 6680, 8336
                hide_name = True
            ]

            tag Goto54 {
                value = "Idc"
                scope = masked_subsystem
                kind = sp
                direction = in
            }
            [
                position = 7344, 8144
                size = 60, 20
            ]

            tag From66 {
                value = "charge"
                scope = masked_subsystem
                kind = sp
                direction = out
            }
            [
                position = 6504, 7576
                hide_name = True
                size = 37, 20
            ]

            junction Junction173 pe
            [
                position = 8320, 8096
            ]

            junction Junction160 pe
            [
                position = 8240, 8000
            ]

            junction Junction207 pe
            [
                position = 8240, 8688
            ]

            junction Junction192 pe
            [
                position = 8240, 8688
            ]

            junction Junction198 pe
            [
                position = 8240, 8688
            ]

            junction Junction216 pe
            [
                position = 8320, 8312
            ]

            junction Junction284 sp
            [
                position = 8624, 8352
            ]

            junction Junction195 pe
            [
                position = 8240, 8688
            ]

            junction Junction215 pe
            [
                position = 8240, 8688
            ]

            junction Junction161 pe
            [
                position = 8160, 7904
            ]

            junction Junction292 pe
            [
                position = 8240, 8688
            ]

            junction Junction283 sp
            [
                position = 8512, 8256
            ]

            junction Junction212 pe
            [
                position = 8240, 8688
            ]

            junction Junction194 pe
            [
                position = 8240, 8688
            ]

            junction Junction213 pe
            [
                position = 8240, 8304
            ]

            junction Junction199 pe
            [
                position = 8240, 8688
            ]

            junction Junction311 sp
            [
                position = 8448, 8144
            ]

            junction Junction312 pe
            [
                position = 8160, 8296
            ]

            junction Junction47 sp
            [
                position = 7864, 7552
            ]

            junction Junction48 sp
            [
                position = 7864, 7552
            ]

            junction Junction320 pe
            [
                position = 8544, 7904
            ]

            junction Junction321 pe
            [
                position = 8608, 8000
            ]

            junction Junction322 pe
            [
                position = 8688, 8096
            ]

            junction Junction188 sp
            [
                position = 8536, 7424
            ]

            junction Junction189 sp
            [
                position = 8536, 7488
            ]

            junction Junction190 sp
            [
                position = 8536, 7552
            ]

            junction Junction191 sp
            [
                position = 8536, 7616
            ]

            junction Junction356 pe
            [
                position = 9424, 7904
            ]

            junction Junction357 pe
            [
                position = 9424, 8000
            ]

            junction Junction358 pe
            [
                position = 9336, 7904
            ]

            junction Junction359 pe
            [
                position = 8688, 8688
            ]

            junction Junction360 pe
            [
                position = 9336, 8688
            ]

            junction Junction361 pe
            [
                position = 9464, 8688
            ]

            junction Junction362 pe
            [
                position = 9472, 8000
            ]

            junction Junction363 pe
            [
                position = 9584, 8096
            ]

            junction Junction369 pe
            [
                position = 7376, 8096
            ]

            junction Junction370 pe
            [
                position = 7376, 7904
            ]

            junction Junction371 sp
            [
                position = 7016, 8000
            ]

            junction Junction372 sp
            [
                position = 7016, 8136
            ]

            junction Junction373 sp
            [
                position = 6608, 7576
            ]

            connect Ea1.n_node Junction292 as Connection1069
            [
                breakpoints = 8544, 8224; 8384, 8224; 8384, 8304; 8384, 8688
            ]
            connect Xi_b1.out Goto44 as Connection374
            connect La1.p_node Ia1.p_node as Connection665
            connect Eb_1.in Junction283 as Connection952
            connect Rt0a1.n_node Junction161 as Connection366
            connect R0b1.n_node L0b1.n_node as Connection385
            connect Junction207 Junction215 as Connection1222
            [
                breakpoints = 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688
            ]
            connect Xi_a1.n_node Junction161 as Connection314
            connect Xi_b1.n_node Junction160 as Connection388
            connect Goto35 Xi_a1.out as Connection342
            connect Xi_c1.out Goto38 as Connection313
            connect Junction283 Eb1.out as Connection951
            connect Junction192 Junction194 as Connection459
            connect Vc2.out Goto33 as Connection617
            [
                breakpoints = 7984, 8480; 7968, 8480
            ]
            connect Junction213 Cb1.p_node as Connection613
            [
                breakpoints = 8240, 8304; 8240, 8304; 8240, 8304
            ]
            connect Ic1.out Goto31 as Connection668
            connect Lc1.p_node Ic1.p_node as Connection663
            connect Rt0b1.n_node Junction160 as Connection351
            connect Junction194 Ca1.n_node as Connection597
            [
                breakpoints = 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8544; 8160, 8544
            ]
            connect L0c1.p_node Xi_c1.p_node as Connection328
            connect Va2.out Goto34 as Connection624
            connect R0c1.n_node L0c1.n_node as Connection330
            connect Junction195 Junction194 as Connection463
            connect Junction207 Junction198 as Connection574
            [
                breakpoints = 8240, 8688
            ]
            connect Cb1.n_node Junction212 as Connection602
            connect VbG.out Vb_G as Connection1126
            connect Vb2.p_node Junction213 as Connection614
            [
                breakpoints = 8064, 8304; 8240, 8304
            ]
            connect Eb1.n_node Junction195 as Connection462
            connect Goto39 Ib1.out as Connection669
            connect Vc2.p_node Junction216 as Connection627
            connect Lb1.p_node Ib1.p_node as Connection664
            connect Vc2.n_node Junction215 as Connection623
            connect Rc1.n_node Lc1.n_node as Connection399
            connect Goto40 Junction283 as Connection950
            connect L0a1.p_node Xi_a1.p_node as Connection378
            connect Junction198 Junction199 as Connection537
            [
                breakpoints = 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688
            ]
            connect Vb2.out Goto42 as Connection616
            connect Xi_c1.n_node Junction173 as Connection304
            connect Junction212 Junction192 as Connection603
            connect Rt0c1.p_node Junction216 as Connection625
            [
                breakpoints = 8320, 8288
            ]
            connect Ec_1.in Junction284 as Connection956
            [
                breakpoints = 8624, 8384; 8624, 8352
            ]
            connect La1.n_node Ra1.n_node as Connection401
            connect L0b1.p_node Xi_b1.p_node as Connection372
            connect L0a1.n_node R0a1.n_node as Connection355
            connect Ia1.out Goto32 as Connection666
            connect Rt0b1.p_node Junction213 as Connection612
            connect Rb1.n_node Lb1.n_node as Connection354
            connect Junction192 Junction292 as Connection1067
            connect Vb2.n_node Junction215 as Connection621
            connect Junction284 Ec1.out as Connection955
            [
                breakpoints = 8624, 8352; 8624, 8272
            ]
            connect Junction292 Cc1.n_node as Connection1068
            [
                breakpoints = 8240, 8688; 8240, 8688; 8240, 8544; 8320, 8544
            ]
            connect Goto30 Junction284 as Connection954
            connect Junction216 Cc1.p_node as Connection626
            [
                breakpoints = 8320, 8304; 8320, 8304; 8320, 8304
            ]
            connect Vc_G VcG.out as Connection1127
            connect Rt0c1.n_node Junction173 as Connection327
            connect Junction198 Junction195 as Connection477
            [
                breakpoints = 8240, 8688; 8240, 8688
            ]
            connect Goto41 Junction311 as Connection1292
            connect Junction311 Ea1.out as Connection1293
            connect Ea_1.in Junction311 as Connection1294
            connect Rt0a1.p_node Junction312 as Connection1296
            connect Junction312 Ca1.p_node as Connection1297
            connect Va2.p_node Junction312 as Connection1298
            connect "INV_sync OFF.in" "Logical operator1.out" as Connection155
            connect INV_sync.out Junction47 as Connection1299
            connect Junction47 Connect6 as Connection343
            connect "Logical operator1.in" Junction48 as Connection345
            connect Junction48 Junction47 as Connection346
            connect "INV_sync ON.in" Junction48 as Connection347
            connect Gain18.out Controller.U_P as Connection1892
            connect Gain17.out Controller.U_Q as Connection1893
            connect Junction161 Junction320 as Connection1899
            [
                breakpoints = 8160, 7904
            ]
            connect Junction320 Ea1.p_node as Connection1900
            [
                breakpoints = 8544, 7904; 8544, 7904; 8544, 7904
            ]
            connect Eb1.p_node Junction321 as Connection1902
            connect Junction321 Junction160 as Connection1903
            [
                breakpoints = 8608, 8000
            ]
            connect Rb1.p_node Junction321 as Connection1904
            connect Junction173 Junction322 as Connection1905
            [
                breakpoints = 8320, 8096
            ]
            connect Junction322 Ec1.p_node as Connection1906
            [
                breakpoints = 8688, 8272; 8688, 8272; 8688, 8096
            ]
            connect Rc1.p_node Junction322 as Connection1907
            connect VaG.out Va_G as Connection1919
            connect Junction320 Ra1.p_node as Connection1941
            [
                breakpoints = 8544, 7904; 8800, 7904
            ]
            connect "Logical operator3.out" Goto45 as Connection1954
            [
                breakpoints = 6984, 8336
            ]
            connect From2 "Bus Split1.in" as Connection1978
            connect "Bus Split1.out" "Three Phase Inverter.InA" as Connection1979
            connect "Bus Split1.out1" "Three Phase Inverter.InB" as Connection1980
            connect "Bus Split1.out2" "Three Phase Inverter.InC" as Connection1981
            connect Constant2.out "Three Phase Inverter.En" as Connection1982
            connect "Three Phase Inverter.a_in" R0a1.p_node as Connection2019
            connect "Three Phase Inverter.b_in" R0b1.p_node as Connection2020
            connect "Three Phase Inverter.c_in" R0c1.p_node as Connection2021
            connect From58 "Power Meter.va" as Connection2022
            connect From59 "Power Meter.vb" as Connection2023
            [
                breakpoints = 8928, 7464; 8928, 7480
            ]
            connect From60 "Power Meter.vc" as Connection2024
            connect From61 "Power Meter.ia" as Connection2025
            connect From62 "Power Meter.ib" as Connection2026
            [
                breakpoints = 8864, 7528; 8960, 7528
            ]
            connect From63 "Power Meter.ic" as Connection2027
            connect P.in "Power Meter.Pdc" as Connection2028
            connect Q.in "Power Meter.Qdc" as Connection2029
            connect From31 Power_Meas.Vq as Connection403
            connect From32 Power_Meas.Vd as Connection402
            connect From34 Power_Meas.Id as Connection404
            connect Goto50 Junction188 as Connection541
            connect Goto49 Junction189 as Connection544
            connect Goto52 Junction190 as Connection547
            connect Goto51 Junction191 as Connection550
            connect Junction188 Power_Meas.P as Connection540
            connect Junction189 Power_Meas.Q as Connection543
            connect Junction190 Power_Meas.S as Connection546
            connect Junction191 Power_Meas.pf as Connection549
            connect P1.in Junction188 as Connection539
            connect Power_Meas.Iq From35 as Connection405
            connect Q1.in Junction189 as Connection542
            connect S.in Junction190 as Connection545
            connect pf.in Junction191 as Connection548
            connect Junction212 Va2.n_node as Connection2089
            [
                breakpoints = 8240, 8688; 8240, 8688; 7744, 8688; 7744, 8688
            ]
            connect "Logical operator2.out" S2.ctrl_in as Connection1938
            connect CONNECT.out "Logical operator2.in" as Connection1939
            connect Connect2 "Rate Transition6.in" as Connection1955
            connect "Rate Transition6.out" "Logical operator2.in1" as Connection1956
            connect S2.a_out A as Connection2116
            connect S2.b_out B as Connection2117
            connect S2.c_out C as Connection2118
            connect Junction356 S2.a_in as Connection2121
            connect Vrms.p_node Junction356 as Connection2122
            connect Ib1.n_node Junction357 as Connection2123
            connect Vrms.n_node Junction357 as Connection2125
            connect Ia1.n_node Junction358 as Connection2126
            connect Junction358 Junction356 as Connection2127
            connect VaG.p_node Junction358 as Connection2128
            connect Ec1.n_node Junction359 as Connection2129
            [
                breakpoints = 8688, 8536
            ]
            connect Junction359 Junction207 as Connection2130
            [
                breakpoints = 8688, 8688; 8688, 8688; 8688, 8688; 8688, 8688; 8688, 8688; 8688, 8688; 8240, 8688; 8240, 8688
            ]
            connect VaG.n_node Junction360 as Connection2132
            connect Junction360 Junction359 as Connection2133
            connect VbG.n_node Junction361 as Connection2135
            connect Junction361 Junction360 as Connection2136
            connect VcG.n_node Junction361 as Connection2137
            connect Junction357 Junction362 as Connection2138
            connect Junction362 S2.b_in as Connection2139
            connect VbG.p_node Junction362 as Connection2140
            connect Ic1.n_node Junction363 as Connection2141
            connect Junction363 S2.c_in as Connection2142
            connect VcG.p_node Junction363 as Connection2143
            connect From7 "Rate Transition1.in" as Connection4333
            connect "Rate Transition1.out" "Logical operator3.in" as Connection4334
            connect Vdc.p_node Idc.n_node as Connection4365
            connect Vdc.n_node Junction369 as Connection4376
            connect Junction369 Cdc.n_node as Connection4377
            [
                breakpoints = 7376, 8096; 7376, 8040
            ]
            connect "Three Phase Inverter.neg_out" Junction369 as Connection4378
            connect Idc.p_node Junction370 as Connection4380
            connect Junction370 Cdc.p_node as Connection4381
            [
                breakpoints = 7376, 7904; 7376, 7944
            ]
            connect "Three Phase Inverter.pos_out" Junction370 as Connection4382
            connect Battery.Vdc Junction371 as Connection4384
            connect Junction371 Vdc.in as Connection4385
            connect Junction372 Junction371 as Connection4388
            connect VDC.in Junction372 as Connection4389
            connect Goto18 "Rate Transition7.out" as Connection4390
            connect "Rate Transition7.in" Junction372 as Connection4391
            connect Idc.out Goto54 as Connection4395
            [
                breakpoints = 7248, 8144
            ]
            connect P_ref_ess.out "C function1.ref" as Connection4396
            connect From66 Junction373 as Connection4399
            connect Junction373 "C function1.charge" as Connection4400
            connect "C function2.charge" Junction373 as Connection4401
            connect Q_ref_ess.out "C function2.ref" as Connection4402
            connect "C function2.out" Gain17.in as Connection4403
            connect "C function1.out" Gain18.in as Connection4404

            mask {
                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A lead acid battery interfaced with a three-phase inverter and LCL filter</p></body></html>"

                Nb {
                    label = "Number of cells in series"
                    widget = edit
                    type = generic
                    default_value = "20"
                    group = "1. Battery"
                }

                Inom {
                    label = "Nominal current"
                    widget = edit
                    type = generic
                    default_value = "55"
                    unit = "A"
                    group = "1. Battery"
                }

                Tamb {
                    label = "Ambient temperature"
                    widget = edit
                    type = generic
                    default_value = "30"
                    unit = "C"
                    group = "1. Battery"
                }

                Ri {
                    label = "Internal resistance"
                    widget = edit
                    type = generic
                    default_value = "0.01"
                    unit = "Ohm"
                    group = "1. Battery"
                }

                Ts {
                    label = "Execution rate"
                    widget = edit
                    type = generic
                    default_value = "Ts_ess"
                    unit = "s"
                    group = "1. Battery"
                }

                S {
                    label = "Rated Power "
                    widget = edit
                    type = generic
                    default_value = "20e3"
                    unit = "VA"
                    group = "2. Three-phase Inverter"
                }

                V_ABC {
                    label = "Rated Phase Voltage (RMS)"
                    widget = edit
                    type = generic
                    default_value = "480/np.sqrt(3)"
                    unit = "V"
                    group = "2. Three-phase Inverter"
                }

                w_0 {
                    label = "Nominal Frequency"
                    widget = edit
                    type = generic
                    default_value = "2*np.pi*60"
                    unit = "rad/s"
                    group = "2. Three-phase Inverter"
                }

                R_i {
                    label = "Input Resistance"
                    widget = edit
                    type = generic
                    default_value = "1e-3"
                    unit = "Ω"
                    group = "3. LCL filter"
                }

                L_i {
                    label = "Input Inductance"
                    widget = edit
                    type = generic
                    default_value = "0.0333"
                    unit = "H"
                    group = "3. LCL filter"
                }

                R_s {
                    label = "Shunt Resistance"
                    widget = edit
                    type = generic
                    default_value = "2.5872"
                    unit = "Ω"
                    group = "3. LCL filter"
                }

                C_s {
                    label = "Shunt Capacitance"
                    widget = edit
                    type = generic
                    default_value = "5e-6"
                    unit = "F"
                    group = "3. LCL filter"
                }

                R_o {
                    label = "Output Resistance"
                    widget = edit
                    type = generic
                    default_value = "2e-3 - R"
                    unit = "Ω"
                    group = "3. LCL filter"
                }

                L_o {
                    label = "Output Inductance"
                    widget = edit
                    type = generic
                    default_value = "3.04e-4 - L"
                    unit = "H"
                    group = "3. LCL filter"
                }

                Kp_I {
                    label = "Inner Loop Proportional Gain"
                    widget = edit
                    type = generic
                    default_value = "0.6079*10"
                    group = "4. Cascaded Controller"
                }

                Ki_I {
                    label = "Inner Loop Integral Gain"
                    widget = edit
                    type = generic
                    default_value = "4*10"
                    group = "4. Cascaded Controller"
                }

                Imax {
                    label = "Inner Loop Upper Limit"
                    widget = edit
                    type = generic
                    default_value = "1"
                    group = "4. Cascaded Controller"
                }

                Imin {
                    label = "Inner Loop Lower Limit"
                    widget = edit
                    type = generic
                    default_value = "-1"
                    group = "4. Cascaded Controller"
                }

                Kp_V {
                    label = "Outer Loop Proportional Gain"
                    widget = edit
                    type = generic
                    default_value = "0.0033"
                    group = "4. Cascaded Controller"
                }

                Ki_V {
                    label = "Outer Loop Integral Gain"
                    widget = edit
                    type = generic
                    default_value = "0.7493"
                    group = "4. Cascaded Controller"
                }

                Vmax {
                    label = "Outer Loop Upper Limit"
                    widget = edit
                    type = generic
                    default_value = "1"
                    group = "4. Cascaded Controller"
                }

                Vmin {
                    label = "Outer Loop Lower Limit"
                    widget = edit
                    type = generic
                    default_value = "-1"
                    group = "4. Cascaded Controller"
                }

                f_D {
                    label = "Frequency Droop Coefficient"
                    widget = edit
                    type = generic
                    default_value = "3e-3"
                    unit = "%"
                    group = "5. Droop Control"
                }

                V_D {
                    label = "Voltage Droop Coefficient"
                    widget = edit
                    type = generic
                    default_value = "5e-3"
                    unit = "%"
                    group = "5. Droop Control"
                }

                T_m {
                    label = "Measurement delay"
                    widget = edit
                    type = generic
                    default_value = "0.5"
                    unit = "s"
                    group = "5. Droop Control"
                }

                maxV_slip {
                    label = "Maximum slip (voltage)"
                    widget = edit
                    type = generic
                    default_value = "5e-3"
                    unit = "pu"
                    group = "6. Automatic Synchronizer"
                }

                minV_slip {
                    label = "Minimum slip (voltage)"
                    widget = edit
                    type = generic
                    default_value = "2.5e-3"
                    unit = "pu"
                    group = "6. Automatic Synchronizer"
                }

                maxw_slip {
                    label = "Maximum slip (frequency)"
                    widget = edit
                    type = generic
                    default_value = "10e-3"
                    unit = "pu"
                    group = "6. Automatic Synchronizer"
                }

                minw_slip {
                    label = "Minimum slip (frequency)"
                    widget = edit
                    type = generic
                    default_value = "5e-3"
                    unit = "pu"
                    group = "6. Automatic Synchronizer"
                }

                maxV_pds {
                    label = "Maximum difference signal (voltage)"
                    widget = edit
                    type = generic
                    default_value = "1e-2"
                    unit = "pu"
                    group = "6. Automatic Synchronizer"
                }

                maxw_pds {
                    label = "Maximum difference signal (frequency)"
                    widget = edit
                    type = generic
                    default_value = "5e-1"
                    unit = "pu"
                    group = "6. Automatic Synchronizer"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE

                CODE init
                    S = mdl.get_property_value(mdl.prop(item_handle, "S"))
                    V_ABC = mdl.get_property_value(mdl.prop(item_handle, "V_ABC"))
                    w_0 = mdl.get_property_value(mdl.prop(item_handle, "w_0"))
                    Ts = mdl.get_property_value(mdl.prop(item_handle, "Ts"))
                    R_i = mdl.get_property_value(mdl.prop(item_handle, "R_i"))
                    L_i = mdl.get_property_value(mdl.prop(item_handle, "L_i"))
                    R_s = mdl.get_property_value(mdl.prop(item_handle, "R_s"))
                    C_s = mdl.get_property_value(mdl.prop(item_handle, "C_s"))
                    R_o = mdl.get_property_value(mdl.prop(item_handle, "R_o"))
                    L_o = mdl.get_property_value(mdl.prop(item_handle, "L_o"))
                    #R = mdl.get_property_value(mdl.prop(item_handle, "R"))
                    #L = mdl.get_property_value(mdl.prop(item_handle, "L"))
                    Kp_I = mdl.get_property_value(mdl.prop(item_handle, "Kp_I"))
                    Ki_I = mdl.get_property_value(mdl.prop(item_handle, "Ki_I"))
                    Imax = mdl.get_property_value(mdl.prop(item_handle, "Imax"))
                    Imin = mdl.get_property_value(mdl.prop(item_handle, "Imin"))
                    Kp_V = mdl.get_property_value(mdl.prop(item_handle, "Kp_V"))
                    Ki_V = mdl.get_property_value(mdl.prop(item_handle, "Ki_V"))
                    Vmax = mdl.get_property_value(mdl.prop(item_handle, "Vmax"))
                    Vmin = mdl.get_property_value(mdl.prop(item_handle, "Vmin"))
                    f_D = mdl.get_property_value(mdl.prop(item_handle, "f_D"))
                    V_D = mdl.get_property_value(mdl.prop(item_handle, "V_D"))
                    T_m = mdl.get_property_value(mdl.prop(item_handle, "T_m"))
                    
                    
                    Tfast = Ts
                    S_DQ = (2/3)*S
                    V_DQ = V_ABC*np.sqrt(2)
                    I_DQ = S_DQ/V_DQ
                    Z_DQ = V_DQ/I_DQ
                    mP = w_0*(f_D/100)
                    nQ = V_DQ*(V_D/100)
                    D_f = 1/mP
                    D_V = 1/nQ
                    Tsync = 1
                    
                    #Nb = 500;
                    #Inom = 50;
                    Cnom = Inom*10;
                    #Vch = V_ABC*1.8;
                    #Vdisch = V_ABC*2.2;
                    Vch = 750;
                    Vdisch = 750;
                    #Tamb = 30;
                ENDCODE

                CODE define_icon
                ENDCODE

                CODE pre_compile
                    # HEADER START
                    Nb = mdl.get_property_value(mdl.prop(item_handle, "Nb"))
                    Inom = mdl.get_property_value(mdl.prop(item_handle, "Inom"))
                    Tamb = mdl.get_property_value(mdl.prop(item_handle, "Tamb"))
                    Ri = mdl.get_property_value(mdl.prop(item_handle, "Ri"))
                    Ts = mdl.get_property_value(mdl.prop(item_handle, "Ts"))
                    S = mdl.get_property_value(mdl.prop(item_handle, "S"))
                    V_ABC = mdl.get_property_value(mdl.prop(item_handle, "V_ABC"))
                    w_0 = mdl.get_property_value(mdl.prop(item_handle, "w_0"))
                    R_i = mdl.get_property_value(mdl.prop(item_handle, "R_i"))
                    L_i = mdl.get_property_value(mdl.prop(item_handle, "L_i"))
                    R_s = mdl.get_property_value(mdl.prop(item_handle, "R_s"))
                    C_s = mdl.get_property_value(mdl.prop(item_handle, "C_s"))
                    R_o = mdl.get_property_value(mdl.prop(item_handle, "R_o"))
                    L_o = mdl.get_property_value(mdl.prop(item_handle, "L_o"))
                    Kp_I = mdl.get_property_value(mdl.prop(item_handle, "Kp_I"))
                    Ki_I = mdl.get_property_value(mdl.prop(item_handle, "Ki_I"))
                    Imax = mdl.get_property_value(mdl.prop(item_handle, "Imax"))
                    Imin = mdl.get_property_value(mdl.prop(item_handle, "Imin"))
                    Kp_V = mdl.get_property_value(mdl.prop(item_handle, "Kp_V"))
                    Ki_V = mdl.get_property_value(mdl.prop(item_handle, "Ki_V"))
                    Vmax = mdl.get_property_value(mdl.prop(item_handle, "Vmax"))
                    Vmin = mdl.get_property_value(mdl.prop(item_handle, "Vmin"))
                    f_D = mdl.get_property_value(mdl.prop(item_handle, "f_D"))
                    V_D = mdl.get_property_value(mdl.prop(item_handle, "V_D"))
                    T_m = mdl.get_property_value(mdl.prop(item_handle, "T_m"))
                    maxV_slip = mdl.get_property_value(mdl.prop(item_handle, "maxV_slip"))
                    minV_slip = mdl.get_property_value(mdl.prop(item_handle, "minV_slip"))
                    maxw_slip = mdl.get_property_value(mdl.prop(item_handle, "maxw_slip"))
                    minw_slip = mdl.get_property_value(mdl.prop(item_handle, "minw_slip"))
                    maxV_pds = mdl.get_property_value(mdl.prop(item_handle, "maxV_pds"))
                    maxw_pds = mdl.get_property_value(mdl.prop(item_handle, "maxw_pds"))
                    # HEADER STOP
                    S = mdl.get_property_value(mdl.prop(item_handle, "S"))
                    V_ABC = mdl.get_property_value(mdl.prop(item_handle, "V_ABC"))
                    w_0 = mdl.get_property_value(mdl.prop(item_handle, "w_0"))
                    Ts = mdl.get_property_value(mdl.prop(item_handle, "Ts"))
                    R_i = mdl.get_property_value(mdl.prop(item_handle, "R_i"))
                    L_i = mdl.get_property_value(mdl.prop(item_handle, "L_i"))
                    R_s = mdl.get_property_value(mdl.prop(item_handle, "R_s"))
                    C_s = mdl.get_property_value(mdl.prop(item_handle, "C_s"))
                    R_o = mdl.get_property_value(mdl.prop(item_handle, "R_o"))
                    L_o = mdl.get_property_value(mdl.prop(item_handle, "L_o"))
                    #R = mdl.get_property_value(mdl.prop(item_handle, "R"))
                    #L = mdl.get_property_value(mdl.prop(item_handle, "L"))
                    Kp_I = mdl.get_property_value(mdl.prop(item_handle, "Kp_I"))
                    Ki_I = mdl.get_property_value(mdl.prop(item_handle, "Ki_I"))
                    Imax = mdl.get_property_value(mdl.prop(item_handle, "Imax"))
                    Imin = mdl.get_property_value(mdl.prop(item_handle, "Imin"))
                    Kp_V = mdl.get_property_value(mdl.prop(item_handle, "Kp_V"))
                    Ki_V = mdl.get_property_value(mdl.prop(item_handle, "Ki_V"))
                    Vmax = mdl.get_property_value(mdl.prop(item_handle, "Vmax"))
                    Vmin = mdl.get_property_value(mdl.prop(item_handle, "Vmin"))
                    f_D = mdl.get_property_value(mdl.prop(item_handle, "f_D"))
                    V_D = mdl.get_property_value(mdl.prop(item_handle, "V_D"))
                    T_m = mdl.get_property_value(mdl.prop(item_handle, "T_m"))
                    
                    
                    Tfast = Ts
                    S_DQ = (2/3)*S
                    V_DQ = V_ABC*np.sqrt(2)
                    I_DQ = S_DQ/V_DQ
                    Z_DQ = V_DQ/I_DQ
                    mP = w_0*(f_D/100)
                    nQ = V_DQ*(V_D/100)
                    D_f = 1/mP
                    D_V = 1/nQ
                    Tsync = 1
                    
                    #Nb = 500;
                    #Inom = 50;
                    Cnom = Inom*10;
                    #Vch = V_ABC*1.8;
                    #Vdisch = V_ABC*2.2;
                    Vch = 750;
                    Vdisch = 750;
                    #Tamb = 30;
                ENDCODE
            }
        }
        [
            position = 5752, 7864
            size = 64, 80
        ]

        component Subsystem "Core coupling2" {
            layout = dynamic
            component "core/Three Phase Core Coupling" "Core Coupling" {
            }
            [
                position = 8192, 8192
                size = 12, 256
            ]

            port b {
                position = right:2
                kind = pe
            }
            [
                position = 8256, 8192
                rotation = down
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 8120, 8192
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 8120, 8288
            ]

            port c {
                position = right:3
                kind = pe
            }
            [
                position = 8256, 8288
                rotation = down
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 8120, 8096
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8256, 8096
                rotation = down
            ]

            connect "Core Coupling.c_out" c as Connection4
            connect "Core Coupling.b_out" b as Connection1
            connect "Core Coupling.a_out" a as Connection6
            connect "Core Coupling.b_in" B as Connection2
            connect "Core Coupling.a_in" A as Connection5
            connect "Core Coupling.c_in" C as Connection3
        }
        [
            position = 5904, 8072
            size = 48, 80
        ]

        component Subsystem "Core coupling1" {
            layout = dynamic
            component "core/Three Phase Core Coupling" "Core Coupling" {
            }
            [
                position = 8192, 8192
                size = 12, 256
            ]

            port b {
                position = right:2
                kind = pe
            }
            [
                position = 8256, 8192
                rotation = down
            ]

            port B {
                position = left:2
                kind = pe
            }
            [
                position = 8120, 8192
            ]

            port C {
                position = left:3
                kind = pe
            }
            [
                position = 8120, 8288
            ]

            port c {
                position = right:3
                kind = pe
            }
            [
                position = 8256, 8288
                rotation = down
            ]

            port A {
                position = left:1
                kind = pe
            }
            [
                position = 8120, 8096
            ]

            port a {
                position = right:1
                kind = pe
            }
            [
                position = 8256, 8096
                rotation = down
            ]

            connect "Core Coupling.c_out" c as Connection4
            connect "Core Coupling.b_out" b as Connection1
            connect "Core Coupling.a_out" a as Connection6
            connect "Core Coupling.b_in" B as Connection2
            connect "Core Coupling.a_in" A as Connection5
            connect "Core Coupling.c_in" C as Connection3
        }
        [
            position = 5904, 7864
            size = 48, 80
        ]

        component "core/RL Section" "RL Section1" {
            inductance_per_l_mile = "L"
            length_mile = "1"
            resistance_per_l_mile = "R"
        }
        [
            position = 6160, 7864
            hide_name = True
            scale = -1, 1
            size = 256, 56
        ]

        component "core/RL Section" "RL Section2" {
            inductance_per_l_mile = "L"
            length_mile = "1"
            resistance_per_l_mile = "R"
        }
        [
            position = 6160, 8072
            hide_name = True
            scale = -1, 1
            size = 256, 56
        ]

        component Subsystem "EV charging st" {
            layout = dynamic
            component Subsystem "Charging Station" {
                layout = dynamic
                component Subsystem Charging_station_meter_split {
                    layout = dynamic
                    component gen_probe POWER_Q {
                    }
                    [
                        position = 7992, 8352
                        scale = -1, 1
                    ]

                    component "core/Meter Split" "Meter Split1" {
                        freq = "True"
                        i_rms = "True"
                        power_p = "True"
                        power_pf = "True"
                        power_q = "True"
                        van = "False"
                        vbn = "False"
                        vcn = "False"
                        vll_rms = "True"
                    }
                    [
                        position = 8288, 8264
                        scale = -1, 1
                        size = 88, 208
                    ]

                    component gen_z_domain_transfer lpf2 {
                        a_coeff = "[1.0/(2.0*np.pi*5.0), 1.0]"
                        b_coeff = "[1.0]"
                        domain = "S-domain"
                    }
                    [
                        position = 8072, 8352
                        scale = -1, 1
                    ]

                    component gen_z_domain_transfer lpf {
                        a_coeff = "[1.0/(2.0*np.pi*5.0), 1.0]"
                        b_coeff = "[1.0]"
                        domain = "S-domain"
                    }
                    [
                        position = 8112, 8192
                        scale = -1, 1
                    ]

                    component gen_probe VLL_RMS {
                    }
                    [
                        position = 8024, 8192
                        scale = -1, 1
                    ]

                    component gen_z_domain_transfer lpf1 {
                        a_coeff = "[1.0/(2.0*np.pi*5.0), 1.0]"
                        b_coeff = "[1.0]"
                        domain = "S-domain"
                    }
                    [
                        position = 8112, 8288
                        scale = -1, 1
                    ]

                    component gen_probe POWER_P {
                    }
                    [
                        position = 7984, 8288
                        scale = -1, 1
                    ]

                    component gen_z_domain_transfer lpf3 {
                        a_coeff = "[1.0/(2.0*np.pi*5.0), 1.0]"
                        b_coeff = "[1.0]"
                        domain = "S-domain"
                    }
                    [
                        position = 8152, 8144
                        scale = -1, 1
                    ]

                    component gen_probe f_Hz {
                    }
                    [
                        position = 8064, 8144
                        scale = -1, 1
                    ]

                    component gen_z_domain_transfer lpf4 {
                        a_coeff = "[1.0/(2.0*np.pi*5.0), 1.0]"
                        b_coeff = "[1.0]"
                        domain = "S-domain"
                    }
                    [
                        position = 8184, 8248
                        scale = -1, 1
                    ]

                    component gen_probe I_RMS {
                    }
                    [
                        position = 8064, 8248
                        scale = -1, 1
                    ]

                    component gen_probe pf {
                    }
                    [
                        position = 7992, 8416
                        scale = -1, 1
                    ]

                    component gen_z_domain_transfer lpf5 {
                        a_coeff = "[1.0/(2.0*np.pi*5.0), 1.0]"
                        b_coeff = "[1.0]"
                        domain = "S-domain"
                    }
                    [
                        position = 8072, 8416
                        scale = -1, 1
                    ]

                    component gen_gain Gain1 {
                        gain = "1e-3"
                    }
                    [
                        position = 7928, 8256
                        rotation = down
                        hide_name = True
                    ]

                    component gen_probe P_kW {
                    }
                    [
                        position = 7848, 8256
                        scale = -1, 1
                    ]

                    component gen_probe Q_kVAr {
                    }
                    [
                        position = 7848, 8328
                        scale = -1, 1
                    ]

                    component gen_gain Gain2 {
                        gain = "1e-3"
                    }
                    [
                        position = 7920, 8328
                        rotation = down
                        hide_name = True
                    ]

                    port In {
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8392, 8248
                        rotation = down
                    ]

                    junction Junction1 sp
                    [
                        position = 8024, 8288
                    ]

                    junction Junction2 sp
                    [
                        position = 8024, 8352
                    ]

                    connect lpf2.in "Meter Split1.POWER_Q" as Connection3927
                    [
                        breakpoints = 8136, 8352; 8136, 8312
                    ]
                    connect lpf.in "Meter Split1.VLL_RMS" as Connection3923
                    connect VLL_RMS.in lpf.out as Connection3922
                    connect "Meter Split1.Input" In as Connection3921
                    connect lpf1.in "Meter Split1.POWER_P" as Connection3925
                    connect f_Hz.in lpf3.out as Connection3928
                    connect lpf3.in "Meter Split1.Freq" as Connection3929
                    connect I_RMS.in lpf4.out as Connection3930
                    connect lpf4.in "Meter Split1.I_RMS" as Connection3931
                    connect pf.in lpf5.out as Connection3932
                    connect "Meter Split1.POWER_PF" lpf5.in as Connection3933
                    [
                        breakpoints = 8160, 8344; 8160, 8416
                    ]
                    connect POWER_P.in Junction1 as Connection3934
                    connect Junction1 lpf1.out as Connection3935
                    connect Gain1.in Junction1 as Connection3936
                    connect P_kW.in Gain1.out as Connection3937
                    connect POWER_Q.in Junction2 as Connection3938
                    connect Junction2 lpf2.out as Connection3939
                    connect Gain2.in Junction2 as Connection3940
                    connect Q_kVAr.in Gain2.out as Connection3941
                }
                [
                    position = 9696, 8072
                    rotation = right
                    size = 48, 48
                ]

                component "core/Three-phase Meter" Charging_station_meter {
                    I_avg_rms = "True"
                    I_rms = "True"
                    P_meas = "True"
                    R = "1e4"
                    Ts = "Ts_ev"
                    VAB = "True"
                    VBC = "True"
                    VCA = "True"
                    VLL_avg_rms = "True"
                    VLL_rms = "True"
                    freq = "True"
                }
                [
                    position = 9696, 8256
                    size = 56, 240
                ]

                component Subsystem Batt_out {
                    layout = dynamic
                    component gen_probe Out {
                    }
                    [
                        position = 8048, 8160
                        rotation = left
                        scale = -1, 1
                    ]

                    component gen_bus_split "Bus Split1" {
                        outputs = "14"
                    }
                    [
                        position = 8136, 8216
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 8304, 7968
                        hide_name = True
                    ]

                    component gen_terminator Termination2 {
                    }
                    [
                        position = 8304, 8000
                        hide_name = True
                    ]

                    component gen_terminator Termination3 {
                    }
                    [
                        position = 8304, 8032
                        hide_name = True
                    ]

                    component gen_terminator Termination4 {
                    }
                    [
                        position = 8304, 8064
                        hide_name = True
                    ]

                    component gen_terminator Termination5 {
                    }
                    [
                        position = 8304, 8096
                        hide_name = True
                    ]

                    component gen_terminator Termination6 {
                    }
                    [
                        position = 8304, 8128
                        hide_name = True
                    ]

                    component gen_terminator Termination7 {
                    }
                    [
                        position = 8304, 8224
                        hide_name = True
                    ]

                    component gen_terminator Termination8 {
                    }
                    [
                        position = 8304, 8256
                        hide_name = True
                    ]

                    component gen_terminator Termination9 {
                    }
                    [
                        position = 8304, 8288
                        hide_name = True
                    ]

                    component gen_terminator Termination10 {
                    }
                    [
                        position = 8304, 8320
                        hide_name = True
                    ]

                    component gen_terminator Termination11 {
                    }
                    [
                        position = 8304, 8352
                        hide_name = True
                    ]

                    component gen_terminator Termination12 {
                    }
                    [
                        position = 8304, 8384
                        hide_name = True
                    ]

                    component gen_terminator Termination13 {
                    }
                    [
                        position = 8304, 8416
                        hide_name = True
                    ]

                    port outputs {
                        position = right:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 8256
                        rotation = left
                        hide_name = True
                    ]

                    port charger_CB {
                        position = left:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8304, 7920
                    ]

                    junction Junction1 sp
                    [
                        position = 8048, 8216
                    ]

                    connect outputs Junction1 as Connection9
                    [
                        breakpoints = 8048, 8224
                    ]
                    connect Junction1 Out.in as Connection10
                    [
                        breakpoints = 8048, 8184
                    ]
                    connect "Bus Split1.in" Junction1 as Connection11
                    connect charger_CB "Bus Split1.out" as Connection12
                    connect "Bus Split1.out1" Termination1.in as Connection13
                    [
                        breakpoints = 8184, 8128; 8184, 7976
                    ]
                    connect "Bus Split1.out2" Termination2.in as Connection14
                    [
                        breakpoints = 8192, 8144; 8192, 8016
                    ]
                    connect "Bus Split1.out3" Termination3.in as Connection15
                    [
                        breakpoints = 8200, 8160; 8200, 8032
                    ]
                    connect "Bus Split1.out4" Termination4.in as Connection16
                    [
                        breakpoints = 8208, 8176; 8208, 8064
                    ]
                    connect "Bus Split1.out5" Termination5.in as Connection17
                    [
                        breakpoints = 8216, 8192; 8216, 8096
                    ]
                    connect "Bus Split1.out6" Termination6.in as Connection18
                    [
                        breakpoints = 8224, 8208; 8224, 8128
                    ]
                    connect "Bus Split1.out7" Termination7.in as Connection19
                    connect "Bus Split1.out8" Termination8.in as Connection20
                    [
                        breakpoints = 8272, 8240
                    ]
                    connect "Bus Split1.out9" Termination9.in as Connection21
                    [
                        breakpoints = 8264, 8256
                    ]
                    connect "Bus Split1.out10" Termination10.in as Connection22
                    [
                        breakpoints = 8256, 8272
                    ]
                    connect "Bus Split1.out11" Termination11.in as Connection23
                    [
                        breakpoints = 8248, 8288
                    ]
                    connect "Bus Split1.out12" Termination12.in as Connection24
                    [
                        breakpoints = 8232, 8304
                    ]
                    connect "Bus Split1.out13" Termination13.in as Connection25
                    [
                        breakpoints = 8216, 8336
                    ]
                }
                [
                    position = 9880, 8064
                    rotation = right
                    scale = -1, 1
                    size = 48, 48
                ]

                component Subsystem Batt_in {
                    layout = dynamic
                    component src_scada_input Pref {
                        execution_rate = "Ts"
                        max = "10e6"
                        min = "-10e6"
                        unit = ""
                    }
                    [
                        position = 8168, 8192
                    ]

                    component gen_c_function "C function1" {
                        in_terminal_dimensions = "inherit;inherit;inherit"
                        in_terminal_dimensions_str = "on inherit;speed inherit;motorstatus inherit"
                        in_terminal_labels = "[(\'on\', True), (\'speed\', True), (\'motorstatus\', True)]"
                        in_terminal_properties = "real on;real speed;inherit motorstatus;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', False)]"
                        output_fnc = "/*Begin code section*/
if (speed <= 0.1 && motorstatus == 0)
        out = on;
    else
        out = 0;
/*End code section*/"
                    }
                    [
                        position = 8232, 8016
                        hide_name = True
                        size = 72, 64
                    ]

                    component src_scada_input f_ref {
                        def_value = "60.0"
                        execution_rate = "Ts"
                        unit = ""
                    }
                    [
                        position = 8168, 8128
                    ]

                    component src_scada_input Qref {
                        execution_rate = "Ts"
                        max = "10e6"
                        min = "-10e6"
                        unit = ""
                    }
                    [
                        position = 8120, 8240
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 8104, 8040
                        hide_name = True
                    ]

                    component gen_bus_join "Bus Join2" {
                        inputs = "6"
                    }
                    [
                        position = 8264, 8336
                        rotation = right
                        hide_name = True
                    ]

                    component src_scada_input Vref {
                        def_value = "480"
                        execution_rate = "Ts"
                        unit = ""
                    }
                    [
                        position = 8120, 8176
                    ]

                    component src_scada_input mode {
                        execution_rate = "Ts"
                        max = "2"
                        min = "0"
                        unit = ""
                    }
                    [
                        position = 8120, 8096
                    ]

                    component src_scada_input On {
                        execution_rate = "Ts"
                        max = "1"
                        min = "0"
                        unit = ""
                    }
                    [
                        position = 8000, 7936
                    ]

                    component tm_delay "Unit Delay2" {
                    }
                    [
                        position = 8096, 7992
                        hide_name = True
                    ]

                    port inputs {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8264, 8408
                        rotation = right
                        hide_name = True
                    ]

                    port motor_status {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8000, 8040
                    ]

                    port speedkmh {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8000, 7992
                    ]

                    connect Vref.out "Bus Join2.in3" as Connection4
                    connect On.out "C function1.on" as Connection8
                    connect "Bus Join2.out" inputs as Connection7
                    connect "Bus Join2.in4" Pref.out as Connection5
                    connect "Unit Delay1.in" motor_status as Connection20
                    [
                        breakpoints = 8080, 8040
                    ]
                    connect mode.out "Bus Join2.in1" as Connection2
                    connect "Unit Delay1.out" "C function1.motorstatus" as Connection16
                    connect "Bus Join2.in2" f_ref.out as Connection3
                    connect Qref.out "Bus Join2.in5" as Connection6
                    connect "Bus Join2.in" "C function1.out" as Connection14
                    [
                        breakpoints = 8304, 8016
                    ]
                    connect speedkmh "Unit Delay2.in" as Connection21
                    connect "Unit Delay2.out" "C function1.speed" as Connection22
                    [
                        breakpoints = 8128, 8016; 8176, 8016
                    ]

                    Ts = "T_charging_station"

                    mask {
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Scada inputs for the battery inverter component from the Microgrid Library.</p></body></html>"

                        Ts {
                            label = "Execution rate"
                            widget = edit
                            type = generic
                            default_value = "200e-6"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE
                    }
                }
                [
                    position = 10104, 8064
                    rotation = right
                    scale = -1, 1
                    size = 80, 64
                ]

                component Subsystem "Battery inverter" {
                    layout = static
                    component pas_capacitor Cfa {
                        capacitance = "1/(np.square(OutputFilterFc*2*np.pi)*L)"
                    }
                    [
                        position = 8624, 8048
                        rotation = right
                    ]

                    component pas_resistor Rfb {
                        resistance = "Resr"
                    }
                    [
                        position = 8696, 7952
                        rotation = left
                        scale = -1, 1
                    ]

                    component pas_inductor Lb {
                        inductance = "L"
                    }
                    [
                        position = 8336, 7768
                        scale = -1, -1
                    ]

                    component pas_resistor Rdc {
                        resistance = "50e-9"
                    }
                    [
                        position = 7440, 7672
                    ]

                    component pas_inductor Lc {
                        inductance = "L"
                    }
                    [
                        position = 8336, 7864
                        scale = -1, -1
                    ]

                    component pas_inductor La {
                        inductance = "L"
                    }
                    [
                        position = 8336, 7672
                        scale = -1, -1
                    ]

                    component pas_capacitor Cdc {
                        capacitance = "20e-3"
                    }
                    [
                        position = 7520, 7768
                        rotation = right
                    ]

                    component pas_capacitor Cfb {
                        capacitance = "1/(np.square(OutputFilterFc*2*np.pi)*L)"
                    }
                    [
                        position = 8696, 8048
                        rotation = right
                    ]

                    component pas_capacitor Cfc {
                        capacitance = "1/(np.square(OutputFilterFc*2*np.pi)*L)"
                    }
                    [
                        position = 8768, 8048
                        rotation = right
                    ]

                    component pas_resistor Rfa {
                        resistance = "Resr"
                    }
                    [
                        position = 8624, 7952
                        rotation = left
                        scale = -1, 1
                    ]

                    component pas_resistor Rfc {
                        resistance = "Resr"
                    }
                    [
                        position = 8768, 7952
                        rotation = left
                        scale = -1, 1
                    ]

                    component pas_resistor Ra {
                        resistance = "R"
                    }
                    [
                        position = 8232, 7672
                    ]

                    component pas_resistor Rb {
                        resistance = "R"
                    }
                    [
                        position = 8232, 7768
                    ]

                    component pas_resistor Rc {
                        resistance = "R"
                    }
                    [
                        position = 8232, 7864
                    ]

                    component "core/Voltage Measurement" VDC {
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 7600, 7768
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vab1 {
                    }
                    [
                        position = 8584, 7720
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Current Measurement" Ic {
                        addr = "16"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8440, 7864
                        size = 64, 32
                    ]

                    component "core/Current Measurement" Ia {
                        addr = "14"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8440, 7672
                        size = 64, 32
                    ]

                    component Subsystem "Converter meas" {
                        layout = dynamic
                        component pas_resistor R4 {
                            resistance = "1e3"
                        }
                        [
                            position = 7536, 8272
                            rotation = right
                            hide_name = True
                        ]

                        component pas_resistor R5 {
                            resistance = "1e3"
                        }
                        [
                            position = 7576, 8272
                            rotation = right
                            hide_name = True
                        ]

                        component pas_resistor R6 {
                            resistance = "1e3"
                        }
                        [
                            position = 7616, 8272
                            rotation = right
                            hide_name = True
                        ]

                        component "core/Voltage Measurement" Vb {
                            execution_rate = "Ts"
                            sig_output = "True"
                        }
                        [
                            position = 7728, 8280
                            rotation = right
                            size = 64, 32
                        ]

                        component "core/Voltage Measurement" Va {
                            execution_rate = "Ts"
                            sig_output = "True"
                        }
                        [
                            position = 7680, 8208
                            rotation = right
                            size = 64, 32
                        ]

                        component "core/Voltage Measurement" Vc {
                            execution_rate = "Ts"
                            sig_output = "True"
                        }
                        [
                            position = 7776, 8352
                            rotation = right
                            size = 64, 32
                        ]

                        port a {
                            label = "a"
                            position = right:1
                            kind = pe
                        }
                        [
                            position = 7992, 7952
                            rotation = down
                        ]

                        port b {
                            label = "b"
                            position = right:2
                            kind = pe
                        }
                        [
                            position = 7992, 8048
                            rotation = down
                        ]

                        port c {
                            label = "c"
                            position = right:3
                            kind = pe
                        }
                        [
                            position = 7992, 8144
                            rotation = down
                        ]

                        port A {
                            label = "A"
                            position = left:1
                            kind = pe
                        }
                        [
                            position = 7488, 7952
                        ]

                        port B {
                            label = "B"
                            position = left:2
                            kind = pe
                        }
                        [
                            position = 7488, 8048
                        ]

                        port C {
                            label = "C"
                            position = left:3
                            kind = pe
                        }
                        [
                            position = 7488, 8144
                        ]

                        port VA {
                            position = bottom:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8208
                            rotation = down
                            scale = -1, 1
                        ]

                        port VB {
                            position = bottom:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8280
                            rotation = down
                            scale = -1, 1
                        ]

                        port VC {
                            position = bottom:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8352
                            rotation = down
                            scale = -1, 1
                        ]

                        junction Junction183 pe
                        [
                            position = 7728, 8400
                        ]

                        junction Junction189 pe
                        [
                            position = 7576, 8400
                        ]

                        junction Junction190 pe
                        [
                            position = 7616, 8400
                        ]

                        junction Junction191 pe
                        [
                            position = 7680, 8400
                        ]

                        junction Junction198 pe
                        [
                            position = 7536, 7952
                        ]

                        junction Junction199 pe
                        [
                            position = 7576, 8048
                        ]

                        junction Junction200 pe
                        [
                            position = 7616, 8144
                        ]

                        junction Junction201 pe
                        [
                            position = 7680, 7952
                        ]

                        junction Junction202 pe
                        [
                            position = 7728, 8048
                        ]

                        junction Junction203 pe
                        [
                            position = 7776, 8144
                        ]

                        connect A Junction198 as Connection2681
                        connect B Junction199 as Connection2684
                        connect C Junction200 as Connection2687
                        connect Junction183 Junction191 as Connection2652
                        connect Junction183 Vc.n_node as Connection2649
                        connect Junction189 R4.n_node as Connection2647
                        connect Junction190 Junction189 as Connection2651
                        connect Junction190 Junction191 as Connection2654
                        connect Junction191 Va.n_node as Connection2653
                        connect Junction200 Junction203 as Connection2703
                        [
                            position = 0, 0
                        ]
                        connect Junction200 R6.p_node as Connection2686
                        connect Junction201 Junction198 as Connection2698
                        [
                            position = 0, 0
                        ]
                        connect Junction202 Junction199 as Connection2701
                        [
                            position = 0, 0
                        ]
                        connect Junction203 Vc.p_node as Connection2704
                        [
                            position = 0, 0
                        ]
                        connect R4.p_node Junction198 as Connection2679
                        connect R5.n_node Junction189 as Connection2632
                        connect R5.p_node Junction199 as Connection2682
                        connect R6.n_node Junction190 as Connection2650
                        connect VA Va.out as Connection2673
                        connect VB Vb.out as Connection2674
                        connect VC Vc.out as Connection2675
                        connect Va.p_node Junction201 as Connection2697
                        connect Vb.n_node Junction183 as Connection2606
                        connect Vb.p_node Junction202 as Connection2700
                        connect a Junction201 as Connection2699
                        connect b Junction202 as Connection2702
                        connect c Junction203 as Connection2705
                    }
                    [
                        position = 8960, 7768
                        rotation = down
                        scale = -1, -1
                        size = 96, 240
                    ]

                    component "core/Current Measurement" Idc_link {
                        addr = "7"
                        execution_rate = "Ts"
                    }
                    [
                        position = 7800, 7672
                        scale = 1, -1
                        size = 64, 32
                    ]

                    component Subsystem Output {
                        layout = dynamic
                        component gen_bus_join "Bus Join1" {
                            inputs = "14"
                        }
                        [
                            position = 8192, 8192
                            rotation = left
                            hide_name = True
                        ]

                        port Out1 {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8192, 8120
                            rotation = left
                        ]

                        port Connected {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7872, 8312
                        ]

                        port Inv_On {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7936, 8336
                        ]

                        port Va {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7872, 8376
                        ]

                        port Vb {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7936, 8400
                        ]

                        port Vc {
                            position = left:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7872, 8440
                        ]

                        port Ia {
                            position = left:7
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7872, 8496
                        ]

                        port Ib {
                            position = left:8
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7936, 8520
                        ]

                        port Ic {
                            position = left:9
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7872, 8560
                        ]

                        tag From29 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7944, 8472
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From32 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7944, 8680
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From34 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7944, 8584
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From33 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7944, 8656
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From31 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7944, 8632
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From30 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7944, 8608
                            hide_name = True
                            size = 60, 20
                        ]

                        connect "Bus Join1.in5" From29 as Connection25
                        connect "Bus Join1.in10" From30 as Connection16
                        connect "Bus Join1.in11" From31 as Connection17
                        connect "Bus Join1.in13" From32 as Connection19
                        connect "Bus Join1.in7" Ib as Connection27
                        connect "Bus Join1.in1" Inv_On as Connection21
                        connect "Bus Join1.out" Out1 as Connection13
                        connect "Bus Join1.in3" Vb as Connection23
                        connect Connected "Bus Join1.in" as Connection20
                        connect From33 "Bus Join1.in12" as Connection18
                        connect From34 "Bus Join1.in9" as Connection15
                        connect Ia "Bus Join1.in6" as Connection26
                        connect Ic "Bus Join1.in8" as Connection28
                        connect Va "Bus Join1.in2" as Connection22
                        connect Vc "Bus Join1.in4" as Connection24
                    }
                    [
                        position = 9080, 7192
                        rotation = left
                        size = 72, 144
                    ]

                    component "core/Current Measurement" Ib {
                        addr = "15"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 8440, 7768
                        size = 64, 32
                    ]

                    component "core/Voltage Measurement" Vbc {
                    }
                    [
                        position = 8152, 7816
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Triple Pole Single Throw Contactor" S1 {
                        ctrl_src = "Model"
                    }
                    [
                        position = 9272, 7768
                        size = 64, 256
                    ]

                    component Subsystem "Grid meas" {
                        layout = dynamic
                        component pas_resistor R4 {
                            resistance = "1e6"
                        }
                        [
                            position = 7536, 8272
                            rotation = right
                            hide_name = True
                        ]

                        component pas_resistor R6 {
                            resistance = "1e6"
                        }
                        [
                            position = 7616, 8272
                            rotation = right
                            hide_name = True
                        ]

                        component pas_resistor R5 {
                            resistance = "1e6"
                        }
                        [
                            position = 7576, 8272
                            rotation = right
                            hide_name = True
                        ]

                        component "core/Voltage Measurement" Va {
                            execution_rate = "Ts"
                            sig_output = "True"
                        }
                        [
                            position = 7680, 8208
                            rotation = right
                            size = 64, 32
                        ]

                        component "core/Voltage Measurement" Vb {
                            execution_rate = "Ts"
                            sig_output = "True"
                        }
                        [
                            position = 7728, 8280
                            rotation = right
                            size = 64, 32
                        ]

                        component "core/Voltage Measurement" Vc {
                            execution_rate = "Ts"
                            sig_output = "True"
                        }
                        [
                            position = 7776, 8352
                            rotation = right
                            size = 64, 32
                        ]

                        port a {
                            label = "a"
                            position = right:1
                            kind = pe
                        }
                        [
                            position = 7864, 7952
                            rotation = down
                        ]

                        port b {
                            label = "b"
                            position = right:2
                            kind = pe
                        }
                        [
                            position = 7864, 8048
                            rotation = down
                        ]

                        port c {
                            label = "c"
                            position = right:3
                            kind = pe
                        }
                        [
                            position = 7864, 8144
                            rotation = down
                        ]

                        port A {
                            label = "A"
                            position = left:1
                            kind = pe
                        }
                        [
                            position = 7488, 7952
                        ]

                        port B {
                            label = "B"
                            position = left:2
                            kind = pe
                        }
                        [
                            position = 7488, 8048
                        ]

                        port C {
                            label = "C"
                            position = left:3
                            kind = pe
                        }
                        [
                            position = 7488, 8144
                        ]

                        port VA {
                            position = bottom:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8208
                            rotation = down
                            scale = -1, 1
                        ]

                        port VB {
                            position = bottom:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8280
                            rotation = down
                            scale = -1, 1
                        ]

                        port VC {
                            position = bottom:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7864, 8352
                            rotation = down
                            scale = -1, 1
                        ]

                        junction Junction183 pe
                        [
                            position = 7728, 8400
                        ]

                        junction Junction189 pe
                        [
                            position = 7576, 8400
                        ]

                        junction Junction190 pe
                        [
                            position = 7616, 8400
                        ]

                        junction Junction191 pe
                        [
                            position = 7680, 8400
                        ]

                        junction Junction198 pe
                        [
                            position = 7536, 7952
                        ]

                        junction Junction199 pe
                        [
                            position = 7576, 8048
                        ]

                        junction Junction200 pe
                        [
                            position = 7616, 8144
                        ]

                        junction Junction201 pe
                        [
                            position = 7680, 7952
                        ]

                        junction Junction202 pe
                        [
                            position = 7728, 8048
                        ]

                        junction Junction203 pe
                        [
                            position = 7776, 8144
                        ]

                        connect A Junction198 as Connection2681
                        connect B Junction199 as Connection2684
                        connect C Junction200 as Connection2687
                        connect Junction183 Junction191 as Connection2652
                        connect Junction183 Vc.n_node as Connection2649
                        connect Junction189 R4.n_node as Connection2647
                        connect Junction190 Junction189 as Connection2651
                        connect Junction190 Junction191 as Connection2654
                        connect Junction191 Va.n_node as Connection2653
                        connect Junction199 Junction202 as Connection2700
                        connect Junction200 R6.p_node as Connection2686
                        connect Junction201 Junction198 as Connection2698
                        connect Junction202 Vb.p_node as Connection2701
                        connect Junction203 Junction200 as Connection2704
                        connect R4.p_node Junction198 as Connection2679
                        connect R5.n_node Junction189 as Connection2632
                        connect R5.p_node Junction199 as Connection2682
                        connect R6.n_node Junction190 as Connection2650
                        connect VA Va.out as Connection2673
                        connect VB Vb.out as Connection2674
                        connect VC Vc.out as Connection2675
                        connect Va.p_node Junction201 as Connection2697
                        connect Vb.n_node Junction183 as Connection2606
                        connect Vc.p_node Junction203 as Connection2703
                        connect a Junction201 as Connection2699
                        connect b Junction202 as Connection2702
                        connect c Junction203 as Connection2705
                    }
                    [
                        position = 9408, 7768
                        rotation = down
                        scale = -1, -1
                        size = 96, 240
                    ]

                    component "core/Voltage Measurement" Vab {
                    }
                    [
                        position = 8152, 7720
                        rotation = right
                        size = 64, 32
                    ]

                    component "core/Three Phase Inverter" "Three Phase Inverter1" {
                        carrier_freq = "fsw"
                        ctrl_src = "Internal modulator"
                        d_time = "0.5e-6"
                    }
                    [
                        position = 7968, 7768
                        size = 127, 256
                    ]

                    component Subsystem Control_Inputs {
                        layout = dynamic
                        component gen_bus_split "Bus Split2" {
                            outputs = "6"
                        }
                        [
                            position = 8144, 8120
                            rotation = right
                            hide_name = True
                        ]

                        component gen_round Round1 {
                            round_fn = "round"
                        }
                        [
                            position = 8304, 8200
                            hide_name = True
                        ]

                        component gen_round Round2 {
                            round_fn = "round"
                        }
                        [
                            position = 8344, 8176
                            hide_name = True
                        ]

                        component gen_limiter Limit1 {
                            lower_limit = "0"
                            upper_limit = "1"
                        }
                        [
                            position = 8264, 8176
                            hide_name = True
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "0"
                            upper_limit = "1"
                        }
                        [
                            position = 8216, 8200
                            hide_name = True
                        ]

                        component gen_digital_probe on {
                        }
                        [
                            position = 8432, 8112
                        ]

                        port Inputs {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8144, 8048
                            rotation = right
                        ]

                        tag Goto90 {
                            value = "f_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8424, 8224
                            hide_name = True
                            size = 58, 20
                        ]

                        tag Goto21 {
                            value = "Pref"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8424, 8272
                            hide_name = True
                            size = 58, 20
                        ]

                        tag Goto91 {
                            value = "On"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8424, 8176
                            hide_name = True
                            size = 58, 20
                        ]

                        tag Goto89 {
                            value = "Vref"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8424, 8248
                            hide_name = True
                            size = 58, 20
                        ]

                        tag Goto22 {
                            value = "Qref"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8424, 8296
                            hide_name = True
                            size = 58, 20
                        ]

                        tag Goto92 {
                            value = "mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8424, 8200
                            hide_name = True
                            size = 58, 20
                        ]

                        junction Junction1 sp
                        [
                            position = 8376, 8176
                        ]

                        connect "Bus Split2.out5" Goto22 as Connection7
                        connect "Bus Split2.out3" Goto89 as Connection5
                        connect "Bus Split2.out2" Goto90 as Connection4
                        connect "Bus Split2.out" Limit1.in as Connection12
                        connect Goto21 "Bus Split2.out4" as Connection6
                        connect Inputs "Bus Split2.in" as Connection1
                        connect Limit1.out Round2.in as Connection13
                        connect Limit2.in "Bus Split2.out1" as Connection15
                        connect Round1.out Goto92 as Connection8
                        connect Round1.in Limit2.out as Connection14
                        connect Round2.out Junction1 as Connection16
                        connect Junction1 Goto91 as Connection17
                        connect on.in Junction1 as Connection18
                    }
                    [
                        position = 7768, 7200
                        size = 48, 48
                    ]

                    component "core/Current Measurement" Ia_out {
                        addr = "14"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 9112, 7672
                        size = 64, 32
                    ]

                    component "core/Current Measurement" Ib_out {
                        addr = "15"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 9112, 7768
                        size = 64, 32
                    ]

                    component "core/Current Measurement" Ic_out {
                        addr = "16"
                        execution_rate = "Ts"
                        sig_output = "True"
                    }
                    [
                        position = 9112, 7864
                        size = 64, 32
                    ]

                    component Subsystem Control {
                        layout = dynamic
                        component gen_probe Iq {
                            addr = "8965"
                        }
                        [
                            position = 7712, 8944
                            rotation = right
                            scale = -1, -1
                        ]

                        component gen_probe Id {
                            addr = "8968"
                        }
                        [
                            position = 7712, 8784
                            rotation = right
                            scale = -1, -1
                        ]

                        component gen_probe Id_out {
                            addr = "8968"
                        }
                        [
                            position = 7720, 9048
                            rotation = right
                            scale = -1, -1
                        ]

                        component gen_probe Q {
                        }
                        [
                            position = 8848, 8840
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe S {
                        }
                        [
                            position = 8848, 8904
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe P {
                        }
                        [
                            position = 8848, 8776
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/Vn_dc"
                        }
                        [
                            position = 8256, 8184
                            rotation = right
                            hide_name = True
                        ]

                        component gen_probe Vq {
                            addr = "8966"
                            signal_type = "voltage"
                        }
                        [
                            position = 7752, 8520
                            rotation = left
                        ]

                        component gen_probe Vd {
                            addr = "8966"
                            signal_type = "voltage"
                        }
                        [
                            position = 7688, 8520
                            rotation = left
                        ]

                        component gen_probe Vt {
                        }
                        [
                            position = 7688, 8736
                            rotation = right
                        ]

                        component gen_probe pf {
                        }
                        [
                            position = 8848, 8968
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe f {
                            addr = "8966"
                            signal_type = "voltage"
                        }
                        [
                            position = 7752, 8736
                            rotation = right
                        ]

                        component gen_probe Iq_out {
                            addr = "8965"
                        }
                        [
                            position = 7720, 9200
                            rotation = right
                            scale = -1, -1
                        ]

                        component Subsystem ABCtoDQ1 {
                            layout = dynamic
                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 8384, 8120
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 8336, 8120
                                rotation = left
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 8344, 8248
                                rotation = right
                                hide_name = True
                            ]

                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 8256, 8184
                                size = 48, 80
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8200, 8056
                                rotation = right
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8056
                                rotation = right
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8288
                                rotation = left
                            ]

                            port wt {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8192, 8288
                                rotation = left
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8336, 8056
                                rotation = left
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8384, 8056
                                rotation = left
                            ]

                            connect Gain1.out d as Connection2338
                            connect Gain2.out q as Connection2337
                            connect "abc to dq1.d_axis" Gain1.in as Connection2339
                            connect "abc to dq1.q_axis" Gain2.in as Connection2340
                            connect "abc to dq1.zero_axis" Termination1.in as Connection2341
                            connect "abc to dq1.va" A as Connection2342
                            connect B "abc to dq1.vb" as Connection2343
                            connect "abc to dq1.vc" C as Connection2344
                            connect "abc to dq1.wt" wt as Connection2345
                        }
                        [
                            position = 7624, 9160
                            size = 72, 192
                        ]

                        component Subsystem Synch {
                            layout = dynamic
                            component gen_digital_probe on_nominal {
                            }
                            [
                                position = 8248, 8784
                                rotation = left
                            ]

                            component gen_digital_probe phase_lock {
                            }
                            [
                                position = 8256, 8512
                                rotation = left
                            ]

                            component gen_probe dfsynch {
                            }
                            [
                                position = 8256, 8360
                                rotation = left
                            ]

                            component gen_digital_probe freq_lock {
                            }
                            [
                                position = 7952, 8344
                                rotation = left
                            ]

                            component Subsystem phase_match {
                                layout = dynamic
                                component gen_c_function confine_phase {
                                    in_terminal_dimensions = "inherit"
                                    in_terminal_dimensions_str = "dtheta inherit"
                                    in_terminal_labels = "False;"
                                    in_terminal_properties = "real dtheta;"
                                    init_fnc = "/*Begin code section*/
dtheta = 0;
dtheta_confined = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit"
                                    out_terminal_dimensions_str = "dtheta_confined inherit"
                                    out_terminal_labels = "False;"
                                    out_terminal_properties = "real dtheta_confined;"
                                    output_fnc = "/*Begin code section*/
if (dtheta > 3.14159265359) {//confine theta to +/- 2*pi;
    dtheta_confined = dtheta - 6.28318530718;
}
else{
    if (dtheta < -3.14159265359){
        dtheta_confined = dtheta + 6.28318530718;
    }
    else{
        dtheta_confined = dtheta;
    }
}
/*End code section*/"
                                }
                                [
                                    position = 7656, 8224
                                    size = 48, 48
                                ]

                                component gen_gain Gain12 {
                                    gain = "1.0/fn"
                                }
                                [
                                    position = 8304, 8216
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8224, 8216
                                    hide_name = True
                                ]

                                component gen_gain Phase_diff {
                                    gain = "Phase_diff*np.pi/180.0"
                                }
                                [
                                    position = 7904, 8360
                                    hide_name = True
                                ]

                                component tm_delay "Unit Delay4" {
                                }
                                [
                                    position = 8488, 8392
                                    hide_name = True
                                ]

                                component gen_logic_op "Logical operator1" {
                                    operator = "NOT"
                                }
                                [
                                    position = 8224, 8400
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                    signs = "++"
                                }
                                [
                                    position = 8432, 8208
                                    hide_name = True
                                ]

                                component tm_delay "Unit Delay3" {
                                }
                                [
                                    position = 8128, 8424
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component tm_delay "Unit Delay5" {
                                }
                                [
                                    position = 8792, 8224
                                    hide_name = True
                                ]

                                component gen_gain Phase_diff1 {
                                    gain = "0.01*Phase_diff*np.pi/180.0"
                                }
                                [
                                    position = 8048, 8424
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component sys_signal_switch "Signal switch2" {
                                    criterion = "ctrl > threshold"
                                    threshold = "0.5"
                                }
                                [
                                    position = 8608, 8224
                                    hide_name = True
                                ]

                                component src_constant Constant4 {
                                    execution_rate = "Ts"
                                    value = "0"
                                }
                                [
                                    position = 8536, 8240
                                    hide_name = True
                                ]

                                component gen_probe phase_diff {
                                }
                                [
                                    position = 7904, 8272
                                    rotation = right
                                ]

                                component src_constant Constant2 {
                                    execution_rate = "Ts"
                                    value = "1.0"
                                }
                                [
                                    position = 7840, 8360
                                    hide_name = True
                                ]

                                component gen_rate_limiter "3 hz per sec" {
                                    falling_limit = "-1e5/fn"
                                    rising_limit = "1e5/fn"
                                }
                                [
                                    position = 8712, 8224
                                ]

                                component gen_sum Sum3 {
                                    signs = "+-"
                                }
                                [
                                    position = 7536, 8224
                                    hide_name = True
                                ]

                                component gen_comparator Comparator2 {
                                }
                                [
                                    position = 8128, 8336
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component gen_abs Abs2 {
                                }
                                [
                                    position = 7976, 8288
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                }
                                [
                                    position = 7984, 8368
                                    hide_name = True
                                ]

                                component gen_c_function c_function {
                                    in_terminal_dimensions = "inherit"
                                    in_terminal_dimensions_str = "counter inherit"
                                    in_terminal_labels = "False;"
                                    in_terminal_properties = "real counter;"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit"
                                    out_terminal_dimensions_str = "out inherit"
                                    out_terminal_labels = "False;"
                                    output_fnc = "/*Begin code section*/
if(counter>=0.1/execution_rate){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8400, 8392
                                    size = 48, 48
                                ]

                                component "core/Counter" Counter1 {
                                    execution_rate = "Ts"
                                }
                                [
                                    position = 8312, 8392
                                    hide_name = True
                                    size = 48, 48
                                ]

                                component Subsystem PI {
                                    layout = dynamic
                                    component gen_sum Sum5 {
                                    }
                                    [
                                        position = 8320, 8224
                                        hide_name = True
                                    ]

                                    component gen_gain Kb {
                                        gain = "1.0"
                                    }
                                    [
                                        position = 8216, 8312
                                        scale = -1, 1
                                    ]

                                    component gen_integrator Integrator1 {
                                        init_value = "out0"
                                        limit_lower = "-1"
                                        limit_upper = "1"
                                        show_reset = "either"
                                    }
                                    [
                                        position = 8216, 8232
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8320, 8312
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8088, 8224
                                        hide_name = True
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "lowLim"
                                        upper_limit = "upLim"
                                    }
                                    [
                                        position = 8408, 8224
                                        hide_name = True
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8144, 8128
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 7992, 8216
                                    ]

                                    port In {
                                        label = "In"
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7888, 8168
                                    ]

                                    port Out {
                                        label = "Out"
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8472, 8224
                                    ]

                                    port reset {
                                        position = top:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8136, 8256
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8368, 8224
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8440, 8224
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 7920, 8168
                                    ]

                                    connect Junction2 Limit1.in as Connection45
                                    connect Junction3 Out as Connection48
                                    connect Junction4 In as Connection67
                                    connect Kb.in Sum6.out as Connection50
                                    connect Ki.in Junction4 as Connection66
                                    connect Kp.in Junction4 as Connection68
                                    connect Kp.out Sum5.in as Connection63
                                    connect Limit1.out Junction3 as Connection47
                                    connect Sum5.in1 Integrator1.out as Connection5
                                    connect Sum5.out Junction2 as Connection44
                                    connect Sum6.in Junction2 as Connection46
                                    connect Sum6.in1 Junction3 as Connection49
                                    connect Sum7.out Integrator1.in as Connection52
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect Sum7.in Ki.out as Connection64
                                    connect reset Integrator1.reset as Connection62

                                    Ki = "Phase_Ki"
                                    Kp = "Phase_Kp"
                                    lowLim = "-1e5"
                                    out0 = "0.0"
                                    upLim = "1e5"

                                    mask {
                                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                        Kp {
                                            label = "Kp"
                                            widget = edit
                                            type = generic
                                            default_value = "1.0"
                                            group = "General"
                                        }

                                        Ki {
                                            label = "Ki"
                                            widget = edit
                                            type = generic
                                            default_value = "5.0"
                                            group = "General"
                                        }

                                        upLim {
                                            label = "Upper limit"
                                            widget = edit
                                            type = generic
                                            default_value = "100.0"
                                            group = "General"
                                        }

                                        lowLim {
                                            label = "Lower limit"
                                            widget = edit
                                            type = generic
                                            default_value = "0.0"
                                            group = "General"
                                        }

                                        out0 {
                                            label = "Integrator initial output"
                                            widget = edit
                                            type = generic
                                            default_value = "fnom"
                                            group = "General"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 8104, 8224
                                    size = 64, 48
                                ]

                                component Subsystem "low pass" {
                                    layout = dynamic
                                    component tm_delay "Unit Delay1" {
                                    }
                                    [
                                        position = 8048, 8120
                                        rotation = right
                                        hide_name = True
                                    ]

                                    component gen_gain a2 {
                                        gain = "a[1]"
                                    }
                                    [
                                        position = 8280, 8336
                                        scale = -1, 1
                                    ]

                                    component gen_gain b2 {
                                        gain = "b[2]"
                                    }
                                    [
                                        position = 8112, 8336
                                    ]

                                    component gen_sum Sum3 {
                                        signs = "+-"
                                    }
                                    [
                                        position = 8192, 8296
                                        rotation = left
                                        hide_name = True
                                    ]

                                    component tm_delay "Unit Delay3" {
                                    }
                                    [
                                        position = 8336, 8128
                                        rotation = right
                                        hide_name = True
                                    ]

                                    component gen_gain b1 {
                                        gain = "b[1]"
                                    }
                                    [
                                        position = 8120, 8184
                                    ]

                                    component gen_gain a1 {
                                        gain = "a[0]"
                                    }
                                    [
                                        position = 8280, 8184
                                        scale = -1, 1
                                    ]

                                    component gen_gain b0 {
                                        gain = "b[0]"
                                    }
                                    [
                                        position = 8120, 8056
                                    ]

                                    component gen_sum Sum2 {
                                        signs = "++-"
                                    }
                                    [
                                        position = 8192, 8152
                                        rotation = left
                                        hide_name = True
                                    ]

                                    component gen_sum Sum1 {
                                    }
                                    [
                                        position = 8232, 8064
                                        hide_name = True
                                    ]

                                    component tm_delay "Unit Delay4" {
                                    }
                                    [
                                        position = 8336, 8264
                                        rotation = right
                                        hide_name = True
                                    ]

                                    component tm_delay "Unit Delay2" {
                                    }
                                    [
                                        position = 8048, 8264
                                        rotation = right
                                        hide_name = True
                                    ]

                                    port In {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8000, 8080
                                    ]

                                    port Out {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8384, 8064
                                    ]

                                    junction Junction1 sp
                                    [
                                        position = 8048, 8080
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8336, 8176
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8048, 8184
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 8336, 8064
                                    ]

                                    connect Junction1 In as Connection643
                                    connect Junction1 "Unit Delay1.in" as Connection615
                                    connect Junction2 "Unit Delay4.in" as Connection622
                                    connect Junction3 "Unit Delay2.in" as Connection625
                                    connect Junction4 Out as Connection642
                                    connect Junction4 "Unit Delay3.in" as Connection630
                                    connect Sum1.out Junction4 as Connection629
                                    connect Sum1.in b0.out as Connection632
                                    connect Sum2.out Sum1.in1 as Connection617
                                    connect Sum2.in2 a1.out as Connection640
                                    connect Sum2.in b1.out as Connection634
                                    connect Sum3.out Sum2.in1 as Connection620
                                    connect "Unit Delay1.out" Junction3 as Connection624
                                    connect "Unit Delay3.out" Junction2 as Connection621
                                    connect a1.in Junction2 as Connection641
                                    connect a2.out Sum3.in1 as Connection638
                                    connect a2.in "Unit Delay4.out" as Connection639
                                    connect b0.in Junction1 as Connection633
                                    connect b1.in Junction3 as Connection635
                                    connect b2.out Sum3.in as Connection636
                                    connect b2.in "Unit Delay2.out" as Connection637

                                    a = "alowpass"
                                    b = "blowpass"

                                    mask {
                                        description = "Digital biquad filter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Direct form 1"

                                        b {
                                            label = "b"
                                            widget = edit
                                            type = generic
                                            default_value = "bnotch"
                                        }

                                        a {
                                            label = "a"
                                            widget = edit
                                            type = generic
                                            default_value = "anotch"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 7768, 8224
                                    size = 48, 48
                                ]

                                port freq_lock {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8008, 8176
                                ]

                                port f_offset {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8344, 8168
                                ]

                                port phase_util {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7400, 8216
                                ]

                                port phase_inv {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7424, 8272
                                ]

                                port sync {
                                    label = "sync"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8608, 8136
                                    rotation = left
                                    scale = 1, -1
                                ]

                                port df_synch {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8864, 8224
                                ]

                                port phase_lock {
                                    label = "Phase match"
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8552, 8392
                                ]

                                junction Junction43 sp
                                [
                                    position = 8176, 8336
                                ]

                                junction Junction51 sp
                                [
                                    position = 8160, 8336
                                ]

                                junction Junction54 sp
                                [
                                    position = 7976, 8224
                                ]

                                junction Junction55 sp
                                [
                                    position = 8104, 8176
                                ]

                                junction Junction61 sp
                                [
                                    position = 7904, 8224
                                ]

                                connect "3 hz per sec.out" "Unit Delay5.in" as Connection1876
                                connect Abs2.in Junction54 as Connection571
                                connect Comparator2.in2 Abs2.out as Connection12
                                connect Comparator2.out Junction51 as Connection539
                                connect Constant2.out Phase_diff.in as Connection15
                                connect Gain12.in Product1.out as Connection583
                                connect Junction43 Counter1.en as Connection454
                                connect Junction51 Junction43 as Connection540
                                connect Junction54 Junction61 as Connection841
                                connect Junction61 phase_diff.in as Connection842
                                connect "Logical operator1.out" Counter1.reset as Connection88
                                connect "Logical operator1.in" Junction43 as Connection453
                                connect PI.In Junction54 as Connection573
                                connect PI.reset Junction55 as Connection576
                                connect Phase_diff.out Sum2.in as Connection542
                                connect Phase_diff1.out Sum2.in1 as Connection545
                                connect Product1.in Junction55 as Connection574
                                connect Product1.in1 PI.Out as Connection577
                                connect "Signal switch2.out" "3 hz per sec.in" as Connection2083
                                connect "Signal switch2.in1" Constant4.out as Connection2082
                                connect "Signal switch2.in" Sum1.out as Connection2094
                                [
                                    position = 0, 0
                                ]
                                connect Sum1.in1 Gain12.out as Connection2093
                                [
                                    position = 0, 0
                                ]
                                connect Sum2.out Comparator2.in1 as Connection543
                                connect Sum3.in1 phase_inv as Connection840
                                connect "Unit Delay3.in" Junction51 as Connection541
                                connect "Unit Delay3.out" Phase_diff1.in as Connection544
                                connect "Unit Delay4.out" phase_lock as Connection845
                                connect "Unit Delay5.out" df_synch as Connection2085
                                connect c_function.counter Counter1.out as Connection2095
                                connect c_function.out "Unit Delay4.in" as Connection2096
                                connect confine_phase.dtheta Sum3.out as Connection2092
                                [
                                    position = 0, 0
                                ]
                                connect confine_phase.dtheta_confined "low pass.In" as Connection2091
                                [
                                    position = 0, 0
                                ]
                                connect f_offset Sum1.in as Connection537
                                connect freq_lock Junction55 as Connection2090
                                connect "low pass.Out" Junction61 as Connection843
                                connect phase_util Sum3.in as Connection839
                                connect sync "Signal switch2.in2" as Connection2089
                            }
                            [
                                position = 8128, 8488
                                size = 176, 184
                            ]

                            component Subsystem PLL_Util {
                                layout = dynamic
                                component gen_probe wt_util {
                                }
                                [
                                    position = 8272, 8288
                                    rotation = left
                                    scale = -1, -1
                                ]

                                component gen_probe Vt_util {
                                }
                                [
                                    position = 8304, 8384
                                    rotation = right
                                ]

                                component gen_terminator Termination3 {
                                }
                                [
                                    position = 8200, 8056
                                    rotation = left
                                    hide_name = True
                                ]

                                component gen_terminator Termination2 {
                                }
                                [
                                    position = 8248, 8056
                                    rotation = left
                                    hide_name = True
                                ]

                                component gen_gain Gain5 {
                                    gain = "1.0/fn"
                                }
                                [
                                    position = 8312, 8176
                                    hide_name = True
                                ]

                                component gen_gain Gain4 {
                                    gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                                }
                                [
                                    position = 8224, 8304
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_probe f_util {
                                }
                                [
                                    position = 8352, 8128
                                    rotation = left
                                ]

                                component "core/Three phase PLL" PLL {
                                    enable_pk = "True"
                                    enable_sin = "False"
                                    enable_zero = "False"
                                    initial_pid_output = "2*np.pi*fn"
                                    low_lim = "0"
                                    rate_high = "5*fn"
                                    rate_low = "-5*fn"
                                    up_lim = "1.4*2*np.pi*fn"
                                }
                                [
                                    position = 8144, 8176
                                    size = 64, 128
                                ]

                                port A {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8088
                                ]

                                port B {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8176
                                ]

                                port C {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8264
                                ]

                                port f {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8400, 8176
                                ]

                                port wt {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8400, 8248
                                ]

                                port t {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8400, 8336
                                ]

                                junction Junction3 sp
                                [
                                    position = 8352, 8176
                                ]

                                junction Junction4 sp
                                [
                                    position = 8304, 8336
                                ]

                                junction Junction5 sp
                                [
                                    position = 8272, 8248
                                ]

                                connect Gain4.out Junction4 as Connection793
                                connect Junction3 Gain5.out as Connection791
                                connect Junction4 t as Connection794
                                connect Vt_util.in Junction4 as Connection795
                                connect f Junction3 as Connection790
                                connect f_util.in Junction3 as Connection792
                                connect PLL.vb B as Connection798
                                connect PLL.va A as Connection799
                                connect PLL.vc C as Connection800
                                connect Termination3.in PLL.d_axis as Connection801
                                connect Termination2.in PLL.q_axis as Connection802
                                connect Gain5.in PLL.freq as Connection803
                                connect wt Junction5 as Connection804
                                connect Junction5 wt_util.in as Connection805
                                connect PLL.theta Junction5 as Connection806
                                connect Gain4.in PLL.peak as Connection807
                            }
                            [
                                position = 7360, 8368
                                size = 80, 152
                            ]

                            component Subsystem Check_nominal_conditions {
                                layout = dynamic
                                component src_constant "+-10%" {
                                    execution_rate = "Ts"
                                    value = "0.1"
                                }
                                [
                                    position = 8112, 8320
                                    hide_name = True
                                ]

                                component src_constant "+-1,5 hz" {
                                    execution_rate = "Ts"
                                    value = "10.0/fn"
                                }
                                [
                                    position = 8120, 8144
                                    hide_name = True
                                ]

                                component gen_logic_op "Logical operator1" {
                                    operator = "OR"
                                }
                                [
                                    position = 8320, 8208
                                    hide_name = True
                                ]

                                component gen_logic_op "Logical operator15" {
                                    operator = "NOT"
                                }
                                [
                                    position = 8424, 8208
                                    hide_name = True
                                ]

                                component gen_digital_probe V_out_nom {
                                }
                                [
                                    position = 8352, 8280
                                ]

                                component gen_sum Sum5 {
                                    signs = "+-"
                                }
                                [
                                    position = 8024, 8272
                                    hide_name = True
                                ]

                                component gen_comparator Comparator2 {
                                }
                                [
                                    position = 8200, 8280
                                    hide_name = True
                                ]

                                component gen_digital_probe f_out_nom {
                                }
                                [
                                    position = 8344, 8128
                                ]

                                component gen_sum Sum4 {
                                    signs = "+-"
                                }
                                [
                                    position = 7984, 8120
                                    hide_name = True
                                ]

                                component gen_abs Abs3 {
                                }
                                [
                                    position = 7888, 8112
                                    hide_name = True
                                ]

                                component gen_abs Abs2 {
                                }
                                [
                                    position = 8104, 8272
                                    hide_name = True
                                ]

                                component gen_comparator Comparator1 {
                                }
                                [
                                    position = 8192, 8128
                                    hide_name = True
                                ]

                                component src_constant "nominal frequency" {
                                    execution_rate = "Ts"
                                    value = "1.0"
                                }
                                [
                                    position = 7888, 8152
                                    hide_name = True
                                ]

                                component gen_c_function wait_to_change {
                                    global_variables = "real wait_time;real counter;"
                                    in_terminal_dimensions = "inherit;inherit"
                                    in_terminal_dimensions_str = "in inherit;reset inherit"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "inherit in;inherit reset;"
                                    init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
wait_time = 0.01;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit"
                                    out_terminal_dimensions_str = "out inherit"
                                    out_terminal_labels = "False;"
                                    output_fnc = "/*Begin code section*/
if(in <= 0){
    counter = 0;
    out = 0;
}
else{
    if(counter >= wait_time){
        out = 1;
    }
    else{
        out = 0;
        counter += execution_rate*in;
    }
}

if(reset == 1){
    counter = 0;
    out = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8600, 8216
                                    size = 48, 48
                                ]

                                component src_constant "nominal voltage" {
                                    execution_rate = "Ts"
                                    value = "1.0"
                                }
                                [
                                    position = 7944, 8304
                                    hide_name = True
                                ]

                                component gen_abs Abs1 {
                                }
                                [
                                    position = 8064, 8120
                                    hide_name = True
                                ]

                                component "core/Edge Detection" "Edge Detection1" {
                                }
                                [
                                    position = 8520, 8240
                                    hide_name = True
                                    size = 32, 32
                                ]

                                component gen_digital_probe reset {
                                }
                                [
                                    position = 8616, 8296
                                ]

                                component gen_probe "Vt inv" {
                                }
                                [
                                    position = 7936, 8200
                                ]

                                port freq {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7792, 8112
                                ]

                                port Vt {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7792, 8264
                                ]

                                port on_nominal {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8688, 8216
                                ]

                                junction Junction1507 sp
                                [
                                    position = 8256, 8128
                                ]

                                junction Junction1508 sp
                                [
                                    position = 8256, 8280
                                ]

                                junction Junction1509 sp
                                [
                                    position = 8480, 8208
                                ]

                                junction Junction1510 sp
                                [
                                    position = 8552, 8240
                                ]

                                junction Junction1511 sp
                                [
                                    position = 7856, 8264
                                ]

                                connect "+-1,5 hz.out" Comparator1.in2 as Connection540
                                connect "+-10%.out" Comparator2.in2 as Connection544
                                connect Abs1.out Comparator1.in1 as Connection539
                                connect Abs1.in Sum4.out as Connection828
                                connect Abs2.out Comparator2.in1 as Connection543
                                connect Abs3.out Sum4.in as Connection574
                                connect Abs3.in freq as Connection827
                                connect Comparator1.out Junction1507 as Connection549
                                connect Comparator2.out Junction1508 as Connection552
                                connect Junction1507 "Logical operator1.in" as Connection550
                                connect Junction1508 "Logical operator1.in1" as Connection553
                                connect Junction1509 "Edge Detection1.In1" as Connection838
                                connect "Logical operator15.out" Junction1509 as Connection844
                                [
                                    position = 0, 0
                                ]
                                connect "Logical operator15.in" "Logical operator1.out" as Connection836
                                connect Sum5.out Abs2.in as Connection541
                                connect V_out_nom.in Junction1508 as Connection554
                                connect f_out_nom.in Junction1507 as Connection551
                                connect "nominal frequency.out" Sum4.in1 as Connection534
                                connect "nominal voltage.out" Sum5.in1 as Connection542
                                connect wait_to_change.in Junction1509 as Connection837
                                connect wait_to_change.out on_nominal as Connection840
                                connect "Edge Detection1.Out1" Junction1510 as Connection845
                                connect Junction1510 wait_to_change.reset as Connection846
                                connect reset.in Junction1510 as Connection847
                                connect Sum5.in Junction1511 as Connection848
                                connect Junction1511 Vt as Connection849
                                connect "Vt inv.in" Junction1511 as Connection850
                            }
                            [
                                position = 8136, 8832
                                size = 104, 64
                            ]

                            component Subsystem Check_grid {
                                layout = dynamic
                                component gen_comparator Comparator1 {
                                }
                                [
                                    position = 8192, 8128
                                    hide_name = True
                                ]

                                component gen_comparator Comparator2 {
                                }
                                [
                                    position = 8200, 8280
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                    signs = "+-"
                                }
                                [
                                    position = 8024, 8272
                                    hide_name = True
                                ]

                                component gen_digital_probe "out of limit volts" {
                                }
                                [
                                    position = 8352, 8280
                                ]

                                component gen_digital_probe "out of limit freq" {
                                }
                                [
                                    position = 8344, 8128
                                ]

                                component gen_logic_op "Logical operator1" {
                                    operator = "OR"
                                }
                                [
                                    position = 8320, 8208
                                    hide_name = True
                                ]

                                component src_constant "+-1,5 hz" {
                                    execution_rate = "Ts"
                                    value = "10.0/fn"
                                }
                                [
                                    position = 8120, 8144
                                    hide_name = True
                                ]

                                component src_constant "nominal frequency" {
                                    execution_rate = "Ts"
                                    value = "1.0"
                                }
                                [
                                    position = 7888, 8152
                                    hide_name = True
                                ]

                                component gen_abs Abs3 {
                                }
                                [
                                    position = 7888, 8112
                                    hide_name = True
                                ]

                                component gen_logic_op "Logical operator15" {
                                    operator = "NOT"
                                }
                                [
                                    position = 8440, 8208
                                    hide_name = True
                                ]

                                component gen_abs Abs1 {
                                }
                                [
                                    position = 8064, 8120
                                    hide_name = True
                                ]

                                component src_constant "nominal voltage" {
                                    execution_rate = "Ts"
                                    value = "1.0"
                                }
                                [
                                    position = 7944, 8304
                                    hide_name = True
                                ]

                                component src_constant "+-10%" {
                                    execution_rate = "Ts"
                                    value = "0.1"
                                }
                                [
                                    position = 8112, 8320
                                    hide_name = True
                                ]

                                component gen_abs Abs2 {
                                }
                                [
                                    position = 8104, 8272
                                    hide_name = True
                                ]

                                component gen_sum Sum4 {
                                    signs = "+-"
                                }
                                [
                                    position = 7984, 8120
                                    hide_name = True
                                ]

                                port freq {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7792, 8112
                                ]

                                port Vt {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7792, 8264
                                ]

                                port live_grid {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8544, 8208
                                ]

                                junction Junction1507 sp
                                [
                                    position = 8256, 8128
                                ]

                                junction Junction1508 sp
                                [
                                    position = 8256, 8280
                                ]

                                connect "+-1,5 hz.out" Comparator1.in2 as Connection540
                                connect "+-10%.out" Comparator2.in2 as Connection544
                                connect Abs1.out Comparator1.in1 as Connection539
                                connect Abs2.out Comparator2.in1 as Connection543
                                connect Abs3.out Sum4.in as Connection574
                                connect Comparator1.out Junction1507 as Connection549
                                connect Comparator2.out Junction1508 as Connection552
                                connect Junction1507 "Logical operator1.in" as Connection550
                                connect Junction1508 "Logical operator1.in1" as Connection553
                                connect "Logical operator1.out" "Logical operator15.in" as Connection823
                                connect "Logical operator15.out" live_grid as Connection824
                                connect Sum4.out Abs1.in as Connection827
                                [
                                    position = 0, 0
                                ]
                                connect Sum5.out Abs2.in as Connection541
                                connect Sum5.in Vt as Connection825
                                connect freq Abs3.in as Connection828
                                [
                                    position = 0, 0
                                ]
                                connect "nominal frequency.out" Sum4.in1 as Connection534
                                connect "nominal voltage.out" Sum5.in1 as Connection542
                                connect "out of limit freq.in" Junction1507 as Connection551
                                connect "out of limit volts.in" Junction1508 as Connection554
                            }
                            [
                                position = 8136, 8688
                                size = 104, 64
                            ]

                            component Subsystem f_match {
                                layout = dynamic
                                component gen_sum Sum1 {
                                    signs = "+-"
                                }
                                [
                                    position = 7912, 8192
                                    hide_name = True
                                ]

                                component gen_comparator Comparator1 {
                                }
                                [
                                    position = 8280, 8256
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component src_constant Constant3 {
                                    execution_rate = "Ts"
                                    value = "0.0"
                                }
                                [
                                    position = 8208, 8128
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component gen_delay Delay1 {
                                    del_length = "10"
                                }
                                [
                                    position = 8704, 8264
                                    hide_name = True
                                ]

                                component sys_signal_switch "Signal switch2" {
                                    criterion = "ctrl > threshold"
                                    threshold = "0.0"
                                }
                                [
                                    position = 8272, 8112
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                }
                                [
                                    position = 8192, 8312
                                    hide_name = True
                                ]

                                component src_constant Constant1 {
                                    execution_rate = "Ts"
                                    value = "1.0"
                                }
                                [
                                    position = 8056, 8304
                                    hide_name = True
                                ]

                                component gen_gain Freq_diff1 {
                                    gain = "0.02"
                                }
                                [
                                    position = 8216, 8376
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Freq_diff {
                                    gain = "f_diff/100.0"
                                }
                                [
                                    position = 8120, 8304
                                    hide_name = True
                                ]

                                component gen_logic_op "Logical operator1" {
                                    operator = "NOT"
                                }
                                [
                                    position = 8376, 8312
                                    hide_name = True
                                ]

                                component tm_delay "Unit Delay1" {
                                }
                                [
                                    position = 8296, 8376
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_abs Abs3 {
                                }
                                [
                                    position = 8160, 8192
                                    hide_name = True
                                ]

                                component gen_probe f_diff {
                                }
                                [
                                    position = 8064, 8256
                                    rotation = right
                                ]

                                component gen_c_function c_function {
                                    in_terminal_dimensions = "inherit"
                                    in_terminal_dimensions_str = "counter inherit"
                                    in_terminal_labels = "False;"
                                    in_terminal_properties = "real counter;"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit"
                                    out_terminal_dimensions_str = "out inherit"
                                    out_terminal_labels = "False;"
                                    output_fnc = "/*Begin code section*/
if(counter>=0.1/execution_rate){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8552, 8264
                                    size = 48, 48
                                ]

                                component Subsystem "low pass" {
                                    layout = dynamic
                                    component gen_gain b1 {
                                        gain = "b[1]"
                                    }
                                    [
                                        position = 8120, 8184
                                    ]

                                    component tm_delay "Unit Delay4" {
                                    }
                                    [
                                        position = 8336, 8264
                                        rotation = right
                                        hide_name = True
                                    ]

                                    component tm_delay "Unit Delay3" {
                                    }
                                    [
                                        position = 8336, 8128
                                        rotation = right
                                        hide_name = True
                                    ]

                                    component gen_gain a1 {
                                        gain = "a[0]"
                                    }
                                    [
                                        position = 8280, 8184
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum3 {
                                        signs = "+-"
                                    }
                                    [
                                        position = 8192, 8296
                                        rotation = left
                                        hide_name = True
                                    ]

                                    component gen_sum Sum1 {
                                    }
                                    [
                                        position = 8232, 8064
                                        hide_name = True
                                    ]

                                    component tm_delay "Unit Delay1" {
                                    }
                                    [
                                        position = 8048, 8120
                                        rotation = right
                                        hide_name = True
                                    ]

                                    component gen_gain b0 {
                                        gain = "b[0]"
                                    }
                                    [
                                        position = 8120, 8056
                                    ]

                                    component gen_gain a2 {
                                        gain = "a[1]"
                                    }
                                    [
                                        position = 8280, 8336
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum2 {
                                        signs = "++-"
                                    }
                                    [
                                        position = 8192, 8152
                                        rotation = left
                                        hide_name = True
                                    ]

                                    component tm_delay "Unit Delay2" {
                                    }
                                    [
                                        position = 8048, 8264
                                        rotation = right
                                        hide_name = True
                                    ]

                                    component gen_gain b2 {
                                        gain = "b[2]"
                                    }
                                    [
                                        position = 8112, 8336
                                    ]

                                    port In {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8000, 8080
                                    ]

                                    port Out {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8384, 8064
                                    ]

                                    junction Junction1 sp
                                    [
                                        position = 8048, 8080
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8336, 8176
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8048, 8184
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 8336, 8064
                                    ]

                                    connect Junction1 In as Connection643
                                    connect Junction1 "Unit Delay1.in" as Connection615
                                    connect Junction2 "Unit Delay4.in" as Connection622
                                    connect Junction3 "Unit Delay2.in" as Connection625
                                    connect Junction4 Out as Connection642
                                    connect Junction4 "Unit Delay3.in" as Connection630
                                    connect Sum1.out Junction4 as Connection629
                                    connect Sum1.in b0.out as Connection632
                                    connect Sum2.out Sum1.in1 as Connection617
                                    connect Sum2.in2 a1.out as Connection640
                                    connect Sum2.in b1.out as Connection634
                                    connect Sum3.out Sum2.in1 as Connection620
                                    connect "Unit Delay1.out" Junction3 as Connection624
                                    connect "Unit Delay3.out" Junction2 as Connection621
                                    connect a1.in Junction2 as Connection641
                                    connect a2.out Sum3.in1 as Connection638
                                    connect a2.in "Unit Delay4.out" as Connection639
                                    connect b0.in Junction1 as Connection633
                                    connect b1.in Junction3 as Connection635
                                    connect b2.out Sum3.in as Connection636
                                    connect b2.in "Unit Delay2.out" as Connection637

                                    a = "alowpass"
                                    b = "blowpass"

                                    mask {
                                        description = "Digital biquad filter
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Direct form 1"

                                        b {
                                            label = "b"
                                            widget = edit
                                            type = generic
                                            default_value = "bnotch"
                                        }

                                        a {
                                            label = "a"
                                            widget = edit
                                            type = generic
                                            default_value = "anotch"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 8008, 8192
                                    size = 48, 48
                                ]

                                component Subsystem PI {
                                    layout = dynamic
                                    component gen_integrator Integrator1 {
                                        init_value = "out0"
                                        limit_lower = "-1"
                                        limit_upper = "1"
                                        show_reset = "rising"
                                    }
                                    [
                                        position = 8216, 8240
                                    ]

                                    component gen_sum Sum5 {
                                    }
                                    [
                                        position = 8320, 8232
                                        hide_name = True
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8320, 8368
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "lowLim"
                                        upper_limit = "upLim"
                                    }
                                    [
                                        position = 8408, 8232
                                        hide_name = True
                                    ]

                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8088, 8232
                                        hide_name = True
                                    ]

                                    component gen_gain Kb {
                                        gain = "1.0"
                                    }
                                    [
                                        position = 8216, 8368
                                        scale = -1, 1
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8152, 8136
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 8000, 8224
                                    ]

                                    port In {
                                        label = "In"
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7888, 8168
                                    ]

                                    port Out {
                                        label = "Out"
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8472, 8232
                                    ]

                                    port reset {
                                        position = top:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8136, 8248
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8368, 8232
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8440, 8232
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 7920, 8168
                                    ]

                                    connect Junction2 Limit1.in as Connection45
                                    connect Junction3 Out as Connection48
                                    connect Junction4 In as Connection67
                                    connect Kb.in Sum6.out as Connection50
                                    connect Ki.in Junction4 as Connection66
                                    connect Kp.in Junction4 as Connection68
                                    connect Kp.out Sum5.in as Connection63
                                    connect Limit1.out Junction3 as Connection47
                                    connect Sum5.in1 Integrator1.out as Connection5
                                    connect Sum5.out Junction2 as Connection44
                                    connect Sum6.in Junction2 as Connection46
                                    connect Sum6.in1 Junction3 as Connection49
                                    connect Sum7.out Integrator1.in as Connection52
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect Sum7.in Ki.out as Connection64
                                    connect reset Integrator1.reset as Connection62

                                    Ki = "fmatch_Ki"
                                    Kp = "fmatch_Kp"
                                    lowLim = "[-0.166*1e5]"
                                    out0 = "0.0"
                                    upLim = "[0.166*1e5]"

                                    mask {
                                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                        Kp {
                                            label = "Kp"
                                            widget = edit
                                            type = generic
                                            default_value = "1.0"
                                            group = "General"
                                        }

                                        Ki {
                                            label = "Ki"
                                            widget = edit
                                            type = generic
                                            default_value = "5.0"
                                            group = "General"
                                        }

                                        upLim {
                                            label = "Upper limit"
                                            widget = edit
                                            type = generic
                                            default_value = "100.0"
                                            group = "General"
                                        }

                                        lowLim {
                                            label = "Lower limit"
                                            widget = edit
                                            type = generic
                                            default_value = "0.0"
                                            group = "General"
                                        }

                                        out0 {
                                            label = "Integrator initial output"
                                            widget = edit
                                            type = generic
                                            default_value = "fnom"
                                            group = "General"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 8368, 8112
                                    size = 64, 64
                                ]

                                component "core/Counter" Counter1 {
                                    execution_rate = "Ts"
                                }
                                [
                                    position = 8464, 8264
                                    hide_name = True
                                    size = 48, 48
                                ]

                                port sync {
                                    label = "sync"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8224, 8032
                                    scale = 1, -1
                                ]

                                port "freq lock" {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8792, 8264
                                ]

                                port delta_f {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8528, 8112
                                ]

                                port f_Util {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7776, 8184
                                ]

                                port f_Inv {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7816, 8232
                                ]

                                junction Junction2 sp
                                [
                                    position = 8328, 8256
                                ]

                                junction Junction32 sp
                                [
                                    position = 8120, 8192
                                ]

                                junction Junction51 sp
                                [
                                    position = 8272, 8032
                                ]

                                junction Junction52 sp
                                [
                                    position = 8064, 8192
                                ]

                                junction Junction53 sp
                                [
                                    position = 8640, 8264
                                ]

                                connect Abs3.in Junction32 as Connection694
                                connect Comparator1.in2 Abs3.out as Connection778
                                connect Comparator1.out Junction2 as Connection670
                                connect Constant1.out Freq_diff.in as Connection14
                                connect Constant3.out "Signal switch2.in1" as Connection651
                                connect Counter1.en Junction2 as Connection674
                                connect Delay1.in Junction53 as Connection789
                                connect Delay1.out "freq lock" as Connection774
                                connect Freq_diff.out Sum2.in as Connection181
                                connect Freq_diff1.out Sum2.in1 as Connection183
                                connect Junction32 Junction52 as Connection784
                                connect Junction32 "Signal switch2.in" as Connection782
                                [
                                    position = 0, 0
                                ]
                                connect Junction52 "low pass.Out" as Connection785
                                connect Junction53 "Unit Delay1.in" as Connection790
                                connect "Logical operator1.out" Counter1.reset as Connection88
                                connect "Logical operator1.in" Junction2 as Connection65
                                connect PI.reset Junction51 as Connection777
                                connect PI.In "Signal switch2.out" as Connection746
                                connect PI.Out delta_f as Connection783
                                [
                                    position = 0, 0
                                ]
                                connect "Signal switch2.in2" Junction51 as Connection780
                                connect Sum1.in1 f_Inv as Connection60
                                connect Sum1.in f_Util as Connection57
                                connect Sum2.out Comparator1.in1 as Connection182
                                connect "Unit Delay1.out" Freq_diff1.in as Connection180
                                connect c_function.counter Counter1.out as Connection788
                                connect c_function.out Junction53 as Connection791
                                connect f_diff.in Junction52 as Connection786
                                connect "low pass.In" Sum1.out as Connection781
                                connect sync Junction51 as Connection775
                            }
                            [
                                position = 7864, 8440
                                size = 136, 88
                            ]

                            component Subsystem Vmatch {
                                layout = dynamic
                                component gen_abs Abs2 {
                                }
                                [
                                    position = 7856, 8272
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_sum Sum10 {
                                    signs = "+-"
                                }
                                [
                                    position = 7792, 8144
                                    hide_name = True
                                ]

                                component gen_gain Phase_diff1 {
                                    gain = "0.01*V_diff/100.0"
                                }
                                [
                                    position = 7928, 8408
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component tm_delay "Unit Delay3" {
                                }
                                [
                                    position = 8008, 8408
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component tm_delay "Unit Delay5" {
                                }
                                [
                                    position = 8248, 8160
                                    hide_name = True
                                ]

                                component gen_comparator Comparator2 {
                                }
                                [
                                    position = 8008, 8320
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component src_constant Constant2 {
                                    execution_rate = "Ts"
                                    value = "1.0"
                                }
                                [
                                    position = 7720, 8344
                                    hide_name = True
                                ]

                                component src_constant Constant3 {
                                    execution_rate = "Ts"
                                    value = "0.0"
                                }
                                [
                                    position = 7912, 8176
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component gen_logic_op "Logical operator1" {
                                    operator = "NOT"
                                }
                                [
                                    position = 8104, 8384
                                    hide_name = True
                                ]

                                component gen_gain Phase_diff {
                                    gain = "V_diff/100.0"
                                }
                                [
                                    position = 7784, 8344
                                    hide_name = True
                                ]

                                component sys_signal_switch "Signal switch2" {
                                    criterion = "ctrl > threshold"
                                    threshold = "0.0"
                                }
                                [
                                    position = 7976, 8160
                                    hide_name = True
                                ]

                                component tm_delay "Unit Delay4" {
                                }
                                [
                                    position = 8360, 8376
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                }
                                [
                                    position = 7864, 8352
                                    hide_name = True
                                ]

                                component gen_c_function c_function {
                                    in_terminal_dimensions = "inherit"
                                    in_terminal_dimensions_str = "counter inherit"
                                    in_terminal_labels = "False;"
                                    in_terminal_properties = "real counter;"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit"
                                    out_terminal_dimensions_str = "out inherit"
                                    out_terminal_labels = "False;"
                                    output_fnc = "/*Begin code section*/
if(counter>=0.1/execution_rate){
    out = 1;
}
else{
    out = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8280, 8376
                                    size = 48, 48
                                ]

                                component "core/Counter" Counter1 {
                                    execution_rate = "Ts"
                                }
                                [
                                    position = 8192, 8376
                                    hide_name = True
                                    size = 48, 48
                                ]

                                component Subsystem PI {
                                    layout = dynamic
                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8088, 8224
                                        hide_name = True
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8320, 8312
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_integrator Integrator1 {
                                        init_value = "out0"
                                        limit_lower = "-1"
                                        limit_upper = "1"
                                        show_reset = "either"
                                    }
                                    [
                                        position = 8216, 8232
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "lowLim"
                                        upper_limit = "upLim"
                                    }
                                    [
                                        position = 8408, 8224
                                        hide_name = True
                                    ]

                                    component gen_gain Kb {
                                        gain = "1.0"
                                    }
                                    [
                                        position = 8216, 8312
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum5 {
                                    }
                                    [
                                        position = 8320, 8224
                                        hide_name = True
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8136, 8128
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 7984, 8216
                                    ]

                                    port In {
                                        label = "In"
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7888, 8168
                                    ]

                                    port Out {
                                        label = "Out"
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8472, 8224
                                    ]

                                    port reset {
                                        position = top:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8136, 8256
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8368, 8224
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8440, 8224
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 7920, 8168
                                    ]

                                    connect Junction2 Limit1.in as Connection45
                                    connect Junction3 Out as Connection48
                                    connect Junction4 In as Connection67
                                    connect Kb.in Sum6.out as Connection50
                                    connect Ki.in Junction4 as Connection66
                                    connect Kp.in Junction4 as Connection68
                                    connect Kp.out Sum5.in as Connection63
                                    connect Limit1.out Junction3 as Connection47
                                    connect Sum5.in1 Integrator1.out as Connection5
                                    connect Sum5.out Junction2 as Connection44
                                    connect Sum6.in Junction2 as Connection46
                                    connect Sum6.in1 Junction3 as Connection49
                                    connect Sum7.out Integrator1.in as Connection52
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect Sum7.in Ki.out as Connection64
                                    connect reset Integrator1.reset as Connection62

                                    Ki = "Vmatch_Ki"
                                    Kp = "Vmatch_Kp"
                                    lowLim = "[-0.147*1e5]"
                                    out0 = "0.0"
                                    upLim = "[0.147*1e5]"

                                    mask {
                                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                        Kp {
                                            label = "Kp"
                                            widget = edit
                                            type = generic
                                            default_value = "1.0"
                                            group = "General"
                                        }

                                        Ki {
                                            label = "Ki"
                                            widget = edit
                                            type = generic
                                            default_value = "5.0"
                                            group = "General"
                                        }

                                        upLim {
                                            label = "Upper limit"
                                            widget = edit
                                            type = generic
                                            default_value = "100.0"
                                            group = "General"
                                        }

                                        lowLim {
                                            label = "Lower limit"
                                            widget = edit
                                            type = generic
                                            default_value = "0.0"
                                            group = "General"
                                        }

                                        out0 {
                                            label = "Integrator initial output"
                                            widget = edit
                                            type = generic
                                            default_value = "fnom"
                                            group = "General"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 8088, 8160
                                    size = 64, 48
                                ]

                                port Sync_Ess {
                                    position = top:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7920, 8088
                                ]

                                port delta_V {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8424, 8160
                                ]

                                port Vt_Util {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7568, 8136
                                ]

                                port Vt_Inv {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7648, 8152
                                ]

                                port V_match {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8424, 8376
                                ]

                                junction Junction43 sp
                                [
                                    position = 8056, 8320
                                ]

                                junction Junction51 sp
                                [
                                    position = 8040, 8320
                                ]

                                junction Junction295 sp
                                [
                                    position = 7976, 8088
                                ]

                                junction Junction298 sp
                                [
                                    position = 7856, 8144
                                ]

                                connect Abs2.in Junction298 as Connection1997
                                connect Comparator2.in2 Abs2.out as Connection12
                                connect Comparator2.out Junction51 as Connection539
                                connect Constant2.out Phase_diff.in as Connection15
                                connect Constant3.out "Signal switch2.in1" as Connection651
                                connect Junction298 "Signal switch2.in" as Connection1996
                                connect Junction43 Counter1.en as Connection454
                                connect Junction51 Junction43 as Connection540
                                connect "Logical operator1.out" Counter1.reset as Connection88
                                connect "Logical operator1.in" Junction43 as Connection453
                                connect PI.reset Junction295 as Connection1989
                                connect PI.Out "Unit Delay5.in" as Connection1999
                                [
                                    position = 0, 0
                                ]
                                connect Phase_diff.out Sum2.in as Connection542
                                connect Phase_diff1.out Sum2.in1 as Connection545
                                connect "Signal switch2.in2" Junction295 as Connection1984
                                connect "Signal switch2.out" PI.In as Connection1998
                                [
                                    position = 0, 0
                                ]
                                connect Sum10.out Junction298 as Connection1995
                                connect Sum10.in1 Vt_Inv as Connection2000
                                [
                                    position = 0, 0
                                    breakpoints = 7736, 8152
                                ]
                                connect Sum2.out Comparator2.in1 as Connection543
                                connect Sync_Ess Junction295 as Connection1982
                                connect "Unit Delay3.in" Junction51 as Connection541
                                connect "Unit Delay3.out" Phase_diff1.in as Connection544
                                connect "Unit Delay4.out" V_match as Connection845
                                connect Vt_Util Sum10.in as Connection2001
                                [
                                    position = 0, 0
                                    breakpoints = 7624, 8136
                                ]
                                connect c_function.counter Counter1.out as Connection2002
                                connect c_function.out "Unit Delay4.in" as Connection2003
                                connect delta_V "Unit Delay5.out" as Connection1992
                            }
                            [
                                position = 8152, 8232
                                size = 120, 104
                            ]

                            component gen_digital_probe "live grid" {
                            }
                            [
                                position = 8256, 8624
                                rotation = left
                            ]

                            port "Turn on Sync" {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8056, 8120
                            ]

                            port Va_util {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7256, 8312
                            ]

                            port Vb_util {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7256, 8368
                            ]

                            port Vc_util {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7256, 8424
                            ]

                            port df_sync {
                                position = right:11
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8312, 8416
                            ]

                            port dV_match {
                                position = right:10
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8304, 8200
                            ]

                            port Vt_inv {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7256, 8528
                            ]

                            port f_inv {
                                position = left:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7256, 8584
                            ]

                            port wt_inv {
                                position = left:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7256, 8640
                            ]

                            port live_grid {
                                position = right:14
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8312, 8688
                            ]

                            port grid_locked {
                                position = right:13
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8312, 8560
                            ]

                            port V_match {
                                position = right:12
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8304, 8264
                            ]

                            port nominal_state {
                                position = right:15
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8312, 8832
                            ]

                            tag From121 {
                                value = "sync_ess"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7776, 8360
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto2 {
                                value = "Vt_util"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8312
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From126 {
                                value = "Vt_inv"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8008, 8264
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From129 {
                                value = "Vt_util"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8016, 8704
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From130 {
                                value = "f_util"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8016, 8672
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From133 {
                                value = "Vt_inv"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8016, 8848
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From132 {
                                value = "f_inv"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8016, 8816
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From128 {
                                value = "f_inv"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7680, 8464
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From124 {
                                value = "wt_util"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7952, 8512
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From122 {
                                value = "sync_ess"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8064, 8368
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From127 {
                                value = "wt_inv"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7952, 8560
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto4 {
                                value = "wt_util"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8424
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto6 {
                                value = "Vt_inv"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7336, 8528
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "sync_ess"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto7 {
                                value = "wt_inv"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7336, 8640
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From125 {
                                value = "f_util"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7680, 8416
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto3 {
                                value = "f_util"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8368
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "f_inv"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7336, 8584
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From123 {
                                value = "Vt_util"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8008, 8200
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction1 sp
                            [
                                position = 7952, 8416
                            ]

                            junction Junction4 sp
                            [
                                position = 8152, 8120
                            ]

                            junction Junction5 sp
                            [
                                position = 8256, 8416
                            ]

                            junction Junction6 sp
                            [
                                position = 8256, 8560
                            ]

                            junction Junction9 sp
                            [
                                position = 8248, 8832
                            ]

                            junction Junction10 sp
                            [
                                position = 8256, 8688
                            ]

                            connect Check_grid.freq From130 as Connection1983
                            connect Check_nominal_conditions.freq From132 as Connection1997
                            connect From121 f_match.sync as Connection1969
                            connect From122 phase_match.sync as Connection1970
                            connect From123 Vmatch.Vt_Util as Connection1977
                            connect From124 phase_match.phase_util as Connection1978
                            connect From125 f_match.f_Util as Connection1979
                            connect From126 Vmatch.Vt_Inv as Connection1982
                            connect From127 phase_match.phase_inv as Connection1981
                            connect From128 f_match.f_Inv as Connection1980
                            connect From129 Check_grid.Vt as Connection1984
                            connect From133 Check_nominal_conditions.Vt as Connection1996
                            connect Goto1 Junction4 as Connection1956
                            connect Goto2 PLL_Util.t as Connection1961
                            connect Goto3 PLL_Util.f as Connection1962
                            connect Goto4 PLL_Util.wt as Connection1963
                            connect Goto5 f_inv as Connection1965
                            connect Goto6 Vt_inv as Connection1964
                            connect Goto7 wt_inv as Connection1966
                            connect Junction1 phase_match.freq_lock as Connection593
                            connect Junction4 Vmatch.Sync_Ess as Connection1955
                            connect Junction5 phase_match.df_synch as Connection1972
                            connect Junction6 phase_match.phase_lock as Connection1975
                            connect Junction9 Check_nominal_conditions.on_nominal as Connection1999
                            connect "Turn on Sync" Junction4 as Connection1954
                            connect V_match Vmatch.V_match as Connection1986
                            connect Va_util PLL_Util.A as Connection1958
                            connect Vb_util PLL_Util.B as Connection1960
                            connect Vc_util PLL_Util.C as Connection1959
                            connect Vmatch.delta_V dV_match as Connection1953
                            connect df_sync Junction5 as Connection1971
                            connect dfsynch.in Junction5 as Connection1973
                            connect "f_match.freq lock" Junction1 as Connection592
                            connect freq_lock.in Junction1 as Connection594
                            connect grid_locked Junction6 as Connection1974
                            connect nominal_state Junction9 as Connection1995
                            connect on_nominal.in Junction9 as Connection1998
                            connect phase_lock.in Junction6 as Connection1976
                            connect phase_match.f_offset f_match.delta_f as Connection588
                            connect live_grid Junction10 as Connection2000
                            connect Junction10 Check_grid.live_grid as Connection2001
                            connect "live grid.in" Junction10 as Connection2002
                        }
                        [
                            position = 8208, 9056
                            size = 136, 280
                        ]

                        component Subsystem Imode_control {
                            layout = dynamic
                            component gen_sum Sum12 {
                                signs = "++"
                            }
                            [
                                position = 7928, 8408
                                hide_name = True
                            ]

                            component gen_probe Idref {
                                addr = "8966"
                                signal_type = "voltage"
                            }
                            [
                                position = 7616, 8048
                                rotation = left
                            ]

                            component gen_probe Qref {
                                addr = "8966"
                                signal_type = "voltage"
                            }
                            [
                                position = 7424, 8024
                                rotation = left
                            ]

                            component gen_probe Pref {
                                addr = "8966"
                                signal_type = "voltage"
                            }
                            [
                                position = 7464, 8056
                                rotation = left
                            ]

                            component gen_probe Iqref {
                                addr = "8966"
                                signal_type = "voltage"
                            }
                            [
                                position = 7616, 8176
                                rotation = left
                            ]

                            component gen_gain Gain2 {
                                gain = "1.0e3/Sn"
                            }
                            [
                                position = 7200, 7904
                                hide_name = True
                            ]

                            component src_constant Constant1 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7144, 7968
                                hide_name = True
                            ]

                            component gen_logic_op "Logical operator1" {
                                operator = "OR"
                            }
                            [
                                position = 7800, 7912
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "1.0e3/Sn"
                            }
                            [
                                position = 7200, 7864
                                hide_name = True
                            ]

                            component Subsystem "Dq current controller" {
                                layout = dynamic
                                component gen_sum Sum2 {
                                    signs = "-+"
                                }
                                [
                                    position = 7072, 8216
                                    rotation = down
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Gain11 {
                                    gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                                }
                                [
                                    position = 7656, 8232
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 7128, 7984
                                    hide_name = True
                                ]

                                component gen_gain Gain10 {
                                    gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                                }
                                [
                                    position = 7656, 8088
                                    hide_name = True
                                ]

                                component gen_sum Sum9 {
                                }
                                [
                                    position = 7440, 8096
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component gen_product Product6 {
                                }
                                [
                                    position = 7128, 8352
                                    hide_name = True
                                ]

                                component gen_product Product5 {
                                    signs = "*/"
                                }
                                [
                                    position = 7568, 8088
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component gen_sum Sum12 {
                                }
                                [
                                    position = 7440, 8224
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component gen_gain Gain5 {
                                    gain = "0.5"
                                }
                                [
                                    position = 6904, 7800
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_sum Sum13 {
                                }
                                [
                                    position = 7232, 8344
                                    hide_name = True
                                    scale = 1, -1
                                ]

                                component gen_product Product7 {
                                    signs = "*/"
                                }
                                [
                                    position = 7568, 8232
                                    hide_name = True
                                ]

                                component gen_gain Gain7 {
                                    gain = "L*(Sn*2*np.pi*fn)/(Vn**2.0)"
                                }
                                [
                                    position = 7056, 8344
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                    signs = "-+"
                                }
                                [
                                    position = 7072, 8104
                                    rotation = down
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_sum Sum10 {
                                    signs = "+-"
                                }
                                [
                                    position = 7232, 7976
                                    hide_name = True
                                ]

                                component gen_limiter Limit3 {
                                    lower_limit = "0.01"
                                }
                                [
                                    position = 6904, 7744
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_gain Gain4 {
                                    gain = "L*(Sn*2*np.pi*fn)/(Vn**2.0)"
                                }
                                [
                                    position = 7056, 7992
                                    hide_name = True
                                ]

                                component Subsystem damper {
                                    layout = dynamic
                                    component gen_sum Sum9 {
                                    }
                                    [
                                        position = 8240, 8280
                                        hide_name = True
                                    ]

                                    component gen_gain Id_damp {
                                        gain = "Imode_damp"
                                    }
                                    [
                                        position = 8120, 8144
                                    ]

                                    component gen_gain Iq_damp {
                                        gain = "Imode_damp"
                                    }
                                    [
                                        position = 8120, 8224
                                        rotation = down
                                        scale = -1, -1
                                    ]

                                    component gen_sum Sum8 {
                                    }
                                    [
                                        position = 8240, 8088
                                        hide_name = True
                                    ]

                                    port id {
                                        position = right:11
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8000, 8144
                                    ]

                                    port "mq out" {
                                        position = left:2
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8328, 8280
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    port iq {
                                        position = right:12
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8000, 8224
                                    ]

                                    port "md out" {
                                        position = left:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8328, 8088
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    port "md in" {
                                        position = right:10
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8072, 8080
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    port "mq in" {
                                        position = right:13
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8080, 8288
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    connect Id_damp.out Sum8.in1 as Connection110
                                    connect Id_damp.in id as Connection109
                                    connect Iq_damp.out Sum9.in as Connection112
                                    connect Iq_damp.in iq as Connection111
                                    connect "md in" Sum8.in as Connection103
                                    connect "md out" Sum8.out as Connection107
                                    connect "mq in" Sum9.in1 as Connection104
                                    connect "mq out" Sum9.out as Connection108
                                }
                                [
                                    position = 7816, 8160
                                    scale = -1, 1
                                    size = 80, 184
                                ]

                                component Subsystem PI_d {
                                    layout = dynamic
                                    component gen_gain Kb {
                                        gain = "1.0"
                                    }
                                    [
                                        position = 8216, 8312
                                        scale = -1, 1
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "lowLim"
                                        upper_limit = "upLim"
                                    }
                                    [
                                        position = 8408, 8224
                                        hide_name = True
                                    ]

                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8088, 8224
                                        hide_name = True
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8320, 8312
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum5 {
                                    }
                                    [
                                        position = 8320, 8224
                                        hide_name = True
                                    ]

                                    component gen_integrator Integrator1 {
                                        init_value = "out0"
                                        limit_lower = "-1"
                                        limit_upper = "1"
                                        show_reset = "either"
                                    }
                                    [
                                        position = 8216, 8232
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8136, 8128
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 7984, 8216
                                    ]

                                    port In {
                                        label = "In"
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7888, 8168
                                    ]

                                    port Out {
                                        label = "Out"
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8472, 8224
                                    ]

                                    port reset {
                                        position = top:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8136, 8256
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8368, 8224
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8440, 8224
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 7920, 8168
                                    ]

                                    connect Junction2 Limit1.in as Connection45
                                    connect Junction3 Out as Connection48
                                    connect Junction4 In as Connection67
                                    connect Kb.in Sum6.out as Connection50
                                    connect Ki.in Junction4 as Connection66
                                    connect Ki.out Sum7.in as Connection63
                                    connect Kp.in Junction4 as Connection68
                                    connect Kp.out Sum5.in as Connection65
                                    connect Limit1.out Junction3 as Connection47
                                    connect Sum5.in1 Integrator1.out as Connection5
                                    connect Sum5.out Junction2 as Connection44
                                    connect Sum6.in Junction2 as Connection46
                                    connect Sum6.in1 Junction3 as Connection49
                                    connect Sum7.out Integrator1.in as Connection52
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect reset Integrator1.reset as Connection62

                                    Ki = "ImodeId_Ki"
                                    Kp = "ImodeId_Kp"
                                    lowLim = "-1e5"
                                    out0 = "0.0"
                                    upLim = "1e5"

                                    mask {
                                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                        Kp {
                                            label = "Kp"
                                            widget = edit
                                            type = generic
                                            default_value = "1.0"
                                            group = "General"
                                        }

                                        Ki {
                                            label = "Ki"
                                            widget = edit
                                            type = generic
                                            default_value = "5.0"
                                            group = "General"
                                        }

                                        upLim {
                                            label = "Upper limit"
                                            widget = edit
                                            type = generic
                                            default_value = "100.0"
                                            group = "General"
                                        }

                                        lowLim {
                                            label = "Lower limit"
                                            widget = edit
                                            type = generic
                                            default_value = "0.0"
                                            group = "General"
                                        }

                                        out0 {
                                            label = "Integrator initial output"
                                            widget = edit
                                            type = generic
                                            default_value = "fnom"
                                            group = "General"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 7184, 8104
                                    size = 64, 48
                                ]

                                component Subsystem PI_q {
                                    layout = dynamic
                                    component gen_gain Kb {
                                        gain = "1.0"
                                    }
                                    [
                                        position = 8216, 8312
                                        scale = -1, 1
                                    ]

                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8088, 8224
                                        hide_name = True
                                    ]

                                    component gen_sum Sum5 {
                                    }
                                    [
                                        position = 8320, 8224
                                        hide_name = True
                                    ]

                                    component gen_integrator Integrator1 {
                                        init_value = "out0"
                                        limit_lower = "-1"
                                        limit_upper = "1"
                                        show_reset = "either"
                                    }
                                    [
                                        position = 8216, 8232
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "lowLim"
                                        upper_limit = "upLim"
                                    }
                                    [
                                        position = 8408, 8224
                                        hide_name = True
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8320, 8312
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 7976, 8216
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8128, 8136
                                    ]

                                    port In {
                                        label = "In"
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7888, 8168
                                    ]

                                    port Out {
                                        label = "Out"
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8472, 8224
                                    ]

                                    port reset {
                                        position = top:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8136, 8256
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8368, 8224
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8440, 8224
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 7920, 8168
                                    ]

                                    connect Junction2 Limit1.in as Connection45
                                    connect Junction3 Out as Connection48
                                    connect Junction4 In as Connection66
                                    connect Kb.in Sum6.out as Connection50
                                    connect Ki.in Junction4 as Connection65
                                    connect Ki.out Sum7.in as Connection68
                                    connect Kp.in Junction4 as Connection67
                                    connect Kp.out Sum5.in as Connection63
                                    connect Limit1.out Junction3 as Connection47
                                    connect Sum5.in1 Integrator1.out as Connection5
                                    connect Sum5.out Junction2 as Connection44
                                    connect Sum6.in Junction2 as Connection46
                                    connect Sum6.in1 Junction3 as Connection49
                                    connect Sum7.out Integrator1.in as Connection52
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect reset Integrator1.reset as Connection62

                                    Ki = "ImodeIq_Ki"
                                    Kp = "ImodeIq_Kp"
                                    lowLim = "-1e5"
                                    out0 = "0.0"
                                    upLim = "1e5"

                                    mask {
                                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                        Kp {
                                            label = "Kp"
                                            widget = edit
                                            type = generic
                                            default_value = "1.0"
                                            group = "General"
                                        }

                                        Ki {
                                            label = "Ki"
                                            widget = edit
                                            type = generic
                                            default_value = "5.0"
                                            group = "General"
                                        }

                                        upLim {
                                            label = "Upper limit"
                                            widget = edit
                                            type = generic
                                            default_value = "100.0"
                                            group = "General"
                                        }

                                        lowLim {
                                            label = "Lower limit"
                                            widget = edit
                                            type = generic
                                            default_value = "0.0"
                                            group = "General"
                                        }

                                        out0 {
                                            label = "Integrator initial output"
                                            widget = edit
                                            type = generic
                                            default_value = "fnom"
                                            group = "General"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 7328, 8216
                                    size = 64, 48
                                ]

                                port Id {
                                    position = right:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 6792, 8112
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Id_ref {
                                    position = right:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 6984, 8096
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Iq_ref {
                                    position = right:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 6984, 8208
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Iq {
                                    position = right:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 6792, 8224
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port m_d {
                                    position = left:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8088
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port m_q {
                                    position = left:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8232
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port f {
                                    position = right:5
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 6792, 8288
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Vd {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7176, 7912
                                    rotation = right
                                    scale = -1, 1
                                ]

                                port Vq {
                                    position = top:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7176, 8288
                                    rotation = right
                                    scale = -1, 1
                                ]

                                port Vdc {
                                    position = top:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 6904, 7680
                                    rotation = right
                                    scale = -1, 1
                                ]

                                port reset {
                                    position = top:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 6984, 7680
                                    rotation = right
                                    scale = -1, 1
                                ]

                                tag From132 {
                                    value = "iq"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 6968, 7992
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From139 {
                                    value = "reset"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7112, 8048
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag Goto21 {
                                    value = "reset"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 6984, 7752
                                    rotation = right
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From133 {
                                    value = "id"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7704, 8136
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag Goto20 {
                                    value = "half_Vdc"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 6904, 7872
                                    rotation = right
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From140 {
                                    value = "reset"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7256, 8176
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag Goto18 {
                                    value = "iq"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 6904, 8200
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag Goto17 {
                                    value = "id"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 6904, 8088
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From131 {
                                    value = "id"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 6968, 8344
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From142 {
                                    value = "half_Vdc"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7472, 8280
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From137 {
                                    value = "half_Vdc"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7480, 8024
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From135 {
                                    value = "f"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 6968, 8384
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag Goto19 {
                                    value = "f"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 6880, 8288
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From134 {
                                    value = "iq"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7704, 8184
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From141 {
                                    value = "f"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 6968, 7952
                                    hide_name = True
                                    size = 60, 20
                                ]

                                junction Junction173 sp
                                [
                                    position = 6856, 8112
                                ]

                                junction Junction174 sp
                                [
                                    position = 6856, 8224
                                ]

                                connect From131 Gain7.in as Connection1814
                                connect From132 Gain4.in as Connection1812
                                connect From133 damper.id as Connection1819
                                connect From134 damper.iq as Connection1820
                                connect From135 Product6.in1 as Connection1823
                                connect From137 Product5.in1 as Connection1827
                                connect From139 PI_d.reset as Connection1835
                                connect From140 PI_q.reset as Connection1839
                                connect From141 Product1.in as Connection1833
                                connect From142 Product7.in1 as Connection1870
                                connect Gain10.out "damper.md in" as Connection1860
                                connect Gain11.out "damper.mq in" as Connection1862
                                connect Goto17 Junction173 as Connection1807
                                connect Goto18 Junction174 as Connection1810
                                connect Goto20 Gain5.out as Connection1826
                                connect Goto21 reset as Connection1830
                                connect Id Junction173 as Connection1805
                                connect Iq Junction174 as Connection1808
                                connect Junction174 Sum2.in as Connection1811
                                connect Limit3.out Gain5.in as Connection1874
                                connect PI_d.In Sum1.out as Connection1834
                                connect PI_q.Out Sum12.in1 as Connection1837
                                connect PI_q.In Sum2.out as Connection1838
                                connect Product1.in1 Gain4.out as Connection177
                                connect Product5.out Gain10.in as Connection1868
                                connect Product5.in Sum9.out as Connection1869
                                connect Product6.in Gain7.out as Connection204
                                connect Product7.out Gain11.in as Connection1871
                                connect Product7.in Sum12.out as Connection1872
                                connect Sum1.in1 Id_ref as Connection276
                                connect Sum1.in Junction173 as Connection1813
                                connect Sum10.in1 Product1.out as Connection176
                                connect Sum10.out Sum9.in1 as Connection1867
                                connect Sum13.in Product6.out as Connection229
                                connect Sum13.out Sum12.in as Connection1866
                                connect Sum2.in1 Iq_ref as Connection277
                                connect Sum9.in PI_d.Out as Connection1875
                                [
                                    position = 0, 0
                                    breakpoints = 7264, 8104
                                ]
                                connect Vd Sum10.in as Connection297
                                connect Vdc Limit3.in as Connection1873
                                connect Vq Sum13.in1 as Connection298
                                connect "damper.mq out" m_q as Connection1876
                                [
                                    position = 0, 0
                                ]
                                connect f Goto19 as Connection1822
                                connect m_d "damper.md out" as Connection1877
                                [
                                    position = 0, 0
                                ]
                            }
                            [
                                position = 7904, 8192
                                scale = -1, 1
                                size = 136, 232
                            ]

                            component Subsystem Limit_PQref {
                                layout = dynamic
                                component gen_rate_limiter "Q rate limit" {
                                    falling_limit = "-ratemax"
                                    rising_limit = "ratemax"
                                }
                                [
                                    position = 7976, 8264
                                ]

                                component tm_delay "Unit Delay1" {
                                }
                                [
                                    position = 8200, 8192
                                    hide_name = True
                                ]

                                component tm_delay "Unit Delay2" {
                                }
                                [
                                    position = 8200, 8336
                                    hide_name = True
                                ]

                                component gen_rate_limiter "S rate limit" {
                                    falling_limit = "-ratemax"
                                    rising_limit = "ratemax"
                                }
                                [
                                    position = 7976, 8336
                                ]

                                component gen_rate_limiter "P rate limit" {
                                    falling_limit = "-ratemax"
                                    rising_limit = "ratemax"
                                }
                                [
                                    position = 7976, 8192
                                ]

                                component Subsystem limS_overPQ {
                                    layout = dynamic
                                    component gen_c_function "S limiting over PQ" {
                                        global_variables = "real S_PQref;"
                                        in_terminal_dimensions = "inherit;inherit;inherit"
                                        in_terminal_dimensions_str = "Pref inherit;Qref inherit;Sref inherit"
                                        in_terminal_labels = "False;False;False;"
                                        in_terminal_properties = "inherit Pref;inherit Qref;inherit Sref;"
                                        init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                        no_feed_inputs = "[\'\']"
                                        no_feed_outputs = "[\'\']"
                                        out_terminal_dimensions = "inherit;inherit"
                                        out_terminal_dimensions_str = "P inherit;Q inherit"
                                        out_terminal_labels = "False;False;"
                                        out_terminal_properties = "inherit P;inherit Q;"
                                        output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                    }
                                    [
                                        position = 8192, 8192
                                        size = 48, 64
                                    ]

                                    port Pref {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8088, 8112
                                        rotation = right
                                    ]

                                    port Qref {
                                        position = left:2
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8040, 8192
                                    ]

                                    port Sref {
                                        position = left:3
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8088, 8272
                                        rotation = left
                                    ]

                                    port P {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8280, 8120
                                        rotation = left
                                    ]

                                    port Q {
                                        position = right:2
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8280, 8272
                                        rotation = right
                                    ]

                                    connect "S limiting over PQ.P" P as Connection3
                                    connect "S limiting over PQ.Pref" Pref as Connection5
                                    connect "S limiting over PQ.Q" Q as Connection2
                                    connect "S limiting over PQ.Qref" Qref as Connection1
                                    connect "S limiting over PQ.Sref" Sref as Connection4
                                }
                                [
                                    position = 8096, 8264
                                    size = 56, 184
                                ]

                                component Subsystem priority_PQlim {
                                    layout = dynamic
                                    component gen_c_function "PQ limiting with priority" {
                                        global_variables = "real signQ;real signP;real Sref;"
                                        in_terminal_dimensions = "inherit;inherit;inherit"
                                        in_terminal_dimensions_str = "Pref inherit;Qref inherit;Smax inherit"
                                        in_terminal_labels = "False;False;False;"
                                        in_terminal_properties = "inherit Pref;inherit Qref;inherit Smax;"
                                        init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                        no_feed_inputs = "[\'\']"
                                        no_feed_outputs = "[\'\']"
                                        out_terminal_dimensions = "inherit;inherit;inherit"
                                        out_terminal_dimensions_str = "P inherit;Q inherit;S inherit"
                                        out_terminal_labels = "False;False;False;"
                                        out_terminal_properties = "inherit P;inherit Q;inherit S;"
                                        output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                        parameters = "real type;"
                                    }
                                    [
                                        position = 8192, 8192
                                        size = 0, 0
                                    ]

                                    port Pref {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8096, 8128
                                        rotation = right
                                    ]

                                    port Qref {
                                        position = left:2
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8032, 8192
                                    ]

                                    port Smax {
                                        position = left:3
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8096, 8272
                                        rotation = left
                                    ]

                                    port P {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8304, 8128
                                        rotation = left
                                    ]

                                    port Q {
                                        position = right:2
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8368, 8192
                                    ]

                                    port S {
                                        position = right:3
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8304, 8272
                                        rotation = right
                                    ]

                                    connect "PQ limiting with priority.P" P as Connection5
                                    connect "PQ limiting with priority.Pref" Pref as Connection2
                                    connect "PQ limiting with priority.Q" Q as Connection6
                                    connect "PQ limiting with priority.Qref" Qref as Connection3
                                    connect "PQ limiting with priority.S" S as Connection4
                                    connect "PQ limiting with priority.Smax" Smax as Connection1
                                }
                                [
                                    position = 7872, 8264
                                    size = 56, 184
                                ]

                                port Qlim {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8336
                                ]

                                port Plim {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8192
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7752, 8192
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7752, 8264
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7752, 8336
                                ]

                                connect "P rate limit.out" limS_overPQ.Pref as Connection166
                                connect "P rate limit.in" priority_PQlim.P as Connection158
                                connect Plim "Unit Delay1.out" as Connection161
                                connect Pref priority_PQlim.Pref as Connection155
                                connect "Q rate limit.out" limS_overPQ.Qref as Connection162
                                connect "Q rate limit.in" priority_PQlim.Q as Connection159
                                connect Qref priority_PQlim.Qref as Connection156
                                connect "S rate limit.out" limS_overPQ.Sref as Connection165
                                connect "S rate limit.in" priority_PQlim.S as Connection157
                                connect Smax priority_PQlim.Smax as Connection154
                                connect "Unit Delay1.in" limS_overPQ.P as Connection164
                                connect "Unit Delay2.out" Qlim as Connection160
                                connect "Unit Delay2.in" limS_overPQ.Q as Connection163

                                type = "1.0"

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                    type {
                                        label = "Priority type"
                                        widget = edit
                                        type = generic
                                        default_value = "2.0"
                                    }

                                    ratemax {
                                        label = "Max power rate"
                                        widget = edit
                                        type = generic
                                        default_value = "powerRate"
                                        unit = "pu/s"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                    
                                    ENDCODE
                                }
                            }
                            [
                                position = 7248, 8040
                                rotation = right
                                size = 64, 96
                            ]

                            component Subsystem "Island detection (modified SFS)" {
                                layout = dynamic
                                component src_constant Constant6 {
                                    execution_rate = "Ts"
                                    value = "1.0"
                                }
                                [
                                    position = 8048, 8216
                                    hide_name = True
                                ]

                                component gen_sum Sum11 {
                                    signs = "+-"
                                }
                                [
                                    position = 8136, 8160
                                    hide_name = True
                                ]

                                component src_constant Constant7 {
                                    execution_rate = "Ts"
                                    value = "k"
                                }
                                [
                                    position = 8128, 8224
                                    hide_name = True
                                ]

                                component gen_gain Gain6 {
                                    gain = "fn*np.pi/2"
                                }
                                [
                                    position = 8320, 8168
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                    signs = "**"
                                }
                                [
                                    position = 8248, 8168
                                    hide_name = True
                                ]

                                port "inv freq" {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8048, 8152
                                ]

                                port "phase shift" {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8384, 8168
                                ]

                                connect Constant6.out Sum11.in1 as Connection2223
                                connect Constant7.out Product1.in1 as Connection2226
                                connect Gain6.in Product1.out as Connection2227
                                connect Gain6.out "phase shift" as Connection2229
                                connect Sum11.out Product1.in as Connection2228
                                connect Sum11.in "inv freq" as Connection2230
                            }
                            [
                                position = 7768, 8472
                                size = 168, 56
                            ]

                            component "core/Edge Detection" "Edge Detection1" {
                            }
                            [
                                position = 7696, 7904
                                hide_name = True
                                size = 32, 32
                            ]

                            component Subsystem Current_ref {
                                layout = dynamic
                                component gen_limiter Limit3 {
                                    lower_limit = "0.01"
                                }
                                [
                                    position = 7464, 8280
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 7496, 7992
                                    hide_name = True
                                ]

                                component gen_product Product5 {
                                }
                                [
                                    position = 7496, 8136
                                    hide_name = True
                                ]

                                component gen_sum Sum3 {
                                    signs = "+-"
                                }
                                [
                                    position = 7600, 8056
                                    hide_name = True
                                ]

                                component gen_sum Sum4 {
                                }
                                [
                                    position = 7600, 8144
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                    signs = "*/"
                                }
                                [
                                    position = 7720, 8064
                                    hide_name = True
                                ]

                                component gen_product Product6 {
                                }
                                [
                                    position = 7496, 8208
                                    hide_name = True
                                ]

                                component gen_product Product2 {
                                    signs = "*/"
                                }
                                [
                                    position = 7720, 8152
                                    hide_name = True
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 7496, 8064
                                    hide_name = True
                                ]

                                component Subsystem squared_Vt {
                                    layout = dynamic
                                    component gen_product Product1 {
                                    }
                                    [
                                        position = 7872, 8136
                                        hide_name = True
                                    ]

                                    component gen_product Product2 {
                                    }
                                    [
                                        position = 7872, 8208
                                        hide_name = True
                                    ]

                                    component gen_sum Sum3 {
                                    }
                                    [
                                        position = 7960, 8168
                                        hide_name = True
                                    ]

                                    port Vd {
                                        position = right:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7760, 8128
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    port Vq {
                                        position = right:3
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7760, 8200
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    port Vt_p2 {
                                        label = "Vt^2"
                                        position = left:2
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8032, 8168
                                        rotation = down
                                        scale = -1, 1
                                    ]

                                    junction Junction136 sp
                                    [
                                        position = 7808, 8128
                                    ]

                                    junction Junction137 sp
                                    [
                                        position = 7808, 8200
                                    ]

                                    connect Junction136 Product1.in as Connection2
                                    connect Junction136 Vd as Connection1
                                    connect Junction137 Vq as Connection3
                                    connect Product1.in1 Junction136 as Connection4
                                    connect Product2.in Junction137 as Connection6
                                    connect Product2.in1 Junction137 as Connection5
                                    connect Sum3.in Product1.out as Connection8
                                    connect Sum3.in1 Product2.out as Connection9
                                    connect Sum3.out Vt_p2 as Connection7
                                }
                                [
                                    position = 7352, 8280
                                    scale = -1, 1
                                    size = 48, 56
                                ]

                                port P_ref {
                                    position = right:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7200, 8128
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Q_ref {
                                    position = right:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7200, 8200
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Id_ref {
                                    position = left:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7856, 8152
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Iq_ref {
                                    position = left:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7856, 8064
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Vq {
                                    position = right:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7200, 7984
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Vd {
                                    position = right:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7200, 8056
                                    rotation = down
                                    scale = -1, 1
                                ]

                                junction Junction139 sp
                                [
                                    position = 7400, 8128
                                ]

                                junction Junction141 sp
                                [
                                    position = 7392, 8200
                                ]

                                junction Junction142 sp
                                [
                                    position = 7336, 8056
                                ]

                                junction Junction143 sp
                                [
                                    position = 7352, 7984
                                ]

                                junction Junction150 sp
                                [
                                    position = 7304, 7984
                                ]

                                junction Junction151 sp
                                [
                                    position = 7288, 8056
                                ]

                                junction Junction152 sp
                                [
                                    position = 7656, 8160
                                ]

                                connect Iq_ref Product1.out as Connection78
                                connect Junction139 P_ref as Connection53
                                connect Junction141 Q_ref as Connection11
                                connect Junction142 Junction151 as Connection58
                                connect Junction143 Junction150 as Connection55
                                connect Junction143 Product3.in as Connection13
                                connect Junction150 Vq as Connection56
                                connect Junction151 Vd as Connection59
                                connect Junction152 Product2.in1 as Connection76
                                connect Limit3.out Junction152 as Connection77
                                connect Limit3.in squared_Vt.Vt_p2 as Connection74
                                connect Product1.in1 Junction152 as Connection75
                                connect Product1.in Sum3.out as Connection23
                                connect Product2.out Id_ref as Connection79
                                connect Product2.in Sum4.out as Connection26
                                connect Product3.in1 Junction139 as Connection27
                                connect Product3.out Sum3.in as Connection28
                                connect Product4.in1 Junction141 as Connection29
                                connect Product4.in Junction142 as Connection30
                                connect Product4.out Sum3.in1 as Connection31
                                connect Product5.in Junction139 as Connection32
                                connect Product5.in1 Junction142 as Connection33
                                connect Product5.out Sum4.in as Connection34
                                connect Product6.in Junction141 as Connection35
                                connect Product6.in1 Junction143 as Connection36
                                connect Product6.out Sum4.in1 as Connection37
                                connect squared_Vt.Vq Junction150 as Connection57
                                connect squared_Vt.Vd Junction151 as Connection60
                            }
                            [
                                position = 7544, 8168
                                scale = -1, 1
                                size = 80, 184
                            ]

                            component "core/Edge Detection" "Edge Detection2" {
                            }
                            [
                                position = 7696, 7960
                                hide_name = True
                                size = 32, 32
                            ]

                            port Vq {
                                position = right:11
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7336, 8192
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:10
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7336, 8240
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id {
                                position = right:12
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq {
                                position = right:13
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8192
                                rotation = down
                                scale = -1, 1
                            ]

                            port f {
                                position = right:14
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vdc {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7888, 7952
                                rotation = left
                                scale = 1, -1
                            ]

                            port wt_ess {
                                position = right:15
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8400
                                rotation = down
                                scale = -1, 1
                            ]

                            port wt {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8408
                                rotation = down
                                scale = -1, 1
                            ]

                            port md {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port mq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port On {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7632, 7960
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vmode {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7632, 7904
                                rotation = down
                                scale = -1, 1
                            ]

                            tag Goto18 {
                                value = "f_ess"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7792, 8264
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From167 {
                                value = "Pref"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7112, 7864
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto19 {
                                value = "Vd_ess"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7432, 8216
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From166 {
                                value = "f_ess"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7592, 8472
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From168 {
                                value = "Qref"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7112, 7904
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto20 {
                                value = "Vq_ess"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7432, 8168
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From151 {
                                value = "Vq_ess"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7920, 8000
                                rotation = right
                                hide_name = True
                                size = 58, 20
                            ]

                            tag From152 {
                                value = "Vd_ess"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7952, 8000
                                rotation = right
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction1 sp
                            [
                                position = 7736, 8288
                            ]

                            junction Junction2 sp
                            [
                                position = 7376, 8192
                            ]

                            junction Junction3 sp
                            [
                                position = 7376, 8240
                            ]

                            junction Junction6 sp
                            [
                                position = 7616, 8240
                            ]

                            junction Junction7 sp
                            [
                                position = 7616, 8096
                            ]

                            junction Junction8 sp
                            [
                                position = 7464, 8096
                            ]

                            junction Junction9 sp
                            [
                                position = 7424, 8144
                            ]

                            connect Constant1.out Limit_PQref.Smax as Connection2566
                            connect Current_ref.Vq Junction2 as Connection2308
                            connect Current_ref.P_ref Junction8 as Connection2554
                            connect Current_ref.Q_ref Junction9 as Connection2557
                            connect "Dq current controller.Id" Id as Connection2287
                            connect "Dq current controller.Iq" Iq as Connection2290
                            connect "Dq current controller.f" Junction1 as Connection2297
                            connect "Dq current controller.Iq_ref" Junction6 as Connection2332
                            connect "Dq current controller.Id_ref" Junction7 as Connection2335
                            connect "Edge Detection1.Out1" "Logical operator1.in" as Connection2510
                            connect "Edge Detection1.In1" Vmode as Connection2513
                            connect "Edge Detection2.Out1" "Logical operator1.in1" as Connection2512
                            connect "Edge Detection2.In1" On as Connection2514
                            connect From151 "Dq current controller.Vq" as Connection1839
                            connect From152 "Dq current controller.Vd" as Connection1840
                            connect From166 "Island detection (modified SFS).inv freq" as Connection2232
                            connect From168 Gain2.in as Connection2542
                            connect Gain1.in From167 as Connection2541
                            connect Gain2.out Limit_PQref.Qref as Connection2567
                            [
                                position = 0, 0
                            ]
                            connect Goto18 Junction1 as Connection2299
                            connect Goto19 Junction3 as Connection2313
                            connect Goto20 Junction2 as Connection2310
                            connect Idref.in Junction7 as Connection2337
                            connect Iqref.in Junction6 as Connection2334
                            connect Junction1 f as Connection2298
                            connect Junction2 Vq as Connection2309
                            connect Junction3 Current_ref.Vd as Connection2312
                            connect Junction6 Current_ref.Iq_ref as Connection2333
                            connect Junction7 Current_ref.Id_ref as Connection2336
                            connect Junction8 Pref.in as Connection2555
                            connect Junction9 Qref.in as Connection2558
                            connect Limit_PQref.Pref Gain1.out as Connection2568
                            [
                                position = 0, 0
                            ]
                            connect Limit_PQref.Plim Junction8 as Connection2556
                            connect Limit_PQref.Qlim Junction9 as Connection2559
                            connect "Logical operator1.out" "Dq current controller.reset" as Connection2515
                            connect Sum12.in1 "Island detection (modified SFS).phase shift" as Connection2231
                            connect Sum12.out wt as Connection2291
                            connect Vd Junction3 as Connection2311
                            connect Vdc "Dq current controller.Vdc" as Connection2432
                            connect md "Dq current controller.m_d" as Connection2295
                            connect mq "Dq current controller.m_q" as Connection2296
                            connect wt_ess Sum12.in as Connection2434
                        }
                        [
                            position = 8216, 8384
                            scale = -1, 1
                            size = 120, 200
                        ]

                        component Subsystem Power_Meas {
                            layout = dynamic
                            component gen_gain Gain3 {
                                gain = "Sn"
                            }
                            [
                                position = 8336, 8256
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "Sn"
                            }
                            [
                                position = 8272, 8112
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "Sn"
                            }
                            [
                                position = 8336, 8112
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQ {
                                layout = dynamic
                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_c_function S_and_pf {
                                    in_terminal_dimensions = "inherit;inherit"
                                    in_terminal_dimensions_str = "P inherit;Q inherit"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real P;inherit Q;"
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "S inherit;pf inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit S;inherit pf;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8448, 8192
                                    size = 48, 48
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8264, 8272
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8264, 8112
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8272
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8520, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8520, 8240
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                junction Junction5 sp
                                [
                                    position = 8320, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8320, 8272
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 7960, 7968
                                ]

                                connect Junction1 Id as Connection49
                                connect Junction1 Product4.in1 as Connection24
                                connect Junction2 Iq as Connection52
                                connect Junction2 Product3.in1 as Connection27
                                connect Junction3 Product2.in as Connection32
                                connect Junction3 Vq as Connection53
                                connect Junction4 Product1.in as Connection35
                                connect Junction4 Vd as Connection50
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction5 P as Connection55
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction6 Q as Connection56
                                connect Product1.in1 Junction1 as Connection25
                                connect Product2.in1 Junction2 as Connection28
                                connect Product3.in Junction4 as Connection36
                                connect Product4.in Junction3 as Connection33
                                connect S_and_pf.P Junction5 as Connection45
                                connect S_and_pf.Q Junction6 as Connection48
                                connect S_and_pf.S S as Connection51
                                connect S_and_pf.pf pf as Connection54
                                connect Sum1.out LPF_P.in as Connection59
                                connect Sum1.in Product1.out as Connection29
                                connect Sum1.in1 Product2.out as Connection30
                                connect Sum2.out LPF_Q.in as Connection58
                                connect Sum2.in1 Product3.out as Connection38
                                connect Sum2.in Product4.out as Connection37

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                    
                                    ENDCODE
                                }
                            }
                            [
                                position = 8184, 8208
                                size = 72, 144
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8096, 8112
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8112
                                rotation = right
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8320
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8096, 8320
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8272, 8048
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8336, 8048
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8336, 8320
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8272, 8320
                                rotation = right
                            ]

                            connect Gain2.out Q as Connection12
                            connect Gain3.out S as Connection14
                            connect P Gain1.out as Connection18
                            connect Power_Meas_DQ.S Gain3.in as Connection13
                            connect Power_Meas_DQ.Id Id as Connection3
                            connect Power_Meas_DQ.Iq Iq as Connection4
                            connect Power_Meas_DQ.Vd Vd as Connection1
                            connect Power_Meas_DQ.Vq Vq as Connection2
                            connect Power_Meas_DQ.pf pf as Connection8
                            connect Gain1.in Power_Meas_DQ.P as Connection25
                            connect Power_Meas_DQ.Q Gain2.in as Connection26
                        }
                        [
                            position = 8664, 8872
                            size = 80, 232
                        ]

                        component Subsystem ABCtoDQ {
                            layout = dynamic
                            component gen_terminator Termination1 {
                            }
                            [
                                position = 8344, 8248
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 8336, 8120
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 8384, 8120
                                rotation = left
                                hide_name = True
                            ]

                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 8256, 8176
                                size = 48, 80
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8200, 8056
                                rotation = right
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8056
                                rotation = right
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8288
                                rotation = left
                            ]

                            port wt {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8192, 8288
                                rotation = left
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8336, 8016
                                rotation = left
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8384, 8016
                                rotation = left
                            ]

                            connect "abc to dq1.va" A as Connection2337
                            connect B "abc to dq1.vb" as Connection2338
                            connect "abc to dq1.vc" C as Connection2339
                            connect wt "abc to dq1.wt" as Connection2340
                            connect "abc to dq1.d_axis" Gain1.in as Connection2341
                            connect "abc to dq1.q_axis" Gain2.in as Connection2342
                            connect "abc to dq1.zero_axis" Termination1.in as Connection2343
                            connect q Gain2.out as Connection2344
                            [
                                position = 0, 0
                            ]
                            connect d Gain1.out as Connection2345
                            [
                                position = 0, 0
                            ]
                        }
                        [
                            position = 7624, 8904
                            size = 72, 192
                        ]

                        component Subsystem Vmode_control {
                            layout = dynamic
                            component gen_sum Sum3 {
                            }
                            [
                                position = 6968, 8096
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "1.0/fn"
                            }
                            [
                                position = 6744, 8360
                                hide_name = True
                            ]

                            component sys_signal_switch "Signal switch1" {
                                criterion = "ctrl > threshold"
                                threshold = "0.5"
                            }
                            [
                                position = 6808, 8048
                                hide_name = True
                            ]

                            component gen_rate_limiter "Rate Limiter2" {
                                falling_limit = "f_fall"
                                rising_limit = "f_rise"
                            }
                            [
                                position = 6816, 8360
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "1.0/Vn"
                            }
                            [
                                position = 6728, 8032
                                hide_name = True
                            ]

                            component src_constant Constant1 {
                                execution_rate = "Ts"
                                value = "0.0"
                            }
                            [
                                position = 6704, 8088
                                hide_name = True
                            ]

                            component gen_rate_limiter "Rate Limiter1" {
                                falling_limit = "V_fall"
                                rising_limit = "V_rise"
                            }
                            [
                                position = 6888, 8048
                                hide_name = True
                            ]

                            component gen_probe Vt_ref {
                            }
                            [
                                position = 7040, 8048
                                rotation = left
                                scale = -1, 1
                            ]

                            component gen_probe Id_ref {
                            }
                            [
                                position = 7208, 8080
                                rotation = left
                                scale = -1, 1
                            ]

                            component gen_logic_op "Logical operator1" {
                                operator = "OR"
                            }
                            [
                                position = 7312, 7912
                                hide_name = True
                            ]

                            component Subsystem Current_ref {
                                layout = dynamic
                                component gen_sum Sum4 {
                                    signs = "+-"
                                }
                                [
                                    position = 7848, 8096
                                    hide_name = True
                                ]

                                component Subsystem PI {
                                    layout = dynamic
                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8088, 8224
                                        hide_name = True
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "lowLim"
                                        upper_limit = "upLim"
                                    }
                                    [
                                        position = 8408, 8224
                                        hide_name = True
                                    ]

                                    component gen_sum Sum5 {
                                    }
                                    [
                                        position = 8320, 8224
                                        hide_name = True
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8320, 8312
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_integrator Integrator1 {
                                        init_value = "out0"
                                        limit_lower = "-1"
                                        limit_upper = "1"
                                        show_reset = "either"
                                    }
                                    [
                                        position = 8216, 8232
                                    ]

                                    component gen_gain Kb {
                                        gain = "1.0"
                                    }
                                    [
                                        position = 8216, 8312
                                        scale = -1, 1
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 7976, 8216
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8128, 8128
                                    ]

                                    port In {
                                        label = "In"
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7888, 8168
                                    ]

                                    port Out {
                                        label = "Out"
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8472, 8224
                                    ]

                                    port reset {
                                        position = top:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8136, 8256
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8368, 8224
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8440, 8224
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 7920, 8168
                                    ]

                                    connect Junction2 Limit1.in as Connection45
                                    connect Junction3 Out as Connection48
                                    connect Junction4 In as Connection67
                                    connect Kb.in Sum6.out as Connection50
                                    connect Ki.in Junction4 as Connection68
                                    connect Ki.out Sum7.in as Connection64
                                    connect Kp.in Junction4 as Connection66
                                    connect Kp.out Sum5.in as Connection63
                                    connect Limit1.out Junction3 as Connection47
                                    connect Sum5.in1 Integrator1.out as Connection5
                                    connect Sum5.out Junction2 as Connection44
                                    connect Sum6.in Junction2 as Connection46
                                    connect Sum6.in1 Junction3 as Connection49
                                    connect Sum7.out Integrator1.in as Connection52
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect reset Integrator1.reset as Connection62

                                    Ki = "VmodeIdRef_Ki"
                                    Kp = "VmodeIdRef_Kp"
                                    lowLim = "-1.00"
                                    out0 = "(((Vn*OutputFilterFc)**2.0*2*np.pi*L)/(Sn*fn))/(Resr**2.0+((2.0*np.pi*L*OutputFilterFc**2.0)/fn)**2.0)"
                                    upLim = "1.00"

                                    mask {
                                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                        Kp {
                                            label = "Kp"
                                            widget = edit
                                            type = generic
                                            default_value = "1.0"
                                            group = "General"
                                        }

                                        Ki {
                                            label = "Ki"
                                            widget = edit
                                            type = generic
                                            default_value = "5.0"
                                            group = "General"
                                        }

                                        upLim {
                                            label = "Upper limit"
                                            widget = edit
                                            type = generic
                                            default_value = "100.0"
                                            group = "General"
                                        }

                                        lowLim {
                                            label = "Lower limit"
                                            widget = edit
                                            type = generic
                                            default_value = "0.0"
                                            group = "General"
                                        }

                                        out0 {
                                            label = "Integrator initial output"
                                            widget = edit
                                            type = generic
                                            default_value = "fnom"
                                            group = "General"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 7960, 8096
                                    size = 64, 48
                                ]

                                port "id ref" {
                                    position = left:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8064, 8096
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port vd {
                                    position = right:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7768, 8136
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port enable {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7920, 8048
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port "vt ref" {
                                    position = right:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7768, 8088
                                    rotation = down
                                    scale = -1, 1
                                ]

                                connect PI.In Sum4.out as Connection1668
                                connect PI.reset enable as Connection1669
                                connect PI.Out "id ref" as Connection1670
                                connect Sum4.in1 vd as Connection1663
                                connect Sum4.in "vt ref" as Connection1667
                            }
                            [
                                position = 7128, 8128
                                scale = -1, 1
                                size = 88, 96
                            ]

                            component "core/Edge Detection" "Edge Detection1" {
                            }
                            [
                                position = 7208, 7904
                                hide_name = True
                                size = 32, 32
                            ]

                            component Subsystem "Inner dq current controller" {
                                layout = dynamic
                                component gen_product Product11 {
                                    signs = "*/"
                                }
                                [
                                    position = 7696, 7560
                                    hide_name = True
                                ]

                                component gen_gain Gain5 {
                                    gain = "Vmode_ovMod"
                                }
                                [
                                    position = 7240, 7392
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_limiter Limit3 {
                                    lower_limit = "0.01"
                                }
                                [
                                    position = 7240, 7336
                                    rotation = right
                                    hide_name = True
                                ]

                                component gen_sum Sum15 {
                                    signs = "-+"
                                }
                                [
                                    position = 7312, 7552
                                    rotation = down
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_gain Gain10 {
                                    gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                                }
                                [
                                    position = 7776, 7560
                                    hide_name = True
                                ]

                                component src_constant Constant1 {
                                    execution_rate = "Ts"
                                    value = "0"
                                }
                                [
                                    position = 7816, 7632
                                    hide_name = True
                                ]

                                component Subsystem PI_d {
                                    layout = dynamic
                                    component gen_gain Kb {
                                        gain = "1.0"
                                    }
                                    [
                                        position = 8216, 8352
                                        scale = -1, 1
                                    ]

                                    component gen_limiter Limit1 {
                                        lower_limit = "lowLim"
                                        upper_limit = "upLim"
                                    }
                                    [
                                        position = 8408, 8232
                                        hide_name = True
                                    ]

                                    component gen_sum Sum6 {
                                        signs = "-+"
                                    }
                                    [
                                        position = 8320, 8352
                                        hide_name = True
                                        scale = -1, 1
                                    ]

                                    component gen_integrator Integrator1 {
                                        init_value = "out0"
                                        limit_lower = "-1"
                                        limit_upper = "1"
                                        show_reset = "either"
                                    }
                                    [
                                        position = 8216, 8240
                                    ]

                                    component gen_sum Sum5 {
                                    }
                                    [
                                        position = 8320, 8232
                                        hide_name = True
                                    ]

                                    component gen_sum Sum7 {
                                    }
                                    [
                                        position = 8088, 8224
                                        hide_name = True
                                    ]

                                    component gen_gain Kp {
                                        gain = "Kp"
                                    }
                                    [
                                        position = 8136, 8128
                                    ]

                                    component gen_gain Ki {
                                        gain = "Ki"
                                    }
                                    [
                                        position = 7984, 8216
                                    ]

                                    port In {
                                        label = "In"
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7888, 8168
                                    ]

                                    port Out {
                                        label = "Out"
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8472, 8232
                                    ]

                                    port reset {
                                        position = top:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8136, 8240
                                    ]

                                    junction Junction2 sp
                                    [
                                        position = 8368, 8232
                                    ]

                                    junction Junction3 sp
                                    [
                                        position = 8440, 8232
                                    ]

                                    junction Junction4 sp
                                    [
                                        position = 7920, 8168
                                    ]

                                    connect Junction2 Limit1.in as Connection45
                                    connect Junction3 Out as Connection48
                                    connect Junction4 In as Connection67
                                    connect Kb.in Sum6.out as Connection50
                                    connect Ki.in Junction4 as Connection66
                                    connect Kp.in Junction4 as Connection68
                                    connect Kp.out Sum5.in as Connection63
                                    connect Limit1.out Junction3 as Connection47
                                    connect Sum5.in1 Integrator1.out as Connection5
                                    connect Sum5.out Junction2 as Connection44
                                    connect Sum6.in Junction2 as Connection46
                                    connect Sum6.in1 Junction3 as Connection49
                                    connect Sum7.out Integrator1.in as Connection52
                                    connect Sum7.in1 Kb.out as Connection53
                                    connect Sum7.in Ki.out as Connection64
                                    connect reset Integrator1.reset as Connection62

                                    Ki = "VmodeId_Ki"
                                    Kp = "VmodeId_Kp"
                                    lowLim = "-10.0"
                                    out0 = "0.0"
                                    upLim = "10.0"

                                    mask {
                                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PI controller</span></p></body></html>"

                                        Kp {
                                            label = "Kp"
                                            widget = edit
                                            type = generic
                                            default_value = "1.0"
                                            group = "General"
                                        }

                                        Ki {
                                            label = "Ki"
                                            widget = edit
                                            type = generic
                                            default_value = "5.0"
                                            group = "General"
                                        }

                                        upLim {
                                            label = "Upper limit"
                                            widget = edit
                                            type = generic
                                            default_value = "100.0"
                                            group = "General"
                                        }

                                        lowLim {
                                            label = "Lower limit"
                                            widget = edit
                                            type = generic
                                            default_value = "0.0"
                                            group = "General"
                                        }

                                        out0 {
                                            label = "Integrator initial output"
                                            widget = edit
                                            type = generic
                                            default_value = "fnom"
                                            group = "General"
                                        }

                                        CODE open
                                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                        
                                            dialog = RegularComponentPropertiesDialog(
                                                component=component,
                                                property_container=component.masks[-1],
                                                current_diagram=current_diagram
                                            )
                                            dialog.exec_()
                                        
                                        ENDCODE
                                    }
                                }
                                [
                                    position = 7464, 7552
                                    size = 64, 48
                                ]

                                port m_d {
                                    position = left:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7896, 7560
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port reset {
                                    position = top:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7320, 7280
                                    rotation = right
                                    scale = -1, 1
                                ]

                                port m_q {
                                    position = left:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7896, 7632
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Vdc {
                                    position = top:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7240, 7280
                                    rotation = right
                                    scale = -1, 1
                                ]

                                port f {
                                    position = right:5
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7160, 7664
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Id_ref {
                                    position = right:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7160, 7544
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Id {
                                    position = right:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7160, 7600
                                    rotation = down
                                    scale = -1, 1
                                ]

                                tag Goto20 {
                                    value = "overMod"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 7240, 7472
                                    rotation = right
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag Goto19 {
                                    value = "f"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 7280, 7664
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From139 {
                                    value = "reset"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7368, 7496
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag Goto21 {
                                    value = "reset"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 7320, 7352
                                    rotation = right
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag Goto17 {
                                    value = "id"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 7272, 7600
                                    hide_name = True
                                    size = 60, 20
                                ]

                                tag From137 {
                                    value = "overMod"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7584, 7576
                                    hide_name = True
                                    size = 60, 20
                                ]

                                junction Junction173 sp
                                [
                                    position = 7208, 7600
                                ]

                                connect Constant1.out m_q as Connection1849
                                connect From137 Product11.in1 as Connection1827
                                connect Goto17 Junction173 as Connection1807
                                connect Goto20 Gain5.out as Connection1826
                                connect Goto21 reset as Connection1830
                                connect Id Junction173 as Connection1805
                                connect Limit3.out Gain5.in as Connection1911
                                connect PI_d.reset From139 as Connection1899
                                connect PI_d.Out Product11.in as Connection1913
                                [
                                    position = 0, 0
                                    breakpoints = 7592, 7552
                                ]
                                connect PI_d.In Sum15.out as Connection1851
                                connect Product11.out Gain10.in as Connection1874
                                connect Sum15.in1 Id_ref as Connection276
                                connect Sum15.in Junction173 as Connection1813
                                connect Vdc Limit3.in as Connection1910
                                connect f Goto19 as Connection1822
                                connect m_d Gain10.out as Connection1914
                                [
                                    position = 0, 0
                                ]
                            }
                            [
                                position = 7408, 8200
                                scale = -1, 1
                                size = 128, 192
                            ]

                            component Subsystem internal_frequency {
                                layout = dynamic
                                component gen_probe inn_wt {
                                }
                                [
                                    position = 8408, 8136
                                ]

                                component gen_gain Gain1 {
                                    gain = "fn"
                                }
                                [
                                    position = 8192, 8216
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                    signs = "++"
                                }
                                [
                                    position = 8112, 8216
                                    hide_name = True
                                ]

                                component gen_probe inner_f {
                                }
                                [
                                    position = 8280, 8144
                                ]

                                component Subsystem "Angle generator" {
                                    layout = dynamic
                                    component gen_c_function int_n_wrap {
                                        global_variables = "real out;"
                                        in_terminal_dimensions = "inherit"
                                        in_terminal_dimensions_str = "in inherit"
                                        in_terminal_labels = "False;"
                                        init_fnc = "/*Begin code section*/
out = 0;
in = 0;
/*End code section*/"
                                        no_feed_inputs = "[u\'\']"
                                        no_feed_outputs = "[u\'\']"
                                        out_terminal_dimensions = "inherit"
                                        out_terminal_dimensions_str = "output inherit"
                                        out_terminal_labels = "False;"
                                        out_terminal_properties = "inherit output;"
                                        output_fnc = "/*Begin code section*/
output = out+0.0;
/*End code section*/"
                                        update_fnc = "/*Begin code section*/
out += execution_rate*in;
if(in>=0.0){
    if(out >= 6.283185307179586)
    {
        out -= 6.283185307179586;
    }
}
else{
        if(out <= -6.283185307179586)
    {
        out += 6.283185307179586;
    }
}
/*End code section*/"
                                    }
                                    [
                                        position = 8088, 8080
                                        size = 0, 0
                                    ]

                                    component gen_gain Gain1 {
                                        gain = "2*np.pi"
                                    }
                                    [
                                        position = 8008, 8080
                                        hide_name = True
                                    ]

                                    port wt {
                                        position = right:1
                                        kind = sp
                                        direction =  in
                                        sp_type {
                                            default = inherit
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 8168, 8080
                                    ]

                                    port f {
                                        position = left:1
                                        kind = sp
                                        direction =  out
                                        sp_type {
                                            default = auto
                                            readonly = True
                                        }
                                    }
                                    [
                                        position = 7944, 8080
                                    ]

                                    connect Gain1.in f as Connection4
                                    connect int_n_wrap.in Gain1.out as Connection3
                                    connect wt int_n_wrap.output as Connection2
                                }
                                [
                                    position = 8288, 8216
                                    size = 48, 48
                                ]

                                port f_ref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8160
                                ]

                                port inner_wt {
                                    label = "wt"
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8360, 8216
                                ]

                                port df_sync {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8224
                                ]

                                junction Junction2 sp
                                [
                                    position = 8328, 8216
                                ]

                                junction Junction3 sp
                                [
                                    position = 8160, 8216
                                ]

                                connect "Angle generator.f" Gain1.out as Connection1138
                                connect "Angle generator.wt" Junction2 as Connection1135
                                connect Gain1.in Junction3 as Connection1148
                                connect Junction2 inner_wt as Connection1136
                                connect Junction3 inner_f.in as Connection1149
                                connect Sum1.out Junction3 as Connection1150
                                connect Sum1.in1 df_sync as Connection1121
                                connect f_ref Sum1.in as Connection1147
                                connect inn_wt.in Junction2 as Connection1137
                            }
                            [
                                position = 6912, 8392
                                size = 88, 104
                            ]

                            component "core/Edge Detection" "Edge Detection2" {
                            }
                            [
                                position = 7240, 7944
                                hide_name = True
                                size = 32, 32
                            ]

                            port Vdc {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7456, 8056
                                rotation = right
                                scale = -1, 1
                            ]

                            port f {
                                position = right:15
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7256, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            port md {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7528, 8120
                                rotation = down
                                scale = -1, 1
                            ]

                            port mq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7528, 8280
                                rotation = down
                                scale = -1, 1
                            ]

                            port wt {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7024, 8392
                                scale = 1, -1
                            ]

                            port On {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6752, 7976
                                rotation = down
                                scale = -1, 1
                            ]

                            port dV_match {
                                position = right:10
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6880, 8104
                                scale = 1, -1
                            ]

                            port df_sync {
                                position = right:16
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6792, 8424
                                scale = 1, -1
                            ]

                            port Vmode {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7144, 7904
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:11
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6992, 8160
                                scale = 1, -1
                            ]

                            port Id {
                                position = right:14
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7256, 8200
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From167 {
                                value = "Vref"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6648, 8032
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From96 {
                                value = "vmode"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7128, 8016
                                rotation = right
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From169 {
                                value = "On"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7160, 7944
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From168 {
                                value = "f_ref"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6664, 8360
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto19 {
                                value = "On"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6872, 7976
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto17 {
                                value = "vmode"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7448, 7912
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction274 sp
                            [
                                position = 6808, 7976
                            ]

                            junction Junction279 sp
                            [
                                position = 7208, 8128
                            ]

                            junction Junction281 sp
                            [
                                position = 7040, 8096
                            ]

                            junction Junction282 sp
                            [
                                position = 7360, 7912
                            ]

                            connect "Current_ref.id ref" Junction279 as Connection2462
                            connect "Current_ref.vt ref" Junction281 as Connection2504
                            connect "Edge Detection1.Out1" "Logical operator1.in" as Connection2510
                            connect "Edge Detection2.Out1" "Logical operator1.in1" as Connection2512
                            connect From167 Gain1.in as Connection2409
                            connect From168 Gain2.in as Connection2411
                            connect From169 "Edge Detection2.In1" as Connection2511
                            connect From96 Current_ref.enable as Connection2371
                            connect Gain1.out "Signal switch1.in" as Connection2417
                            connect Gain2.out "Rate Limiter2.in" as Connection2412
                            connect Goto19 Junction274 as Connection2427
                            connect Id "Inner dq current controller.Id" as Connection2494
                            connect "Inner dq current controller.Id_ref" Junction279 as Connection2492
                            connect "Inner dq current controller.reset" Junction282 as Connection2515
                            connect "Inner dq current controller.Vdc" Vdc as Connection2491
                            connect Junction274 "Signal switch1.in2" as Connection2426
                            connect Junction279 Id_ref.in as Connection2461
                            connect Junction281 Vt_ref.in as Connection2505
                            connect Junction282 Goto17 as Connection2514
                            connect "Logical operator1.out" Junction282 as Connection2513
                            connect On Junction274 as Connection2425
                            connect "Rate Limiter2.out" internal_frequency.f_ref as Connection2405
                            connect "Signal switch1.in1" Constant1.out as Connection2467
                            connect "Signal switch1.out" "Rate Limiter1.in" as Connection2418
                            connect Sum3.out Junction281 as Connection2506
                            connect Sum3.in "Rate Limiter1.out" as Connection2503
                            connect Sum3.in1 dV_match as Connection2307
                            connect Vd Current_ref.vd as Connection2489
                            connect Vmode "Edge Detection1.In1" as Connection2509
                            connect df_sync internal_frequency.df_sync as Connection2507
                            connect f "Inner dq current controller.f" as Connection2490
                            connect md "Inner dq current controller.m_d" as Connection2480
                            connect mq "Inner dq current controller.m_q" as Connection2481
                            connect wt internal_frequency.inner_wt as Connection2396
                        }
                        [
                            position = 8208, 8720
                            scale = -1, 1
                            size = 120, 168
                        ]

                        component Subsystem Inv_Cab_SM {
                            layout = dynamic
                            component gen_c_function Inv_Cab_SM {
                                global_variables = "real lock1;real lock2;real from_grid_follow;"
                                in_terminal_dimensions = "inherit;inherit;inherit;inherit;inherit;inherit"
                                in_terminal_dimensions_str = "On inherit;mode inherit;grid_locked inherit;v_match inherit;live_grid inherit;on_nominal inherit"
                                in_terminal_labels = "False;False;False;False;False;False;"
                                in_terminal_properties = "inherit On;inherit mode;inherit grid_locked;inherit v_match;inherit live_grid;inherit on_nominal;"
                                init_fnc = "/*Begin code section*/
lock1 = 0;
lock2 = 0;
/*End code section*/"
                                no_feed_inputs = "[\'\']"
                                no_feed_outputs = "[\'\']"
                                out_terminal_dimensions = "inherit;inherit;inherit;inherit"
                                out_terminal_dimensions_str = "control_mode inherit;Vmode inherit;synch inherit;contactor inherit"
                                out_terminal_labels = "False;False;False;False;"
                                out_terminal_properties = "real control_mode;inherit Vmode;inherit synch;inherit contactor;"
                                output_fnc = "/*Begin code section*/
if(On == 0){ //all off
    contactor = 0;
    synch = 0;
    Vmode = 1;
    lock1 = 0;
    lock2 = 0;
    control_mode = 0;
    from_grid_follow = 0;
}
else{
    if((mode == 0) && (lock1 == 0)){ //voltage mode
        lock2 = 0;
        if((on_nominal) || (from_grid_follow)){
            Vmode = 1;
            contactor = 1;
            synch = 0;
            lock1 = 1;
            control_mode = 1;
            from_grid_follow = 0;
        }
        else{
            Vmode = 1;
            contactor = 0;
            synch = 0;
            control_mode = 0;
        }
    }
    else{
        if((mode == 1) && (lock2 ==0)){ //current mode
            lock1 = 0;
            if((on_nominal) &&  (live_grid == 1)){
                synch = 1;
                if((grid_locked == 1) && (v_match == 1)){
                    Vmode = 0;
                    contactor = 1;
                    synch = 0;
                    lock2 = 1;
                    control_mode = 2;
                    from_grid_follow = 1;
                }
                else{
                    Vmode = 1;
                    contactor = 0;
                    control_mode = 0;
                }
            }
            else{
                Vmode = 1;
                contactor = 0;
                synch = 0;
                control_mode = 0;
            }
        }
    }
}
/*End code section*/"
                            }
                            [
                                position = 8176, 8240
                                size = 144, 112
                            ]

                            component gen_digital_probe V_mode {
                            }
                            [
                                position = 8408, 8168
                                rotation = right
                                scale = -1, -1
                            ]

                            component gen_digital_probe CB_status {
                            }
                            [
                                position = 8408, 8312
                                rotation = right
                            ]

                            component gen_digital_probe synch {
                            }
                            [
                                position = 8528, 8200
                                rotation = left
                            ]

                            component Subsystem read_mode {
                                layout = dynamic
                                component gen_digital_probe StandBy {
                                }
                                [
                                    position = 8240, 8024
                                    rotation = left
                                ]

                                component gen_digital_probe on {
                                }
                                [
                                    position = 7992, 8040
                                ]

                                component gen_digital_probe "Grid following" {
                                }
                                [
                                    position = 8240, 8168
                                    rotation = right
                                ]

                                component gen_digital_probe "Grid forming" {
                                }
                                [
                                    position = 8328, 8088
                                ]

                                component gen_c_function verify_mode {
                                    in_terminal_dimensions = "inherit"
                                    in_terminal_dimensions_str = "control_mode inherit"
                                    in_terminal_labels = "False;"
                                    in_terminal_properties = "real control_mode;"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit;inherit"
                                    out_terminal_dimensions_str = "stand_by inherit;grid_forming inherit;grid_following inherit"
                                    out_terminal_labels = "False;False;False;"
                                    out_terminal_properties = "real stand_by;inherit grid_forming;inherit grid_following;"
                                    output_fnc = "/*Begin code section*/
if(control_mode == 0){
    stand_by = 1;
    grid_forming = 0;
    grid_following = 0;
}
else{
    if(control_mode == 1){
        stand_by = 0;
        grid_forming = 1;
        grid_following = 0;
    }
    else{
        stand_by = 0;
        grid_forming = 0;
        grid_following = 1;
    }
}
/*End code section*/"
                                }
                                [
                                    position = 8160, 8088
                                    size = 48, 64
                                ]

                                port Mode {
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8104, 8000
                                    rotation = right
                                ]

                                port On {
                                    position = top:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7952, 8000
                                    rotation = right
                                ]

                                connect "Grid following.in" verify_mode.grid_following as Connection1957
                                connect "Grid forming.in" verify_mode.grid_forming as Connection1956
                                connect Mode verify_mode.control_mode as Connection1954
                                connect StandBy.in verify_mode.stand_by as Connection1955
                                connect on.in On as Connection1953
                            }
                            [
                                position = 8256, 8112
                                rotation = down
                                size = 48, 48
                            ]

                            port On {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8064
                                rotation = right
                            ]

                            port mode {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7896, 8064
                                rotation = right
                            ]

                            port grid_locked {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7888, 8272
                                rotation = right
                                scale = -1, -1
                            ]

                            port Synch {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8608, 8256
                            ]

                            port CB {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8464, 8344
                                rotation = right
                            ]

                            port Vmode {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8464, 8160
                                rotation = left
                            ]

                            port V_match {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7920, 8304
                                rotation = right
                                scale = -1, -1
                            ]

                            port live_grid {
                                position = left:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8336
                                rotation = right
                                scale = -1, -1
                            ]

                            port on_nominal {
                                position = left:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8368
                                rotation = right
                                scale = -1, -1
                            ]

                            junction Junction7 sp
                            [
                                position = 8408, 8224
                            ]

                            junction Junction8 sp
                            [
                                position = 8528, 8256
                            ]

                            junction Junction9 sp
                            [
                                position = 8408, 8272
                            ]

                            junction Junction10 sp
                            [
                                position = 8072, 8200
                            ]

                            comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Modes:</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">0 = voltage mode/grid forming</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1 = current mode/grid following           </p></body></html> ENDCOMMENT 
                            [
                                position = 8032, 8360
                            ]

                            connect CB Junction9 as Connection1759
                            connect Inv_Cab_SM.On Junction10 as Connection1773
                            connect Inv_Cab_SM.Vmode Junction7 as Connection1755
                            connect Inv_Cab_SM.synch Junction8 as Connection1758
                            connect Inv_Cab_SM.contactor Junction9 as Connection1761
                            connect Junction10 read_mode.On as Connection1774
                            [
                                position = 0, 0
                            ]
                            connect Junction7 V_mode.in as Connection1754
                            connect Junction8 synch.in as Connection1757
                            connect Junction9 CB_status.in as Connection1760
                            connect On Junction10 as Connection1775
                            connect Synch Junction8 as Connection1756
                            connect V_match Inv_Cab_SM.v_match as Connection1715
                            connect Vmode Junction7 as Connection1753
                            connect grid_locked Inv_Cab_SM.grid_locked as Connection1714
                            connect live_grid Inv_Cab_SM.live_grid as Connection1725
                            connect mode Inv_Cab_SM.mode as Connection1776
                            connect on_nominal Inv_Cab_SM.on_nominal as Connection1746
                            connect read_mode.Mode Inv_Cab_SM.control_mode as Connection1767
                        }
                        [
                            position = 7720, 8344
                            size = 104, 224
                        ]

                        component Subsystem Change_CtrlMode {
                            layout = dynamic
                            component sys_signal_switch "Signal switch2" {
                                criterion = "ctrl > threshold"
                                threshold = "0.5"
                            }
                            [
                                position = 8192, 8232
                                hide_name = True
                            ]

                            component sys_signal_switch "Signal switch3" {
                                criterion = "ctrl > threshold"
                                threshold = "0.5"
                            }
                            [
                                position = 8192, 8368
                                hide_name = True
                            ]

                            component sys_signal_switch "Signal switch1" {
                                criterion = "ctrl > threshold"
                                threshold = "0.5"
                            }
                            [
                                position = 8192, 8096
                                hide_name = True
                            ]

                            port wt {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8256, 8368
                            ]

                            port wt_Imode {
                                position = left:12
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8000, 8384
                            ]

                            port wt_Vmode {
                                position = left:15
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8056, 8336
                            ]

                            port md {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8256, 8096
                            ]

                            port mq {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8256, 8232
                            ]

                            port md_Imode {
                                position = left:10
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8000, 8112
                            ]

                            port md_Vmode {
                                position = left:13
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8056, 8056
                            ]

                            port mq_Imode {
                                position = left:11
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8000, 8248
                            ]

                            port mq_Vmode {
                                position = left:14
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8056, 8208
                            ]

                            port Vmode {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8192, 7968
                                rotation = right
                            ]

                            tag From20 {
                                value = "Vmode"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8128, 8168
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto17 {
                                value = "Vmode"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8272, 8032
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From21 {
                                value = "Vmode"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8128, 8304
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction1 sp
                            [
                                position = 8192, 8032
                            ]

                            connect From20 "Signal switch2.in2" as Connection16
                            connect From21 "Signal switch3.in2" as Connection17
                            connect Junction1 Goto17 as Connection28
                            connect "Signal switch1.in2" Junction1 as Connection27
                            connect "Signal switch1.out" md as Connection2
                            connect "Signal switch2.out" mq as Connection7
                            connect "Signal switch3.out" wt as Connection4
                            connect Vmode Junction1 as Connection29
                            connect md_Imode "Signal switch1.in1" as Connection19
                            connect md_Vmode "Signal switch1.in" as Connection18
                            connect mq_Imode "Signal switch2.in1" as Connection21
                            connect mq_Vmode "Signal switch2.in" as Connection20
                            connect wt_Imode "Signal switch3.in1" as Connection23
                            connect wt_Vmode "Signal switch3.in" as Connection22
                        }
                        [
                            position = 8632, 8552
                            size = 104, 208
                        ]

                        component Subsystem duty_cycle {
                            layout = dynamic
                            component gen_probe Dz_A {
                                addr = "8968"
                            }
                            [
                                position = 7856, 8104
                                rotation = left
                            ]

                            component gen_probe Dz_B {
                                addr = "8968"
                            }
                            [
                                position = 7856, 8184
                                rotation = left
                            ]

                            component gen_limiter Limit2 {
                                lower_limit = "mod_lowLim"
                                upper_limit = "mod_upLim"
                            }
                            [
                                position = 7512, 7944
                                hide_name = True
                            ]

                            component src_constant o_ref {
                                execution_rate = "Ts"
                                value = "0"
                            }
                            [
                                position = 7560, 8016
                                hide_name = True
                            ]

                            component gen_probe m_q {
                                addr = "8967"
                            }
                            [
                                position = 7600, 7896
                                rotation = left
                                scale = -1, 1
                            ]

                            component gen_probe Db {
                                addr = "8968"
                            }
                            [
                                position = 7680, 8184
                                rotation = left
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "-1.1546"
                                upper_limit = "1.1546"
                            }
                            [
                                position = 7512, 7992
                                hide_name = True
                            ]

                            component gen_probe Da {
                                addr = "8968"
                            }
                            [
                                position = 7680, 8104
                                rotation = left
                            ]

                            component gen_probe m_d {
                                addr = "8969"
                            }
                            [
                                position = 7560, 7896
                                rotation = right
                                scale = 1, -1
                            ]

                            component gen_probe Dc {
                                addr = "8968"
                            }
                            [
                                position = 7680, 8256
                                rotation = left
                            ]

                            component gen_probe Dz_C {
                                addr = "8968"
                            }
                            [
                                position = 7856, 8256
                                rotation = left
                            ]

                            component Subsystem ZSM {
                                layout = dynamic
                                component gen_probe Z0 {
                                }
                                [
                                    position = 8048, 8088
                                    rotation = left
                                ]

                                component src_constant Constant3 {
                                    execution_rate = "inherit"
                                }
                                [
                                    position = 7672, 8128
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                    signs = "-+"
                                }
                                [
                                    position = 7752, 8264
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "-+"
                                }
                                [
                                    position = 7752, 8120
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "++"
                                }
                                [
                                    position = 8328, 8176
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                    signs = "++"
                                }
                                [
                                    position = 8328, 8264
                                    hide_name = True
                                ]

                                component src_constant Constant2 {
                                    execution_rate = "inherit"
                                }
                                [
                                    position = 7656, 8288
                                    hide_name = True
                                ]

                                component src_constant Constant1 {
                                    execution_rate = "inherit"
                                    value = "k"
                                }
                                [
                                    position = 7336, 8080
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                    signs = "++"
                                }
                                [
                                    position = 8328, 8096
                                    hide_name = True
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 7848, 8152
                                    hide_name = True
                                ]

                                component gen_minmax "Min Max2" {
                                    inputs = "3"
                                    operation = "max"
                                }
                                [
                                    position = 7584, 8256
                                    hide_name = True
                                ]

                                component gen_sum Sum3 {
                                    signs = "--+"
                                }
                                [
                                    position = 7984, 8152
                                    hide_name = True
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 7848, 8256
                                    hide_name = True
                                ]

                                component gen_minmax "Min Max1" {
                                    inputs = "3"
                                }
                                [
                                    position = 7584, 8160
                                    hide_name = True
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "0"
                                    upper_limit = "1"
                                }
                                [
                                    position = 7408, 8080
                                    hide_name = True
                                ]

                                component src_constant Constant4 {
                                    execution_rate = "inherit"
                                }
                                [
                                    position = 7816, 8072
                                    hide_name = True
                                ]

                                component gen_sum Sum8 {
                                    signs = "-+"
                                }
                                [
                                    position = 7896, 8064
                                    hide_name = True
                                ]

                                port Da {
                                    position = right:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7264, 8144
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Db {
                                    position = right:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7264, 8208
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Dc {
                                    position = right:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7264, 8272
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Dz_A {
                                    position = left:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8416, 8096
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Dz_B {
                                    position = left:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8416, 8176
                                    rotation = down
                                    scale = -1, 1
                                ]

                                port Dz_C {
                                    position = left:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8416, 8264
                                    rotation = down
                                    scale = -1, 1
                                ]

                                tag From5 {
                                    value = "Db"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 8240, 8168
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag From8 {
                                    value = "Z0"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 8240, 8288
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag From7 {
                                    value = "Dc"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 8240, 8256
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag From2 {
                                    value = "k"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7736, 8208
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag Goto2 {
                                    value = "Da"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 7400, 8168
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag From6 {
                                    value = "Z0"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 8240, 8200
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag Goto4 {
                                    value = "Dc"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 7400, 8304
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag From3 {
                                    value = "Z0"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 8240, 8120
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag From4 {
                                    value = "Da"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 8240, 8088
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag Goto1 {
                                    value = "k"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 7488, 8080
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag Goto3 {
                                    value = "Db"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 7400, 8240
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag From1 {
                                    value = "k"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7648, 8080
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag Goto5 {
                                    value = "Z0"
                                    scope = local
                                    kind = sp
                                    direction = in
                                }
                                [
                                    position = 8120, 8152
                                    hide_name = True
                                    size = 0, 0
                                ]

                                tag From9 {
                                    value = "k"
                                    scope = local
                                    kind = sp
                                    direction = out
                                }
                                [
                                    position = 7792, 8024
                                    hide_name = True
                                    size = 0, 0
                                ]

                                junction Junction254 sp
                                [
                                    position = 7480, 8144
                                ]

                                junction Junction255 sp
                                [
                                    position = 7496, 8208
                                ]

                                junction Junction256 sp
                                [
                                    position = 7512, 8272
                                ]

                                junction Junction257 sp
                                [
                                    position = 7344, 8144
                                ]

                                junction Junction258 sp
                                [
                                    position = 7344, 8208
                                ]

                                junction Junction259 sp
                                [
                                    position = 7344, 8272
                                ]

                                junction Junction260 sp
                                [
                                    position = 8048, 8152
                                ]

                                connect Constant1.out Limit1.in as Connection1425
                                connect Constant2.out Sum1.in1 as Connection1427
                                connect Constant3.out Sum2.in1 as Connection1434
                                connect Da Junction257 as Connection1474
                                connect Db Junction258 as Connection1477
                                connect Dc Junction259 as Connection1480
                                connect From1 Sum2.in as Connection1440
                                connect From2 Product1.in as Connection1441
                                connect From3 Sum5.in1 as Connection1446
                                connect From4 Sum5.in as Connection1487
                                connect From5 Sum6.in as Connection1489
                                connect From6 Sum6.in1 as Connection1488
                                connect From7 Sum7.in as Connection1493
                                connect From8 Sum7.in1 as Connection1492
                                connect Goto1 Limit1.out as Connection1439
                                connect Goto2 Junction257 as Connection1476
                                connect Goto3 Junction258 as Connection1479
                                connect Goto4 Junction259 as Connection1482
                                connect Goto5 Junction260 as Connection1486
                                connect Junction254 "Min Max2.in" as Connection1466
                                connect Junction255 "Min Max1.in1" as Connection1469
                                connect Junction256 "Min Max1.in2" as Connection1472
                                connect Junction257 Junction254 as Connection1475
                                connect Junction258 Junction255 as Connection1478
                                connect Junction259 Junction256 as Connection1481
                                connect Junction260 Sum3.out as Connection1485
                                connect "Min Max1.in" Junction254 as Connection1465
                                connect "Min Max2.in1" Junction255 as Connection1468
                                connect "Min Max2.in2" Junction256 as Connection1471
                                connect Product1.in1 Sum1.out as Connection1428
                                connect Product1.out Sum3.in2 as Connection1451
                                connect Product2.in1 "Min Max1.out" as Connection1430
                                connect Product2.out Sum3.in1 as Connection1450
                                connect Sum1.in "Min Max2.out" as Connection1426
                                connect Sum2.out Product2.in as Connection1435
                                connect Sum5.out Dz_A as Connection1447
                                connect Sum6.out Dz_B as Connection1490
                                connect Sum7.out Dz_C as Connection1491
                                connect Z0.in Junction260 as Connection1484
                                connect From9 Sum8.in as Connection1496
                                connect Constant4.out Sum8.in1 as Connection1495
                                connect Sum8.out Sum3.in as Connection1497

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                    k {
                                        label = "Modulation type coefficent k"
                                        widget = edit
                                        type = generic
                                        default_value = "0.5"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                    
                                    ENDCODE
                                }
                            }
                            [
                                position = 7776, 8216
                                scale = -1, 1
                                size = 88, 184
                            ]

                            component "core/dq to abc" "dq to abc1" {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7608, 8096
                                rotation = right
                                size = 48, 80
                            ]

                            port wt {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7448, 8040
                            ]

                            port mq {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7448, 7992
                            ]

                            port md {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7448, 7944
                            ]

                            port m_a {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7936, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port m_b {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7936, 8216
                                rotation = down
                                scale = -1, 1
                            ]

                            port m_c {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7936, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction6 sp
                            [
                                position = 7856, 8288
                            ]

                            junction Junction7 sp
                            [
                                position = 7856, 8216
                            ]

                            junction Junction8 sp
                            [
                                position = 7856, 8144
                            ]

                            junction Junction9 sp
                            [
                                position = 7560, 7944
                            ]

                            junction Junction10 sp
                            [
                                position = 7600, 7992
                            ]

                            junction Junction11 sp
                            [
                                position = 7680, 8144
                            ]

                            junction Junction12 sp
                            [
                                position = 7680, 8216
                            ]

                            junction Junction13 sp
                            [
                                position = 7680, 8288
                            ]

                            connect Dz_A.in Junction8 as Connection2320
                            connect Dz_B.in Junction7 as Connection2317
                            connect Dz_C.in Junction6 as Connection2314
                            connect Junction6 ZSM.Dz_C as Connection2313
                            connect Junction7 m_b as Connection2316
                            connect Junction8 ZSM.Dz_A as Connection2319
                            connect ZSM.Dz_B Junction7 as Connection2315
                            connect m_a Junction8 as Connection2318
                            connect m_c Junction6 as Connection2312
                            connect md Limit2.in as Connection31
                            connect mq Limit3.in as Connection33
                            connect m_d.in Junction9 as Connection2326
                            connect Junction9 Limit2.out as Connection2327
                            connect "dq to abc1.d_input" Junction9 as Connection2328
                            connect Limit3.out Junction10 as Connection2329
                            connect Junction10 m_q.in as Connection2330
                            connect "dq to abc1.q_input" Junction10 as Connection2331
                            connect o_ref.out "dq to abc1.zero_input" as Connection2332
                            connect "dq to abc1.wt" wt as Connection2333
                            connect Da.in Junction11 as Connection2334
                            connect Junction11 ZSM.Da as Connection2335
                            connect "dq to abc1.phase_a" Junction11 as Connection2336
                            connect ZSM.Db Junction12 as Connection2337
                            connect Junction12 Db.in as Connection2338
                            connect "dq to abc1.phase_b" Junction12 as Connection2339
                            connect Dc.in Junction13 as Connection2340
                            connect Junction13 ZSM.Dc as Connection2341
                            connect "dq to abc1.phase_c" Junction13 as Connection2342
                        }
                        [
                            position = 8776, 8552
                            scale = -1, 1
                            size = 80, 200
                        ]

                        component Subsystem PLL_pu {
                            layout = dynamic
                            component gen_gain Gain6 {
                                gain = "1.0/fn"
                            }
                            [
                                position = 8400, 8120
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                            }
                            [
                                position = 8240, 8064
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain7 {
                                gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                            }
                            [
                                position = 8400, 8248
                                hide_name = True
                            ]

                            component gen_gain Gain4 {
                                gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                            }
                            [
                                position = 8208, 8016
                                rotation = left
                                hide_name = True
                            ]

                            component "core/Three phase PLL" PLL {
                                enable_pk = "True"
                                enable_sin = "False"
                                enable_zero = "False"
                                initial_pid_output = "2*np.pi*fn"
                                low_lim = "0"
                                rate_high = "5*fn"
                                rate_low = "-5*fn"
                                up_lim = "1.4*2*np.pi*fn"
                            }
                            [
                                position = 8144, 8144
                                size = 64, 128
                            ]

                            port d {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8304, 7976
                            ]

                            port q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8304, 8024
                            ]

                            port f {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8464, 8120
                            ]

                            port wt {
                                position = right:5
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8304, 8160
                            ]

                            port A {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8048
                            ]

                            port B {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8144
                            ]

                            port C {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8240
                            ]

                            port Vt {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8464, 8248
                            ]

                            tag Goto1 {
                                value = "Vt"
                                scope = masked_subsystem
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "f"
                                scope = masked_subsystem
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction1 sp
                            [
                                position = 8264, 8248
                            ]

                            junction Junction2 sp
                            [
                                position = 8280, 8120
                            ]

                            connect Gain4.out d as Connection2283
                            connect Vt Gain7.out as Connection2309
                            connect f Gain6.out as Connection2286
                            connect q Gain5.out as Connection2284
                            connect PLL.vb B as Connection2313
                            connect PLL.va A as Connection2314
                            connect PLL.vc C as Connection2315
                            connect Gain4.in PLL.d_axis as Connection2316
                            connect Gain5.in PLL.q_axis as Connection2317
                            connect Goto1 Junction1 as Connection2326
                            connect Junction1 PLL.peak as Connection2327
                            connect Gain7.in Junction1 as Connection2328
                            connect Goto2 Junction2 as Connection2329
                            connect Junction2 Gain6.in as Connection2330
                            connect PLL.freq Junction2 as Connection2331
                            connect wt PLL.theta as Connection2332
                        }
                        [
                            position = 7624, 8632
                            size = 72, 168
                        ]

                        port Ib {
                            position = left:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8880
                        ]

                        port Ia {
                            position = left:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8832
                        ]

                        port Ic {
                            position = left:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8928
                        ]

                        port Vc {
                            position = left:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8696
                        ]

                        port Vb {
                            position = left:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8632
                        ]

                        port Va {
                            position = left:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8568
                        ]

                        port VDC {
                            position = left:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8256, 8120
                            rotation = right
                        ]

                        port On {
                            position = top:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7488, 8264
                        ]

                        port Vb_util {
                            position = left:18
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 8984
                        ]

                        port Va_util {
                            position = left:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 8936
                        ]

                        port Vc_util {
                            position = left:19
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8056, 9032
                        ]

                        port mode {
                            position = top:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 8296
                        ]

                        port Contactor {
                            position = right:15
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7832, 8432
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_a {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8472
                        ]

                        port m_b {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8552
                        ]

                        port m_c {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8632
                        ]

                        port Ia_out {
                            position = left:20
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 9088
                        ]

                        port Ib_out {
                            position = left:21
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 9136
                        ]

                        port Ic_out {
                            position = left:22
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7528, 9184
                        ]

                        tag From188 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8560, 8776
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto101 {
                            value = "V_match"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8360, 9032
                            hide_name = True
                            size = 74, 20
                        ]

                        tag From202 {
                            value = "V_match"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7592, 8360
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto91 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8792, 8944
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From203 {
                            value = "wt_Imode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8472, 8536
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto92 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8792, 8880
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From204 {
                            value = "mq_Imode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8472, 8504
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From189 {
                            value = "Id_out"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8560, 8904
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From205 {
                            value = "md_Imode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8472, 8472
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto42 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8792, 8752
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From206 {
                            value = "md_Vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8472, 8568
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From196 {
                            value = "f"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8056, 9128
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From207 {
                            value = "mq_Vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8472, 8600
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From197 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8056, 9176
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From208 {
                            value = "wt_Vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8472, 8632
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto61 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8600
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto90 {
                            value = "df_sync"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 8984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From61 {
                            value = "VDC"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8248, 8568
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto93 {
                            value = "dV_match"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 8936
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto102 {
                            value = "md_Imode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 8304
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto103 {
                            value = "wt_Imode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From66 {
                            value = "synch"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8136, 8880
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From195 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8056, 9080
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto104 {
                            value = "mq_Imode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 8384
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto105 {
                            value = "wt_Vmode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 8784
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto67 {
                            value = "grid_locked"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8360, 9080
                            hide_name = True
                            size = 74, 20
                        ]

                        tag Goto35 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7768, 8984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto106 {
                            value = "md_Vmode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 8656
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From192 {
                            value = "dV_match"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8080, 8656
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto60 {
                            value = "f"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8664
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From154 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8080, 8688
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto107 {
                            value = "mq_Vmode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 8720
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto108 {
                            value = "on_nominal"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 9176
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From148 {
                            value = "f"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8080, 8752
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto34 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7768, 8824
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From209 {
                            value = "on_nominal"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7592, 8424
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From108 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8080, 8720
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto98 {
                            value = "Vmode"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7840, 8256
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto109 {
                            value = "Id_out"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7792, 9080
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From60 {
                            value = "df_sync"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8080, 8784
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From43 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8464
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From156 {
                            value = "On"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8216, 8208
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From38 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7520, 8976
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto99 {
                            value = "live_grid"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8352, 9128
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "f"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8432
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From157 {
                            value = "Vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8176, 8208
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From198 {
                            value = "Vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8168, 8568
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto58 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8568
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From68 {
                            value = "Vmode"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8632, 8376
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From112 {
                            value = "Id_out"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8368
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From199 {
                            value = "On"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8208, 8568
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From210 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7520, 9232
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto43 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8792, 8816
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto59 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8696
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From113 {
                            value = "Iq_out"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8400
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto100 {
                            value = "synch"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7840, 8344
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From146 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From190 {
                            value = "Iq_out"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8560, 8968
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto110 {
                            value = "Iq_out"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7792, 9240
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto89 {
                            value = "VDC"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8320, 8240
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From200 {
                            value = "grid_locked"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7592, 8328
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From155 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8064, 8336
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From187 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8560, 8840
                            hide_name = True
                            size = 57, 20
                        ]

                        tag Goto96 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7816, 8632
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto97 {
                            value = "On"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7608, 8240
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From201 {
                            value = "live_grid"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7592, 8392
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction233 sp
                        [
                            position = 7752, 8600
                        ]

                        junction Junction234 sp
                        [
                            position = 7688, 8568
                        ]

                        junction Junction263 sp
                        [
                            position = 7712, 8984
                        ]

                        junction Junction264 sp
                        [
                            position = 7712, 8824
                        ]

                        junction Junction329 sp
                        [
                            position = 7752, 8664
                        ]

                        junction Junction330 sp
                        [
                            position = 8744, 8776
                        ]

                        junction Junction331 sp
                        [
                            position = 8744, 8840
                        ]

                        junction Junction333 sp
                        [
                            position = 8744, 8904
                        ]

                        junction Junction334 sp
                        [
                            position = 8744, 8968
                        ]

                        junction Junction337 sp
                        [
                            position = 7688, 8632
                        ]

                        junction Junction341 sp
                        [
                            position = 7560, 8264
                        ]

                        junction Junction342 sp
                        [
                            position = 8256, 8240
                        ]

                        junction Junction343 sp
                        [
                            position = 7720, 9080
                        ]

                        junction Junction344 sp
                        [
                            position = 7720, 9240
                        ]

                        connect ABCtoDQ.A Ia as Connection2493
                        connect ABCtoDQ.B Ib as Connection2494
                        connect ABCtoDQ.C Ic as Connection2495
                        connect ABCtoDQ1.q Junction344 as Connection2857
                        connect Change_CtrlMode.mq_Imode From204 as Connection2730
                        connect Change_CtrlMode.mq_Vmode From207 as Connection2733
                        connect Contactor Inv_Cab_SM.CB as Connection2606
                        connect From112 Imode_control.Id as Connection2562
                        connect From146 Imode_control.Vd as Connection2560
                        connect From156 Imode_control.On as Connection2566
                        connect From157 Imode_control.Vmode as Connection2567
                        connect From187 Power_Meas.Vq as Connection2462
                        connect From188 Power_Meas.Vd as Connection2461
                        connect From189 Power_Meas.Id as Connection2463
                        connect From190 Power_Meas.Iq as Connection2464
                        connect From192 Vmode_control.dV_match as Connection2592
                        connect From195 Synch.Vt_inv as Connection2589
                        connect From198 Vmode_control.Vmode as Connection2603
                        connect From199 Vmode_control.On as Connection2604
                        connect From200 Inv_Cab_SM.grid_locked as Connection2607
                        connect From201 Inv_Cab_SM.live_grid as Connection2610
                        connect From202 Inv_Cab_SM.V_match as Connection2611
                        connect From203 Change_CtrlMode.wt_Imode as Connection2731
                        connect From205 Change_CtrlMode.md_Imode as Connection2729
                        connect From206 Change_CtrlMode.md_Vmode as Connection2732
                        connect From208 Change_CtrlMode.wt_Vmode as Connection2734
                        connect From209 Inv_Cab_SM.on_nominal as Connection2747
                        connect From210 ABCtoDQ1.wt as Connection2748
                        connect From38 ABCtoDQ.wt as Connection2360
                        connect From39 Imode_control.f as Connection2564
                        connect From60 Vmode_control.df_sync as Connection2593
                        connect From61 Vmode_control.Vdc as Connection2736
                        connect From66 "Synch.Turn on Sync" as Connection2576
                        connect From68 Change_CtrlMode.Vmode as Connection2719
                        connect Goto100 Inv_Cab_SM.Synch as Connection2605
                        connect Goto101 Synch.V_match as Connection2609
                        connect Goto102 Imode_control.md as Connection2742
                        connect Goto103 Imode_control.wt as Connection2740
                        connect Goto104 Imode_control.mq as Connection2741
                        connect Goto105 Vmode_control.wt as Connection2744
                        connect Goto106 Vmode_control.md as Connection2745
                        connect Goto107 Vmode_control.mq as Connection2743
                        connect Goto108 Synch.nominal_state as Connection2746
                        connect Goto109 Junction343 as Connection2856
                        connect Goto110 Junction344 as Connection2859
                        connect Goto34 Junction264 as Connection2511
                        connect Goto42 Junction330 as Connection2467
                        connect Goto43 Junction331 as Connection2470
                        connect Goto59 PLL_pu.wt as Connection2363
                        connect Goto60 Junction329 as Connection2452
                        connect Goto67 Synch.grid_locked as Connection2585
                        connect Goto89 Junction342 as Connection2737
                        connect Goto90 Synch.df_sync as Connection2587
                        connect Goto91 Junction334 as Connection2483
                        connect Goto92 Junction333 as Connection2480
                        connect Goto93 Synch.dV_match as Connection2591
                        connect Goto96 Junction337 as Connection2521
                        connect Goto97 Junction341 as Connection2602
                        connect Goto98 Inv_Cab_SM.Vmode as Connection2596
                        connect Goto99 Synch.live_grid as Connection2594
                        connect Id.in Junction264 as Connection1616
                        connect Id_out.in Junction343 as Connection2854
                        connect Imode_control.Iq From113 as Connection2563
                        connect Imode_control.Vq From155 as Connection2561
                        connect Imode_control.wt_ess From43 as Connection2565
                        connect Imode_control.Vdc Junction342 as Connection2739
                        connect Iq.in Junction263 as Connection1613
                        connect Junction233 Goto61 as Connection1201
                        connect Junction233 PLL_pu.q as Connection2449
                        connect Junction234 Goto58 as Connection1203
                        connect Junction234 PLL_pu.d as Connection2367
                        connect Junction263 ABCtoDQ.q as Connection2356
                        connect Junction263 Goto35 as Connection1612
                        connect Junction264 ABCtoDQ.d as Connection2357
                        connect Junction329 PLL_pu.f as Connection2453
                        connect Junction330 Power_Meas.P as Connection2466
                        connect Junction331 Power_Meas.Q as Connection2469
                        connect Junction333 S.in as Connection2479
                        connect Junction334 Power_Meas.pf as Connection2482
                        connect Junction337 PLL_pu.Vt as Connection2522
                        connect Junction341 Inv_Cab_SM.On as Connection2601
                        connect Junction342 Gain1.out as Connection2738
                        connect Junction343 ABCtoDQ1.d as Connection2855
                        connect Junction344 Iq_out.in as Connection2858
                        connect On Junction341 as Connection2600
                        connect P.in Junction330 as Connection2465
                        connect Power_Meas.S Junction333 as Connection2478
                        connect Q.in Junction331 as Connection2468
                        connect Synch.f_inv From196 as Connection2590
                        connect Synch.wt_inv From197 as Connection2588
                        connect Synch.Vc_util Vc_util as Connection2584
                        connect VDC Gain1.in as Connection2498
                        connect Va PLL_pu.A as Connection2526
                        connect Va_util Synch.Va_util as Connection2586
                        connect Vb PLL_pu.B as Connection2525
                        connect Vb_util Synch.Vb_util as Connection2577
                        connect Vc PLL_pu.C as Connection2524
                        connect Vd.in Junction234 as Connection1200
                        connect Vmode_control.Id From108 as Connection2548
                        connect Vmode_control.f From148 as Connection2549
                        connect Vmode_control.Vd From154 as Connection2547
                        connect Vq.in Junction233 as Connection1206
                        connect Vt.in Junction337 as Connection2523
                        connect duty_cycle.mq Change_CtrlMode.mq as Connection2727
                        connect duty_cycle.md Change_CtrlMode.md as Connection2728
                        connect duty_cycle.wt Change_CtrlMode.wt as Connection2726
                        connect duty_cycle.m_a m_a as Connection2313
                        connect f.in Junction329 as Connection2454
                        connect m_b duty_cycle.m_b as Connection2714
                        connect m_c duty_cycle.m_c as Connection2715
                        connect mode Inv_Cab_SM.mode as Connection2597
                        connect pf.in Junction334 as Connection2481
                        connect Ia_out ABCtoDQ1.A as Connection2860
                        connect Ib_out ABCtoDQ1.B as Connection2861
                        connect Ic_out ABCtoDQ1.C as Connection2862
                    }
                    [
                        position = 8352, 7336
                        size = 136, 440
                    ]

                    component "core/Voltage RMS" Vrms_ev {
                        feed_forward = "true"
                        frequency = "sys_f"
                    }
                    [
                        position = 8768, 7720
                        rotation = right
                        size = 64, 32
                    ]

                    port A {
                        position = 144.0, -96.0
                        kind = pe
                        direction =  out
                    }
                    [
                        position = 9560, 7672
                        rotation = down
                    ]

                    port B {
                        position = 144.0, -0.1
                        kind = pe
                        direction =  out
                    }
                    [
                        position = 9560, 7768
                        rotation = down
                    ]

                    port C {
                        position = 144.0, 96.0
                        kind = pe
                        direction =  out
                    }
                    [
                        position = 9560, 7864
                        rotation = down
                    ]

                    port DCpos {
                        position = -144.0, -96.0
                        kind = pe
                    }
                    [
                        position = 7360, 7672
                    ]

                    port DCneg {
                        position = -144.0, 96.0
                        kind = pe
                    }
                    [
                        position = 7360, 7864
                    ]

                    port Inputs {
                        position = -112.0, -120.0
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7768, 7120
                        rotation = right
                    ]

                    port Outputs {
                        position = 112.0, -120.0
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 9080, 7112
                        rotation = left
                    ]

                    tag From171 {
                        value = "inv_Vb"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7176
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto2 {
                        value = "m_a"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8520, 7144
                        rotation = down
                        hide_name = True
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag Goto94 {
                        value = "m_c"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8520, 7400
                        rotation = down
                        hide_name = True
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From167 {
                        value = "On"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8304, 7056
                        rotation = right
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From213 {
                        value = "m_a"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7864, 7584
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From205 {
                        value = "mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8400, 7056
                        rotation = right
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From206 {
                        value = "On"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7864, 7608
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From215 {
                        value = "m_c"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7864, 7536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From208 {
                        value = "util_Vb"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7400
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From214 {
                        value = "m_b"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7864, 7560
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From209 {
                        value = "util_Va"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7368
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto98 {
                        value = "Ia_out"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9184, 7640
                        rotation = down
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag From210 {
                        value = "util_Vc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7432
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto99 {
                        value = "Ic_out"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9184, 7840
                        rotation = down
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag Goto92 {
                        value = "CB"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8520, 7528
                        rotation = down
                        hide_name = True
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag Goto100 {
                        value = "Ib_out"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9184, 7736
                        rotation = down
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag From211 {
                        value = "CB"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 9192, 7576
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From189 {
                        value = "inv_Vc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8832, 7368
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From185 {
                        value = "On"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8832, 7296
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From190 {
                        value = "Ia"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8832, 7392
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From188 {
                        value = "inv_Va"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8832, 7320
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From187 {
                        value = "inv_Vb"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8832, 7344
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From192 {
                        value = "Ic"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8832, 7440
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From191 {
                        value = "Ib"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8832, 7416
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto85 {
                        value = "inv_Vc"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8984, 7952
                        rotation = right
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag From212 {
                        value = "CB"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8832, 7272
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto88 {
                        value = "Ic"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8496, 7832
                        rotation = down
                        hide_name = True
                        scale = -1, -1
                        size = 0, 0
                    ]

                    tag Goto87 {
                        value = "Ib"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8496, 7736
                        rotation = down
                        hide_name = True
                        scale = -1, -1
                        size = 0, 0
                    ]

                    tag Goto84 {
                        value = "inv_Vb"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8960, 7952
                        rotation = right
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag Goto90 {
                        value = "util_Vb"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9408, 7952
                        rotation = right
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag Goto91 {
                        value = "util_Va"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9384, 7952
                        rotation = right
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag Goto18 {
                        value = "VDC"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7680, 7768
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto83 {
                        value = "inv_Va"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8936, 7952
                        rotation = right
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag Goto89 {
                        value = "util_Vc"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9432, 7952
                        rotation = right
                        hide_name = True
                        scale = -1, 1
                        size = 0, 0
                    ]

                    tag From182 {
                        value = "Ic"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7304
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From169 {
                        value = "inv_Va"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7144
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From184 {
                        value = "VDC"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7336
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From181 {
                        value = "Ia"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7240
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From170 {
                        value = "inv_Vc"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7208
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto86 {
                        value = "Ia"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8496, 7640
                        rotation = down
                        hide_name = True
                        scale = -1, -1
                        size = 0, 0
                    ]

                    tag From183 {
                        value = "Ib"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7272
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto93 {
                        value = "m_b"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8520, 7272
                        rotation = down
                        hide_name = True
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From216 {
                        value = "Ib_out"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7496
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From217 {
                        value = "Ic_out"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7528
                        hide_name = True
                        size = 0, 0
                    ]

                    tag From218 {
                        value = "Ia_out"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8216, 7464
                        hide_name = True
                        size = 0, 0
                    ]

                    junction Junction10 pe
                    [
                        position = 8696, 8104
                    ]

                    junction Junction118 pe
                    [
                        position = 8152, 7768
                    ]

                    junction Junction129 pe
                    [
                        position = 8152, 7672
                    ]

                    junction Junction130 pe
                    [
                        position = 8152, 7864
                    ]

                    junction Junction176 pe
                    [
                        position = 8584, 7768
                    ]

                    junction Junction178 pe
                    [
                        position = 8584, 7672
                    ]

                    junction Junction203 pe
                    [
                        position = 7520, 7864
                    ]

                    junction Junction204 pe
                    [
                        position = 7520, 7672
                    ]

                    junction Junction205 pe
                    [
                        position = 8624, 7672
                    ]

                    junction Junction206 pe
                    [
                        position = 8696, 7768
                    ]

                    junction Junction207 pe
                    [
                        position = 8768, 7864
                    ]

                    junction Junction208 pe
                    [
                        position = 7600, 7672
                    ]

                    junction Junction209 pe
                    [
                        position = 7600, 7864
                    ]

                    junction Junction210 pe
                    [
                        position = 8768, 7672
                    ]

                    junction Junction211 pe
                    [
                        position = 8768, 7768
                    ]

                    connect Cfa.n_node Junction10 as Connection7
                    connect Cfb.n_node Junction10 as Connection8
                    connect Control.Va From169 as Connection2808
                    connect Control.Vc From170 as Connection2806
                    connect Control.Vb From171 as Connection2807
                    connect Control.Ia From181 as Connection2805
                    connect Control.Ic From182 as Connection2803
                    connect Control.Ib From183 as Connection2804
                    connect Control.VDC From184 as Connection2802
                    connect Control.Vb_util From208 as Connection2800
                    connect Control.Va_util From209 as Connection2801
                    connect Control.Vc_util From210 as Connection2799
                    connect Control.m_a Goto2 as Connection2795
                    connect Control.Contactor Goto92 as Connection2798
                    connect Control.m_c Goto94 as Connection2797
                    connect "Converter meas.VA" Goto83 as Connection2790
                    connect "Converter meas.VB" Goto84 as Connection2791
                    connect "Converter meas.VC" Goto85 as Connection2792
                    connect From167 Control.On as Connection2793
                    connect From185 Output.Inv_On as Connection2501
                    connect From187 Output.Vb as Connection2503
                    connect From190 Output.Ia as Connection2505
                    connect From192 Output.Ic as Connection2507
                    connect From205 Control.mode as Connection2794
                    connect From206 "Three Phase Inverter1.En" as Connection2747
                    connect From211 S1.ctrl_in as Connection2754
                    connect From212 Output.Connected as Connection2755
                    connect From213 "Three Phase Inverter1.InA" as Connection2769
                    connect From215 "Three Phase Inverter1.InC" as Connection2771
                    connect Goto100 Ib_out.out as Connection2778
                    connect Goto86 Ia.out as Connection2258
                    connect Goto87 Ib.out as Connection2259
                    connect Goto88 Ic.out as Connection2260
                    connect Goto93 Control.m_b as Connection2796
                    connect Goto98 Ia_out.out as Connection2779
                    connect Goto99 Ic_out.out as Connection2780
                    connect "Grid meas.VC" Goto89 as Connection2736
                    connect "Grid meas.VB" Goto90 as Connection2735
                    connect "Grid meas.VA" Goto91 as Connection2734
                    connect "Grid meas.C" S1.c_out as Connection2711
                    connect "Grid meas.A" S1.a_out as Connection2715
                    connect "Grid meas.B" S1.b_out as Connection2713
                    connect Ia.n_node Junction178 as Connection2478
                    connect Ia.p_node La.p_node as Connection2158
                    connect Ia_out.p_node "Converter meas.a" as Connection2784
                    connect Ia_out.n_node S1.a_in as Connection2781
                    connect Ib.n_node Junction176 as Connection2473
                    connect Ib_out.p_node "Converter meas.b" as Connection2786
                    connect Ic.p_node Lc.p_node as Connection2156
                    connect Ic_out.p_node "Converter meas.c" as Connection2788
                    connect Ic_out.n_node S1.c_in as Connection2783
                    connect Idc_link.n_node "Three Phase Inverter1.pos_out" as Connection18
                    connect Inputs Control_Inputs.Inputs as Connection2496
                    connect Junction10 Cfc.n_node as Connection2689
                    connect Junction129 Ra.p_node as Connection34
                    connect Junction130 Rc.p_node as Connection35
                    connect Junction176 Vab1.n_node as Connection2474
                    connect Junction178 Vab1.p_node as Connection2479
                    connect Lb.p_node Ib.p_node as Connection2157
                    connect Output.Va From188 as Connection2502
                    connect Output.Vc From189 as Connection2504
                    connect Output.Ib From191 as Connection2506
                    connect Outputs Output.Out1 as Connection2499
                    connect Ra.n_node La.n_node as Connection283
                    connect Rb.p_node Junction118 as Connection50
                    connect Rb.n_node Lb.n_node as Connection51
                    connect Rc.n_node Lc.n_node as Connection52
                    connect Rdc.p_node DCpos as Connection1078
                    connect Rfa.p_node Cfa.p_node as Connection53
                    connect Rfb.p_node Cfb.p_node as Connection55
                    connect Rfc.p_node Cfc.p_node as Connection57
                    connect S1.b_in Ib_out.n_node as Connection2782
                    connect "Three Phase Inverter1.InB" From214 as Connection2770
                    connect "Three Phase Inverter1.b_in" Junction118 as Connection67
                    connect "Three Phase Inverter1.a_in" Junction129 as Connection68
                    connect "Three Phase Inverter1.c_in" Junction130 as Connection69
                    connect VDC.out Goto18 as Connection166
                    connect Vab.n_node Junction118 as Connection74
                    connect Vab.p_node Junction129 as Connection75
                    connect Vbc.p_node Junction118 as Connection81
                    connect Vbc.n_node Junction130 as Connection82
                    connect From217 Control.Ic_out as Connection2809
                    connect From216 Control.Ib_out as Connection2810
                    connect From218 Control.Ia_out as Connection2811
                    connect DCneg Junction203 as Connection2833
                    connect Cdc.n_node Junction203 as Connection2835
                    connect Rdc.n_node Junction204 as Connection2836
                    connect Cdc.p_node Junction204 as Connection2838
                    connect Junction178 Junction205 as Connection2842
                    [
                        breakpoints = 8584, 7672
                    ]
                    connect Junction205 Rfa.n_node as Connection2843
                    [
                        breakpoints = 8624, 7672; 8624, 7672
                    ]
                    connect Junction176 Junction206 as Connection2845
                    [
                        breakpoints = 8584, 7768
                    ]
                    connect Junction206 Rfb.n_node as Connection2846
                    [
                        breakpoints = 8696, 7768
                    ]
                    connect Ic.n_node Junction207 as Connection2848
                    connect Junction207 Rfc.n_node as Connection2849
                    [
                        breakpoints = 8768, 7864
                    ]
                    connect "Converter meas.C" Junction207 as Connection2850
                    connect A "Grid meas.a" as Connection2851
                    connect "Grid meas.b" B as Connection2852
                    connect C "Grid meas.c" as Connection2853
                    connect Junction204 Junction208 as Connection2856
                    [
                        breakpoints = 7520, 7672
                    ]
                    connect Junction208 VDC.p_node as Connection2857
                    [
                        breakpoints = 7600, 7672
                    ]
                    connect Idc_link.p_node Junction208 as Connection2858
                    connect VDC.n_node Junction209 as Connection2859
                    connect Junction209 Junction203 as Connection2860
                    [
                        breakpoints = 7600, 7864
                    ]
                    connect "Three Phase Inverter1.neg_out" Junction209 as Connection2861
                    connect "Converter meas.A" Junction210 as Connection2862
                    connect Junction210 Junction205 as Connection2863
                    connect Vrms_ev.p_node Junction210 as Connection2864
                    connect "Converter meas.B" Junction211 as Connection2865
                    connect Junction211 Junction206 as Connection2866
                    connect Vrms_ev.n_node Junction211 as Connection2867

                    ImodeId_Kp = "1.0"
                    ImodeIq_Kp = "1.0"
                    L = "5e-3"
                    OutputFilterFc = "1500"
                    Sn = "22e3"
                    Ts = "T_charging_station"
                    Vn = "208"
                    Vn_dc = "400"
                    fsw = "10000"

                    mask {
                        icon = "image(\'converter_cabinet.svg\')"
                        description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Battery inverter (Switching)  model.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The input \"mode\" define if the battery inverter is in grid forming or voltage mode (0) or in grid following  or current mode (1). When in voltage mode, the inverter will follow the references of voltage and frequency. When in current mode, the inverter will follow references for active and reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of regular inputs is 5 and of outputs is 14. They are organized as an array in the following order:</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Inputs: 0 - On; 1 - mode; 2 - f_ref; 3 - Vref; 4 - Pref; 5 - Qref;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q; 12 - S; 13 - pf;</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                        help_file = "battery_inverter.html"

                        Sn {
                            label = "Nominal power"
                            widget = edit
                            type = generic
                            default_value = "1.6e6"
                            unit = "VA"
                            group = "1 - General"
                        }

                        Vn {
                            label = "Nominal voltage"
                            widget = edit
                            type = generic
                            default_value = "480.0"
                            unit = "V (line to line)"
                            group = "1 - General"
                        }

                        Vn_dc {
                            label = "Nominal DC link voltage"
                            widget = edit
                            type = generic
                            default_value = "1000.0"
                            unit = "V"
                            group = "1 - General"
                        }

                        fn {
                            label = "Nominal frequency"
                            widget = edit
                            type = generic
                            default_value = "60.0"
                            unit = "Hz"
                            group = "1 - General"
                        }

                        fsw {
                            label = "Switching frequency"
                            widget = edit
                            type = generic
                            default_value = "2500.0"
                            unit = "Hz"
                            group = "1 - General"
                        }

                        Ts {
                            label = "Execution rate"
                            widget = edit
                            type = generic
                            default_value = "200e-6"
                            unit = "s"
                            group = "1 - General"
                        }

                        L {
                            label = "LC filter inductance"
                            widget = edit
                            type = generic
                            default_value = "100.0e-6"
                            unit = "H"
                            group = "2 - Filter"
                        }

                        R {
                            label = "LC filter inductor ESR"
                            widget = edit
                            type = generic
                            default_value = "1e-5"
                            unit = "Ohms"
                            group = "2 - Filter"
                        }

                        OutputFilterFc {
                            label = "LC filter cut-off frequency"
                            widget = edit
                            type = generic
                            default_value = "500.0"
                            unit = "Hz"
                            group = "2 - Filter"
                        }

                        Resr {
                            label = "LC filter capacitor ESR"
                            widget = edit
                            type = generic
                            default_value = "15e-3"
                            unit = "Ohms"
                            group = "2 - Filter"
                        }

                        blowpass {
                            label = "Synch - PLL input filter num"
                            widget = edit
                            type = generic
                            default_value = "[  9.82591682e-06,   1.96518336e-05,   9.82591682e-06]"
                            group = "3 - Adv. 1"
                        }

                        alowpass {
                            label = "Synch - PLL input filter den"
                            widget = edit
                            type = generic
                            default_value = "[ -1.99111429,  0.9911536 ]"
                            group = "3 - Adv. 1"
                        }

                        V_diff {
                            label = "Synch - Accepted voltage diff."
                            widget = edit
                            type = generic
                            default_value = "5"
                            unit = "%"
                            group = "3 - Adv. 1"
                        }

                        Vmatch_Kp {
                            label = "Synch - Voltage match - PI - Kp"
                            widget = edit
                            type = generic
                            default_value = "0.1"
                            group = "3 - Adv. 1"
                        }

                        Vmatch_Ki {
                            label = "Synch - Voltage match - PI - Ki"
                            widget = edit
                            type = generic
                            default_value = "5.0"
                            group = "3 - Adv. 1"
                        }

                        f_diff {
                            label = "Synch - Accepted frequency diff."
                            widget = edit
                            type = generic
                            default_value = "0.2"
                            unit = "%"
                            group = "3 - Adv. 1"
                        }

                        fmatch_Kp {
                            label = "Synch - Frequency match - PI - Kp"
                            widget = edit
                            type = generic
                            default_value = "0.01"
                            group = "3 - Adv. 1"
                        }

                        fmatch_Ki {
                            label = "Synch - Frequency match - PI - Ki"
                            widget = edit
                            type = generic
                            default_value = "3.0"
                            group = "3 - Adv. 1"
                        }

                        Phase_diff {
                            label = "Synch - Accepted phase diff."
                            widget = edit
                            type = generic
                            default_value = "1.0"
                            unit = "%"
                            group = "3 - Adv. 1"
                        }

                        Phase_Kp {
                            label = "Synch - Phase match - PI - Kp"
                            widget = edit
                            type = generic
                            default_value = "0.005"
                            group = "3 - Adv. 1"
                        }

                        Phase_Ki {
                            label = "Synch - Phase match - PI - Ki"
                            widget = edit
                            type = generic
                            default_value = "0.5"
                            group = "3 - Adv. 1"
                        }

                        ImodeId_Kp {
                            label = "Current mode Id - PI - Kp"
                            widget = edit
                            type = generic
                            default_value = "0.347"
                            group = "4 - Adv. 2"
                        }

                        ImodeId_Ki {
                            label = "Current mode Id - PI - Ki"
                            widget = edit
                            type = generic
                            default_value = "347.22"
                            group = "4 - Adv. 2"
                        }

                        ImodeIq_Kp {
                            label = "Current mode Iq - PI - Kd"
                            widget = edit
                            type = generic
                            default_value = "0.347"
                            group = "4 - Adv. 2"
                        }

                        ImodeIq_Ki {
                            label = "Current mode Iq - PI - Ki"
                            widget = edit
                            type = generic
                            default_value = "347.22"
                            group = "4 - Adv. 2"
                        }

                        Imode_damp {
                            label = "Current mode Id and Iq damping gain"
                            widget = edit
                            type = generic
                            default_value = "-0.272"
                            group = "4 - Adv. 2"
                        }

                        powerRate {
                            label = "Maximum power reference change rate"
                            widget = edit
                            type = generic
                            default_value = "1e5"
                            unit = "p.u./s"
                            group = "4 - Adv. 2"
                        }

                        VmodeIdRef_Kp {
                            label = "Voltage mode Id ref - PI - Kp"
                            widget = edit
                            type = generic
                            default_value = "10.0"
                            group = "5 - Adv. 3"
                        }

                        VmodeIdRef_Ki {
                            label = "Voltage mode Id ref - PI - Ki"
                            widget = edit
                            type = generic
                            default_value = "10.0"
                            group = "5 - Adv. 3"
                        }

                        VmodeId_Kp {
                            label = "Voltage mode Id - PI - Kp"
                            widget = edit
                            type = generic
                            default_value = "0.8328"
                            group = "5 - Adv. 3"
                        }

                        VmodeId_Ki {
                            label = "Voltage mode Id - PI - Ki"
                            widget = edit
                            type = generic
                            default_value = "833.33"
                            group = "5 - Adv. 3"
                        }

                        Vmode_ovMod {
                            label = "Voltage mode Id overmodulation gain"
                            widget = edit
                            type = generic
                            default_value = "1.2"
                            group = "5 - Adv. 3"
                        }

                        Vmode_damp {
                            label = "Voltage mode Id damping gain"
                            widget = edit
                            type = generic
                            default_value = "-0.0001"
                            group = "5 - Adv. 3"
                        }

                        V_rise {
                            label = "V reference rising rate"
                            widget = edit
                            type = generic
                            default_value = "10e3"
                            unit = "p.u./s"
                            group = "5 - Adv. 3"
                        }

                        V_fall {
                            label = "V reference falling rate"
                            widget = edit
                            type = generic
                            default_value = "-10e3"
                            unit = "p.u./s"
                            group = "5 - Adv. 3"
                        }

                        f_rise {
                            label = "f reference rising rate"
                            widget = edit
                            type = generic
                            default_value = "10.0"
                            unit = "p.u./s"
                            group = "5 - Adv. 3"
                        }

                        f_fall {
                            label = "f reference falling rate"
                            widget = edit
                            type = generic
                            default_value = "-10.0"
                            unit = "p.u./s"
                            group = "5 - Adv. 3"
                        }

                        mod_upLim {
                            label = "Modulation signals upper limit"
                            widget = edit
                            type = generic
                            default_value = "1.1546"
                            group = "6 - Adv. 4"
                        }

                        mod_lowLim {
                            label = "Modulation signals lower limit"
                            widget = edit
                            type = generic
                            default_value = "-1.1546"
                            group = "6 - Adv. 4"
                        }

                        k {
                            label = "Active islanding detector k factor"
                            widget = edit
                            type = generic
                            default_value = "0.05"
                            group = "6 - Adv. 4"
                        }

                        CODE open
                            from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                        
                            dialog = RegularComponentPropertiesDialog(
                                component=component,
                                property_container=component.masks[-1],
                                current_diagram=current_diagram
                            )
                            dialog.exec_()
                            
                        ENDCODE

                        CODE define_icon
                            mdl.set_component_icon_image(item_handle, "converter_cabinet.svg")
                        ENDCODE
                    }
                }
                [
                    position = 9992, 8256
                    scale = -1, 1
                    size = 288, 239
                ]

                component gen_bus_split "Bus Split1" {
                }
                [
                    position = 10000, 7904
                ]

                component "core/Three Phase Core Coupling" "Core Coupling1" {
                    C1 = "10e-6"
                    L1 = "100e-6"
                    R1 = "1"
                    R2 = "1e-2"
                    fixed_snb_i = "true"
                    fixed_snb_u = "true"
                    snb_type_i = "R1-C1"
                }
                [
                    position = 9528, 8256
                    scale = -1, 1
                    size = 12, 256
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "T_charging_station"
                }
                [
                    position = 9936, 7904
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Three Phase Two Winding Transformer" Tr1 {
                    Poc1 = "344.99999999952564"
                    Psc1 = "1762.5"
                    Sn = "120000"
                    V1 = "208"
                    V2 = "480"
                    current_vals_SCOC = "[0.0024, 1.0]"
                    f = "60.0"
                    ioc1 = "0.6999999999992988"
                    usc1 = "3.9999999999957394"
                }
                [
                    position = 9328, 8256
                    scale = -1, 1
                    size = 126, 256
                ]

                port DC- {
                    position = left:3
                    kind = pe
                }
                [
                    position = 10304, 8352
                    scale = -1, 1
                ]

                port DC+ {
                    position = left:1
                    kind = pe
                }
                [
                    position = 10304, 8160
                    scale = -1, 1
                ]

                port A {
                    position = right:1
                    kind = pe
                }
                [
                    position = 9136, 8160
                    rotation = down
                    scale = -1, 1
                ]

                port B {
                    position = right:2
                    kind = pe
                }
                [
                    position = 9136, 8256
                    rotation = down
                    scale = -1, 1
                ]

                port C {
                    position = right:3
                    kind = pe
                }
                [
                    position = 9136, 8352
                    rotation = down
                    scale = -1, 1
                ]

                port in_extras {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 9872, 7904
                ]

                port out_extras {
                    position = top:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 9728, 7976
                    rotation = down
                ]

                connect Charging_station_meter_split.In Charging_station_meter.Out as Connection4026
                connect "Battery inverter.Outputs" Batt_out.outputs as Connection1105
                connect Batt_in.inputs "Battery inverter.Inputs" as Connection1106
                connect Charging_station_meter.C- "Battery inverter.C" as Connection4057
                connect Charging_station_meter.B- "Battery inverter.B" as Connection4058
                connect "Battery inverter.A" Charging_station_meter.A- as Connection4059
                connect "Battery inverter.DCpos" DC+ as Connection4060
                connect "Battery inverter.DCneg" DC- as Connection4061
                connect "Bus Split1.out" Batt_in.motor_status as Connection4064
                connect Batt_out.charger_CB out_extras as Connection4065
                connect "Bus Split1.out1" Batt_in.speedkmh as Connection4066
                connect "Core Coupling1.b_in" Charging_station_meter.B+ as Connection4068
                connect Charging_station_meter.C+ "Core Coupling1.c_in" as Connection4069
                connect Charging_station_meter.A+ "Core Coupling1.a_in" as Connection4071
                connect in_extras "Rate Transition1.in" as Connection4073
                connect "Rate Transition1.out" "Bus Split1.in" as Connection4074
                connect B Tr1.sec_2 as Connection4075
                connect Tr1.prm_2 "Core Coupling1.b_out" as Connection4076
                connect "Core Coupling1.a_out" Tr1.prm_1 as Connection4077
                connect Tr1.sec_1 A as Connection4078
                connect "Core Coupling1.c_out" Tr1.prm_3 as Connection4079
                connect Tr1.sec_3 C as Connection4080
                connect Tr1.n2 Tr1.n1 as Connection4086
                [
                    breakpoints = 9360, 8472
                ]

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Charging point.</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Look under mask (Ctrl+Enter)</p></body></html>"

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE

                    CODE define_icon
                        image(r"C:\00 Typhoon SVN\t_misc\00 Project management\90 Demos\0900 EATON-Typhoon Demo 5_26_2020\img\station.png")
                    ENDCODE
                }
            }
            [
                position = 7840, 8240
                scale = -1, 1
                size = 200, 240
            ]

            component Subsystem "Electric Vehicle" {
                layout = dynamic
                component "core/Current Measurement" Ia {
                }
                [
                    position = 8688, 8448
                    size = 64, 32
                ]

                component gen_scada_output "battery soc" {
                    unit = ""
                }
                [
                    position = 7824, 8536
                ]

                component "core/Current Measurement" Ic {
                }
                [
                    position = 8688, 8640
                    size = 64, 32
                ]

                component pas_capacitor C1 {
                    capacitance = "Cf"
                }
                [
                    position = 8256, 8704
                    rotation = right
                ]

                component "core/Current Measurement" Ib {
                }
                [
                    position = 8688, 8544
                    size = 64, 32
                ]

                component "core/Three Phase Inverter" 3ph_inverter {
                    ctrl_src = "Internal modulator"
                    d_time = "1e-6"
                }
                [
                    position = 7968, 8544
                    size = 127, 256
                ]

                component pas_capacitor C2 {
                    capacitance = "Cf"
                }
                [
                    position = 8328, 8704
                    rotation = right
                ]

                component pas_capacitor C3 {
                    capacitance = "Cf"
                }
                [
                    position = 8400, 8704
                    rotation = right
                ]

                component "core/Battery" Battery {
                    Kdisc_I = "20.0"
                    Ke_exp = "103.0"
                    Ke_full = "116.0"
                    Kq_exp = "85.0"
                    Kq_nom = "93.5"
                    R_series = "0.06666666666666672"
                    battery_type = "Lithium-Ion"
                    capacity = "150"
                    execution_rate = "Ts"
                    initial_soc = "80"
                    nominal_voltage = "400"
                    sig_output = "True"
                }
                [
                    position = 7744, 8536
                    rotation = right
                    size = 64, 48
                ]

                component "core/Voltage Measurement" Vab {
                }
                [
                    position = 8432, 8496
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vbc {
                }
                [
                    position = 8432, 8592
                    rotation = right
                    size = 64, 32
                ]

                component pas_inductor L2 {
                    inductance = "Lf"
                }
                [
                    position = 8200, 8544
                ]

                component pas_inductor L3 {
                    inductance = "Lf"
                }
                [
                    position = 8200, 8640
                ]

                component "core/Three-phase Meter" "Three-phase Meter1" {
                    P_meas = "True"
                    R = "10e3"
                    Ts = "Ts"
                }
                [
                    position = 8576, 8544
                    hide_name = True
                    size = 56, 240
                ]

                component pas_inductor L1 {
                    inductance = "Lf"
                }
                [
                    position = 8200, 8448
                ]

                component "core/Induction Machine with Squirrel Cage" "Induction motor" {
                    Jm = "1.2"
                    Llr = "Llr"
                    Lls = "Lls"
                    Lm = "Lm"
                    Rr = "Rr"
                    Rs = "Rs"
                    Rsnb_stator = "5e3"
                    enb_sig_out = "True"
                    execution_rate = "Ts"
                    friction_coeff = "0.01"
                    load_src = "Model"
                    unconstrained_angle = "enabled"
                }
                [
                    position = 8880, 8544
                    size = 160, 160
                ]

                component gen_probe P {
                }
                [
                    position = 8280, 8352
                    rotation = down
                ]

                component "core/Meter Split" "Meter Split" {
                    power_p = "True"
                    van = "False"
                    vbn = "False"
                    vcn = "False"
                }
                [
                    position = 8496, 8352
                    rotation = down
                    hide_name = True
                    size = 104, 48
                ]

                component gen_digital_probe "motor started" {
                }
                [
                    position = 7464, 8112
                ]

                component Subsystem "Powertrain Control Module (PCM)" {
                    layout = dynamic
                    component Subsystem "Reference signal generator" {
                        layout = dynamic
                        component gen_product Product6 {
                            signs = "/*"
                        }
                        [
                            position = 8160, 8048
                            hide_name = True
                        ]

                        component gen_product Product9 {
                            signs = "**"
                        }
                        [
                            position = 8336, 8344
                            hide_name = True
                        ]

                        component src_constant "Base voltage" {
                            execution_rate = "Ts"
                            value = "Vb"
                        }
                        [
                            position = 7952, 8016
                        ]

                        component gen_sum Sum2 {
                        }
                        [
                            position = 8056, 8336
                            hide_name = True
                        ]

                        component gen_sum Sum1 {
                        }
                        [
                            position = 8056, 8232
                            hide_name = True
                        ]

                        component gen_trigonometric sin1 {
                        }
                        [
                            position = 8160, 8136
                            hide_name = True
                        ]

                        component gen_trigonometric sin2 {
                        }
                        [
                            position = 8160, 8232
                            hide_name = True
                        ]

                        component gen_trigonometric sin3 {
                        }
                        [
                            position = 8160, 8336
                            hide_name = True
                        ]

                        component gen_product Product8 {
                            signs = "**"
                        }
                        [
                            position = 8336, 8240
                            hide_name = True
                        ]

                        component src_constant Constant5 {
                            execution_rate = "Ts"
                            value = "-2*np.pi/3"
                        }
                        [
                            position = 7952, 8240
                            hide_name = True
                        ]

                        component src_constant Constant6 {
                            execution_rate = "Ts"
                            value = "2*np.pi/3"
                        }
                        [
                            position = 7952, 8344
                            hide_name = True
                        ]

                        component gen_product Product7 {
                            signs = "**"
                        }
                        [
                            position = 8336, 8144
                            hide_name = True
                        ]

                        port "Angle(w*t)" {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7952, 8136
                        ]

                        port ma {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8440, 8144
                        ]

                        port mc {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8440, 8344
                        ]

                        port Voltage {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7952, 8080
                        ]

                        port mb {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8440, 8240
                        ]

                        junction Junction12 sp
                        [
                            position = 8000, 8224
                        ]

                        junction Junction123 sp
                        [
                            position = 8256, 8152
                        ]

                        junction Junction124 sp
                        [
                            position = 8256, 8248
                        ]

                        junction Junction62 sp
                        [
                            position = 8000, 8136
                        ]

                        connect Product6.in "Base voltage.out" as Connection479
                        [
                            breakpoints = 8064, 8040; 8064, 8016
                        ]
                        connect Constant5.out Sum1.in1 as Connection18
                        connect Product7.in sin1.out as Connection702
                        connect Constant6.out Sum2.in1 as Connection19
                        connect Sum2.in Junction12 as Connection57
                        connect Product9.in1 Junction124 as Connection502
                        connect Junction123 Product7.in1 as Connection498
                        connect Product8.in sin2.out as Connection706
                        connect sin3.out Product9.in as Connection714
                        connect Product6.out Junction123 as Connection497
                        connect Product8.in1 Junction124 as Connection500
                        connect Junction124 Junction123 as Connection501
                        connect Junction62 Junction12 as Connection112
                        connect sin3.in Sum2.out as Connection83
                        connect sin1.in Junction62 as Connection111
                        connect sin2.in Sum1.out as Connection81
                        connect Sum1.in Junction12 as Connection56
                        connect Product8.out mb as Connection719
                        connect Junction62 "Angle(w*t)" as Connection715
                        connect Product6.in1 Voltage as Connection718
                        [
                            breakpoints = 8064, 8056; 8064, 8080
                        ]
                        connect Product9.out mc as Connection717
                        connect Product7.out ma as Connection716
                    }
                    [
                        position = 7824, 8056
                        size = 176, 80
                    ]

                    component Subsystem "Voltage control" {
                        layout = dynamic
                        component gen_logic_op "Logical operator1" {
                            operator = "NOT"
                        }
                        [
                            position = 8168, 8064
                            hide_name = True
                        ]

                        component tm_delay "Unit Delay" {
                            init_value = "20"
                        }
                        [
                            position = 8312, 8144
                            rotation = down
                            hide_name = True
                        ]

                        component gen_sum Sum7 {
                            signs = "+-"
                        }
                        [
                            position = 7792, 8224
                            hide_name = True
                        ]

                        component gen_product Pref {
                            signs = "*/*"
                        }
                        [
                            position = 7664, 8160
                        ]

                        component gen_product Product11 {
                            signs = "**/"
                        }
                        [
                            position = 7984, 8224
                            hide_name = True
                        ]

                        component gen_digital_probe "regenerative breaking signal" {
                        }
                        [
                            position = 8288, 8064
                        ]

                        component src_constant "Base power" {
                            execution_rate = "Ts"
                            value = "Pb"
                        }
                        [
                            position = 7552, 8224
                        ]

                        component gen_c_function "regenerative breaking voltage" {
                            global_variables = "real voltage_buffer;real w_buffer;"
                            in_terminal_dimensions = "inherit;inherit;inherit"
                            in_terminal_dimensions_str = "voltage inherit;w_el_machine inherit;throttle inherit"
                            in_terminal_labels = "[(\'voltage\', True), (\'w_el_machine\', True), (\'throttle\', True)]"
                            in_terminal_properties = "real voltage;inherit w_el_machine;inherit throttle;"
                            init_fnc = "/*Begin code section*/
out = 0;
if (throttle>0.01)
{
    out = voltage;
    voltage_buffer = voltage;
    w_buffer = w_el_machine;
}
else 
{
    if (w_buffer == 0)
    {
        out = 0;
    }
    else
    {
        out = voltage_buffer - (w_buffer-w_el_machine)*voltage_buffer/w_buffer;
    }
}
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "[(\'out\', True)]"
                            output_fnc = "/*Begin code section*/
if (throttle>0.01)
{
    out = voltage;
    voltage_buffer = voltage;
    w_buffer = w_el_machine;
}
else 
{
    if (w_buffer == 0)
    {
        out = 0;
    }
    else
    {
        out = voltage_buffer - (w_buffer-w_el_machine)*voltage_buffer/w_buffer;
    }
}
/*End code section*/"
                        }
                        [
                            position = 8368, 8240
                            size = 88, 64
                        ]

                        component src_constant Constant12 {
                            execution_rate = "Ts"
                            value = "100"
                        }
                        [
                            position = 7552, 8160
                            hide_name = True
                        ]

                        component src_constant Constant16 {
                            execution_rate = "Ts"
                            value = "1e-3"
                        }
                        [
                            position = 7904, 8160
                            hide_name = True
                        ]

                        component Subsystem "PI controller" {
                            layout = dynamic
                            component gen_gain Ki {
                                execution_rate = "Ts"
                                gain = "Ki"
                            }
                            [
                                position = 8136, 8128
                            ]

                            component gen_integrator Integrator {
                                execution_rate = "Ts"
                                show_init_condition = "external"
                                show_reset = "rising"
                            }
                            [
                                position = 8240, 8144
                            ]

                            component gen_gain Kp {
                                execution_rate = "Ts"
                                gain = "Kp"
                            }
                            [
                                position = 8136, 8256
                            ]

                            component gen_sum Sum {
                                execution_rate = "Ts"
                            }
                            [
                                position = 8352, 8192
                            ]

                            component gen_limiter Limit {
                                execution_rate = "Ts"
                                lower_limit = "PIDmin"
                                upper_limit = "PIDmax"
                            }
                            [
                                position = 8440, 8192
                            ]

                            port out {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8504, 8192
                                hide_name = True
                            ]

                            port in {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8008, 8192
                                hide_name = True
                            ]

                            port reset {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8152, 8048
                            ]

                            port initial {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8192, 8216
                                rotation = left
                            ]

                            junction Junction1 sp
                            [
                                position = 8064, 8192
                            ]

                            connect Sum.out Limit.in as Connection15
                            connect Integrator.out Sum.in as Connection10
                            connect Limit.out out as Connection16
                            connect Junction1 in as Connection7
                            connect reset Integrator.reset as Connection14
                            [
                                breakpoints = 8192, 8048; 8192, 8144
                            ]
                            connect Integrator.in Ki.out as Connection4
                            connect initial Integrator.init_condition_port as Connection13
                            connect Kp.in Junction1 as Connection8
                            connect Kp.out Sum.in1 as Connection11
                            connect Ki.in Junction1 as Connection6

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">This block implements discrete-time PI control algorithm.</p></body></html>"

                                Kp {
                                    label = "Kp"
                                    widget = edit
                                    type = generic
                                    default_value = "5"
                                }

                                Ki {
                                    label = "Ki"
                                    widget = edit
                                    type = generic
                                    default_value = "1000"
                                }

                                init {
                                    label = "Integrator initial condition"
                                    widget = edit
                                    type = generic
                                    default_value = "20"
                                }

                                Ts {
                                    label = "Execution rate"
                                    widget = edit
                                    type = generic
                                    default_value = "Ts"
                                }

                                PIDmax {
                                    label = "Upper limit"
                                    widget = edit
                                    type = generic
                                    default_value = "400"
                                }

                                PIDmin {
                                    label = "Lower limit"
                                    widget = edit
                                    type = generic
                                    default_value = "0"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                    
                                ENDCODE
                            }
                        }
                        [
                            position = 8112, 8224
                            size = 96, 48
                        ]

                        component gen_comparator Comparator1 {
                        }
                        [
                            position = 8000, 8128
                            hide_name = True
                        ]

                        port "Voltage ref" {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8624, 8240
                        ]

                        port Throttle {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7328, 8096
                        ]

                        port "Start motor" {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7328, 8160
                        ]

                        port "Electrical speed" {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7328, 8224
                        ]

                        port "output power" {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7328, 8280
                        ]

                        tag From8 {
                            value = "Throttle"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7552, 8096
                            hide_name = True
                        ]

                        tag From9 {
                            value = "Throttle"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8240, 8272
                            hide_name = True
                        ]

                        tag From13 {
                            value = "Throttle"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7904, 8096
                            hide_name = True
                        ]

                        tag From12 {
                            value = "w_electrical"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8240, 8240
                            hide_name = True
                            scale = 1, -1
                        ]

                        tag From7 {
                            value = "start_motor"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7888, 8208
                            hide_name = True
                        ]

                        tag Goto1 {
                            value = "Throttle"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7440, 8096
                            hide_name = True
                        ]

                        tag Goto2 {
                            value = "start_motor"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7440, 8160
                            hide_name = True
                        ]

                        tag Goto3 {
                            value = "w_electrical"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7440, 8224
                            hide_name = True
                        ]

                        tag Goto4 {
                            value = "output_power"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7456, 8280
                            hide_name = True
                            size = 84, 20
                        ]

                        tag From14 {
                            value = "output_power"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7680, 8232
                            hide_name = True
                            size = 84, 20
                        ]

                        junction Junction148 sp
                        [
                            position = 7600, 8224
                        ]

                        junction Junction182 sp
                        [
                            position = 8080, 8128
                        ]

                        junction Junction180 sp
                        [
                            position = 8464, 8240
                        ]

                        connect Pref.in From8 as Connection845
                        [
                            breakpoints = 7616, 8144; 7600, 8144; 7600, 8096
                        ]
                        connect Constant12.out Pref.in1 as Connection665
                        connect Comparator1.out Junction182 as Connection928
                        connect From7 Product11.in as Connection687
                        connect From12 "regenerative breaking voltage.w_el_machine" as Connection900
                        connect "Unit Delay.in" Junction180 as Connection921
                        connect Product11.in1 Sum7.out as Connection686
                        connect Junction148 Pref.in2 as Connection695
                        [
                            breakpoints = 7600, 8208; 7600, 8176
                        ]
                        connect Product11.in2 Junction148 as Connection696
                        connect "Unit Delay.out" "PI controller.initial" as Connection918
                        connect Constant16.out Comparator1.in2 as Connection926
                        connect "Base power.out" Junction148 as Connection694
                        connect Sum7.in Pref.out as Connection667
                        connect "regenerative breaking voltage.out" Junction180 as Connection919
                        connect "regenerative breaking signal.in" "Logical operator1.out" as Connection931
                        connect From13 Comparator1.in1 as Connection925
                        connect Junction182 "PI controller.reset" as Connection929
                        connect Product11.out "PI controller.in" as Connection905
                        connect "Logical operator1.in" Junction182 as Connection930
                        connect From9 "regenerative breaking voltage.throttle" as Connection927
                        connect Throttle Goto1 as Connection933
                        connect "Start motor" Goto2 as Connection934
                        connect "Electrical speed" Goto3 as Connection935
                        connect Junction180 "Voltage ref" as Connection936
                        [
                            breakpoints = 8464, 8240; 8512, 8240
                        ]
                        connect "PI controller.out" "regenerative breaking voltage.voltage" as Connection938
                        [
                            breakpoints = 8208, 8224; 8272, 8224
                        ]
                        connect "output power" Goto4 as Connection939
                        connect From14 Sum7.in1 as Connection940
                    }
                    [
                        position = 7536, 7984
                        size = 176, 80
                    ]

                    component Subsystem "Frequency control" {
                        layout = dynamic
                        component gen_product Ws {
                            signs = "*/"
                        }
                        [
                            position = 7552, 8088
                            hide_name = True
                        ]

                        component gen_gain w_to_f {
                            gain = "1/(2*np.pi)"
                        }
                        [
                            position = 7680, 8088
                        ]

                        component gen_limiter "Frequency Limit" {
                            lower_limit = "6"
                            upper_limit = "600"
                        }
                        [
                            position = 7792, 8088
                        ]

                        component gen_sum "1 - s" {
                            signs = "+-"
                        }
                        [
                            position = 7384, 8096
                            hide_name = True
                        ]

                        component gen_gain w_meh_to_w_elec {
                            gain = "pms"
                        }
                        [
                            position = 7248, 8016
                        ]

                        component tm_delay "Unit Delay1" {
                            init_value = "6"
                        }
                        [
                            position = 7808, 8200
                            rotation = down
                            hide_name = True
                        ]

                        component lut_1d "slip reference" {
                            ext_mode = "Linear"
                            in_vec_x = "f"
                            out_vec_f_x = "sp"
                            table_impl = "Non-equidistant"
                        }
                        [
                            position = 7304, 8120
                        ]

                        component src_constant Constant13 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7304, 8072
                            hide_name = True
                        ]

                        component gen_gain f_to_w {
                            gain = "2*np.pi"
                        }
                        [
                            position = 7888, 8088
                        ]

                        component gen_c_function "regenerative breaking frequency" {
                            in_terminal_dimensions = "inherit;inherit;inherit"
                            in_terminal_dimensions_str = "throttle inherit;w_field inherit;w_el_machine inherit"
                            in_terminal_labels = "[(\'throttle\', True), (\'w_field\', True), (\'w_el_machine\', True)]"
                            in_terminal_properties = "inherit throttle;real w_field;inherit w_el_machine;"
                            init_fnc = "/*Begin code section*/
out = 10;
if (throttle>0.01)
{
    out = (out+w_field)/2;
}
else 
{
    out = 0.9*w_el_machine;
}
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "[(\'out\', False)]"
                            output_fnc = "/*Begin code section*/
if (throttle>0.01)
{
    out = (out+w_field)/2;
}
else 
{
    out = 0.95*w_el_machine;
}
/*End code section*/"
                        }
                        [
                            position = 8168, 8088
                            size = 176, 80
                        ]

                        component gen_c_function "C function1" {
                            global_variables = "real teta;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "w inherit"
                            in_terminal_labels = "False;"
                            in_terminal_properties = "real w;"
                            init_fnc = "/*Begin code section*/
teta = 0.0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "wt inherit"
                            out_terminal_labels = "False;"
                            out_terminal_properties = "real wt;"
                            output_fnc = "/*Begin code section*/
wt = teta;
/*End code section*/"
                            update_fnc = "/*Begin code section*/
teta = w*execution_rate + teta;
if (teta >= 2*3.1416)
    teta = teta - (2*3.1416);
/*End code section*/"
                        }
                        [
                            position = 8344, 8088
                            hide_name = True
                            size = 48, 48
                        ]

                        port "Machine speed" {
                            position = left:auto
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7152, 8016
                            rotation = down
                            scale = -1, 1
                        ]

                        port "Angle(w*t)" {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8488, 8088
                        ]

                        port Throttle {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8032
                        ]

                        port "Electrical speed" {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7368, 7912
                        ]

                        tag From11 {
                            value = "w_electrical"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7976, 8128
                            hide_name = True
                            scale = 1, -1
                        ]

                        tag Goto8 {
                            value = "w_electrical"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7368, 7968
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                        ]

                        junction Junction191 sp
                        [
                            position = 7304, 8016
                        ]

                        junction Junction194 sp
                        [
                            position = 7304, 7968
                        ]

                        junction Junction200 sp
                        [
                            position = 8416, 8088
                        ]

                        connect w_to_f.out "Frequency Limit.in" as Connection767
                        connect "1 - s.in" Constant13.out as Connection758
                        [
                            breakpoints = 7344, 8088; 7344, 8072
                        ]
                        connect w_meh_to_w_elec.out Junction191 as Connection996
                        connect Ws.in1 "1 - s.out" as Connection763
                        connect "slip reference.addr" "Unit Delay1.out" as Connection776
                        [
                            breakpoints = 7240, 8120
                        ]
                        connect "slip reference.value" "1 - s.in1" as Connection773
                        [
                            breakpoints = 7344, 8120; 7344, 8104
                        ]
                        connect "Machine speed" w_meh_to_w_elec.in as Connection1007
                        connect Junction191 Junction194 as Connection1019
                        [
                            breakpoints = 7304, 8016
                        ]
                        connect Goto8 Junction194 as Connection1021
                        connect From11 "regenerative breaking frequency.w_el_machine" as Connection889
                        connect Throttle "regenerative breaking frequency.throttle" as Connection1017
                        connect Junction200 "Unit Delay1.in" as Connection1043
                        [
                            breakpoints = 8416, 8088; 8416, 8088
                        ]
                        connect "C function1.wt" Junction200 as Connection1044
                        connect Junction200 "Angle(w*t)" as Connection1062
                        connect Ws.in Junction191 as Connection1070
                        [
                            breakpoints = 7440, 8016
                        ]
                        connect "Electrical speed" Junction194 as Connection1071
                        [
                            breakpoints = 7304, 7912
                        ]
                        connect "regenerative breaking frequency.w_field" f_to_w.out as Connection1072
                        connect w_to_f.in Ws.out as Connection1074
                        connect f_to_w.in "Frequency Limit.out" as Connection1075
                        connect "C function1.w" "regenerative breaking frequency.out" as Connection1076
                    }
                    [
                        position = 7544, 8160
                        scale = 1, -1
                        size = 176, 80
                    ]

                    component gen_c_function "Throttle limitter" {
                        in_terminal_dimensions = "inherit;inherit"
                        in_terminal_dimensions_str = "w_electrical inherit;throttle inherit"
                        in_terminal_labels = "[(\'w_electrical\', True), (\'throttle\', True)]"
                        in_terminal_properties = "inherit w_electrical;real throttle;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', False)]"
                        output_fnc = "/*Begin code section*/
if ((w_electrical < 50) & (throttle > 2))
{
    out = 2;
}
else
{
    out = throttle;
}
/*End code section*/"
                    }
                    [
                        position = 7096, 7968
                        size = 120, 48
                    ]

                    port mc {
                        position = auto:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 8112
                    ]

                    port mb {
                        position = auto:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 8056
                    ]

                    port ma {
                        position = auto:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8008, 8000
                    ]

                    port "Machine speed" {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 8144
                        rotation = down
                        scale = -1, 1
                    ]

                    port On {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6936, 8048
                    ]

                    port Throttle {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6936, 7992
                    ]

                    port "output power" {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 6944, 8224
                        rotation = down
                        scale = -1, 1
                    ]

                    tag From10 {
                        value = "Throttle"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7352, 8176
                        hide_name = True
                        scale = 1, -1
                    ]

                    tag Goto8 {
                        value = "w_electrical"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7712, 8176
                        hide_name = True
                    ]

                    tag From11 {
                        value = "Throttle"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7352, 7928
                        hide_name = True
                        scale = 1, -1
                    ]

                    tag From12 {
                        value = "w_electrical"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7352, 7992
                        hide_name = True
                        scale = 1, -1
                    ]

                    tag From13 {
                        value = "start_motor"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7352, 7960
                        hide_name = True
                        scale = 1, -1
                    ]

                    tag Goto6 {
                        value = "start_motor"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7224, 8048
                        hide_name = True
                    ]

                    tag From14 {
                        value = "w_electrical"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 6944, 7944
                        hide_name = True
                    ]

                    tag Goto7 {
                        value = "Throttle"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7224, 7968
                        hide_name = True
                    ]

                    tag Goto9 {
                        value = "output_power"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7048, 8224
                        hide_name = True
                        size = 99, 20
                    ]

                    tag From15 {
                        value = "output_power"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7344, 8016
                        hide_name = True
                        scale = 1, -1
                        size = 85, 20
                    ]

                    connect "Reference signal generator.mb" mb as Connection979
                    connect "Reference signal generator.ma" ma as Connection980
                    [
                        breakpoints = 7944, 8040
                    ]
                    connect "Reference signal generator.mc" mc as Connection981
                    [
                        breakpoints = 7944, 8072
                    ]
                    connect "Reference signal generator.Voltage" "Voltage control.Voltage ref" as Connection987
                    [
                        breakpoints = 7696, 8040; 7696, 7984
                    ]
                    connect "Frequency control.Angle(w*t)" "Reference signal generator.Angle(w*t)" as Connection988
                    [
                        breakpoints = 7696, 8144; 7696, 8072
                    ]
                    connect Goto8 "Frequency control.Electrical speed" as Connection989
                    connect "Machine speed" "Frequency control.Machine speed" as Connection990
                    connect From10 "Frequency control.Throttle" as Connection991
                    connect From11 "Voltage control.Throttle" as Connection992
                    connect From12 "Voltage control.Electrical speed" as Connection993
                    connect From13 "Voltage control.Start motor" as Connection994
                    [
                        breakpoints = 7400, 7976; 7432, 7976
                    ]
                    connect Goto6 On as Connection952
                    connect From14 "Throttle limitter.w_electrical" as Connection1000
                    [
                        breakpoints = 7000, 7944
                    ]
                    connect "Throttle limitter.throttle" Throttle as Connection999
                    [
                        breakpoints = 7000, 7976; 7000, 7992
                    ]
                    connect "Throttle limitter.out" Goto7 as Connection997
                    connect "output power" Goto9 as Connection1001
                    connect From15 "Voltage control.output power" as Connection1002
                }
                [
                    position = 7800, 8128
                    size = 144, 168
                ]

                component src_scada_input Throttle {
                    execution_rate = "Ts"
                    unit = ""
                }
                [
                    position = 7632, 8064
                ]

                component Subsystem Load {
                    layout = dynamic
                    component gen_gain Gain1 {
                        gain = "1/3600"
                    }
                    [
                        position = 7904, 8048
                        hide_name = True
                    ]

                    component gen_gain "speed mps" {
                        gain = "0.668/2/9.73"
                    }
                    [
                        position = 7968, 8304
                        rotation = left
                    ]

                    component gen_sum Sum8 {
                    }
                    [
                        position = 8480, 8192
                        hide_name = True
                    ]

                    component gen_integrator Integrator1 {
                    }
                    [
                        position = 7968, 8048
                        hide_name = True
                    ]

                    component gen_product Product12 {
                    }
                    [
                        position = 8384, 8048
                        hide_name = True
                    ]

                    component gen_probe Distance {
                    }
                    [
                        position = 8048, 8048
                    ]

                    component src_scada_input Brake {
                        execution_rate = "Ts"
                        unit = ""
                    }
                    [
                        position = 8256, 8112
                    ]

                    component gen_probe "speed kmph" {
                        signal_type = "speed"
                    }
                    [
                        position = 7808, 8184
                        rotation = down
                    ]

                    component Subsystem "Torque calculator" {
                        layout = dynamic
                        component gen_trigonometric "Trigonometric function1" {
                        }
                        [
                            position = 8032, 7936
                            hide_name = True
                        ]

                        component gen_math_fnc "Mathematical function1" {
                            mathematical_fn = "power"
                        }
                        [
                            position = 8016, 8192
                        ]

                        component gen_product "Drag area" {
                        }
                        [
                            position = 8048, 8360
                        ]

                        component src_constant "Drag coefficient" {
                            execution_rate = "Ts"
                            value = "0.24"
                        }
                        [
                            position = 7936, 8328
                            scale = 1, -1
                        ]

                        component gen_product "Rolling resistance" {
                        }
                        [
                            position = 8144, 8080
                            scale = 1, -1
                        ]

                        component src_constant constant {
                            execution_rate = "Ts"
                            value = "2"
                        }
                        [
                            position = 7888, 8224
                            hide_name = True
                            scale = 1, -1
                        ]

                        component gen_product "Sum torque" {
                            signs = "**//"
                        }
                        [
                            position = 8496, 8224
                        ]

                        component gen_product "Grade resistance" {
                        }
                        [
                            position = 8160, 7944
                            scale = 1, -1
                        ]

                        component src_constant Area {
                            execution_rate = "Ts"
                            value = "2.22"
                        }
                        [
                            position = 7936, 8392
                            scale = 1, -1
                        ]

                        component src_constant "gear ratio" {
                            execution_rate = "Ts"
                            value = "9.73"
                        }
                        [
                            position = 8320, 8360
                            scale = 1, -1
                        ]

                        component gen_product "Wind resistance" {
                            signs = "*/**"
                        }
                        [
                            position = 8144, 8256
                        ]

                        component src_constant "wheel diameter" {
                            execution_rate = "Ts"
                            value = "0.668"
                        }
                        [
                            position = 8320, 8208
                            scale = 1, -1
                        ]

                        component src_constant "Air density" {
                            execution_rate = "Ts"
                            value = "1.2754"
                        }
                        [
                            position = 7936, 8272
                            scale = 1, -1
                        ]

                        component src_constant Weight {
                            execution_rate = "Ts"
                            value = "2000"
                        }
                        [
                            position = 7936, 8008
                            scale = 1, -1
                        ]

                        component gen_probe "wind resss" {
                        }
                        [
                            position = 8240, 8168
                        ]

                        component src_scada_input angle {
                            execution_rate = "Ts"
                            unit = ""
                        }
                        [
                            position = 7936, 7936
                            scale = 1, -1
                        ]

                        component gen_probe "rol res" {
                        }
                        [
                            position = 8376, 8008
                        ]

                        component gen_sum "Sum Force" {
                            signs = "3"
                        }
                        [
                            position = 8320, 8112
                        ]

                        component lut_1d "rolling coefficient" {
                            ext_mode = "Linear"
                            in_vec_x = "[0, 1, 40, 80, 120, 160, 200]"
                            out_vec_f_x = "[0, 0.01, 0.012, 0.015, 0.02, 0.03, 0.04]"
                            table_impl = "Non-equidistant"
                        }
                        [
                            position = 7936, 8088
                        ]

                        component src_constant constant1 {
                            execution_rate = "Ts"
                            value = "2"
                        }
                        [
                            position = 8320, 8296
                            hide_name = True
                            scale = 1, -1
                        ]

                        port "speed kmph" {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7776, 8088
                        ]

                        port "speed mps" {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7800, 8184
                        ]

                        port load_torque {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8568, 8224
                        ]

                        junction Junction10 sp
                        [
                            position = 7920, 8224
                        ]

                        junction Junction9 sp
                        [
                            position = 8192, 8168
                        ]

                        junction Junction4 sp
                        [
                            position = 8104, 8008
                        ]

                        junction Junction11 sp
                        [
                            position = 8208, 8080
                        ]

                        connect "Rolling resistance.in1" Junction4 as Connection73
                        [
                            breakpoints = 8104, 8056; 8104, 8008
                        ]
                        connect "Trigonometric function1.in" angle.out as Connection68
                        connect "Sum torque.in1" "wheel diameter.out" as Connection103
                        connect Junction4 "Grade resistance.in" as Connection72
                        [
                            breakpoints = 8104, 8008; 8104, 7960
                        ]
                        connect Junction9 "Wind resistance.out" as Connection113
                        connect "rolling coefficient.addr" "speed kmph" as Connection507
                        connect "wind resss.in" Junction9 as Connection114
                        connect "Mathematical function1.in1" Junction10 as Connection117
                        connect "Sum Force.in" "Grade resistance.out" as Connection99
                        [
                            breakpoints = 8256, 8096; 8256, 7968
                        ]
                        connect "Drag coefficient.out" "Drag area.in" as Connection132
                        connect "Rolling resistance.out" Junction11 as Connection509
                        connect Junction10 constant.out as Connection118
                        [
                            breakpoints = 7920, 8224
                        ]
                        connect "Sum torque.out" load_torque as Connection506
                        connect "Sum torque.in" "Sum Force.out" as Connection102
                        [
                            breakpoints = 8448, 8192
                        ]
                        connect "rol res.in" Junction11 as Connection511
                        connect "Mathematical function1.in" "speed mps" as Connection508
                        connect "Wind resistance.in1" Junction10 as Connection119
                        connect "Trigonometric function1.out" "Grade resistance.in1" as Connection70
                        connect Junction11 "Sum Force.in1" as Connection510
                        [
                            breakpoints = 8240, 8112
                        ]
                        connect Weight.out Junction4 as Connection71
                        connect "Sum Force.in2" Junction9 as Connection505
                        connect "Drag area.in1" Area.out as Connection133
                        [
                            breakpoints = 8000, 8368; 8000, 8392
                        ]
                        connect "Wind resistance.in3" "Drag area.out" as Connection134
                        [
                            breakpoints = 8096, 8280; 8096, 8360
                        ]
                        connect "Mathematical function1.out" "Wind resistance.in" as Connection116
                        connect "rolling coefficient.value" "Rolling resistance.in" as Connection74
                        connect "Air density.out" "Wind resistance.in2" as Connection131
                        [
                            breakpoints = 8064, 8272
                        ]
                        connect constant1.out "Sum torque.in2" as Connection520
                        [
                            breakpoints = 8368, 8288
                        ]
                        connect "gear ratio.out" "Sum torque.in3" as Connection521
                        [
                            breakpoints = 8400, 8360
                        ]
                    }
                    [
                        position = 8288, 8200
                        scale = 1, -1
                        size = 112, 64
                    ]

                    component gen_gain "mps to kmph" {
                        gain = "3.6"
                    }
                    [
                        position = 7920, 8184
                        rotation = down
                    ]

                    component gen_scada_output "machine Wr" {
                        unit = ""
                    }
                    [
                        position = 8112, 8344
                    ]

                    port torque {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8552, 8192
                    ]

                    port w_speed {
                        position = right:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7968, 8480
                        rotation = left
                    ]

                    port speedkmh {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7800, 8328
                        rotation = down
                    ]

                    junction Junction188 sp
                    [
                        position = 7888, 8224
                    ]

                    junction Junction191 sp
                    [
                        position = 7968, 8344
                    ]

                    junction Junction170 sp
                    [
                        position = 7872, 8184
                    ]

                    junction Junction6 sp
                    [
                        position = 7968, 8184
                    ]

                    junction Junction5 sp
                    [
                        position = 7888, 8184
                    ]

                    junction Junction193 sp
                    [
                        position = 8008, 8184
                    ]

                    connect Sum8.in1 "Torque calculator.load_torque" as Connection830
                    connect "speed mps.in" Junction191 as Connection1047
                    [
                        breakpoints = 7968, 8344
                    ]
                    connect Junction191 "machine Wr.in" as Connection1043
                    connect "mps to kmph.in" Junction6 as Connection88
                    [
                        breakpoints = 7968, 8216
                    ]
                    connect Product12.out Sum8.in as Connection838
                    connect Integrator1.out Distance.in as Connection829
                    connect Product12.in1 Brake.out as Connection837
                    connect Junction5 "mps to kmph.out" as Connection82
                    connect Gain1.in Junction170 as Connection828
                    connect Junction5 Junction188 as Connection997
                    connect torque Sum8.out as Connection1049
                    connect Junction6 "speed mps.out" as Connection89
                    connect "speed kmph.in" Junction170 as Connection825
                    connect Integrator1.in Gain1.out as Connection827
                    connect Junction188 "Torque calculator.speed kmph" as Connection998
                    connect Junction170 Junction5 as Connection826
                    [
                        breakpoints = 7872, 8184
                    ]
                    connect Junction6 Junction193 as Connection1051
                    [
                        breakpoints = 7968, 8184
                    ]
                    connect Junction193 "Torque calculator.speed mps" as Connection1052
                    [
                        breakpoints = 8016, 8184
                    ]
                    connect Product12.in Junction193 as Connection1053
                    [
                        breakpoints = 8008, 8152; 8008, 8184
                    ]
                    connect Junction191 w_speed as Connection1054
                    [
                        breakpoints = 7968, 8344; 7968, 8432
                    ]
                    connect speedkmh Junction188 as Connection1058
                    [
                        breakpoints = 7888, 8272
                    ]
                }
                [
                    position = 9008, 8320
                    rotation = down
                    size = 80, 64
                ]

                component "core/Current Measurement" I_battery {
                    override_signal_name = "True"
                    signal_name = "I_battery"
                }
                [
                    position = 7816, 8448
                    size = 64, 32
                ]

                component sys_signal_switch "Signal switch" {
                    threshold = "0.5"
                }
                [
                    position = 7344, 8144
                ]

                component src_constant Constant1 {
                    execution_rate = "inherit"
                    value = "0"
                }
                [
                    position = 7224, 8104
                    hide_name = True
                ]

                component src_scada_input "start motor" {
                    execution_rate = "Ts"
                    max = "1"
                    min = "0"
                    unit = ""
                }
                [
                    position = 7224, 8184
                ]

                component "core/Voltage Measurement" Vbc0 {
                }
                [
                    position = 8112, 8592
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vab0 {
                }
                [
                    position = 8112, 8496
                    rotation = right
                    size = 64, 32
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8984, 8440
                    hide_name = True
                ]

                component gen_bus_join "Bus Join1" {
                }
                [
                    position = 7408, 8312
                ]

                component "core/Single Phase Core Coupling" "Core Coupling 2" {
                    C1 = "0.05e-6"
                    L1 = "0.001"
                    R1 = "1"
                    fixed_snb_i = "true"
                    fixed_snb_u = "true"
                }
                [
                    position = 7640, 8544
                    size = 12, 256
                ]

                component "core/Rate Transition" "Rate Transition1" {
                    execution_rate = "Ts"
                }
                [
                    position = 7376, 8384
                    size = 32, 32
                ]

                component gen_probe speed {
                }
                [
                    position = 8824, 8248
                    rotation = down
                ]

                component gen_probe SOC {
                }
                [
                    position = 7872, 8704
                    rotation = down
                    scale = -1, 1
                ]

                port DC- {
                    position = right:2
                    kind = pe
                    direction =  out
                }
                [
                    position = 7504, 8640
                    rotation = down
                    scale = -1, 1
                ]

                port DC+ {
                    position = right:1
                    kind = pe
                    direction =  out
                }
                [
                    position = 7504, 8448
                    rotation = down
                    scale = -1, 1
                ]

                port out_extras {
                    position = top:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7496, 8312
                ]

                port in_extras {
                    position = top:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7272, 8384
                ]

                tag Goto8 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7928, 8064
                    hide_name = True
                    size = 60, 20
                ]

                tag From16 {
                    value = "start_motor"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 8112
                    hide_name = True
                ]

                tag Goto6 {
                    value = "start_motor"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7464, 8176
                    hide_name = True
                ]

                tag Goto7 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7928, 8128
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7928, 8192
                    hide_name = True
                    size = 60, 20
                ]

                tag From17 {
                    value = "start_motor"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7888, 8384
                    hide_name = True
                ]

                tag From18 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7888, 8336
                    hide_name = True
                ]

                tag From19 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7888, 8360
                    hide_name = True
                ]

                tag From20 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7888, 8312
                    hide_name = True
                ]

                tag From21 {
                    value = "start_motor"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7312, 8296
                    hide_name = True
                    size = 58, 20
                ]

                tag From22 {
                    value = "output_power"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7632, 8192
                    hide_name = True
                    size = 93, 20
                ]

                tag Goto9 {
                    value = "output_power"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8304, 8288
                    rotation = down
                    hide_name = True
                    size = 86, 20
                ]

                tag Goto10 {
                    value = "charger_connected"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7512, 8384
                    hide_name = True
                    size = 92, 20
                ]

                tag From24 {
                    value = "charger_connected"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7256, 8072
                    hide_name = True
                    size = 98, 20
                ]

                tag Goto11 {
                    value = "w_speed"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 9024, 8392
                    hide_name = True
                    size = 60, 20
                ]

                tag From25 {
                    value = "w_speed"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 8144
                    hide_name = True
                ]

                tag Goto12 {
                    value = "speedkmh"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8888, 8304
                    rotation = down
                    hide_name = True
                    size = 58, 20
                ]

                tag From26 {
                    value = "speedkmh"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7312, 8320
                    hide_name = True
                    size = 68, 20
                ]

                junction Junction157 pe
                [
                    position = 8328, 8744
                ]

                junction Junction116 pe
                [
                    position = 8432, 8544
                ]

                junction Junction139 pe
                [
                    position = 8400, 8640
                ]

                junction Junction160 pe
                [
                    position = 8432, 8640
                ]

                junction Junction159 pe
                [
                    position = 8432, 8544
                ]

                junction Junction138 pe
                [
                    position = 8328, 8544
                ]

                junction Junction158 pe
                [
                    position = 8432, 8448
                ]

                junction Junction134 pe
                [
                    position = 8256, 8448
                ]

                junction Junction199 sp
                [
                    position = 7392, 8144
                ]

                junction Junction194 pe
                [
                    position = 8112, 8640
                ]

                junction Junction200 pe
                [
                    position = 8112, 8544
                ]

                junction Junction193 pe
                [
                    position = 8112, 8448
                ]

                junction Junction201 pe
                [
                    position = 8112, 8544
                ]

                junction Junction204 sp
                [
                    position = 8368, 8352
                ]

                junction Junction205 sp
                [
                    position = 8936, 8392
                ]

                junction Junction206 pe
                [
                    position = 7744, 8640
                ]

                junction Junction207 pe
                [
                    position = 7744, 8448
                ]

                junction Junction208 sp
                [
                    position = 8944, 8304
                ]

                junction Junction209 sp
                [
                    position = 7784, 8536
                ]

                connect Vab.n_node Junction116 as Connection442
                connect Ic.n_node "Induction motor.c_in" as Connection404
                [
                    breakpoints = 8752, 8640; 8752, 8576
                ]
                connect Ib.p_node "Three-phase Meter1.B-" as Connection737
                connect Ia.n_node "Induction motor.a_in" as Connection191
                [
                    breakpoints = 8752, 8448; 8752, 8512
                ]
                connect Vbc.p_node Junction116 as Connection444
                connect "Three-phase Meter1.A-" Ia.p_node as Connection738
                connect "Three-phase Meter1.C-" Ic.p_node as Connection739
                connect C1.n_node Junction157 as Connection744
                connect Junction157 C2.n_node as Connection745
                connect C3.n_node Junction157 as Connection746
                connect Ib.n_node "Induction motor.b_in" as Connection402
                connect "Meter Split.Input" "Three-phase Meter1.Out" as Connection1053
                connect Goto1 "Powertrain Control Module (PCM).ma" as Connection1057
                connect Goto7 "Powertrain Control Module (PCM).mb" as Connection1068
                connect Goto8 "Powertrain Control Module (PCM).mc" as Connection1067
                connect From17 3ph_inverter.En as Connection1070
                connect From19 3ph_inverter.InA as Connection1071
                connect From18 3ph_inverter.InB as Connection1072
                connect From20 3ph_inverter.InC as Connection1073
                connect Junction139 C3.p_node as Connection641
                connect Junction160 Junction139 as Connection754
                [
                    breakpoints = 8432, 8640
                ]
                connect L3.n_node Junction139 as Connection642
                [
                    breakpoints = 8248, 8640; 8400, 8640
                ]
                connect "Three-phase Meter1.C+" Junction160 as Connection755
                connect Vbc.n_node Junction160 as Connection753
                connect "Three-phase Meter1.B+" Junction159 as Connection752
                connect Junction159 Junction116 as Connection751
                [
                    breakpoints = 8432, 8544
                ]
                connect L2.n_node Junction138 as Connection638
                connect Junction138 Junction159 as Connection750
                [
                    breakpoints = 8328, 8544
                ]
                connect C2.p_node Junction138 as Connection636
                connect L1.n_node Junction134 as Connection632
                connect Vab.p_node Junction158 as Connection747
                connect C1.p_node Junction134 as Connection620
                connect "Three-phase Meter1.A+" Junction158 as Connection749
                connect Junction158 Junction134 as Connection748
                [
                    breakpoints = 8432, 8448
                ]
                connect I_battery.n_node 3ph_inverter.pos_out as Connection1124
                [
                    breakpoints = 7888, 8448
                ]
                connect Junction199 "motor started.in" as Connection1149
                [
                    breakpoints = 7392, 8112
                ]
                connect "Signal switch.out" Junction199 as Connection1150
                connect Constant1.out "Signal switch.in" as Connection1152
                [
                    breakpoints = 7272, 8128
                ]
                connect "start motor.out" "Signal switch.in1" as Connection1153
                [
                    breakpoints = 7272, 8160
                ]
                connect Vbc0.n_node Junction194 as Connection1123
                connect 3ph_inverter.c_in Junction194 as Connection1121
                connect L3.p_node Junction194 as Connection1168
                connect L2.p_node Junction200 as Connection1170
                connect 3ph_inverter.a_in Junction193 as Connection1118
                connect Vab0.p_node Junction193 as Connection1120
                connect Junction193 L1.p_node as Connection1166
                [
                    breakpoints = 8112, 8448
                ]
                connect Vab0.n_node Junction200 as Connection1176
                [
                    breakpoints = 8112, 8544
                ]
                connect Junction200 Junction201 as Connection1177
                connect Junction201 3ph_inverter.b_in as Connection1178
                connect Vbc0.p_node Junction201 as Connection1179
                connect From16 "Powertrain Control Module (PCM).On" as Connection1180
                connect Throttle.out "Powertrain Control Module (PCM).Throttle" as Connection1181
                connect Load.torque "Induction motor.load_in" as Connection1188
                connect Termination1.in "Induction motor.torque_out" as Connection1189
                connect Junction199 Goto6 as Connection1217
                [
                    breakpoints = 7392, 8144; 7392, 8144; 7392, 8176; 7392, 8176; 7392, 8176
                ]
                connect From22 "Powertrain Control Module (PCM).output power" as Connection1220
                connect "Meter Split.POWER_P" Junction204 as Connection1222
                [
                    breakpoints = 8408, 8352; 8392, 8352
                ]
                connect Junction204 P.in as Connection1223
                connect Goto9 Junction204 as Connection1224
                connect "Bus Join1.out" out_extras as Connection1225
                connect From24 "Signal switch.in2" as Connection1229
                connect From21 "Bus Join1.in" as Connection1231
                connect "Induction motor.speed_out" Junction205 as Connection1232
                connect Junction205 Load.w_speed as Connection1233
                [
                    breakpoints = 8936, 8392; 8936, 8344
                ]
                connect Goto11 Junction205 as Connection1234
                connect "Powertrain Control Module (PCM).Machine speed" From25 as Connection1235
                connect From26 "Bus Join1.in1" as Connection1237
                connect "Core Coupling 2.a_in" DC+ as Connection1251
                connect DC- "Core Coupling 2.b_in" as Connection1252
                connect Battery.n_node Junction206 as Connection1253
                connect Junction206 3ph_inverter.neg_out as Connection1254
                [
                    breakpoints = 7744, 8648; 7744, 8640; 7744, 8640
                ]
                connect "Core Coupling 2.b_out" Junction206 as Connection1255
                connect Battery.p_node Junction207 as Connection1256
                connect Junction207 I_battery.p_node as Connection1257
                [
                    breakpoints = 7744, 8448; 7744, 8448; 7744, 8448; 7744, 8448
                ]
                connect "Core Coupling 2.a_out" Junction207 as Connection1258
                connect in_extras "Rate Transition1.in" as Connection1259
                connect "Rate Transition1.out" Goto10 as Connection1260
                connect Goto12 Junction208 as Connection1261
                connect Junction208 Load.speedkmh as Connection1262
                connect speed.in Junction208 as Connection1263
                connect "battery soc.in" Junction209 as Connection1264
                connect Junction209 Battery.out as Connection1265
                connect SOC.in Junction209 as Connection1266

                Ts = "Ts_ev"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Electric vehicle with 250kW induction motor and 150Ah Li-ion battery. The 22kVA on-board battery charger is implemented using \"Battery inverter\" component from the microgrid library. Supports grid forming/following, vehicle-to-grid and grid-to-vehicle operation. The powertrain control module (PCM) implements regenerative breaking.</p></body></html>"

                    Ts {
                        label = "Ts"
                        widget = edit
                        type = generic
                        default_value = "0"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, r"C:\00 Typhoon SVN\t_misc\00 Project management\90 Demos\0900 EATON-Typhoon Demo 5_26_2020\img\EVredcar.jpg")
                    ENDCODE
                }
            }
            [
                position = 8384, 8240
                scale = -1, 1
                size = 528, 240
            ]

            port A {
                position = right:1
                kind = pe
            }
            [
                position = 7656, 8144
            ]

            port C {
                position = right:3
                kind = pe
            }
            [
                position = 7656, 8336
            ]

            port B {
                position = right:2
                kind = pe
            }
            [
                position = 7656, 8240
            ]

            tag Goto1 {
                value = "EV_out_extras"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8624, 8048
                rotation = left
                hide_name = True
                size = 74, 20
            ]

            tag From1 {
                value = "EV_out_extras"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7760, 8064
                rotation = right
                hide_name = True
                size = 73, 20
            ]

            tag Goto2 {
                value = "CS_out_extras"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7920, 8064
                rotation = left
                hide_name = True
                size = 74, 20
            ]

            tag From2 {
                value = "CS_out_extras"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 8144, 8064
                rotation = right
                hide_name = True
                size = 73, 20
            ]

            connect "Charging Station.A" A as Connection30
            connect "Charging Station.C" C as Connection31
            connect "Charging Station.B" B as Connection32
            connect "Charging Station.DC+" "Electric Vehicle.DC+" as Connection39
            [
                breakpoints = 8016, 8144; 8040, 8144
            ]
            connect "Charging Station.DC-" "Electric Vehicle.DC-" as Connection40
            [
                breakpoints = 8016, 8336; 8040, 8336
            ]
            connect From1 "Charging Station.in_extras" as Connection11
            connect Goto2 "Charging Station.out_extras" as Connection12
            connect From2 "Electric Vehicle.in_extras" as Connection13
            connect Goto1 "Electric Vehicle.out_extras" as Connection29
        }
        [
            position = 6568, 7968
            scale = -1, 1
            size = 48, 64
        ]

        tag Tag36 {
            value = "Ground"
            scope = global
            kind = pe
        }
        [
            position = 6496, 7152
            hide_name = True
            scale = -1, 1
        ]

        tag Tag37 {
            value = "Ground"
            scope = global
            kind = pe
        }
        [
            position = 6504, 7712
            hide_name = True
            scale = -1, 1
        ]

        junction Junction495 pe
        [
            position = 6400, 7152
        ]

        junction Junction603 pe
        [
            position = 6384, 7848
        ]

        junction Junction606 pe
        [
            position = 6384, 7848
        ]

        junction Junction607 pe
        [
            position = 6400, 7864
        ]

        junction Junction608 pe
        [
            position = 6416, 7880
        ]

        junction Junction609 pe
        [
            position = 5968, 8056
        ]

        junction Junction610 pe
        [
            position = 6000, 8072
        ]

        junction Junction611 pe
        [
            position = 5984, 7848
        ]

        junction Junction612 pe
        [
            position = 6016, 7864
        ]

        junction Junction613 pe
        [
            position = 6416, 7880
        ]

        junction Junction614 pe
        [
            position = 6400, 7864
        ]

        junction Junction615 pe
        [
            position = 6400, 7368
        ]

        junction Junction616 pe
        [
            position = 6304, 7320
        ]

        junction Junction617 pe
        [
            position = 6384, 7952
        ]

        junction Junction618 pe
        [
            position = 6400, 7968
        ]

        junction Junction619 pe
        [
            position = 6416, 7984
        ]

        connect PCC.G Tag37 as Connection3388
        connect Junction495 Tag36 as Connection4156
        [
            breakpoints = 6400, 7152
        ]
        connect Vs1.n_node Junction495 as Connection4157
        connect "RL Section.P1" Vs1.c_node as Connection4707
        connect "RL Section.P6" PCC.A as Connection4708
        connect "RL Section.P4" PCC.B as Connection4709
        connect "RL Section.P2" PCC.C as Connection4710
        connect PV1.B "Core coupling2.B" as Connection4740
        connect PV1.A "Core coupling2.A" as Connection4743
        connect PV1.C "Core coupling2.C" as Connection4741
        connect ESS1.A "Core coupling1.A" as Connection4751
        connect ESS1.B "Core coupling1.B" as Connection4752
        connect ESS1.C "Core coupling1.C" as Connection4753
        connect PCC.a Junction603 as Connection4771
        [
            breakpoints = 6384, 7832; 6384, 7832; 6384, 7832
        ]
        connect Junction603 Load.A as Connection4772
        [
            breakpoints = 6384, 7848; 6488, 7848
        ]
        connect "Core coupling1.c" "RL Section1.P5" as Connection4782
        connect "RL Section1.P2" Junction606 as Connection4783
        connect Junction606 Junction603 as Connection4784
        connect "RL Section1.P4" Junction607 as Connection4786
        connect "RL Section1.P6" Junction608 as Connection4789
        connect "Core coupling2.c" "RL Section2.P5" as Connection4794
        connect "Core coupling2.a" Junction609 as Connection4799
        connect Junction609 "RL Section2.P1" as Connection4800
        [
            breakpoints = 6000, 8056
        ]
        connect Vrms_pv.p_node Junction609 as Connection4801
        connect "Core coupling2.b" Junction610 as Connection4802
        connect Junction610 "RL Section2.P3" as Connection4803
        connect Vrms_pv.n_node Junction610 as Connection4804
        connect "Core coupling1.a" Junction611 as Connection4805
        connect Junction611 "RL Section1.P1" as Connection4806
        connect Vrms_ess.p_node Junction611 as Connection4807
        connect "Core coupling1.b" Junction612 as Connection4808
        connect Junction612 "RL Section1.P3" as Connection4809
        connect Vrms_ess.n_node Junction612 as Connection4810
        connect Load.C Junction613 as Connection4816
        connect Junction613 Junction608 as Connection4817
        [
            breakpoints = 6416, 7880
        ]
        connect PCC.c Junction613 as Connection4818
        connect Load.B Junction614 as Connection4820
        [
            breakpoints = 6528, 7864
        ]
        connect Junction614 Junction607 as Connection4821
        [
            breakpoints = 6400, 7864
        ]
        connect PCC.b Junction614 as Connection4822
        connect Junction495 gnd2.node as Connection4823
        [
            breakpoints = 6400, 7152; 6400, 7152; 6400, 7152; 6400, 7152
        ]
        connect "RL Section.P3" Junction615 as Connection4825
        connect Junction615 Vs1.b_node as Connection4826
        connect Vrms_grid.n_node Junction615 as Connection4827
        connect "RL Section.P5" Junction616 as Connection4828
        connect Junction616 Vs1.a_node as Connection4829
        [
            breakpoints = 6304, 7320; 6304, 7320; 6304, 7320
        ]
        connect Vrms_grid.p_node Junction616 as Connection4830
        connect "RL Section2.P2" Junction617 as Connection4848
        connect Junction617 Junction606 as Connection4849
        [
            breakpoints = 6384, 7952
        ]
        connect "EV charging st.A" Junction617 as Connection4850
        connect "RL Section2.P4" Junction618 as Connection4851
        connect Junction618 Junction607 as Connection4852
        [
            breakpoints = 6400, 7968
        ]
        connect "EV charging st.B" Junction618 as Connection4853
        connect Junction608 Junction619 as Connection4854
        [
            breakpoints = 6416, 7880; 6416, 7880
        ]
        connect Junction619 "RL Section2.P6" as Connection4855
        [
            breakpoints = 6416, 7984; 6416, 8032
        ]
        connect "EV charging st.C" Junction619 as Connection4856
    }

    default {
        gen_PQ_transform {
            filter_order = "first order"
            filter_cutoff_Hz = "30"
            initial_filter_input = "0"
            initial_filter_output = "0"
            enable_inst_ports = "True"
            enable_zero_ports = "False"
            execution_rate = "inherit"
        }

        gen_abs {
            execution_rate = "inherit"
        }

        gen_bus_join {
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_bus_split {
            outputs = "2"
            execution_rate = "inherit"
        }

        gen_c_function {
            in_terminal_properties = "real in;"
            in_terminal_labels = ""
            out_terminal_properties = "real out;"
            out_terminal_labels = ""
            no_feed_inputs = ""
            no_feed_outputs = ""
            in_terminal_dimensions = ""
            in_terminal_dimensions_str = ""
            out_terminal_dimensions = ""
            out_terminal_dimensions_str = ""
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_comparator {
            execution_rate = "inherit"
        }

        gen_data_type_conversion {
            output_type = "real"
            execution_rate = "inherit"
        }

        gen_delay {
            delay_type = "Fixed delay"
            del_length = "2"
            max_delay_length = "20"
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_limiter {
            upper_limit = "[\'inf\']"
            lower_limit = "[\'-inf\']"
            execution_rate = "inherit"
        }

        gen_logic_op {
            operator = "AND"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_math_fnc {
            mathematical_fn = "exponential"
            execution_rate = "inherit"
        }

        gen_minmax {
            operation = "min"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_pid_controller {
            controller_type = "PID"
            kp = "1"
            kp_source = "internal"
            ki = "1"
            ki_source = "internal"
            kd = "0"
            kd_source = "internal"
            filt_coef = "100"
            int_init_value = "0"
            filt_init_value = "0"
            enb_output_limit_out = "False"
            upper_sat_lim = "1"
            lower_sat_lim = "-1"
            enb_anti_windup_out = "False"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_product {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_rate_limiter {
            rising_limit = "1"
            falling_limit = "-1"
            execution_rate = "inherit"
        }

        gen_rel_op {
            relational_op = "=="
            execution_rate = "inherit"
        }

        gen_rms_value {
            op_mode = "PLL based"
            frequency = "50"
            period_timeout = "0.5"
            execution_rate = "inherit"
        }

        gen_round {
            round_fn = "floor"
            execution_rate = "inherit"
        }

        gen_scada_output {
            addr = "0"
            format = "real"
            unit = " "
            override_signal_name = "False"
            signal_name = ""
            execution_rate = "inherit"
        }

        gen_sr_ff {
            init_value = "0"
            execution_rate = "inherit"
        }

        gen_sum {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_terminator {
            execution_rate = "inherit"
        }

        gen_trigonometric {
            trigonometric_fn = "sin"
            execution_rate = "inherit"
        }

        gen_z_domain_transfer {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1]"
            a_coeff = "[1,-1]"
            init_states = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        lut_1d {
            in_vec_x = "np.arange(-5,6)"
            out_vec_f_x = "np.arange(-5,6)**2"
            table_impl = "Equidistant"
            ext_mode = "Clip"
            execution_rate = "inherit"
        }

        pas_capacitor {
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_inductor {
            inductance = "1e-3"
            initial_current = "0.0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_resistor {
            resistance = "1"
        }

        src_clock {
            execution_rate = "100e-6"
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
        }

        src_digital_input {
            addr = "1"
            invert = "false"
            signal_type = "uint"
            execution_rate = "100e-6"
        }

        src_scada_input {
            addr = "0"
            format = "real"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "real"
            min = "-1e6"
            max = "1e6"
            def_value = "0"
            unit = " "
            execution_rate = "100e-6"
        }

        sys_signal_switch {
            criterion = "ctrl >= threshold"
            threshold = "0"
            execution_rate = "inherit"
        }

        tm_delay {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Battery" {
            sig_output = "False"
            lut = "False"
            battery_type = "Lead-Acid"
            nominal_voltage = "12.0"
            capacity = "1.2"
            initial_soc = "100.0"
            execution_rate = "100e-6"
            Ke_full = "108.0"
            Kdisc_I = "5.0"
            R_series = "0.25"
            Kq_nom = "50.0"
            Kq_exp = "0.9"
            Ke_exp = "102.5"
            preview = "Preview SOC Curve"
        }

        "core/Counter" {
            ext_reset = "level"
            init_val = "0"
            state_type = "real"
            execution_rate = "inherit"
        }

        "core/Current Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Edge Detection" {
            edge = "both"
            execution_rate = "inherit"
        }

        "core/Induction Machine with Squirrel Cage" {
            model_type = "linear"
            Rs = "13.12"
            Rr = "11.202"
            Lls = "0.0276"
            Llr = "0.0194"
            Lm = "0.3482"
            curve_type = "flux vs current"
            im_vector = "[0.0, 0.0]"
            psim_vector = "[0.0, 0.0]"
            Lm_vector = "[0.0, 0.0]"
            pms = "2"
            Jm = "10e-6"
            friction_coeff = "0"
            unconstrained_angle = "disabled"
            load_src = "SCADA / external"
            ext_mdl_load_type = "torque"
            load_ai_pin_addr = "1"
            load_ai_offset = "0"
            load_ai_gain = "1"
            enc_ppr = "1024"
            res_pole_pairs = "1"
            res_carr_source = "internal"
            res_int_carr_f = "5e+3"
            res_ai_pin_addr = "1"
            res_ai_offset = "0"
            res_ai_gain = "1"
            absenc_type = "None"
            endat_clock_di_addr = "1"
            endat_clock_di_logic = "active high"
            endat_data_di_addr = "2"
            endat_data_di_logic = "active high"
            biss_clock_di_addr = "1"
            biss_clock_di_logic = "active high"
            biss_data_di_addr = "2"
            ssi_clock_di_addr = "1"
            ssi_clock_di_logic = "active high"
            ssi_data_di_addr = "2"
            Rsnb_stator = "20e3"
            calculate_max_snubber = "Calculate"
            enb_sig_out = "False"
            execution_rate = "100e-6"
        }

        "core/Meter Split" {
            van = "True"
            vbn = "True"
            vcn = "True"
            van_rms = "False"
            vbn_rms = "False"
            vcn_rms = "False"
            vln_rms = "False"
            vab = "False"
            vbc = "False"
            vca = "False"
            vab_rms = "False"
            vbc_rms = "False"
            vca_rms = "False"
            vll_rms = "False"
            ia = "False"
            ib = "False"
            ic = "False"
            ia_rms = "False"
            ib_rms = "False"
            ic_rms = "False"
            i_rms = "False"
            freq = "False"
            power_p = "False"
            power_q = "False"
            power_s = "False"
            power_pf = "False"
            enable_extra_in = "No"
            power_pa = "False"
            power_pb = "False"
            power_pc = "False"
            power_qa = "False"
            power_qb = "False"
            power_qc = "False"
            power_sa = "False"
            power_sb = "False"
            power_sc = "False"
            power_pfa = "False"
            power_pfb = "False"
            power_pfc = "False"
        }

        "core/RL Section" {
            model_def = "R-L"
            unit_sys = "imperial"
            num_of_phases = "3"
            resistance_per_l = "1"
            resistance_per_l_mile = "1"
            inductance_per_l = "1e-3"
            inductance_per_l_mile = "1e-3"
            length = "1.0"
            length_mile = "1.0"
            power = "500.0"
            voltage = "11.0"
            frequency = "50.0"
            R_value = "21.55"
            L_value = "0.00842"
        }

        "core/Rate Transition" {
            init_value = "0.0"
            execution_rate = "100e-6"
        }

        "core/Signal Controlled Voltage Source" {
            execution_rate = "inherit"
        }

        "core/Single Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100000.0"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
        }

        "core/Three Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/Three Phase Inverter" {
            ctrl_src = "Digital input per switch"
            op_mode = "Fixed carrier frequency"
            carrier_freq = "10000.0"
            carr_ph_offset = "0.0"
            d_time = "5e-6"
            ref_sig_min_max = "[-1.0, 1.0]"
            load_mode = "on min"
            execution_rate = "inherit"
            Sa_top = "1"
            Sa_top_logic = "active high"
            Sa_bot = "2"
            Sa_bot_logic = "active high"
            Sb_top = "3"
            Sb_top_logic = "active high"
            Sb_bot = "4"
            Sb_bot_logic = "active high"
            Sc_top = "5"
            Sc_top_logic = "active high"
            Sc_bot = "6"
            Sc_bot_logic = "active high"
            delay_enabled = "False"
            fixed_delay = "1e-6"
            var_delay_lut = "[-10.0, 1e-6, 10.0, 1e-6]"
            preview_var_delay = "Preview"
            Sa_top_I = "False"
            Sa_bot_I = "False"
            Sb_top_I = "False"
            Sb_bot_I = "False"
            Sc_top_I = "False"
            Sc_bot_I = "False"
            losses_estimation = "False"
            Import_igbt_xml = "not selected"
            Import_diode_xml = "not selected"
            Vce = "1.3"
            Rce = "0"
            Vd = "1.2"
            Rd = "0"
            i_sw = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw = "[0.0, 600.0]"
            temp_sw = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            et_on_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*3.8e-3, 0.4*3.8e-3, 0.8*3.8e-3, 0.68*3.8e-3, 0.9*3.8e-3], [0.65*3.8e-3, 0.9*3.8e-3, 1.2*3.8e-3, 1.5*3.8e-3, 1.7*3.8e-3], [0.9*3.8e-3, 1.3*3.8e-3, 1.7*3.8e-3, 1.9*3.8e-3, 2.25*3.8e-3], [1.1*3.8e-3, 1.7*3.8e-3, 2.1*3.8e-3, 2.3*3.8e-3, 2.5*3.8e-3]]"
            et_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.1e-3, 0.4*2.1e-3, 0.8*2.1e-3, 0.68*2.1e-3, 0.9*2.1e-3], [0.65*2.1e-3, 0.9*2.1e-3, 1.2*2.1e-3, 1.5*2.1e-3, 1.7*2.1e-3], [0.9*2.1e-3, 1.3*2.1e-3, 1.7*2.1e-3, 1.9*2.1e-3, 2.25*2.1e-3], [1.1*2.1e-3, 1.7*2.1e-3, 2.1*2.1e-3, 2.3*2.1e-3, 2.5*2.1e-3]]"
            ed_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            temp_estimation = "False"
            thermal_networks_type = "Foster"
            switch_Rth = "[0.159, 0.133, 0.120, 0.038]"
            switch_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            switch_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            diode_Rth = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            loss_exec_rate = "100e-6"
            vout_cmp_pullup_mode = "False"
            show_cnt_out = "False"
            show_monitoring = "false"
            _control_property = "all high"
            dtv_flag_en = "True"
            pwm_enabling = "False"
            pwm_enable_di = "13"
            pwm_enable_inv = "active high"
        }

        "core/Three Phase Two Winding Transformer" {
            input = "SC and OC tests"
            core_sat = "False"
            Sn = "160000.0"
            f = "50.0"
            V1 = "10000.0"
            V2 = "400.0"
            usc1 = "4.0"
            Psc1 = "2350.0"
            ioc1 = "0.7"
            Poc1 = "460.0"
            R1 = "4.58984375"
            L1 = ".0370093710364"
            R2 = ".00734375"
            L2 = "5.92149936583e-05"
            Rm = "217391.304348"
            Lm = "311.709196788"
            flux_vals_SI = "[1910.3, 2419.7]"
            current_vals_SI = "[0.66653, 277.72]"
            r1 = ".00734375"
            l1 = ".0186029389059"
            r2 = ".00734375"
            l2 = ".0186029389059"
            rm = "347.826086957"
            lm = "156.68213163"
            flux_vals_pu = "[1.2, 1.52]"
            current_vals_pu = "[0.0024, 1]"
            flux_vals_SCOC = "[1.2, 1.52]"
            current_vals_SCOC = "[0.0024, 1]"
            import_from_SI2SCOC = "Import from SI"
            import_from_pu2SCOC = "Import from PU"
            import_from_SCOC2SI = "Import from SC OC"
            import_from_pu2SI = "Import from PU"
            import_from_SCOC2pu = "Import from SC OC"
            import_from_SI2pu = "Import from SI"
            winding_1_connection = "Y"
            winding_2_connection = "Y"
            clock_number = "0"
            embedded_cpl = "false"
            coupling_type = "core"
            Rshunt = "inf"
        }

        "core/Three Phase Voltage Source" {
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Three phase PLL" {
            initial_filter_output = "60"
            wn = "157.0796"
            zeta = "0.707"
            rate_high = "12"
            rate_low = "-12"
            freq_unit = "Hz"
            kp = "100"
            ki = "3200"
            kd = "1"
            N = "714.2857"
            initial_pid_output = "376.99111843"
            up_lim = "1e4"
            low_lim = "-1e4"
            kb = "1"
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "False"
            wn_LPFdq = "62.83185307"
            execution_rate = "inherit"
            enable_pk = "False"
            enable_zero = "True"
            enable_sin = "True"
        }

        "core/Three-phase Meter" {
            R = "1e5"
            n_cycles = "1"
            Ts = "100e-6"
            enable_probes = "True"
            enable_out = "True"
            remove_snubber = "False"
            VAn = "True"
            VBn = "True"
            VCn = "True"
            VAB = "False"
            VBC = "False"
            VCA = "False"
            IA = "True"
            IB = "True"
            IC = "True"
            freq = "False"
            VLn_rms = "False"
            VLL_rms = "False"
            VLn_avg_rms = "False"
            VLL_avg_rms = "False"
            I_rms = "False"
            I_avg_rms = "False"
            P_method = "alpha-beta"
            enable_extra_out = "False"
            P_meas = "False"
        }

        "core/Triple Pole Single Throw Contactor" {
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
        }

        "core/Voltage Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Voltage RMS" {
            op_mode = "PLL based"
            frequency = "50"
            sig_output = "False"
            execution_rate = "inherit"
            feed_forward = "false"
            nd_msr_estimation = "false"
        }

        "core/abc to dq" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "True"
            initial_filter_output = "0"
            wn_LPFdq = "1000"
            execution_rate = "inherit"
        }

        "core/dq to abc" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            execution_rate = "0"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        Ts = 1e-3
        sys_f = 60.0    # Hz
        sys_w = 2.0*np.pi*sys_f    #rad/s
        Ts_ess = 20e-6
        Ts_pv = 20e-6
        
        # Grid specs
        
        R=1e-3
        L=100e-6
        
        # Solar irradiance model parameters
        ang = 0
        ang_z = 20*np.pi/180
        ang_t = 20*np.pi/180
        rho = 0.2
        GHI = 304
        ETR = 346
        
        # EV charging station
        Ts_ev = 200e-6  #s
        #Tbatt = 200e-6
        T_charging_station = 200e-6
        
        ex_rate=200e-6
        #Tprotection = 200e-6
        
        #base values
        Vb = 400     #V
        Pb = 250e3   #W
        fb = 600     #Hz
        
        #filter parameters
        Lf = 1e-6    #H
        Cf = 2000e-6 #F
        
        #machine parameters
        pms = 2      #number of pole pairs 
        Rs = 9e-3    #Ω
        Rr = 15e-3   #Ω
        Lls = 1e-5   #H
        Llr = 1e-5   #H
        Lm = 8e-3    #H
        
        #maximum torque slip lookup table
        f =  [5,   100, 110,  120,   130,  140,  150,   160,   180 , 200,   225,  250,  275,   300,   350,  400,    450,   500  , 550,   600]
        sp = [0.5, 0.5, 0.6, 0.655, 0.804, 0.76, 0.72, 0.681, 0.616, 0.56, 0.506, 0.46, 0.42, 0.387, 0.334, 0.294, 0.262, 0.236, 0.215, 0.197]
        
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        # RMS, phase and power calculation execuiton rate
        Rshunt_msr = 1e4
        
        
        # -------- Calculating R and L values for load ----------
        # --------- Functions definition ---------
        def calc_R(V,P,S):
            R = V**2*P/S**2
            return R
            
        def calc_L(V,Q,S):
            XL = V**2*Q/S**2
            L = XL/(2*np.pi*freq)
            return L
        
        # Constants
        freq = 60.0
        # Phase 1 load configuration
        P1 = 1800000.0/3.0
        pf1 = 0.9
        S1 = P1/pf1
        Q1 = np.sqrt(S1**2-P1**2)
        # Phase 2 load configuration
        P2 = 1800000.0/3.0
        pf2 = 0.9
        S2 = P2/pf2
        Q2 = np.sqrt(S2**2-P2**2)
        # Phase 3 load configuration
        P3 = 1800000.0/3.0
        pf3 = 0.9
        S3 = P3/pf3
        Q3 = np.sqrt(S3**2-P3**2)
        
        # Voltages measured at node 4
        V1_node4 = 1920.0
        V2_node4 = 2054.0
        V3_node4 = 1986.0
        
        # Calulating R and L values 
        R1 = calc_R(V1_node4, P1, S1)
        R2 = calc_R(V2_node4, P2, S2)
        R3 = calc_R(V3_node4, P3, S3)
        
        L1 = calc_L(V1_node4, Q1, S1)
        L2 = calc_L(V2_node4, Q2, S2)
        L3 = calc_L(V3_node4, Q3, S3)
    ENDCODE
}
