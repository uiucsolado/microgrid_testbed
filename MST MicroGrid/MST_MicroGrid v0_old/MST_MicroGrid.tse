version = 4.2

//
// Saved by sw version: 2020.1 SP2
// Save timestamp: 27-Jul-2020 @ 09:45:06 AM
//

model "MST_MicroGrid" {
    configuration {
        hil_device = "HIL603"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = 4e-6
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = True
        cpl_stb = False
        enb_dep_sw_detect = False
        code_section = "external memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 5e-05
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "double precision"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
    }

    component Subsystem Root {
        component Subsystem ESS {
            layout = dynamic
            component "core/Voltage Measurement" Vb {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8400, 8432
                rotation = right
                size = 64, 32
            ]

            component pas_resistor R17 {
                resistance = "1e4"
            }
            [
                position = 8632, 8480
                rotation = right
            ]

            component "core/Voltage Measurement" Vc {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8472, 8480
                rotation = right
                size = 64, 32
            ]

            component pas_resistor R18 {
                resistance = "1e4"
            }
            [
                position = 8568, 8480
                rotation = right
            ]

            component "core/Voltage Measurement" Va {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8328, 8384
                rotation = right
                size = 64, 32
            ]

            component pas_resistor R16 {
                resistance = "1e4"
            }
            [
                position = 8696, 8480
                rotation = right
            ]

            component "core/Current Measurement" ESS_Ia {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8920, 8056
                size = 64, 32
            ]

            component "core/Current Measurement" ESS_Ic {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8824, 8248
                size = 64, 32
            ]

            component "core/Current Measurement" ESS_Ib {
                execution_rate = "Ts"
                sig_output = "True"
            }
            [
                position = 8872, 8152
                size = 64, 32
            ]

            component src_scada_input P_ref_ess {
                def_value = "50"
                execution_rate = "20e-6"
                unit = "kW"
            }
            [
                position = 7816, 8128
            ]

            component src_scada_input Q_ref_ess {
                def_value = "30"
                execution_rate = "20e-6"
                unit = "kVAr"
            }
            [
                position = 7768, 8224
            ]

            component Subsystem "Grid forming inverter (averaged)" {
                layout = dynamic
                component pas_capacitor Cc1 {
                    capacitance = "C_s"
                    initial_voltage = "V_ABC"
                }
                [
                    position = 8320, 8352
                    rotation = right
                ]

                component pas_resistor Rt0a1 {
                    resistance = "R_s"
                }
                [
                    position = 8160, 8256
                    rotation = left
                    scale = -1, 1
                ]

                component pas_resistor Ra1 {
                    resistance = "R_o"
                }
                [
                    position = 8920, 7904
                ]

                component "core/Current Measurement" Ia1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 9168, 7904
                    size = 64, 32
                ]

                component gen_probe Ea_1 {
                }
                [
                    position = 8496, 8176
                ]

                component pas_inductor L0b1 {
                    inductance = "L_i"
                }
                [
                    position = 7888, 8000
                    rotation = down
                ]

                component "core/Voltage Measurement" Vc2 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8000, 8480
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component pas_capacitor Cb1 {
                    capacitance = "C_s"
                    initial_voltage = "V_ABC"
                }
                [
                    position = 8240, 8352
                    rotation = right
                ]

                component Subsystem Controller {
                    layout = dynamic
                    component gen_product Product13 {
                    }
                    [
                        position = 7368, 8464
                        scale = -1, 1
                    ]

                    component gen_gain Gain4 {
                        gain = "1/T_m"
                    }
                    [
                        position = 6992, 8232
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_gain Gain15 {
                        gain = "S"
                    }
                    [
                        position = 7136, 8168
                        rotation = right
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_probe Q1 {
                    }
                    [
                        position = 7072, 8488
                        rotation = down
                    ]

                    component gen_gain Gain6 {
                        gain = "1/I_DQ"
                    }
                    [
                        position = 7856, 7816
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_integrator Integrator2 {
                    }
                    [
                        position = 6896, 8232
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_sum Sum1 {
                    }
                    [
                        position = 7192, 8224
                        scale = -1, 1
                    ]

                    component gen_gain Gain1 {
                        gain = "1/(2*np.pi)"
                    }
                    [
                        position = 8416, 8328
                        scale = -1, 1
                    ]

                    component gen_gain Gain13 {
                        gain = "1/T_m"
                    }
                    [
                        position = 7000, 8376
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_product Product12 {
                    }
                    [
                        position = 7368, 8376
                        scale = -1, 1
                    ]

                    component gen_gain Gain10 {
                        gain = "1/V_DQ"
                    }
                    [
                        position = 7864, 8520
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_gain Gain14 {
                        gain = "S"
                    }
                    [
                        position = 7136, 8456
                        rotation = right
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_bus_join "Bus Join1" {
                        inputs = "3"
                    }
                    [
                        position = 7200, 7952
                        scale = -1, 1
                    ]

                    component gen_gain Gain9 {
                        gain = "1/V_DQ"
                    }
                    [
                        position = 7856, 8392
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_integrator Integrator3 {
                    }
                    [
                        position = 6904, 8376
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_probe E_dREF1 {
                    }
                    [
                        position = 7568, 7848
                    ]

                    component src_constant Constant1 {
                        execution_rate = "Ts"
                        value = "0"
                    }
                    [
                        position = 7912, 8776
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_sum Sum2 {
                        signs = "+-"
                    }
                    [
                        position = 7192, 8368
                        scale = -1, 1
                    ]

                    component gen_product Product10 {
                    }
                    [
                        position = 7368, 8296
                        scale = -1, 1
                    ]

                    component Subsystem Current_abc_to_dq {
                        layout = dynamic
                        component "core/abc to dq" "abc to dq1" {
                        }
                        [
                            position = 7856, 8008
                            size = 48, 80
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7952, 8064
                        ]

                        port Xi_d2 {
                            label = "Xi_d2"
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 7976
                        ]

                        port Xi_c2 {
                            label = "Xi_c2"
                            position = right:5
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8040
                        ]

                        port wt2 {
                            label = "wt2"
                            position = right:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8088
                        ]

                        port Xi_a2 {
                            label = "Xi_a2"
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 7960
                        ]

                        port Xi_q2 {
                            label = "Xi_q2"
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8016
                        ]

                        port Xi_b2 {
                            label = "Xi_b2"
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8000
                        ]

                        connect Xi_c2 "abc to dq1.vc" as Connection3
                        connect "abc to dq1.q_axis" Xi_q2 as Connection6
                        connect "abc to dq1.d_axis" Xi_d2 as Connection5
                        connect wt2 "abc to dq1.wt" as Connection7
                        connect Xi_a2 "abc to dq1.va" as Connection1
                        connect Xi_b2 "abc to dq1.vb" as Connection2
                        connect Termination1.in "abc to dq1.zero_axis" as Connection4
                    }
                    [
                        position = 7936, 7880
                        size = 80, 168
                    ]

                    component gen_gain Gain7 {
                        gain = "1/I_DQ"
                    }
                    [
                        position = 7856, 7944
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_gain Gain12 {
                        gain = "1/I_DQ"
                    }
                    [
                        position = 7384, 8744
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_product Product111 {
                    }
                    [
                        position = 7368, 8216
                        scale = -1, 1
                    ]

                    component gen_sum Sum4 {
                        signs = "+-"
                    }
                    [
                        position = 7072, 8232
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_gain Gain11 {
                        gain = "1/I_DQ"
                    }
                    [
                        position = 7384, 8616
                        hide_name = True
                        scale = -1, -1
                    ]

                    component gen_probe E_qREF1 {
                    }
                    [
                        position = 7568, 8056
                    ]

                    component Subsystem Current_abc_to_dq3 {
                        layout = dynamic
                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7952, 8064
                        ]

                        component "core/abc to dq" "abc to dq1" {
                        }
                        [
                            position = 7856, 8008
                            size = 48, 80
                        ]

                        port "^Ec2" {
                            label = "^Ec2"
                            position = right:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8040
                        ]

                        port "^Ed2" {
                            label = "^Ed2"
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 7976
                        ]

                        port "^Eb2" {
                            label = "^Eb2"
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8000
                        ]

                        port "^Ea2" {
                            label = "^Ea2"
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 7960
                        ]

                        port wt2 {
                            label = "wt2"
                            position = right:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8088
                        ]

                        port "^Eq2" {
                            label = "^Eq2"
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8016
                        ]

                        connect Termination1.in "abc to dq1.zero_axis" as Connection4
                        connect "abc to dq1.q_axis" "^Eq2" as Connection6
                        connect wt2 "abc to dq1.wt" as Connection7
                        connect "abc to dq1.d_axis" "^Ed2" as Connection5
                        connect "^Eb2" "abc to dq1.vb" as Connection2
                        connect "^Ea2" "abc to dq1.va" as Connection1
                        connect "^Ec2" "abc to dq1.vc" as Connection3
                    }
                    [
                        position = 7936, 8456
                        size = 80, 168
                    ]

                    component gen_probe f1 {
                    }
                    [
                        position = 8328, 8328
                        rotation = down
                    ]

                    component Subsystem Current_abc_to_dq4 {
                        layout = dynamic
                        component "core/abc to dq" "abc to dq1" {
                        }
                        [
                            position = 7856, 8008
                            size = 48, 80
                        ]

                        component gen_terminator Termination1 {
                        }
                        [
                            position = 7952, 8064
                        ]

                        port wt2 {
                            label = "wt2"
                            position = right:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8088
                        ]

                        port "^Eq2" {
                            label = "^Eq2"
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8016
                        ]

                        port "^Ea2" {
                            label = "^Ea2"
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 7960
                        ]

                        port "^Eb2" {
                            label = "^Eb2"
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8000
                        ]

                        port "^Ec2" {
                            label = "^Ec2"
                            position = right:6
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8040
                        ]

                        port "^Ed2" {
                            label = "^Ed2"
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 7976
                        ]

                        connect "abc to dq1.q_axis" "^Eq2" as Connection6
                        connect wt2 "abc to dq1.wt" as Connection7
                        connect "abc to dq1.d_axis" "^Ed2" as Connection5
                        connect "^Ea2" "abc to dq1.va" as Connection1
                        connect "^Ec2" "abc to dq1.vc" as Connection3
                        connect Termination1.in "abc to dq1.zero_axis" as Connection4
                        connect "^Eb2" "abc to dq1.vb" as Connection2
                    }
                    [
                        position = 7480, 8680
                        size = 80, 168
                    ]

                    component gen_sum Sum5 {
                        signs = "+-"
                    }
                    [
                        position = 7080, 8376
                        hide_name = True
                        scale = -1, 1
                    ]

                    component gen_probe P1 {
                    }
                    [
                        position = 7080, 8136
                        rotation = down
                    ]

                    component Subsystem "Outer Voltage Loop + Inner Current Loop" {
                        layout = dynamic
                        component Subsystem "Outer voltage control loop" {
                            layout = dynamic
                            component gen_sum Sum12 {
                                signs = "++"
                            }
                            [
                                position = 7792, 8512
                                scale = -1, 1
                            ]

                            component gen_gain Gain4 {
                                gain = "C_s*Z_DQ"
                            }
                            [
                                position = 8248, 8352
                                scale = -1, 1
                            ]

                            component gen_sum Sum8 {
                                signs = "+-"
                            }
                            [
                                position = 8376, 8168
                                scale = -1, 1
                            ]

                            component gen_product Product8 {
                            }
                            [
                                position = 8144, 8808
                                scale = -1, 1
                            ]

                            component gen_sum Sum10 {
                                signs = "+-"
                            }
                            [
                                position = 7952, 8248
                                scale = -1, 1
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 8152, 8320
                                scale = -1, 1
                            ]

                            component gen_sum Sum11 {
                                signs = "+-"
                            }
                            [
                                position = 8376, 8504
                                scale = -1, 1
                            ]

                            component gen_probe Ed_err {
                            }
                            [
                                position = 8376, 8104
                            ]

                            component gen_gain Gain6 {
                                gain = "C_s*Z_DQ"
                            }
                            [
                                position = 8248, 8840
                                scale = -1, 1
                            ]

                            component gen_pid_controller "PID controller4" {
                                controller_type = "PI"
                                enb_anti_windup_out = "True"
                                enb_output_limit_out = "True"
                                ki = "Ki_V"
                                kp = "Kp_V"
                                lower_sat_lim = "Vmin"
                                upper_sat_lim = "Vmax"
                            }
                            [
                                position = 8088, 8504
                                scale = -1, 1
                            ]

                            component gen_sum Sum13 {
                                signs = "++"
                            }
                            [
                                position = 7936, 8712
                                scale = -1, 1
                            ]

                            component gen_sum Sum9 {
                                signs = "++"
                            }
                            [
                                position = 7800, 8176
                                scale = -1, 1
                            ]

                            component gen_pid_controller "PID controller3" {
                                controller_type = "PI"
                                enb_anti_windup_out = "True"
                                enb_output_limit_out = "True"
                                execution_rate = "Ts"
                                ki = "Ki_V"
                                kp = "Kp_V"
                                lower_sat_lim = "Vmin"
                                upper_sat_lim = "Vmax"
                            }
                            [
                                position = 8112, 8104
                                scale = -1, 1
                            ]

                            component gen_probe Eq_err {
                            }
                            [
                                position = 8376, 8440
                            ]

                            component gen_probe ED_ctrl {
                            }
                            [
                                position = 8040, 8048
                            ]

                            component gen_probe EQ_ctrl {
                            }
                            [
                                position = 8000, 8456
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 8200, 8104
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit2 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 8176, 8504
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 7728, 8176
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit4 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 7712, 8512
                                hide_name = True
                                scale = -1, 1
                            ]

                            port Xi_rd {
                                position = auto:auto
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7664, 8176
                                scale = -1, 1
                            ]

                            port Xi_rq {
                                position = auto:auto
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7632, 8512
                                scale = -1, 1
                            ]

                            port "^E_q_ref" {
                                label = "^E_q_ref1"
                                position = auto:auto
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8440
                                scale = -1, 1
                            ]

                            port "^E_d_ref" {
                                label = "^E_d_ref1"
                                position = auto:auto
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8544, 8104
                                scale = -1, 1
                            ]

                            port "^E_q" {
                                label = "^E_q1"
                                position = auto:auto
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8600, 8512
                                scale = -1, 1
                            ]

                            port "^E_d" {
                                label = "^E_d1"
                                position = auto:auto
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8616, 8176
                                scale = -1, 1
                            ]

                            tag From33 {
                                value = "w"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8280, 8280
                                scale = -1, 1
                            ]

                            tag From35 {
                                value = "w"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8280, 8768
                                scale = -1, 1
                            ]

                            tag From32 {
                                value = "Id"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8384, 8240
                                scale = -1, 1
                            ]

                            tag From36 {
                                value = "Iq"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8376, 8688
                                scale = -1, 1
                            ]

                            junction Junction174 sp
                            [
                                position = 7968, 8104
                            ]

                            junction Junction175 sp
                            [
                                position = 7960, 8496
                            ]

                            junction Junction176 sp
                            [
                                position = 8480, 8176
                            ]

                            junction Junction177 sp
                            [
                                position = 8448, 8512
                            ]

                            junction Junction178 sp
                            [
                                position = 8336, 8104
                            ]

                            junction Junction179 sp
                            [
                                position = 8336, 8504
                            ]

                            connect "^E_d_ref" Sum8.in as Connection215
                            connect Sum11.in "^E_q_ref" as Connection217
                            connect Sum13.in1 Product8.out as Connection233
                            connect From32 Sum10.in as Connection259
                            connect Gain6.out Product8.in1 as Connection84
                            connect From33 Product6.in as Connection68
                            connect Sum10.in1 Product6.out as Connection67
                            connect From36 Sum13.in as Connection260
                            connect From35 Product8.in as Connection79
                            connect Gain4.out Product6.in1 as Connection69
                            connect "PID controller3.out" Junction174 as Connection311
                            [
                                breakpoints = 8072, 8104
                            ]
                            connect Junction174 ED_ctrl.in as Connection312
                            [
                                breakpoints = 7968, 8104
                            ]
                            connect Sum9.in Junction174 as Connection313
                            connect EQ_ctrl.in Junction175 as Connection320
                            connect Junction175 "PID controller4.out" as Connection321
                            [
                                breakpoints = 7960, 8504; 7960, 8504; 8024, 8504
                            ]
                            connect Sum12.in Junction175 as Connection322
                            connect "PID controller3.in" Limit1.out as Connection331
                            connect Limit2.out "PID controller4.in" as Connection334
                            connect Gain6.in Junction176 as Connection340
                            connect Junction176 Sum8.in1 as Connection341
                            [
                                breakpoints = 8480, 8176
                            ]
                            connect "^E_d" Junction176 as Connection342
                            connect Gain4.in Junction177 as Connection344
                            connect Junction177 Sum11.in1 as Connection345
                            [
                                breakpoints = 8448, 8512
                            ]
                            connect "^E_q" Junction177 as Connection346
                            connect Ed_err.in Junction178 as Connection348
                            connect Junction178 Sum8.out as Connection349
                            [
                                breakpoints = 8336, 8168; 8336, 8168
                            ]
                            connect Limit1.in Junction178 as Connection350
                            connect Sum11.out Junction179 as Connection352
                            connect Junction179 Eq_err.in as Connection353
                            [
                                breakpoints = 8336, 8504
                            ]
                            connect Limit2.in Junction179 as Connection354
                            connect Sum9.in1 Sum10.out as Connection357
                            connect Sum12.in1 Sum13.out as Connection358
                            connect Xi_rd Limit3.out as Connection359
                            connect Limit3.in Sum9.out as Connection360
                            connect Xi_rq Limit4.out as Connection361
                            connect Limit4.in Sum12.out as Connection362
                        }
                        [
                            position = 8808, 8400
                            scale = -1, 1
                            size = 152, 168
                        ]

                        component gen_gain Gain5 {
                            gain = "V_DQ"
                        }
                        [
                            position = 8032, 8560
                            hide_name = True
                            scale = -1, -1
                        ]

                        component gen_sum Sum7 {
                        }
                        [
                            position = 9176, 8552
                            scale = -1, 1
                        ]

                        component gen_sum Sum10 {
                            signs = "+-"
                        }
                        [
                            position = 9416, 8496
                            scale = -1, 1
                        ]

                        component gen_sum Sum11 {
                            signs = "+-"
                        }
                        [
                            position = 9424, 8192
                            scale = -1, 1
                        ]

                        component gen_gain Gain6 {
                            gain = "V_DQ"
                        }
                        [
                            position = 8064, 8624
                            hide_name = True
                            scale = -1, -1
                        ]

                        component gen_gain Gain3 {
                            gain = "R_s/Z_DQ"
                        }
                        [
                            position = 9320, 8496
                            scale = -1, 1
                        ]

                        component gen_sum Sum8 {
                        }
                        [
                            position = 9208, 8232
                            scale = -1, 1
                        ]

                        component Subsystem "dq to abc" {
                            layout = dynamic
                            component src_constant o_ref {
                                execution_rate = "Ts"
                                value = "[0]"
                            }
                            [
                                position = 7520, 8200
                            ]

                            component "core/dq to abc" "dq to abc1" {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7744, 8184
                                size = 48, 80
                            ]

                            port c {
                                label = "c"
                                position = left:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7864, 8216
                            ]

                            port d {
                                label = "Ud1"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7520, 8136
                            ]

                            port alpha {
                                label = "alpha1"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7600, 8232
                            ]

                            port a {
                                label = "a"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7864, 8152
                            ]

                            port q {
                                label = "Uq1"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7472, 8168
                            ]

                            port b {
                                label = "b"
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7896, 8184
                            ]

                            connect q "dq to abc1.q_input" as Connection6
                            connect d "dq to abc1.d_input" as Connection3
                            connect "dq to abc1.phase_b" b as Connection4
                            connect c "dq to abc1.phase_c" as Connection2
                            connect a "dq to abc1.phase_a" as Connection1
                            connect o_ref.out "dq to abc1.zero_input" as Connection5
                            connect alpha "dq to abc1.wt" as Connection7
                        }
                        [
                            position = 7912, 8624
                            size = 80, 168
                        ]

                        component gen_gain Gain4 {
                            gain = "R_s/Z_DQ"
                        }
                        [
                            position = 9328, 8192
                            scale = -1, 1
                        ]

                        component Subsystem "inner current control loop" {
                            layout = dynamic
                            component gen_gain Gain7 {
                                gain = "L_i/Z_DQ"
                            }
                            [
                                position = 8272, 8592
                                scale = -1, 1
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 7760, 8048
                                scale = -1, 1
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 8024, 8104
                                scale = -1, 1
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 7760, 8400
                                scale = -1, 1
                            ]

                            component gen_sum Sum6 {
                            }
                            [
                                position = 8032, 8408
                                scale = -1, 1
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 8168, 8560
                                scale = -1, 1
                            ]

                            component gen_gain Gain6 {
                                gain = "L_i/Z_DQ"
                            }
                            [
                                position = 8256, 8240
                                scale = -1, 1
                            ]

                            component gen_sum Sum8 {
                                signs = "+-"
                            }
                            [
                                position = 8432, 8040
                                scale = -1, 1
                            ]

                            component gen_sum Sum9 {
                                signs = "+-"
                            }
                            [
                                position = 8424, 8376
                                scale = -1, 1
                            ]

                            component gen_gain Gain5 {
                                gain = "[0.5]"
                            }
                            [
                                position = 7720, 8600
                                scale = -1, 1
                            ]

                            component gen_pid_controller "PID controller1" {
                                controller_type = "PI"
                                enb_anti_windup_out = "True"
                                enb_output_limit_out = "True"
                                ki = "Ki_I/Z_DQ"
                                kp = "Kp_I/Z_DQ"
                                lower_sat_lim = "Imin"
                                upper_sat_lim = "Imax"
                            }
                            [
                                position = 8200, 8040
                                scale = -1, 1
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 8168, 8208
                                scale = -1, 1
                            ]

                            component gen_probe id_err {
                            }
                            [
                                position = 8544, 7960
                            ]

                            component gen_probe iq_err {
                            }
                            [
                                position = 8560, 8272
                            ]

                            component gen_z_domain_transfer "Discrete Transfer Function1" {
                                a_coeff = "[1e-6,1]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8144, 7920
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_z_domain_transfer "Discrete Transfer Function2" {
                                a_coeff = "[1e-6,1]"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8120, 8296
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_product Product5 {
                                signs = "*/"
                            }
                            [
                                position = 7600, 8056
                                scale = -1, 1
                            ]

                            component gen_product Product6 {
                                signs = "*/"
                            }
                            [
                                position = 7600, 8408
                                scale = -1, 1
                            ]

                            component gen_pid_controller "PID controller2" {
                                controller_type = "PI"
                                enb_anti_windup_out = "True"
                                enb_output_limit_out = "True"
                                ki = "Ki_I/Z_DQ"
                                kp = "Kp_I/Z_DQ"
                                lower_sat_lim = "Imin"
                                upper_sat_lim = "Imax"
                            }
                            [
                                position = 8200, 8376
                                scale = -1, 1
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 7488, 8056
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit2 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 7472, 8408
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_z_domain_transfer LPF_dc {
                                a_coeff = "[1.0/(2*np.pi*1),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 8000, 8696
                                scale = -1, 1
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "10"
                            }
                            [
                                position = 7888, 8696
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit4 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 8288, 8040
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit5 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 8280, 8376
                                hide_name = True
                                scale = -1, 1
                            ]

                            port Uq1 {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7376, 8408
                                rotation = down
                            ]

                            port Xi_q_meas1 {
                                label = "Xi_q_meas1"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8560, 8400
                                rotation = down
                            ]

                            port Xi_q_ref1 {
                                label = "Xi_q_ref1"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8624, 8352
                                rotation = down
                            ]

                            port Ud1 {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7376, 8056
                                rotation = down
                            ]

                            port Xi_d_ref1 {
                                label = "Xi_d_ref1"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8544, 8032
                                rotation = down
                            ]

                            port Xi_d_meas1 {
                                label = "Xi_d_meas1"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8544, 8112
                                rotation = down
                            ]

                            tag From23 {
                                value = "w"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8272, 8176
                                scale = -1, 1
                                size = 60, 20
                            ]

                            tag From24 {
                                value = "Ed"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 7920
                                scale = -1, 1
                                size = 60, 20
                            ]

                            tag From26 {
                                value = "Eq"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8208, 8296
                                scale = -1, 1
                                size = 60, 20
                            ]

                            tag From27 {
                                value = "VDC"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8128, 8696
                                scale = -1, 1
                                size = 60, 20
                            ]

                            tag From25 {
                                value = "w"
                                scope = masked_subsystem
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8288, 8536
                                scale = -1, 1
                                size = 60, 20
                            ]

                            junction Junction177 sp
                            [
                                position = 8504, 8112
                            ]

                            junction Junction176 sp
                            [
                                position = 8504, 8384
                            ]

                            junction Junction181 sp
                            [
                                position = 8344, 8040
                            ]

                            junction Junction182 sp
                            [
                                position = 7640, 8416
                            ]

                            junction Junction183 sp
                            [
                                position = 8344, 8376
                            ]

                            connect From23 Product1.in as Connection1
                            connect Sum5.in1 Product1.out as Connection24
                            connect Gain6.out Product1.in1 as Connection289
                            connect Junction177 Gain7.in as Connection300
                            connect Gain7.out Product2.in1 as Connection293
                            connect Xi_q_meas1 Junction176 as Connection290
                            connect Sum6.in1 Product2.out as Connection26
                            connect Junction176 Sum9.in1 as Connection291
                            [
                                breakpoints = 8504, 8368; 8504, 8384
                            ]
                            connect Sum8.in1 Junction177 as Connection301
                            connect From25 Product2.in as Connection2
                            connect Sum8.in Xi_d_ref1 as Connection297
                            connect Sum9.in Xi_q_ref1 as Connection283
                            [
                                breakpoints = 8464, 8352; 8528, 8352
                            ]
                            connect Gain6.in Junction176 as Connection292
                            connect Xi_d_meas1 Junction177 as Connection299
                            connect Sum8.out Junction181 as Connection313
                            connect id_err.in Junction181 as Connection315
                            [
                                breakpoints = 8344, 7960; 8344, 8040
                            ]
                            connect Sum3.in "PID controller1.out" as Connection316
                            [
                                breakpoints = 7896, 8040; 8160, 8040; 8160, 8040
                            ]
                            connect Sum5.in "Discrete Transfer Function1.out" as Connection318
                            [
                                breakpoints = 8088, 8096; 8088, 7920
                            ]
                            connect "Discrete Transfer Function1.in" From24 as Connection319
                            connect From26 "Discrete Transfer Function2.in" as Connection320
                            connect "Discrete Transfer Function2.out" Sum6.in as Connection321
                            connect Product5.in Sum3.out as Connection322
                            connect Product6.in Sum7.out as Connection324
                            connect Sum7.in1 Sum6.out as Connection326
                            connect Sum5.out Sum3.in1 as Connection327
                            connect Gain5.out Junction182 as Connection329
                            connect Junction182 Product6.in1 as Connection330
                            connect Product5.in1 Junction182 as Connection331
                            connect "PID controller2.out" Sum7.in as Connection346
                            connect Sum9.out Junction183 as Connection349
                            connect Junction183 iq_err.in as Connection350
                            [
                                breakpoints = 8344, 8360; 8344, 8272
                            ]
                            connect Product5.out Limit1.in as Connection352
                            connect Limit1.out Ud1 as Connection353
                            connect Product6.out Limit2.in as Connection354
                            connect Limit2.out Uq1 as Connection355
                            connect From27 LPF_dc.in as Connection356
                            connect LPF_dc.out Limit3.in as Connection357
                            connect Limit3.out Gain5.in as Connection358
                            connect Junction181 Limit4.in as Connection359
                            connect Limit4.out "PID controller1.in" as Connection360
                            connect "PID controller2.in" Limit5.out as Connection361
                            connect Limit5.in Junction183 as Connection362
                        }
                        [
                            position = 8176, 8592
                            size = 96, 184
                        ]

                        component gen_probe Xi_d_ref {
                        }
                        [
                            position = 8216, 8416
                            rotation = down
                        ]

                        component gen_probe Xi_q_ref {
                        }
                        [
                            position = 8256, 8768
                            rotation = down
                        ]

                        component gen_probe Ud {
                        }
                        [
                            position = 7912, 8456
                            scale = -1, 1
                        ]

                        component gen_probe Uq {
                        }
                        [
                            position = 7984, 8672
                            scale = -1, 1
                        ]

                        component gen_probe Eq_ref {
                        }
                        [
                            position = 9032, 8176
                            rotation = down
                        ]

                        component gen_probe Ed_ref {
                        }
                        [
                            position = 9016, 8544
                            rotation = down
                        ]

                        component gen_probe alpha {
                        }
                        [
                            position = 7984, 8768
                            scale = -1, 1
                        ]

                        component Subsystem "outer power loop" {
                            layout = dynamic
                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 8232, 8072
                                scale = -1, 1
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 8120, 8080
                                scale = -1, 1
                            ]

                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 8120, 8168
                                scale = -1, 1
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 8440, 8080
                                scale = -1, 1
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 8232, 8160
                                scale = -1, 1
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 8440, 8152
                                scale = -1, 1
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 8440, 8008
                                scale = -1, 1
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 8440, 8224
                                scale = -1, 1
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 8424, 8344
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 8048, 8080
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_limiter Limit4 {
                                lower_limit = "[-1]"
                                upper_limit = "[1]"
                            }
                            [
                                position = 8048, 8168
                                hide_name = True
                                scale = -1, 1
                            ]

                            port Q_ref {
                                label = "Q_ref"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8648, 8216
                                rotation = down
                            ]

                            port Eq {
                                label = "Eq"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8648, 8000
                                rotation = down
                            ]

                            port Xi_rq {
                                label = "Xi_rq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7984, 8080
                                rotation = down
                            ]

                            port Et_p2 {
                                label = "Et^2"
                                position = right:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8512, 8344
                                rotation = down
                            ]

                            port Ed {
                                label = "Ed"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8648, 8072
                                rotation = down
                            ]

                            port P_ref {
                                label = "P_ref"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8648, 8144
                                rotation = down
                            ]

                            port Xi_rd {
                                label = "Xi_rd"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7984, 8168
                                rotation = down
                            ]

                            junction Junction142 sp
                            [
                                position = 8528, 8072
                            ]

                            junction Junction143 sp
                            [
                                position = 8544, 8000
                            ]

                            junction Junction139 sp
                            [
                                position = 8568, 8144
                            ]

                            junction Junction141 sp
                            [
                                position = 8560, 8216
                            ]

                            junction Junction144 sp
                            [
                                position = 8160, 8176
                            ]

                            connect Product1.in Sum3.out as Connection23
                            connect Product6.in1 Junction143 as Connection36
                            connect Product3.out Sum3.in as Connection28
                            connect Product6.out Sum4.in1 as Connection37
                            connect Product4.in1 Junction141 as Connection29
                            connect Product4.in Junction142 as Connection30
                            connect Junction141 Q_ref as Connection11
                            connect Product4.out Sum3.in1 as Connection31
                            connect Junction142 Ed as Connection12
                            connect Eq Junction143 as Connection3
                            connect Junction143 Product3.in as Connection13
                            connect Product5.in Junction139 as Connection32
                            connect Product5.in1 Junction142 as Connection33
                            connect Product5.out Sum4.in as Connection34
                            connect Product6.in Junction141 as Connection35
                            connect Product2.in Sum4.out as Connection26
                            connect Product3.in1 Junction139 as Connection27
                            connect P_ref Junction139 as Connection48
                            [
                                breakpoints = 8600, 8144
                            ]
                            connect Product1.in1 Junction144 as Connection273
                            connect Junction144 Product2.in1 as Connection274
                            [
                                breakpoints = 8160, 8176
                            ]
                            connect Limit3.out Junction144 as Connection275
                            connect Et_p2 Limit3.in as Connection276
                            connect Xi_rq Limit1.out as Connection277
                            connect Limit1.in Product1.out as Connection278
                            connect Xi_rd Limit4.out as Connection279
                            connect Limit4.in Product2.out as Connection280
                        }
                        [
                            position = 8840, 8784
                            size = 176, 128
                        ]

                        component Subsystem squared_Vt2 {
                            layout = dynamic
                            component gen_product Product1 {
                            }
                            [
                                position = 8208, 8160
                                scale = -1, 1
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 8104, 8192
                                scale = -1, 1
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 8208, 8232
                                scale = -1, 1
                            ]

                            port Et_p2 {
                                label = "Et^2"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8032, 8192
                                rotation = down
                            ]

                            port Eq {
                                label = "Eq"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8328, 8224
                                rotation = down
                            ]

                            port Ed {
                                label = "Ed"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8328, 8152
                                rotation = down
                            ]

                            junction Junction137 sp
                            [
                                position = 8280, 8224
                            ]

                            junction Junction136 sp
                            [
                                position = 8280, 8152
                            ]

                            connect Junction137 Eq as Connection3
                            connect Product2.in Junction137 as Connection6
                            connect Sum3.in Product1.out as Connection8
                            connect Junction136 Ed as Connection1
                            connect Product1.in1 Junction136 as Connection4
                            connect Sum3.in1 Product2.out as Connection9
                            connect Product2.in1 Junction137 as Connection5
                            connect Sum3.out Et_p2 as Connection7
                            connect Junction136 Product1.in as Connection2
                        }
                        [
                            position = 8992, 8848
                            size = 48, 56
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl != threshold"
                            threshold = "1"
                        }
                        [
                            position = 8496, 8576
                            hide_name = True
                            scale = -1, -1
                        ]

                        component gen_bus_join "Bus Join1" {
                        }
                        [
                            position = 8616, 8400
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_bus_split "Bus Split1" {
                        }
                        [
                            position = 8392, 8576
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_bus_join "Bus Join2" {
                        }
                        [
                            position = 8616, 8776
                            hide_name = True
                            scale = -1, 1
                        ]

                        component src_scada_input GFM_mode {
                            execution_rate = "Ts"
                            format = "int"
                            max = "1"
                            min = "0"
                            signal_type = "int"
                            unit = ""
                        }
                        [
                            position = 8536, 8856
                            rotation = left
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "OR"
                        }
                        [
                            position = 8496, 8720
                            rotation = left
                            hide_name = True
                        ]

                        port Ua {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8560
                            rotation = down
                        ]

                        port E_q_ref1 {
                            label = "E_q_ref1"
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9472, 8304
                            rotation = down
                        ]

                        port Uc {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8688
                            rotation = down
                        ]

                        port E_d_ref1 {
                            label = "E_d_ref1"
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9456, 8632
                            rotation = down
                        ]

                        port Ub {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7824, 8624
                            rotation = down
                        ]

                        tag From36 {
                            value = "E_q1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8992, 8416
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag From29 {
                            value = "Xi_d"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8288, 8568
                            scale = -1, 1
                        ]

                        tag From40 {
                            value = "Xi_q"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9536, 8232
                            rotation = down
                        ]

                        tag From38 {
                            value = "Id"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9536, 8448
                            rotation = down
                            size = 56, 20
                        ]

                        tag From1 {
                            value = "wt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8176, 8728
                            scale = -1, 1
                            size = 63, 25
                        ]

                        tag From30 {
                            value = "Xi_q"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8288, 8664
                            scale = -1, 1
                        ]

                        tag From31 {
                            value = "Iq"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9536, 8152
                            rotation = down
                        ]

                        tag From39 {
                            value = "Xi_d"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9536, 8544
                            rotation = down
                        ]

                        tag From37 {
                            value = "E_d1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8992, 8464
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag From20 {
                            value = "Ed"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9152, 8784
                            hide_name = True
                            scale = -1, 1
                            size = 67, 20
                        ]

                        tag From41 {
                            value = "Eq"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9152, 8816
                            hide_name = True
                            scale = -1, 1
                            size = 67, 20
                        ]

                        tag From42 {
                            value = "Pref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9064, 8728
                            hide_name = True
                            scale = -1, 1
                            size = 67, 20
                        ]

                        tag From43 {
                            value = "Qref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9064, 8760
                            hide_name = True
                            scale = -1, 1
                            size = 67, 20
                        ]

                        tag From44 {
                            value = "Island"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8480, 8864
                            rotation = left
                            hide_name = True
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag Goto21 {
                            value = "GFM_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8400, 8664
                            scale = -1, 1
                        ]

                        junction Junction3 sp
                        [
                            position = 7984, 8560
                        ]

                        junction Junction4 sp
                        [
                            position = 8032, 8624
                        ]

                        junction Junction7 sp
                        [
                            position = 9112, 8232
                        ]

                        junction Junction9 sp
                        [
                            position = 8080, 8728
                        ]

                        junction Junction10 sp
                        [
                            position = 8296, 8520
                        ]

                        junction Junction11 sp
                        [
                            position = 8336, 8616
                        ]

                        junction Junction12 sp
                        [
                            position = 9136, 8544
                        ]

                        junction Junction13 sp
                        [
                            position = 9064, 8784
                        ]

                        junction Junction14 sp
                        [
                            position = 9088, 8816
                        ]

                        junction Junction15 sp
                        [
                            position = 8496, 8664
                        ]

                        connect Sum11.out Gain4.in as Connection290
                        connect From31 Sum11.in as Connection293
                        connect From29 "inner current control loop.Xi_d_meas1" as Connection253
                        connect Sum7.in1 E_d_ref1 as Connection324
                        connect From30 "inner current control loop.Xi_q_meas1" as Connection257
                        connect Sum10.out Gain3.in as Connection287
                        connect "dq to abc.c" Uc as Connection284
                        connect "dq to abc.b" Ub as Connection282
                        connect Gain6.in "inner current control loop.Uq1" as Connection346
                        [
                            breakpoints = 8112, 8664
                        ]
                        connect From40 Sum11.in1 as Connection294
                        connect From39 Sum10.in1 as Connection286
                        connect E_q_ref1 Sum8.in1 as Connection344
                        connect "dq to abc.a" Ua as Connection283
                        connect Gain5.in "inner current control loop.Ud1" as Connection345
                        [
                            breakpoints = 8112, 8520
                        ]
                        connect Gain3.out Sum7.in as Connection289
                        connect Gain4.out Sum8.in as Connection343
                        connect From38 Sum10.in as Connection285
                        connect "dq to abc.d" Junction3 as Connection374
                        connect Junction3 Gain5.out as Connection375
                        connect Ud.in Junction3 as Connection376
                        connect "dq to abc.q" Junction4 as Connection377
                        connect Junction4 Gain6.out as Connection378
                        connect Uq.in Junction4 as Connection379
                        connect Sum8.out Junction7 as Connection398
                        connect Junction7 "Outer voltage control loop.^E_q_ref" as Connection399
                        [
                            breakpoints = 9112, 8232
                        ]
                        connect Eq_ref.in Junction7 as Connection400
                        connect From36 "Outer voltage control loop.^E_q" as Connection404
                        connect From37 "Outer voltage control loop.^E_d" as Connection405
                        connect "dq to abc.alpha" Junction9 as Connection406
                        [
                            breakpoints = 7968, 8728
                        ]
                        connect Junction9 From1 as Connection407
                        [
                            breakpoints = 8112, 8728
                        ]
                        connect alpha.in Junction9 as Connection408
                        connect squared_Vt2.Et_p2 "outer power loop.Et_p2" as Connection359
                        connect "Bus Join1.in" "Outer voltage control loop.Xi_rd" as Connection412
                        connect "Bus Join1.in1" "Outer voltage control loop.Xi_rq" as Connection413
                        connect Xi_d_ref.in Junction10 as Connection414
                        [
                            breakpoints = 8296, 8504
                        ]
                        connect Junction10 "inner current control loop.Xi_d_ref1" as Connection415
                        [
                            breakpoints = 8288, 8520
                        ]
                        connect "Bus Split1.out" Junction10 as Connection416
                        [
                            breakpoints = 8344, 8568; 8344, 8520
                        ]
                        connect "inner current control loop.Xi_q_ref1" Junction11 as Connection417
                        connect Junction11 Xi_q_ref.in as Connection418
                        [
                            breakpoints = 8336, 8632; 8336, 8632
                        ]
                        connect "Bus Split1.out1" Junction11 as Connection419
                        connect "Bus Join2.in" "outer power loop.Xi_rd" as Connection420
                        connect "Bus Join2.in1" "outer power loop.Xi_rq" as Connection421
                        connect "Signal switch2.in1" "Bus Join1.out" as Connection422
                        connect "Signal switch2.in" "Bus Join2.out" as Connection423
                        connect "Bus Split1.in" "Signal switch2.out" as Connection424
                        connect "Outer voltage control loop.^E_d_ref" Junction12 as Connection426
                        [
                            breakpoints = 9136, 8384; 9136, 8384
                        ]
                        connect Junction12 Sum7.out as Connection427
                        connect Ed_ref.in Junction12 as Connection428
                        connect From42 "outer power loop.P_ref" as Connection431
                        connect From43 "outer power loop.Q_ref" as Connection432
                        connect From20 Junction13 as Connection433
                        connect Junction13 "outer power loop.Ed" as Connection434
                        connect squared_Vt2.Ed Junction13 as Connection435
                        connect From41 Junction14 as Connection436
                        connect Junction14 "outer power loop.Eq" as Connection437
                        [
                            breakpoints = 9088, 8816; 9032, 8816
                        ]
                        connect squared_Vt2.Eq Junction14 as Connection438
                        connect "Logical operator1.in" From44 as Connection440
                        connect "Logical operator1.in1" GFM_mode.out as Connection441
                        connect "Logical operator1.out" Junction15 as Connection442
                        connect Junction15 "Signal switch2.in2" as Connection443
                        connect Goto21 Junction15 as Connection444
                    }
                    [
                        position = 7360, 7952
                        size = 128, 152
                    ]

                    component gen_limiter Limit1 {
                        lower_limit = "[-0.8,-0.8,-0.8]"
                        upper_limit = "[0.8,0.8,0.8]"
                    }
                    [
                        position = 7128, 7952
                        hide_name = True
                        scale = -1, 1
                    ]

                    component Subsystem "Frequency droop" {
                        layout = dynamic
                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 8160, 8120
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_sum Sum4 {
                            signs = "++"
                        }
                        [
                            position = 7880, 8216
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_gain Gain3 {
                            gain = "1/D_f"
                        }
                        [
                            position = 8088, 8120
                            hide_name = True
                            scale = -1, 1
                        ]

                        component src_clock Clock1 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8112, 8168
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_c_function "C function1" {
                            in_terminal_dimensions = "1;1"
                            in_terminal_dimensions_str = "in 1;clk 1"
                            in_terminal_labels = "[(\'in\', True), (\'clk\', True)]"
                            in_terminal_properties = "real in;inherit clk;"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "[(\'out\', False)]"
                            output_fnc = "/*Begin code section*/
if (clk>120){
    out = in;
}
else{out=0;}
out = in;
/*End code section*/"
                        }
                        [
                            position = 8000, 8128
                            hide_name = True
                            scale = -1, 1
                            size = 48, 48
                        ]

                        component gen_c_function "C function2" {
                            global_variables = "real time;int connected;"
                            in_terminal_dimensions = "1;1;1"
                            in_terminal_dimensions_str = "in 1;clk 1;cnt 1"
                            in_terminal_labels = "[(\'in\', True), (\'clk\', True), (\'cnt\', True)]"
                            in_terminal_properties = "real in;inherit clk;inherit cnt;"
                            init_fnc = "/*Begin code section*/
connected = 0;
time = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "[(\'out\', False)]"
                            output_fnc = "/*Begin code section*/
/*
if (connected>0 && clk<time+60){
    out = out + 0.001*(in-out);
}
else{out=in;}
*/
if (cnt>0) out = in;
else out = 2*3.14159265359*60;
/*End code section*/"
                            update_fnc = "/*Begin code section*/
if (connected<1 && cnt>0){
    time = clk;
}
if (cnt>0){connected = 1;}
/*End code section*/"
                        }
                        [
                            position = 7752, 8224
                            hide_name = True
                            scale = -1, 1
                            size = 48, 64
                        ]

                        component src_clock Clock2 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7880, 8272
                            hide_name = True
                            scale = -1, 1
                        ]

                        component "core/Rate Transition" "Rate Transition12" {
                            execution_rate = "Ts"
                            init_value = "0"
                        }
                        [
                            position = 8008, 8264
                            hide_name = True
                            scale = -1, 1
                            size = 32, 32
                        ]

                        component gen_c_function "C function3" {
                            execution_rate = "Tsync"
                            in_terminal_dimensions = "1;1;inherit"
                            in_terminal_dimensions_str = "del_w 1;INV_sync 1;Connect inherit"
                            in_terminal_labels = "[(\'del_w\', True), (\'INV_sync\', True), (\'Connect\', True)]"
                            in_terminal_properties = "real del_w;inherit INV_sync;inherit Connect;"
                            init_fnc = "/*Begin code section*/
wref = w_0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "wref inherit"
                            out_terminal_labels = "[(\'wref\', False)]"
                            out_terminal_properties = "real wref;"
                            output_fnc = "/*Begin code section*/
if (INV_sync) wref = wref + del_w;
if (Connect) wref = w_0;
/*End code section*/"
                            parameters = "real w_0;"
                        }
                        [
                            position = 8128, 8264
                            hide_name = True
                            scale = -1, 1
                            size = 64, 96
                        ]

                        port w1 {
                            label = "w1"
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7680, 8216
                            scale = -1, 1
                        ]

                        port U_P {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8248, 8096
                            scale = -1, 1
                        ]

                        tag From17 {
                            value = "P1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8248, 8144
                            hide_name = True
                            scale = -1, 1
                        ]

                        tag theta_bus7 {
                            value = "del_w"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8256, 8240
                            hide_name = True
                            scale = -1, 1
                        ]

                        tag MT_ON2 {
                            value = "Connect"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8256, 8288
                            hide_name = True
                            scale = -1, 1
                        ]

                        tag From44 {
                            value = "GFM_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7872, 8328
                            hide_name = True
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag MT_ON3 {
                            value = "INV_sync"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8256, 8264
                            hide_name = True
                            scale = -1, 1
                        ]

                        connect U_P Sum1.in as Connection368
                        connect From17 Sum1.in1 as Connection316
                        connect Gain3.in Sum1.out as Connection392
                        connect Clock1.out "C function1.clk" as Connection413
                        connect Sum4.in "C function1.out" as Connection414
                        connect Gain3.out "C function1.in" as Connection415
                        connect "C function2.in" Sum4.out as Connection416
                        connect "C function2.out" w1 as Connection417
                        connect Clock2.out "C function2.clk" as Connection418
                        [
                            breakpoints = 7832, 8272; 7832, 8224
                        ]
                        connect From44 "C function2.cnt" as Connection423
                        connect "Rate Transition12.out" Sum4.in1 as Connection424
                        connect "C function3.wref" "Rate Transition12.in" as Connection425
                        connect theta_bus7 "C function3.del_w" as Connection426
                        connect MT_ON3 "C function3.INV_sync" as Connection427
                        connect MT_ON2 "C function3.Connect" as Connection428
                    }
                    [
                        position = 8352, 8184
                        size = 96, 120
                    ]

                    component Subsystem "Voltage droop" {
                        layout = dynamic
                        component gen_sum Sum2 {
                            signs = "+-"
                        }
                        [
                            position = 8208, 8104
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_probe E_1 {
                        }
                        [
                            position = 7872, 8104
                        ]

                        component gen_gain Gain3 {
                            gain = "1/D_V"
                        }
                        [
                            position = 8128, 8104
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_sum Sum4 {
                        }
                        [
                            position = 7872, 8208
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_probe dQ {
                        }
                        [
                            position = 8216, 8040
                        ]

                        component gen_c_function "C function1" {
                            in_terminal_dimensions = "1;1"
                            in_terminal_dimensions_str = "in 1;clk 1"
                            in_terminal_labels = "[(\'in\', True), (\'clk\', True)]"
                            in_terminal_properties = "real in;inherit clk;"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "[(\'out\', False)]"
                            output_fnc = "/*Begin code section*/
if (clk>120){
    out = in;
}
else{out=0;}
out = in;
/*End code section*/"
                        }
                        [
                            position = 8016, 8112
                            hide_name = True
                            scale = -1, 1
                            size = 48, 48
                        ]

                        component src_clock Clock1 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 8128, 8152
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_c_function "C function2" {
                            global_variables = "real time;int connected;"
                            in_terminal_dimensions = "1;1;1"
                            in_terminal_dimensions_str = "in 1;clk 1;GFM 1"
                            in_terminal_labels = "[(\'in\', True), (\'clk\', True), (\'GFM\', True)]"
                            in_terminal_properties = "real in;inherit clk;inherit GFM;"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "[(\'out\', False)]"
                            output_fnc = "/*Begin code section*/
if (GFM>0) out = in;
else out = 1;
/*End code section*/"
                        }
                        [
                            position = 7640, 8224
                            hide_name = True
                            scale = -1, 1
                            size = 48, 64
                        ]

                        component src_clock Clock2 {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7776, 8280
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_c_function "C function3" {
                            execution_rate = "Tsync"
                            in_terminal_dimensions = "1;1;inherit"
                            in_terminal_dimensions_str = "del_V 1;INV_sync 1;Connect inherit"
                            in_terminal_labels = "[(\'del_V\', True), (\'INV_sync\', True), (\'Connect\', True)]"
                            in_terminal_properties = "real del_V;inherit INV_sync;inherit Connect;"
                            init_fnc = "/*Begin code section*/
Vref = 1;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "Vref inherit"
                            out_terminal_labels = "[(\'Vref\', False)]"
                            out_terminal_properties = "real Vref;"
                            output_fnc = "/*Begin code section*/
if (INV_sync) Vref = Vref + del_V;
if (Connect) Vref = 1;
/*End code section*/"
                        }
                        [
                            position = 8048, 8280
                            hide_name = True
                            scale = -1, 1
                            size = 64, 96
                        ]

                        component "core/Rate Transition" "Rate Transition13" {
                            execution_rate = "Ts"
                        }
                        [
                            position = 7944, 8216
                            hide_name = True
                            scale = -1, 1
                            size = 32, 32
                        ]

                        port E_magnitude1 {
                            label = "E_magnitude1"
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7536, 8224
                            scale = -1, 1
                        ]

                        port Q_ref1 {
                            label = "Q_ref1"
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8352, 8080
                            scale = -1, 1
                        ]

                        tag From18 {
                            value = "Q1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8352, 8128
                            hide_name = True
                            scale = -1, 1
                        ]

                        tag MT_ON1 {
                            value = "INV_sync"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8184, 8280
                            hide_name = True
                            scale = -1, 1
                        ]

                        tag From44 {
                            value = "GFM_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7776, 8312
                            hide_name = True
                            scale = -1, 1
                            size = 60, 20
                        ]

                        tag MT_ON2 {
                            value = "del_V"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8184, 8256
                            hide_name = True
                            scale = -1, 1
                        ]

                        tag MT_ON3 {
                            value = "Connect"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8184, 8304
                            hide_name = True
                            scale = -1, 1
                        ]

                        junction Junction2 sp
                        [
                            position = 8160, 8104
                        ]

                        junction Junction3 sp
                        [
                            position = 7808, 8208
                        ]

                        connect From18 Sum2.in1 as Connection323
                        connect Q_ref1 Sum2.in as Connection360
                        connect Gain3.in Junction2 as Connection406
                        connect Junction2 Sum2.out as Connection407
                        connect dQ.in Junction2 as Connection408
                        connect Clock1.out "C function1.clk" as Connection413
                        connect Sum4.in "C function1.out" as Connection414
                        connect "C function1.in" Gain3.out as Connection415
                        connect Clock2.out "C function2.clk" as Connection418
                        [
                            breakpoints = 7728, 8280; 7728, 8232
                        ]
                        connect "C function2.out" E_magnitude1 as Connection420
                        connect E_1.in Junction3 as Connection421
                        connect Junction3 Sum4.out as Connection422
                        [
                            breakpoints = 7808, 8208
                        ]
                        connect "C function2.in" Junction3 as Connection423
                        connect From44 "C function2.GFM" as Connection425
                        connect MT_ON2 "C function3.del_V" as Connection427
                        connect MT_ON1 "C function3.INV_sync" as Connection428
                        connect MT_ON3 "C function3.Connect" as Connection429
                        connect "C function3.Vref" "Rate Transition13.in" as Connection430
                        connect "Rate Transition13.out" Sum4.in1 as Connection431
                    }
                    [
                        position = 8352, 7944
                        size = 120, 96
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component gen_gain Gain3 {
                            gain = "1/V_DQ"
                        }
                        [
                            position = 8160, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1/V_DQ"
                        }
                        [
                            position = 8112, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component gen_probe f_meas {
                        }
                        [
                            position = 8520, 8224
                        ]

                        component "core/Three phase PLL" PLL {
                            enable_sin = "False"
                            enable_zero = "False"
                            low_lim = "0"
                            rate_high = "5*60"
                            rate_low = "-5*60"
                            up_lim = "1.4*2*np.pi*60"
                        }
                        [
                            position = 8064, 8184
                            size = 64, 128
                        ]

                        component gen_gain Gain5 {
                            gain = "2*np.pi"
                        }
                        [
                            position = 8208, 8080
                            rotation = left
                            hide_name = True
                        ]

                        port w {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8016
                        ]

                        port Vd {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7920
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8184
                        ]

                        port Vq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7968
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8096
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7880, 8288
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8200
                        ]

                        tag Goto33 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8320, 8136
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction3 sp
                        [
                            position = 8208, 8136
                        ]

                        connect From1 f_meas.in as Connection73
                        connect Gain3.out Vq as Connection54
                        connect Vd Gain4.out as Connection55
                        connect Gain3.in PLL.q_axis as Connection81
                        connect PLL.theta wt as Connection85
                        connect PLL.d_axis Gain4.in as Connection80
                        connect A PLL.va as Connection89
                        connect B PLL.vb as Connection90
                        connect C PLL.vc as Connection91
                        connect Goto33 Junction3 as Connection93
                        [
                            breakpoints = 8264, 8136
                        ]
                        connect Junction3 PLL.freq as Connection94
                        [
                            breakpoints = 8208, 8136
                        ]
                        connect w Gain5.out as Connection95
                        connect Gain5.in Junction3 as Connection96
                    }
                    [
                        position = 7952, 8184
                        size = 64, 176
                    ]

                    port U_P {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8600, 8144
                        scale = -1, 1
                    ]

                    port U_Q {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8528, 7912
                        scale = -1, 1
                    ]

                    tag Goto29 {
                        value = "E_d1"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7760, 8392
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From6 {
                        value = "Xi_b1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8088, 7856
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag Goto19 {
                        value = "Id"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7304, 8616
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag Goto37 {
                        value = "P1"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6808, 8232
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From24 {
                        value = "Ib1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8656
                        scale = -1, 1
                    ]

                    tag Goto47 {
                        value = "E_mag"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8512, 7976
                        hide_name = True
                    ]

                    tag From28 {
                        value = "wt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8088, 7904
                        scale = -1, 1
                    ]

                    tag From42 {
                        value = "E_qR"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7568, 8008
                        scale = -1, 1
                    ]

                    tag Goto22 {
                        value = "Xi_d"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7744, 7816
                        scale = -1, 1
                    ]

                    tag From37 {
                        value = "Xi_d"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7568, 8256
                        scale = -1, 1
                    ]

                    tag From7 {
                        value = "Xi_c1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8088, 7944
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag Goto28 {
                        value = "E_q1"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7760, 8520
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag Goto23 {
                        value = "Xi_q"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7744, 7944
                        scale = -1, 1
                    ]

                    tag From34 {
                        value = "E_c1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8520
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From36 {
                        value = "Ed"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7568, 8208
                        scale = -1, 1
                    ]

                    tag From26 {
                        value = "wt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8704
                        scale = -1, 1
                    ]

                    tag From5 {
                        value = "Xi_a1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8088, 7816
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag Goto20 {
                        value = "Iq"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7304, 8744
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From23 {
                        value = "Ia1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8616
                        scale = -1, 1
                    ]

                    tag From20 {
                        value = "E_dR"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7568, 7896
                        scale = -1, 1
                        size = 67, 20
                    ]

                    tag Goto45 {
                        value = "E_dR"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7760, 8648
                        scale = -1, 1
                        size = 64, 20
                    ]

                    tag Goto2 {
                        value = "modulator"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7048, 7952
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "E_a1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8392
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From25 {
                        value = "Ic1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7592, 8744
                        scale = -1, 1
                    ]

                    tag From43 {
                        value = "E_mag"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7920, 8648
                        hide_name = True
                        scale = -1, 1
                    ]

                    tag Goto36 {
                        value = "Q1"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 6808, 8376
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "wt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8480
                        scale = -1, 1
                    ]

                    tag Goto46 {
                        value = "E_qR"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7784, 8776
                        scale = -1, 1
                    ]

                    tag From35 {
                        value = "E_b1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8064, 8432
                        scale = -1, 1
                        size = 60, 20
                    ]

                    tag From38 {
                        value = "Xi_q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7568, 8472
                        scale = -1, 1
                    ]

                    tag From39 {
                        value = "Eq"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7568, 8400
                        scale = -1, 1
                    ]

                    tag Goto48 {
                        value = "w_e"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8672, 8328
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto49 {
                        value = "Pref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8488, 8088
                        scale = -1, 1
                    ]

                    tag Goto50 {
                        value = "Qref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8400, 7840
                        scale = -1, 1
                    ]

                    tag Goto14 {
                        value = "w"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8056, 8200
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto13 {
                        value = "Eq"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8056, 8168
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "Ed"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8056, 8120
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto15 {
                        value = "wt"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8056, 8248
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From44 {
                        value = "Eb1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7760, 8184
                        size = 60, 20
                    ]

                    tag From45 {
                        value = "Ea1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7760, 8144
                        size = 60, 20
                    ]

                    tag From46 {
                        value = "Ec1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7760, 8232
                        size = 60, 20
                    ]

                    junction Junction228 sp
                    [
                        position = 7520, 8400
                    ]

                    junction Junction230 sp
                    [
                        position = 7472, 8472
                    ]

                    junction Junction231 sp
                    [
                        position = 7520, 7896
                    ]

                    junction Junction258 sp
                    [
                        position = 7520, 8008
                    ]

                    junction Junction267 sp
                    [
                        position = 7136, 8368
                    ]

                    junction Junction268 sp
                    [
                        position = 7136, 8224
                    ]

                    junction Junction159 sp
                    [
                        position = 7472, 8208
                    ]

                    junction Junction229 sp
                    [
                        position = 7520, 8256
                    ]

                    junction Junction274 sp
                    [
                        position = 6856, 8376
                    ]

                    junction Junction275 sp
                    [
                        position = 6856, 8232
                    ]

                    junction Junction277 sp
                    [
                        position = 8552, 8144
                    ]

                    junction Junction278 sp
                    [
                        position = 8472, 7912
                    ]

                    junction Junction279 sp
                    [
                        position = 8544, 8328
                    ]

                    connect From25 "Current_abc_to_dq4.^Ec2" as Connection699
                    connect Gain10.in "Current_abc_to_dq3.^Eq2" as Connection875
                    connect Junction231 From20 as Connection728
                    connect Current_abc_to_dq4.wt2 From26 as Connection702
                    connect Product111.in Junction159 as Connection703
                    connect Sum4.in Junction268 as Connection955
                    connect Junction228 From39 as Connection680
                    connect Gain11.out Goto19 as Connection877
                    connect Current_abc_to_dq.Xi_d2 Gain6.in as Connection864
                    connect Gain13.out Integrator3.in as Connection925
                    connect From7 Current_abc_to_dq.Xi_c2 as Connection40
                    connect Sum1.in1 Product13.out as Connection719
                    connect From6 Current_abc_to_dq.Xi_b2 as Connection39
                    connect Junction231 "Outer Voltage Loop + Inner Current Loop.E_d_ref1" as Connection736
                    connect "Current_abc_to_dq4.^Ea2" From23 as Connection701
                    connect "Outer Voltage Loop + Inner Current Loop.Ua" "Bus Join1.in" as Connection839
                    connect Goto23 Gain7.out as Connection962
                    connect Product12.out Sum2.in1 as Connection721
                    connect Sum5.in Junction267 as Connection952
                    connect f1.in Gain1.out as Connection318
                    connect E_dREF1.in Junction231 as Connection729
                    [
                        breakpoints = 7520, 7848; 7520, 7896
                    ]
                    connect E_qREF1.in Junction258 as Connection861
                    connect Product111.out Sum1.in as Connection684
                    connect Product13.in Junction228 as Connection679
                    connect Product12.in Junction159 as Connection720
                    connect "Current_abc_to_dq4.^Eb2" From24 as Connection700
                    connect "Outer Voltage Loop + Inner Current Loop.Uc" "Bus Join1.in2" as Connection840
                    connect From43 Goto45 as Connection881
                    connect Junction159 From36 as Connection698
                    connect P1.in Gain15.out as Connection966
                    connect Product10.out Sum2.in as Connection672
                    connect Gain15.in Junction268 as Connection967
                    connect Sum5.out Gain13.in as Connection926
                    connect Q1.in Gain14.out as Connection968
                    connect Product10.in Junction229 as Connection723
                    connect "Current_abc_to_dq4.^Ed2" Gain11.in as Connection876
                    connect Product12.in1 Junction230 as Connection678
                    connect Junction229 From37 as Connection683
                    connect Gain14.in Junction267 as Connection969
                    connect Current_abc_to_dq.wt2 From28 as Connection247
                    [
                        breakpoints = 8000, 7904; 8040, 7904
                    ]
                    connect Product10.in1 Junction228 as Connection681
                    connect From35 "Current_abc_to_dq3.^Eb2" as Connection276
                    connect "Bus Join1.in1" "Outer Voltage Loop + Inner Current Loop.Ub" as Connection838
                    connect Gain6.out Goto22 as Connection961
                    connect From42 Junction258 as Connection859
                    connect From34 "Current_abc_to_dq3.^Ec2" as Connection279
                    connect "Current_abc_to_dq3.^Ea2" From33 as Connection278
                    connect Junction258 "Outer Voltage Loop + Inner Current Loop.E_q_ref1" as Connection860
                    connect Junction230 From38 as Connection677
                    connect Product13.in1 Junction230 as Connection676
                    connect Sum4.out Gain4.in as Connection330
                    connect Constant1.out Goto46 as Connection882
                    connect From5 Current_abc_to_dq.Xi_a2 as Connection38
                    connect Gain12.in "Current_abc_to_dq4.^Eq2" as Connection879
                    connect Gain4.out Integrator2.in as Connection335
                    connect From32 Current_abc_to_dq3.wt2 as Connection275
                    connect Product111.in1 Junction229 as Connection682
                    connect Goto20 Gain12.out as Connection878
                    connect "Current_abc_to_dq3.^Ed2" Gain9.in as Connection872
                    connect Goto28 Gain10.out as Connection874
                    connect Current_abc_to_dq.Xi_q2 Gain7.in as Connection866
                    connect Integrator3.out Junction274 as Connection1003
                    connect Junction274 Sum5.in1 as Connection1004
                    [
                        breakpoints = 6856, 8376; 6856, 8376; 6856, 8376; 6856, 8376; 6856, 8376; 6856, 8424; 7120, 8424
                    ]
                    connect Goto36 Junction274 as Connection1005
                    connect Integrator2.out Junction275 as Connection1006
                    connect Junction275 Sum4.in1 as Connection1007
                    [
                        breakpoints = 6856, 8232; 6856, 8232; 6856, 8232; 6856, 8280; 7112, 8280
                    ]
                    connect Goto37 Junction275 as Connection1008
                    connect Junction267 Sum2.out as Connection1014
                    [
                        breakpoints = 7136, 8368; 7152, 8368
                    ]
                    connect Junction268 Sum1.out as Connection1013
                    [
                        breakpoints = 7136, 8224; 7152, 8224
                    ]
                    connect Goto2 Limit1.out as Connection1017
                    connect Limit1.in "Bus Join1.out" as Connection1018
                    connect "Voltage droop.E_magnitude1" Goto47 as Connection1028
                    connect "Frequency droop.U_P" Junction277 as Connection1033
                    connect Junction277 U_P as Connection1034
                    connect Goto49 Junction277 as Connection1035
                    connect "Voltage droop.Q_ref1" Junction278 as Connection1036
                    connect Junction278 U_Q as Connection1037
                    connect Goto50 Junction278 as Connection1038
                    connect Gain1.in Junction279 as Connection1044
                    connect Junction279 Goto48 as Connection1045
                    [
                        breakpoints = 8624, 8328
                    ]
                    connect "Frequency droop.w1" Junction279 as Connection1046
                    connect Gain9.out Goto29 as Connection1047
                    [
                        breakpoints = 7816, 8392
                    ]
                    connect PLL.Vd Goto12 as Connection553
                    connect Goto13 PLL.Vq as Connection554
                    connect Goto14 PLL.w as Connection556
                    connect PLL.wt Goto15 as Connection557
                    connect From45 PLL.A as Connection1041
                    connect From44 PLL.B as Connection1042
                    connect From46 PLL.C as Connection1043
                }
                [
                    position = 6960, 7568
                    size = 296, 128
                ]

                component "core/Triple Pole Single Throw Contactor" S2 {
                    ctrl_src = "Model"
                }
                [
                    position = 9920, 8000
                    size = 64, 256
                ]

                component pas_inductor L0c1 {
                    inductance = "L_i"
                }
                [
                    position = 7888, 8096
                    rotation = down
                ]

                component pas_inductor L0a1 {
                    inductance = "L_i"
                }
                [
                    position = 7888, 7904
                    rotation = down
                ]

                component "core/Three Phase Two Winding Transformer" Tr1 {
                    L1 = "1e-6"
                    L2 = "1e-6"
                    Lm = "1e6"
                    Poc1 = "344.99999999952564"
                    Psc1 = "1762.5"
                    R1 = "1e-6"
                    R2 = "1e-6"
                    Rm = "1e6"
                    Sn = "5e6"
                    V1 = "277"
                    V2 = "480"
                    current_vals_SCOC = "[0.0024, 1.0]"
                    f = "60.0"
                    input = "SI"
                    ioc1 = "0.6999999999992988"
                    usc1 = "3.9999999999957394"
                }
                [
                    position = 10504, 8000
                    size = 126, 256
                ]

                component pas_resistor Rt0b1 {
                    resistance = "R_s"
                }
                [
                    position = 8240, 8256
                    rotation = left
                    scale = -1, 1
                ]

                component "core/Voltage Measurement" Va2 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7744, 8384
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component pas_inductor La1 {
                    inductance = "L_o"
                }
                [
                    position = 9016, 7904
                    rotation = down
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "3"
                }
                [
                    position = 7368, 7776
                    hide_name = True
                ]

                component gen_probe Ec_1 {
                }
                [
                    position = 8656, 8400
                ]

                component "core/Signal Controlled Voltage Source" Vbtt {
                }
                [
                    position = 6976, 8000
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component pas_resistor Rt0c1 {
                    resistance = "R_s"
                }
                [
                    position = 8320, 8256
                    rotation = left
                    scale = -1, 1
                ]

                component pas_resistor R0b1 {
                    resistance = "R_i"
                }
                [
                    position = 7776, 8000
                ]

                component gen_probe Eb_1 {
                }
                [
                    position = 8544, 8288
                ]

                component "core/Voltage Measurement" Vb2 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7872, 8432
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" VaG {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 10032, 8216
                    rotation = right
                    size = 64, 32
                ]

                component pas_resistor Rc1 {
                    resistance = "R_o"
                }
                [
                    position = 8920, 8096
                ]

                component "core/Voltage Measurement" VbG {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 10160, 8288
                    rotation = right
                    size = 64, 32
                ]

                component pas_resistor R0c1 {
                    resistance = "R_i"
                }
                [
                    position = 7776, 8096
                ]

                component pas_inductor Lb1 {
                    inductance = "L_o"
                }
                [
                    position = 9016, 8000
                    rotation = down
                ]

                component pas_resistor R0a1 {
                    resistance = "R_i"
                }
                [
                    position = 7776, 7904
                ]

                component "core/Current Measurement" Ic1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 9168, 8096
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Eb1 {
                    addr = "9"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8608, 8208
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Ea1 {
                    addr = "7"
                    execution_rate = "Ts"
                    feed_forward = "true"
                    sig_output = "True"
                }
                [
                    position = 8544, 8144
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component "core/Current Measurement" Xi_b1 {
                    addr = "15"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8032, 8000
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 9168, 8000
                    size = 64, 32
                ]

                component "core/Current Measurement" Xi_a1 {
                    addr = "14"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7984, 7904
                    scale = 1, -1
                    size = 64, 32
                ]

                component pas_capacitor Ca1 {
                    capacitance = "C_s"
                    initial_voltage = "V_ABC"
                }
                [
                    position = 8160, 8352
                    rotation = right
                ]

                component "core/Voltage Measurement" VcG {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 10280, 8408
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Ec1 {
                    addr = "11"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8688, 8272
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component "core/Current Measurement" Xi_c1 {
                    addr = "16"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8096, 8096
                    scale = 1, -1
                    size = 64, 32
                ]

                component pas_inductor Lc1 {
                    inductance = "L_o"
                }
                [
                    position = 9016, 8096
                    rotation = down
                ]

                component pas_resistor Rb1 {
                    resistance = "R_o"
                }
                [
                    position = 8920, 8000
                ]

                component Subsystem "BE1-25A Synchronizer" {
                    layout = dynamic
                    component gen_trigonometric "Trigonometric function2" {
                        trigonometric_fn = "atan2"
                    }
                    [
                        position = 7456, 8088
                        hide_name = True
                    ]

                    component gen_math_fnc "Mathematical function1" {
                        mathematical_fn = "sqrt"
                    }
                    [
                        position = 8312, 8224
                        hide_name = True
                    ]

                    component gen_limiter Limit2 {
                        lower_limit = "1e-12"
                    }
                    [
                        position = 7384, 8104
                        hide_name = True
                    ]

                    component src_constant Constant9 {
                        execution_rate = "Ts"
                        value = "3e-3"
                    }
                    [
                        position = 8456, 8224
                        hide_name = True
                    ]

                    component gen_c_function "BE1-25A Synchronizer1" {
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "dV inherit"
                        in_terminal_labels = "[(\'dV\', True)]"
                        in_terminal_properties = "real dV;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "del_V inherit"
                        out_terminal_labels = "[(\'del_V\', True)]"
                        out_terminal_properties = "real del_V;"
                        output_fnc = "/*Begin code section*/
del_V =0.01*dV;
/*End code section*/"
                        parameters = "real Ts;real maxV_slip;real minV_slip;real maxV_pds;"
                    }
                    [
                        position = 8488, 8616
                        hide_name = True
                        size = 96, 96
                    ]

                    component gen_abs Abs2 {
                    }
                    [
                        position = 8456, 8192
                        hide_name = True
                    ]

                    component src_scada_input "Connect INV" {
                        def_value = "1"
                        execution_rate = "Tsync"
                        format = "int"
                        max = "1"
                        min = "0"
                        signal_type = "int"
                        unit = ""
                    }
                    [
                        position = 8680, 8184
                    ]

                    component gen_terminator Termination1 {
                    }
                    [
                        position = 7440, 8600
                        hide_name = True
                    ]

                    component gen_trigonometric "Trigonometric function1" {
                        trigonometric_fn = "atan2"
                    }
                    [
                        position = 7456, 8000
                        hide_name = True
                    ]

                    component gen_c_function "BE1-25A Synchronizer" {
                        in_terminal_dimensions = "inherit;inherit"
                        in_terminal_dimensions_str = "df inherit;dAng inherit"
                        in_terminal_labels = "[(\'df\', True), (\'dAng\', True)]"
                        in_terminal_properties = "real df;real dAng;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "del_w inherit"
                        out_terminal_labels = "[(\'del_w\', True)]"
                        out_terminal_properties = "real del_w;"
                        output_fnc = "/*Begin code section*/
if (dAng>3.14159265359) dAng -= 2*3.14159265359;
if (dAng<-3.14159265359) dAng += 2*3.14159265359;
del_w = 0.01*dAng/Tsync+df;
if (del_w>0.1) del_w = 0.1;
else if (del_w<-0.1) del_w = -0.1;
/*End code section*/"
                        parameters = "real Ts;real maxw_pds;real maxw_slip;real minw_slip;real Tsync;"
                    }
                    [
                        position = 8184, 8392
                        hide_name = True
                        scale = 1, -1
                        size = 128, 112
                    ]

                    component gen_product Product1 {
                    }
                    [
                        position = 8160, 8192
                        hide_name = True
                    ]

                    component gen_sum Sum4 {
                    }
                    [
                        position = 8240, 8224
                        hide_name = True
                    ]

                    component gen_c_function "confine phase" {
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "in inherit"
                        in_terminal_labels = "[(\'in\', True)]"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', True)]"
                        output_fnc = "/*Begin code section*/
if (in > 0)
{
    if (in > (6.283185307179586/2))
        out = in - 6.283185307179586;
    else
        out = in;
}
if (in < 0)
{
    if (in < (-6.283185307179586/2))
        out = in + 6.283185307179586;
    else
        out = in;
}
/*End code section*/"
                    }
                    [
                        position = 7824, 8048
                        size = 56, 48
                    ]

                    component gen_sum Sum5 {
                    }
                    [
                        position = 7344, 8352
                        hide_name = True
                    ]

                    component gen_probe frequency_diff3 {
                    }
                    [
                        position = 7920, 8128
                        scale = -1, 1
                    ]

                    component gen_product Product4 {
                    }
                    [
                        position = 7264, 8384
                        hide_name = True
                    ]

                    component gen_digital_probe "Digital Probe3" {
                        override_signal_name = "True"
                        signal_name = "ang_sync3"
                    }
                    [
                        position = 8616, 8040
                        hide_name = True
                    ]

                    component src_constant Constant7 {
                        execution_rate = "Ts"
                    }
                    [
                        position = 8088, 8112
                        hide_name = True
                    ]

                    component gen_sum Sum1 {
                        signs = "-+"
                    }
                    [
                        position = 7736, 8048
                        hide_name = True
                    ]

                    component gen_c_function "confine phase2" {
                        global_variables = "real x;real floor_in;"
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "in inherit"
                        in_terminal_labels = "[(\'in\', True)]"
                        init_fnc = "/*Begin code section*/
floor_in = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', True)]"
                        output_fnc = "/*Begin code section*/
x = in/6.283185307179586;
floor_in = floor(x);
out = in - (6.283185307179586*floor_in);
/*End code section*/"
                    }
                    [
                        position = 7640, 8088
                        hide_name = True
                        size = 56, 48
                    ]

                    component gen_product Product3 {
                    }
                    [
                        position = 7264, 8320
                        hide_name = True
                    ]

                    component tm_delay "Unit Delay2" {
                    }
                    [
                        position = 7608, 8624
                        rotation = right
                        hide_name = True
                    ]

                    component gen_sum Sum2 {
                        signs = "-+"
                    }
                    [
                        position = 7824, 8200
                        hide_name = True
                    ]

                    component gen_rel_op "Relational operator1" {
                        relational_op = ">"
                    }
                    [
                        position = 8160, 8040
                        hide_name = True
                    ]

                    component gen_rel_op "Relational operator4" {
                        relational_op = "<"
                    }
                    [
                        position = 8520, 8208
                        hide_name = True
                    ]

                    component gen_abs Abs4 {
                    }
                    [
                        position = 8056, 8072
                        hide_name = True
                    ]

                    component gen_probe volt_diff3 {
                    }
                    [
                        position = 8448, 8512
                    ]

                    component src_constant Constant6 {
                        execution_rate = "Ts"
                        value = "1e-2"
                    }
                    [
                        position = 8056, 8032
                        hide_name = True
                    ]

                    component gen_digital_probe "Digital Probe1" {
                        override_signal_name = "True"
                        signal_name = "gridconnect2"
                    }
                    [
                        position = 9072, 8184
                        hide_name = True
                    ]

                    component gen_logic_op "Logical operator2" {
                        inputs = "4"
                        operator = "NOT"
                    }
                    [
                        position = 9008, 8224
                        rotation = right
                        hide_name = True
                    ]

                    component gen_product Product2 {
                    }
                    [
                        position = 8160, 8256
                        hide_name = True
                    ]

                    component gen_gain Gain6 {
                        gain = "1/V_DQ"
                    }
                    [
                        position = 7376, 8576
                        hide_name = True
                    ]

                    component gen_digital_probe "Digital Probe4" {
                        override_signal_name = "True"
                        signal_name = "freq_sync3"
                    }
                    [
                        position = 8616, 8008
                        hide_name = True
                    ]

                    component gen_digital_probe "Digital Probe5" {
                        override_signal_name = "True"
                        signal_name = "volt_sync3"
                    }
                    [
                        position = 8616, 8072
                        hide_name = True
                    ]

                    component gen_logic_op "Logical operator1" {
                        inputs = "3"
                    }
                    [
                        position = 8616, 8120
                        hide_name = True
                    ]

                    component gen_abs Abs5 {
                    }
                    [
                        position = 8056, 8128
                        hide_name = True
                    ]

                    component gen_probe angle_diff3 {
                    }
                    [
                        position = 8056, 7952
                    ]

                    component gen_sum Sum3 {
                        signs = "-+"
                    }
                    [
                        position = 8392, 8192
                        hide_name = True
                        scale = 1, -1
                    ]

                    component gen_gain Gain5 {
                        gain = "1/V_DQ"
                    }
                    [
                        position = 7336, 8552
                        hide_name = True
                    ]

                    component gen_rel_op "Relational operator2" {
                        relational_op = ">"
                    }
                    [
                        position = 8160, 8120
                        hide_name = True
                    ]

                    component gen_c_function "confine phase1" {
                        global_variables = "real x;real floor_in;"
                        in_terminal_dimensions = "inherit"
                        in_terminal_dimensions_str = "in inherit"
                        in_terminal_labels = "[(\'in\', True)]"
                        init_fnc = "/*Begin code section*/
floor_in = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', True)]"
                        output_fnc = "/*Begin code section*/
x = in/6.283185307179586;
floor_in = floor(x);
out = in - (6.283185307179586*floor_in);
/*End code section*/"
                    }
                    [
                        position = 7640, 8000
                        hide_name = True
                        size = 56, 48
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component gen_pid_controller "PID controller1" {
                            controller_type = "PI"
                            enb_anti_windup_out = "True"
                            enb_output_limit_out = "True"
                            int_init_value = "2*np.pi*60"
                            ki = "2"
                            lower_sat_lim = "2*np.pi*59.5"
                            upper_sat_lim = "2*np.pi*60.5"
                        }
                        [
                            position = 8192, 8152
                            hide_name = True
                        ]

                        component gen_c_function "C function1" {
                            global_variables = "real var;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "in inherit"
                            in_terminal_labels = "[(\'in\', True)]"
                            init_fnc = "/*Begin code section*/
var = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "[(\'out\', True)]"
                            output_fnc = "/*Begin code section*/
out = var;
/*End code section*/"
                            parameters = "real Ts;"
                            update_fnc = "/*Begin code section*/
var += (Ts*in);
/*End code section*/"
                        }
                        [
                            position = 8304, 8152
                            hide_name = True
                            size = 80, 48
                        ]

                        component gen_c_function "confine phase" {
                            global_variables = "real x;real floor_in;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "in inherit"
                            in_terminal_labels = "[(\'in\', True)]"
                            init_fnc = "/*Begin code section*/
floor_in = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "[(\'out\', True)]"
                            output_fnc = "/*Begin code section*/
x = in/6.283185307179586;
floor_in = floor(x);
out = in - (6.283185307179586*floor_in);
/*End code section*/"
                        }
                        [
                            position = 8408, 8152
                            size = 56, 48
                        ]

                        port wt {
                            label = "wt"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8496, 8152
                        ]

                        port w {
                            label = "w"
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8304, 8208
                        ]

                        port q {
                            label = "q"
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8064, 8152
                        ]

                        junction Junction1 sp
                        [
                            position = 8240, 8152
                        ]

                        connect w Junction1 as Connection19
                        connect "C function1.in" Junction1 as Connection17
                        connect wt "confine phase.out" as Connection14
                        connect "confine phase.in" "C function1.out" as Connection16
                        connect Junction1 "PID controller1.out" as Connection18
                        connect q "PID controller1.in" as Connection20
                    }
                    [
                        position = 7544, 8576
                        scale = 1, -1
                        size = 96, 56
                    ]

                    component gen_limiter Limit1 {
                        lower_limit = "1e-12"
                    }
                    [
                        position = 7384, 8016
                        hide_name = True
                    ]

                    component gen_digital_probe "Digital Probe6" {
                        override_signal_name = "True"
                        signal_name = "griddisconnect2"
                    }
                    [
                        position = 9072, 8256
                        hide_name = True
                    ]

                    component "core/abc to dq" "abc to dq1" {
                    }
                    [
                        position = 7264, 8576
                        size = 48, 80
                    ]

                    component gen_math_fnc "Mathematical function2" {
                        mathematical_fn = "sqrt"
                    }
                    [
                        position = 7416, 8352
                        hide_name = True
                    ]

                    component gen_probe Vd_G {
                    }
                    [
                        position = 7328, 8480
                        scale = -1, 1
                    ]

                    component gen_probe Vq_G {
                    }
                    [
                        position = 7432, 8472
                        scale = -1, 1
                    ]

                    component gen_probe del_w {
                    }
                    [
                        position = 8744, 8376
                    ]

                    component gen_probe del_V {
                    }
                    [
                        position = 9048, 8584
                    ]

                    component gen_c_function "stay connected1" {
                        global_variables = "real connect;"
                        in_terminal_dimensions = "inherit;inherit"
                        in_terminal_dimensions_str = "ready inherit;connectINV inherit"
                        in_terminal_labels = "[(\'ready\', True), (\'connectINV\', True)]"
                        in_terminal_properties = "inherit ready;inherit connectINV;"
                        init_fnc = "/*Begin code section*/
connect = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', True)]"
                        out_terminal_properties = "int out;"
                        output_fnc = "/*Begin code section*/
out = connect;
/*End code section*/"
                        parameters = "real Ts;"
                        update_fnc = "/*Begin code section*/
if ((ready==1)&&(connectINV==1)){
    connect = 1;
}
else if(connectINV==0){
    connect = 0;
}
/*End code section*/"
                    }
                    [
                        position = 8848, 8152
                        hide_name = True
                        size = 160, 104
                    ]

                    component gen_probe "|V|" {
                    }
                    [
                        position = 7512, 8304
                    ]

                    component gen_probe w_G {
                    }
                    [
                        position = 7824, 8160
                        rotation = down
                        scale = -1, 1
                    ]

                    component gen_probe w_bus {
                    }
                    [
                        position = 7824, 8240
                    ]

                    component gen_sum Sum6 {
                        signs = "+-"
                    }
                    [
                        position = 7752, 8336
                        hide_name = True
                    ]

                    component gen_sum Sum7 {
                        signs = "+-"
                    }
                    [
                        position = 7752, 8408
                        hide_name = True
                    ]

                    component gen_sum Sum8 {
                        signs = "+-"
                    }
                    [
                        position = 7752, 8480
                        hide_name = True
                    ]

                    component gen_probe Ea-Va {
                    }
                    [
                        position = 7848, 8336
                    ]

                    component gen_probe Eb-Vb {
                    }
                    [
                        position = 7848, 8408
                    ]

                    component gen_probe Ec-Vc {
                    }
                    [
                        position = 7848, 8480
                    ]

                    component "core/abc to dq" "abc to dq2" {
                    }
                    [
                        position = 7984, 8592
                        size = 48, 80
                    ]

                    component gen_probe Ed-Vd {
                    }
                    [
                        position = 8072, 8552
                    ]

                    component gen_probe Eq-Vq {
                    }
                    [
                        position = 8120, 8592
                    ]

                    component gen_terminator Termination2 {
                    }
                    [
                        position = 8072, 8632
                        hide_name = True
                    ]

                    component gen_probe E_d {
                    }
                    [
                        position = 7616, 8704
                    ]

                    component gen_probe E_q {
                    }
                    [
                        position = 7616, 8856
                        rotation = down
                        scale = -1, 1
                    ]

                    component gen_gain Gain7 {
                        gain = "1/V_DQ"
                    }
                    [
                        position = 7336, 8736
                        hide_name = True
                    ]

                    component Subsystem Current_abc_to_dq3 {
                        layout = dynamic
                        component "core/abc to dq" "abc to dq1" {
                        }
                        [
                            position = 7856, 8008
                            size = 48, 80
                        ]

                        component gen_terminator Termination {
                        }
                        [
                            position = 7952, 8064
                        ]

                        port wt {
                            position = right:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8088
                        ]

                        port Ec {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8040
                        ]

                        port Eq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 8016
                        ]

                        port Ea {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 7960
                        ]

                        port Ed {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8008, 7976
                        ]

                        port Eb {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7704, 8000
                        ]

                        connect Termination.in "abc to dq1.zero_axis" as Connection4
                        connect "abc to dq1.q_axis" Eq as Connection6
                        connect Ec "abc to dq1.vc" as Connection3
                        connect Ea "abc to dq1.va" as Connection1
                        connect Eb "abc to dq1.vb" as Connection2
                        connect "abc to dq1.d_axis" Ed as Connection5
                        connect wt "abc to dq1.wt" as Connection7
                    }
                    [
                        position = 7256, 8784
                        hide_name = True
                        scale = -1, 1
                        size = 64, 144
                    ]

                    component gen_gain Gain12 {
                        gain = "1/V_DQ"
                    }
                    [
                        position = 7336, 8832
                        hide_name = True
                    ]

                    component gen_c_function "Hold after connect2" {
                        global_variables = "real var;"
                        in_terminal_dimensions = "inherit;inherit;inherit"
                        in_terminal_dimensions_str = "in inherit;connect inherit;INV_sync inherit"
                        in_terminal_labels = "[(\'in\', True), (\'connect\', True), (\'INV_sync\', True)]"
                        in_terminal_properties = "real in;int connect;inherit INV_sync;"
                        init_fnc = "/*Begin code section*/
var = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', True)]"
                        output_fnc = "/*Begin code section*/
out = var;
/*End code section*/"
                        update_fnc = "/*Begin code section*/
if ((connect==0)&&(INV_sync==1))
    var = in;
else if (connect==1)
    var =0;
/*End code section*/"
                    }
                    [
                        position = 8488, 8432
                        hide_name = True
                        size = 96, 96
                    ]

                    component gen_c_function "Hold after connect3" {
                        global_variables = "real var;"
                        in_terminal_dimensions = "inherit;inherit;inherit"
                        in_terminal_dimensions_str = "in inherit;connect inherit;INV_sync inherit"
                        in_terminal_labels = "[(\'in\', True), (\'connect\', True), (\'INV_sync\', True)]"
                        in_terminal_properties = "real in;int connect;inherit INV_sync;"
                        init_fnc = "/*Begin code section*/
var = 0;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', True)]"
                        output_fnc = "/*Begin code section*/
out = var;
/*End code section*/"
                        update_fnc = "/*Begin code section*/
if ((connect==0)&&(INV_sync==1))
    var = in;
else if (connect==1)
    var =0;
/*End code section*/"
                    }
                    [
                        position = 8784, 8648
                        hide_name = True
                        size = 96, 96
                    ]

                    component gen_probe "|E|" {
                    }
                    [
                        position = 8392, 8248
                    ]

                    component gen_probe Connect {
                    }
                    [
                        position = 9072, 8024
                    ]

                    component "core/Rate Transition" "Rate Transition2" {
                        execution_rate = "Tsync"
                    }
                    [
                        position = 8056, 8360
                        hide_name = True
                        size = 32, 32
                    ]

                    component "core/Rate Transition" "Rate Transition4" {
                        execution_rate = "Tsync"
                    }
                    [
                        position = 8056, 8424
                        hide_name = True
                        size = 32, 32
                    ]

                    component "core/Rate Transition" "Rate Transition6" {
                        execution_rate = "Tsync"
                    }
                    [
                        position = 8320, 8616
                        hide_name = True
                        size = 32, 32
                    ]

                    component "core/Rate Transition" "Rate Transition12" {
                        execution_rate = "Tsync"
                        init_value = "0"
                    }
                    [
                        position = 8704, 8120
                        hide_name = True
                        size = 32, 32
                    ]

                    tag From39 {
                        value = "E_q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8072, 8264
                        hide_name = True
                    ]

                    tag From43 {
                        value = "Vd_G"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7176, 8312
                        hide_name = True
                    ]

                    tag w_bus1 {
                        value = "w_bus"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7656, 8568
                        hide_name = True
                    ]

                    tag Vb_G1 {
                        value = "VbG"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7176, 8560
                        hide_name = True
                    ]

                    tag "|V|1" {
                        value = "|V| bus"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7512, 8352
                        hide_name = True
                    ]

                    tag theta_bus {
                        value = "theta_bus"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7656, 8656
                        hide_name = True
                    ]

                    tag theta_bus5 {
                        value = "dV"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8240, 8616
                        hide_name = True
                    ]

                    tag Goto2 {
                        value = "del_w"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8744, 8432
                        hide_name = True
                    ]

                    tag From42 {
                        value = "Vq_G"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7176, 8392
                        hide_name = True
                    ]

                    tag Goto32 {
                        value = "Vq_G"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7544, 8536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto31 {
                        value = "del_V"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9040, 8648
                        hide_name = True
                    ]

                    tag Connect2 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8296, 8432
                        hide_name = True
                        size = 42, 20
                    ]

                    tag From44 {
                        value = "Vd_G"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7320, 8104
                        hide_name = True
                    ]

                    tag From45 {
                        value = "Vq_G"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7320, 8072
                        hide_name = True
                    ]

                    tag Goto30 {
                        value = "dV"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8504, 8160
                        hide_name = True
                    ]

                    tag Goto33 {
                        value = "Vd_G"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7440, 8552
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Vc_G1 {
                        value = "VcG"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7176, 8584
                        hide_name = True
                    ]

                    tag From41 {
                        value = "E_d"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7320, 8016
                        hide_name = True
                    ]

                    tag Va_G1 {
                        value = "VaG"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7176, 8536
                        hide_name = True
                    ]

                    tag From36 {
                        value = "E_d"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8072, 8184
                        hide_name = True
                    ]

                    tag theta_bus2 {
                        value = "w_bus"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8224
                        hide_name = True
                    ]

                    tag Connect1 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 9072, 8152
                        hide_name = True
                    ]

                    tag From1 {
                        value = "|V| bus"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8240, 8152
                        hide_name = True
                    ]

                    tag From40 {
                        value = "E_q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7320, 7984
                        hide_name = True
                    ]

                    tag w_e7 {
                        value = "w_e"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7640, 8176
                        hide_name = True
                    ]

                    tag From46 {
                        value = "Ec1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From37 {
                        value = "Ea1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8320
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From38 {
                        value = "Eb1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8392
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Vb_G2 {
                        value = "VbG"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8424
                        hide_name = True
                    ]

                    tag Vc_G2 {
                        value = "VcG"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8496
                        hide_name = True
                    ]

                    tag Va_G2 {
                        value = "VaG"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7664, 8352
                        hide_name = True
                    ]

                    tag Goto28 {
                        value = "E_q"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7432, 8832
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto29 {
                        value = "E_d"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7432, 8736
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "Ec1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7160, 8800
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "Ea1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7160, 8736
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From35 {
                        value = "Eb1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7160, 8768
                        hide_name = True
                        size = 60, 20
                    ]

                    tag theta_bus1 {
                        value = "theta_bus"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7160, 8832
                        hide_name = True
                    ]

                    tag Connect4 {
                        value = "INV_sync"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8296, 8472
                        hide_name = True
                        size = 42, 20
                    ]

                    tag Connect5 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8600, 8656
                        hide_name = True
                        size = 42, 20
                    ]

                    tag Connect6 {
                        value = "INV_sync"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 8600, 8704
                        hide_name = True
                        size = 42, 20
                    ]

                    junction Junction41 sp
                    [
                        position = 7480, 8576
                    ]

                    junction Junction38 sp
                    [
                        position = 8304, 8120
                    ]

                    junction Junction26 sp
                    [
                        position = 8112, 8184
                    ]

                    junction Junction42 sp
                    [
                        position = 7216, 8392
                    ]

                    junction Junction43 sp
                    [
                        position = 7216, 8312
                    ]

                    junction Junction28 sp
                    [
                        position = 8112, 8264
                    ]

                    junction Junction45 sp
                    [
                        position = 7608, 8656
                    ]

                    junction Junction49 sp
                    [
                        position = 7872, 8048
                    ]

                    junction Junction35 sp
                    [
                        position = 8424, 8192
                    ]

                    junction Junction57 sp
                    [
                        position = 7480, 8536
                    ]

                    junction Junction58 sp
                    [
                        position = 7368, 8552
                    ]

                    junction Junction63 sp
                    [
                        position = 9008, 8152
                    ]

                    junction Junction66 sp
                    [
                        position = 8552, 8136
                    ]

                    junction Junction67 sp
                    [
                        position = 8576, 8040
                    ]

                    junction Junction69 sp
                    [
                        position = 7456, 8352
                    ]

                    junction Junction72 sp
                    [
                        position = 7968, 8200
                    ]

                    junction Junction73 sp
                    [
                        position = 7968, 8128
                    ]

                    junction Junction74 sp
                    [
                        position = 7800, 8336
                    ]

                    junction Junction75 sp
                    [
                        position = 7800, 8480
                    ]

                    junction Junction76 sp
                    [
                        position = 7800, 8408
                    ]

                    junction Junction77 sp
                    [
                        position = 7608, 8656
                    ]

                    junction Junction78 sp
                    [
                        position = 9008, 8184
                    ]

                    junction Junction61 sp
                    [
                        position = 7376, 8736
                    ]

                    junction Junction80 sp
                    [
                        position = 7376, 8832
                    ]

                    junction Junction81 sp
                    [
                        position = 8352, 8224
                    ]

                    junction Junction83 sp
                    [
                        position = 8376, 8616
                    ]

                    junction Junction84 sp
                    [
                        position = 7992, 8048
                    ]

                    junction Junction85 sp
                    [
                        position = 9000, 8152
                    ]

                    junction Junction86 sp
                    [
                        position = 8680, 8432
                    ]

                    junction Junction87 sp
                    [
                        position = 8952, 8648
                    ]

                    junction Junction88 sp
                    [
                        position = 7784, 8176
                    ]

                    junction Junction89 sp
                    [
                        position = 7784, 8224
                    ]

                    connect "Digital Probe4.in" Junction38 as Connection366
                    connect "confine phase2.out" Sum1.in1 as Connection399
                    connect From39 Junction28 as Connection259
                    connect "abc to dq1.q_axis" Gain6.in as Connection319
                    connect From41 Limit1.in as Connection285
                    connect Sum3.in1 From1 as Connection81
                    connect Vc_G1 "abc to dq1.vc" as Connection222
                    connect angle_diff3.in Junction49 as Connection430
                    connect Product2.out Sum4.in1 as Connection251
                    connect Abs2.out "Relational operator4.in" as Connection84
                    connect Goto30 Junction35 as Connection308
                    connect Va_G1 "abc to dq1.va" as Connection224
                    connect theta_bus Junction45 as Connection404
                    connect Termination1.in "abc to dq1.zero_axis" as Connection29
                    connect From45 "Trigonometric function2.in" as Connection401
                    connect Sum4.out "Mathematical function1.in" as Connection252
                    connect Product2.in Junction28 as Connection261
                    connect Junction28 Product2.in1 as Connection260
                    connect Constant7.out "Relational operator2.in" as Connection70
                    connect Abs2.in Junction35 as Connection306
                    connect From44 Limit2.in as Connection402
                    connect "Digital Probe6.in" "Logical operator2.out" as Connection454
                    connect Junction26 From36 as Connection248
                    connect Product1.in Junction26 as Connection247
                    connect Limit2.out "Trigonometric function2.in1" as Connection398
                    connect Product3.out Sum5.in as Connection390
                    connect Junction38 "Relational operator2.out" as Connection365
                    [
                        breakpoints = 8288, 8120; 8288, 8120
                    ]
                    connect Product3.in Junction43 as Connection386
                    connect Limit1.out "Trigonometric function1.in1" as Connection286
                    connect From40 "Trigonometric function1.in" as Connection284
                    connect Vb_G1 "abc to dq1.vb" as Connection223
                    connect "Relational operator2.in1" Abs5.out as Connection357
                    connect From42 Junction42 as Connection384
                    connect Junction43 From43 as Connection389
                    connect Sum5.out "Mathematical function2.in" as Connection387
                    connect Product3.in1 Junction43 as Connection391
                    connect Gain6.out Junction41 as Connection381
                    connect Junction35 Sum3.out as Connection307
                    connect "confine phase.in" Sum1.out as Connection146
                    connect Product4.out Sum5.in1 as Connection388
                    connect "confine phase1.out" Sum1.in as Connection400
                    connect Constant9.out "Relational operator4.in1" as Connection85
                    connect PLL.w w_bus1 as Connection233
                    connect Product4.in Junction42 as Connection385
                    connect "confine phase.out" Junction49 as Connection428
                    connect Junction45 "abc to dq1.wt" as Connection405
                    connect Product1.in1 Junction26 as Connection249
                    connect Junction41 PLL.q as Connection382
                    connect Constant6.out "Relational operator1.in" as Connection69
                    connect Product1.out Sum4.in as Connection250
                    connect Junction42 Product4.in1 as Connection392
                    connect "Logical operator1.in1" Junction38 as Connection364
                    [
                        breakpoints = 8576, 8120
                    ]
                    connect Gain5.in "abc to dq1.d_axis" as Connection318
                    connect Goto32 Junction57 as Connection468
                    connect Junction57 Junction41 as Connection469
                    connect Vq_G.in Junction57 as Connection470
                    connect Goto33 Junction58 as Connection471
                    connect Junction58 Gain5.out as Connection472
                    connect Vd_G.in Junction58 as Connection473
                    connect PLL.wt "Unit Delay2.in" as Connection474
                    connect "Connect INV.out" "stay connected1.connectINV" as Connection504
                    connect Connect1 Junction63 as Connection508
                    connect "Logical operator1.in2" Junction66 as Connection530
                    connect Junction66 "Relational operator4.out" as Connection531
                    connect "Digital Probe5.in" Junction66 as Connection532
                    connect "Relational operator1.out" Junction67 as Connection534
                    connect Junction67 "Logical operator1.in" as Connection535
                    connect "Digital Probe3.in" Junction67 as Connection536
                    connect "Trigonometric function2.out" "confine phase2.in" as Connection542
                    connect "Trigonometric function1.out" "confine phase1.in" as Connection543
                    connect "Mathematical function2.out" Junction69 as Connection544
                    connect Junction69 "|V|1" as Connection545
                    [
                        breakpoints = 7456, 8352
                    ]
                    connect "|V|.in" Junction69 as Connection546
                    connect Sum2.out Junction72 as Connection554
                    connect Abs5.in Junction73 as Connection557
                    connect Junction73 Junction72 as Connection558
                    connect frequency_diff3.in Junction73 as Connection559
                    connect Vc_G2 Sum8.in1 as Connection560
                    connect From46 Sum8.in as Connection561
                    connect Vb_G2 Sum7.in1 as Connection562
                    connect From38 Sum7.in as Connection563
                    connect Va_G2 Sum6.in1 as Connection564
                    connect From37 Sum6.in as Connection565
                    connect Ea-Va.in Junction74 as Connection569
                    connect Junction74 Sum6.out as Connection570
                    connect "abc to dq2.va" Junction74 as Connection571
                    [
                        breakpoints = 7944, 8536; 7944, 8296; 7800, 8296
                    ]
                    connect Ec-Vc.in Junction75 as Connection580
                    connect Junction75 Sum8.out as Connection581
                    connect "abc to dq2.vc" Junction75 as Connection582
                    connect Eb-Vb.in Junction76 as Connection599
                    connect Junction76 Sum7.out as Connection600
                    [
                        breakpoints = 7800, 8408; 7800, 8408; 7800, 8408; 7800, 8408; 7800, 8408
                    ]
                    connect "abc to dq2.vb" Junction76 as Connection601
                    [
                        breakpoints = 7944, 8584; 7904, 8584; 7904, 8384; 7880, 8384; 7880, 8384; 7800, 8384
                    ]
                    connect "Unit Delay2.out" Junction77 as Connection602
                    connect Junction77 Junction45 as Connection603
                    connect "abc to dq2.wt" Junction77 as Connection604
                    [
                        breakpoints = 7944, 8680; 7608, 8680; 7608, 8656
                    ]
                    connect Ed-Vd.in "abc to dq2.d_axis" as Connection605
                    connect Eq-Vq.in "abc to dq2.q_axis" as Connection606
                    connect Termination2.in "abc to dq2.zero_axis" as Connection607
                    connect Junction63 Junction78 as Connection609
                    [
                        breakpoints = 9008, 8152
                    ]
                    connect Junction78 "Logical operator2.in" as Connection610
                    [
                        breakpoints = 9008, 8184
                    ]
                    connect "Digital Probe1.in" Junction78 as Connection611
                    connect From34 Current_abc_to_dq3.Ec as Connection421
                    connect From33 Current_abc_to_dq3.Ea as Connection278
                    connect From35 Current_abc_to_dq3.Eb as Connection422
                    connect Gain7.in Current_abc_to_dq3.Ed as Connection438
                    [
                        breakpoints = 7304, 8736
                    ]
                    connect Current_abc_to_dq3.Eq Gain12.in as Connection439
                    [
                        breakpoints = 7304, 8832
                    ]
                    connect Goto29 Junction61 as Connection444
                    connect Junction61 Gain7.out as Connection445
                    connect Current_abc_to_dq3.wt theta_bus1 as Connection616
                    connect E_d.in Junction61 as Connection618
                    [
                        breakpoints = 7472, 8760; 7376, 8760; 7376, 8736
                    ]
                    connect Goto28 Junction80 as Connection620
                    connect Junction80 Gain12.out as Connection621
                    connect E_q.in Junction80 as Connection622
                    [
                        breakpoints = 7584, 8808; 7376, 8808
                    ]
                    connect "Mathematical function1.out" Junction81 as Connection633
                    connect Junction81 Sum3.in as Connection634
                    connect "|E|.in" Junction81 as Connection635
                    connect Junction72 "Rate Transition4.in" as Connection641
                    connect "Rate Transition4.out" "BE1-25A Synchronizer.df" as Connection642
                    connect "BE1-25A Synchronizer.del_w" "Hold after connect2.in" as Connection649
                    connect theta_bus5 "Rate Transition6.in" as Connection650
                    connect "BE1-25A Synchronizer1.dV" Junction83 as Connection659
                    connect Junction83 volt_diff3.in as Connection660
                    [
                        breakpoints = 8376, 8616; 8376, 8616; 8376, 8512
                    ]
                    connect "Rate Transition6.out" Junction83 as Connection661
                    connect "Logical operator1.out" "Rate Transition12.in" as Connection662
                    connect "Rate Transition12.out" "stay connected1.ready" as Connection663
                    connect "Rate Transition2.out" "BE1-25A Synchronizer.dAng" as Connection664
                    connect "BE1-25A Synchronizer1.del_V" "Hold after connect3.in" as Connection671
                    connect Abs4.out "Relational operator1.in1" as Connection672
                    connect Junction49 Junction84 as Connection673
                    connect Junction84 Abs4.in as Connection674
                    connect "Rate Transition2.in" Junction84 as Connection675
                    connect Connect4 "Hold after connect2.INV_sync" as Connection676
                    connect Connect6 "Hold after connect3.INV_sync" as Connection677
                    connect Junction63 Junction85 as Connection683
                    connect Junction85 Connect.in as Connection684
                    [
                        breakpoints = 9008, 8152; 9000, 8152; 9008, 8152; 9016, 8152
                    ]
                    connect "stay connected1.out" Junction85 as Connection685
                    connect "Hold after connect2.out" Junction86 as Connection691
                    connect Junction86 del_w.in as Connection692
                    [
                        breakpoints = 8680, 8432; 8680, 8432
                    ]
                    connect Goto2 Junction86 as Connection693
                    connect Connect2 "Hold after connect2.connect" as Connection694
                    connect Connect5 "Hold after connect3.connect" as Connection695
                    connect "Hold after connect3.out" Junction87 as Connection701
                    connect Junction87 Goto31 as Connection702
                    [
                        breakpoints = 8992, 8648
                    ]
                    connect del_V.in Junction87 as Connection703
                    connect w_G.in Junction88 as Connection706
                    connect Junction88 Sum2.in as Connection707
                    [
                        breakpoints = 7784, 8176
                    ]
                    connect w_e7 Junction88 as Connection708
                    connect w_bus.in Junction89 as Connection709
                    connect Junction89 Sum2.in1 as Connection710
                    [
                        breakpoints = 7784, 8224
                    ]
                    connect theta_bus2 Junction89 as Connection711
                }
                [
                    position = 7600, 7552
                    size = 112, 144
                ]

                component gen_logic_op "Logical operator1" {
                    operator = "NOT"
                }
                [
                    position = 7864, 7592
                    rotation = right
                    hide_name = True
                ]

                component gen_digital_probe "INV_sync OFF" {
                }
                [
                    position = 7936, 7624
                ]

                component gen_digital_probe "INV_sync ON" {
                }
                [
                    position = 7936, 7520
                    rotation = down
                    scale = -1, 1
                ]

                component src_scada_input INV_sync {
                    execution_rate = "Tsync"
                    format = "int"
                    max = "1"
                    min = "0"
                    signal_type = "int"
                    unit = ""
                }
                [
                    position = 7808, 7552
                ]

                component gen_bus_join "Bus Join4" {
                }
                [
                    position = 6624, 7208
                    hide_name = True
                ]

                component gen_bus_join "Bus Join5" {
                }
                [
                    position = 6624, 7368
                    hide_name = True
                ]

                component gen_probe Pref_probe {
                }
                [
                    position = 6824, 7312
                ]

                component gen_probe Qref_probe {
                }
                [
                    position = 6872, 7136
                ]

                component gen_gain Gain17 {
                    gain = "1/S"
                }
                [
                    position = 6912, 7208
                    hide_name = True
                ]

                component gen_gain Gain18 {
                    gain = "1/S"
                }
                [
                    position = 6832, 7408
                    rotation = right
                    hide_name = True
                ]

                component gen_gain Gain19 {
                    gain = "S"
                }
                [
                    position = 6536, 7216
                    hide_name = True
                ]

                component gen_gain Gain20 {
                    gain = "S"
                }
                [
                    position = 6528, 7376
                    hide_name = True
                ]

                component gen_c_function "C function6" {
                    global_variables = "real prev;"
                    in_terminal_dimensions = "2"
                    in_terminal_dimensions_str = "in 2"
                    in_terminal_labels = "[(\'in\', True)]"
                    init_fnc = "/*Begin code section*/
prev = 50;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "1"
                    out_terminal_dimensions_str = "out 1"
                    out_terminal_labels = "[(\'out\', False)]"
                    output_fnc = "/*Begin code section*/
out = 1000*prev;
/*
if (out>in[1]+1000){
    out = in[1]+1000;
}
if (out<in[1]-1000){
    out = in[1]-1000;
}
*/
/*End code section*/"
                    update_fnc = "/*Begin code section*/
prev = prev + 3e-6*(in[0]-prev);
/*
if (out-in[1]<40 && out-in[1]>-40){ 
    prev = prev + 1e-2*(in[0]-prev);
}
*/
/*End code section*/"
                }
                [
                    position = 6720, 7368
                    hide_name = True
                    size = 48, 48
                ]

                component gen_c_function "C function7" {
                    global_variables = "real prev;"
                    in_terminal_dimensions = "2"
                    in_terminal_dimensions_str = "in 2"
                    in_terminal_labels = "[(\'in\', True)]"
                    init_fnc = "/*Begin code section*/
prev = 50;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "1"
                    out_terminal_dimensions_str = "out 1"
                    out_terminal_labels = "[(\'out\', False)]"
                    output_fnc = "/*Begin code section*/
out = 1000*prev;
/*
if (out>in[1]+1000){
    out = in[1]+1000;
}
if (out<in[1]-1000){
    out = in[1]-1000;
}
*/
/*End code section*/"
                    update_fnc = "/*Begin code section*/
prev = prev + 3e-6*(in[0]-prev);
/*
if (out-in[1]<40 && out-in[1]>-40){ 
    prev = prev + 1e-2*(in[0]-prev);
}
*/
/*End code section*/"
                }
                [
                    position = 6720, 7208
                    hide_name = True
                    size = 48, 48
                ]

                component src_scada_input CONNECT {
                    execution_rate = "Ts"
                    format = "int"
                    max = "1"
                    min = "0"
                    signal_type = "int"
                    unit = ""
                }
                [
                    position = 9632, 7736
                ]

                component gen_logic_op "Logical operator2" {
                    operator = "OR"
                }
                [
                    position = 9760, 7776
                    hide_name = True
                ]

                component "core/Voltage RMS" Vrms {
                    frequency = "sys_f"
                }
                [
                    position = 10120, 7952
                    rotation = right
                    size = 64, 32
                ]

                component gen_logic_op "Logical operator3" {
                    operator = "NOT"
                }
                [
                    position = 6592, 8336
                    hide_name = True
                ]

                component "core/Rate Transition" "Rate Transition6" {
                    execution_rate = "Ts"
                }
                [
                    position = 9680, 7808
                    hide_name = True
                    size = 32, 32
                ]

                component "core/Three Phase Inverter" "Three Phase Inverter" {
                    ctrl_src = "Internal modulator"
                    ref_sig_min_max = "[-1.25, 1.25]"
                }
                [
                    position = 7504, 8000
                    size = 127, 256
                ]

                component src_constant Constant2 {
                    execution_rate = "Ts"
                }
                [
                    position = 7368, 7832
                    hide_name = True
                ]

                component "core/Four Phase Core Coupling" "Core Coupling" {
                }
                [
                    position = 9768, 8048
                    size = 12, 352
                ]

                component gen_PQ_transform "Power Meter" {
                    enable_inst_ports = "False"
                    filter_cutoff_Hz = "1"
                }
                [
                    position = 9008, 7504
                ]

                component gen_probe P {
                }
                [
                    position = 9112, 7432
                ]

                component gen_probe Q {
                }
                [
                    position = 9112, 7488
                ]

                component gen_probe Vbat {
                }
                [
                    position = 6648, 8112
                    scale = -1, 1
                ]

                component Subsystem Battery {
                    layout = dynamic
                    component gen_abs Abs1 {
                    }
                    [
                        position = 7368, 8144
                        hide_name = True
                    ]

                    component gen_math_fnc "Mathematical function1" {
                        mathematical_fn = "power"
                    }
                    [
                        position = 7608, 8160
                        hide_name = True
                    ]

                    component src_constant Constant1 {
                        execution_rate = "Ts"
                        value = "Inom"
                    }
                    [
                        position = 7280, 8184
                        hide_name = True
                    ]

                    component gen_product Product1 {
                        signs = "*/"
                    }
                    [
                        position = 7472, 8152
                        hide_name = True
                    ]

                    component src_constant Constant2 {
                        execution_rate = "Ts"
                        value = "0.9"
                    }
                    [
                        position = 7512, 8208
                        hide_name = True
                    ]

                    component gen_abs Abs2 {
                    }
                    [
                        position = 7368, 8264
                        hide_name = True
                    ]

                    component gen_math_fnc "Mathematical function2" {
                        mathematical_fn = "power"
                    }
                    [
                        position = 7496, 8272
                        hide_name = True
                    ]

                    component src_constant Constant3 {
                        execution_rate = "Ts"
                        value = "0.86"
                    }
                    [
                        position = 7400, 8312
                        hide_name = True
                    ]

                    component gen_abs Abs4 {
                    }
                    [
                        position = 7376, 8616
                        hide_name = True
                    ]

                    component gen_math_fnc "Mathematical function4" {
                        mathematical_fn = "power"
                    }
                    [
                        position = 7504, 8624
                        hide_name = True
                    ]

                    component src_constant Constant5 {
                        execution_rate = "Ts"
                        value = "1.5"
                    }
                    [
                        position = 7408, 8672
                        hide_name = True
                    ]

                    component gen_sum Sum1 {
                        signs = "+-"
                    }
                    [
                        position = 7352, 8376
                        hide_name = True
                    ]

                    component src_constant Constant6 {
                        execution_rate = "Ts"
                    }
                    [
                        position = 7272, 8352
                        hide_name = True
                    ]

                    component gen_abs Abs5 {
                    }
                    [
                        position = 7448, 8376
                        hide_name = True
                    ]

                    component gen_math_fnc "Mathematical function5" {
                        mathematical_fn = "power"
                    }
                    [
                        position = 7576, 8384
                        hide_name = True
                    ]

                    component src_constant Constant7 {
                        execution_rate = "Ts"
                        value = "1.2"
                    }
                    [
                        position = 7480, 8432
                        hide_name = True
                    ]

                    component gen_bus_join "Bus Join1" {
                        inputs = "6"
                    }
                    [
                        position = 7792, 8360
                    ]

                    component gen_c_function "C function" {
                        global_variables = "real Cbat;"
                        in_terminal_dimensions = "1;6;1;1"
                        in_terminal_dimensions_str = "Ibat 1;x 6;charge 1;Ceff 1"
                        in_terminal_labels = "[(\'Ibat\', True), (\'x\', True), (\'charge\', True), (\'Ceff\', True)]"
                        in_terminal_properties = "real Ibat;real x;int charge;real Ceff;"
                        init_fnc = "/*Begin code section*/
SOC = 0.5;
/*End code section*/"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "1;1"
                        out_terminal_dimensions_str = "Vbat 1;SOC 1"
                        out_terminal_labels = "[(\'Vbat\', True), (\'SOC\', True)]"
                        out_terminal_properties = "real Vbat;real SOC;"
                        output_fnc = "/*Begin code section*/
if (Ibat>0){
    Vbat = Nb*(2+0.16*SOC)+Nb*Ibat/Cnom*(6/(1+x[1])+0.48/x[2]+0.036)*(1-0.025*(Tamb-25));
    SOC = SOC +Ceff*Ibat/Cbat*Ts/3600.0;
}
else{
    Vbat = Nb*(1.965+0.12*SOC)+Nb*x[3]/Cnom*(4/(1+x[4])+0.27/x[5]+0.02)*(1-0.007*(Tamb-25));
    SOC = SOC + Ibat/Cbat*Ts/3600.0;
}
if (SOC<0) SOC = 0;
if (SOC>1) SOC = 1;
if (Vbat<0) Vbat = 0;  
if (Vbat>1.5e3) Vbat = 1.5e3;
/*End code section*/"
                        parameters = "real Nb;real Cnom;real Inom;real Tamb;real Ts;"
                        update_fnc = "/*Begin code section*/
Cbat = 1.67*Cnom*(1+0.005*(Tamb-25))/(1+0.67*x[0]);
/*End code section*/"
                    }
                    [
                        position = 8192, 8328
                        size = 88, 152
                    ]

                    component gen_abs Abs3 {
                    }
                    [
                        position = 7368, 8496
                        hide_name = True
                    ]

                    component gen_math_fnc "Mathematical function3" {
                        mathematical_fn = "power"
                    }
                    [
                        position = 7496, 8504
                        hide_name = True
                    ]

                    component src_constant Constant4 {
                        execution_rate = "Ts"
                        value = "1.3"
                    }
                    [
                        position = 7400, 8552
                        hide_name = True
                    ]

                    component gen_c_function "C function1" {
                        in_terminal_dimensions = "inherit;inherit"
                        in_terminal_dimensions_str = "SOC inherit;Ibat inherit"
                        in_terminal_labels = "[(\'SOC\', True), (\'Ibat\', True)]"
                        in_terminal_properties = "real SOC;inherit Ibat;"
                        no_feed_inputs = "[\'\']"
                        no_feed_outputs = "[\'\']"
                        out_terminal_dimensions = "inherit"
                        out_terminal_dimensions_str = "out inherit"
                        out_terminal_labels = "[(\'out\', False)]"
                        output_fnc = "/*Begin code section*/
if (Ibat>0) out = 20.73*(SOC-1)/(Ibat/Inom+0.55);
else out = 20.73*(SOC-1)/(-Ibat/Inom+0.55);
/*End code section*/"
                        parameters = "real Inom;"
                    }
                    [
                        position = 7832, 8608
                        hide_name = True
                        size = 56, 72
                    ]

                    component gen_math_fnc "Mathematical function6" {
                    }
                    [
                        position = 7952, 8608
                        hide_name = True
                    ]

                    component gen_sum Sum2 {
                        signs = "+-"
                    }
                    [
                        position = 8040, 8536
                        hide_name = True
                    ]

                    component src_constant Constant8 {
                        execution_rate = "Ts"
                    }
                    [
                        position = 7952, 8528
                        hide_name = True
                    ]

                    component tm_delay "Unit Delay1" {
                    }
                    [
                        position = 8288, 8384
                        hide_name = True
                    ]

                    component gen_probe SOC {
                    }
                    [
                        position = 8256, 8472
                        scale = -1, 1
                    ]

                    port Vbat {
                        position = auto:auto
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8320, 8272
                    ]

                    tag From57 {
                        value = "Ibat"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7280, 8144
                        hide_name = True
                        size = 37, 20
                    ]

                    tag From58 {
                        value = "Ibat"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7280, 8264
                        hide_name = True
                        size = 37, 20
                    ]

                    tag From60 {
                        value = "SOC"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7288, 8616
                        hide_name = True
                        size = 37, 20
                    ]

                    tag From61 {
                        value = "SOC"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7272, 8408
                        hide_name = True
                        size = 37, 20
                    ]

                    tag From62 {
                        value = "Ibat"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7792, 8280
                        hide_name = True
                        size = 37, 20
                    ]

                    tag Goto34 {
                        value = "SOC"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8368, 8384
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From63 {
                        value = "charge"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7896, 8344
                        hide_name = True
                        size = 37, 20
                    ]

                    tag From59 {
                        value = "Ibat"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7280, 8496
                        hide_name = True
                        size = 37, 20
                    ]

                    tag From64 {
                        value = "SOC"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7752, 8592
                        hide_name = True
                        size = 37, 20
                    ]

                    tag From65 {
                        value = "Ibat"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7752, 8624
                        hide_name = True
                        size = 37, 20
                    ]

                    junction Junction1 sp
                    [
                        position = 7424, 8496
                    ]

                    junction Junction2 sp
                    [
                        position = 8320, 8384
                    ]

                    connect From57 Abs1.in as Connection1
                    connect Abs1.out Product1.in as Connection2
                    connect Constant1.out Product1.in1 as Connection3
                    connect Product1.out "Mathematical function1.in" as Connection4
                    connect Constant2.out "Mathematical function1.in1" as Connection5
                    connect From58 Abs2.in as Connection6
                    connect Constant3.out "Mathematical function2.in1" as Connection7
                    connect Abs2.out "Mathematical function2.in" as Connection8
                    connect Constant5.out "Mathematical function4.in1" as Connection12
                    connect Abs4.out "Mathematical function4.in" as Connection13
                    connect From60 Abs4.in as Connection14
                    connect From61 Sum1.in1 as Connection15
                    connect Constant6.out Sum1.in as Connection16
                    connect Constant7.out "Mathematical function5.in1" as Connection17
                    connect Abs5.out "Mathematical function5.in" as Connection18
                    connect Sum1.out Abs5.in as Connection19
                    connect From62 "C function.Ibat" as Connection25
                    connect "Bus Join1.out" "C function.x" as Connection26
                    [
                        breakpoints = 7832, 8312; 7912, 8312
                    ]
                    connect From63 "C function.charge" as Connection29
                    connect From59 Abs3.in as Connection9
                    connect Constant4.out "Mathematical function3.in1" as Connection10
                    connect "Bus Join1.in" "Mathematical function1.out" as Connection30
                    connect "Bus Join1.in1" "Mathematical function2.out" as Connection31
                    connect "Bus Join1.in2" "Mathematical function5.out" as Connection32
                    connect Abs3.out Junction1 as Connection39
                    connect Junction1 "Mathematical function3.in" as Connection40
                    [
                        breakpoints = 7424, 8496
                    ]
                    connect "Bus Join1.in3" Junction1 as Connection41
                    [
                        breakpoints = 7624, 8368; 7624, 8472
                    ]
                    connect "Mathematical function3.out" "Bus Join1.in4" as Connection42
                    [
                        breakpoints = 7648, 8504; 7648, 8384
                    ]
                    connect "Mathematical function4.out" "Bus Join1.in5" as Connection43
                    [
                        breakpoints = 7672, 8624; 7672, 8400
                    ]
                    connect From64 "C function1.SOC" as Connection45
                    connect From65 "C function1.Ibat" as Connection46
                    connect "C function1.out" "Mathematical function6.in" as Connection47
                    connect Constant8.out Sum2.in as Connection48
                    connect "Mathematical function6.out" Sum2.in1 as Connection49
                    connect Sum2.out "C function.Ceff" as Connection50
                    connect "C function.SOC" "Unit Delay1.in" as Connection51
                    connect "Unit Delay1.out" Junction2 as Connection57
                    connect Junction2 Goto34 as Connection58
                    [
                        breakpoints = 8320, 8384
                    ]
                    connect SOC.in Junction2 as Connection59
                    connect "C function.Vbat" Vbat as Connection60
                }
                [
                    position = 6520, 8000
                    size = 96, 216
                ]

                component "core/Current Measurement" Idc {
                    addr = "14"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7168, 7904
                    scale = -1, -1
                    size = 64, 32
                ]

                component gen_probe Ibat {
                }
                [
                    position = 7096, 8040
                    scale = -1, 1
                ]

                component gen_limiter Limit2 {
                    lower_limit = "[-200]"
                    upper_limit = "[200]"
                }
                [
                    position = 7168, 8144
                    rotation = right
                    hide_name = True
                ]

                component gen_probe S {
                }
                [
                    position = 8648, 7552
                    rotation = down
                    scale = -1, 1
                ]

                component gen_probe Q1 {
                }
                [
                    position = 8648, 7488
                    rotation = down
                    scale = -1, 1
                ]

                component gen_probe pf {
                }
                [
                    position = 8648, 7616
                    rotation = down
                    scale = -1, 1
                ]

                component gen_probe P1 {
                }
                [
                    position = 8648, 7424
                    rotation = down
                    scale = -1, 1
                ]

                component Subsystem Power_Meas {
                    layout = dynamic
                    component gen_gain Gain6 {
                        gain = "S"
                    }
                    [
                        position = 8048, 8232
                        rotation = right
                        hide_name = True
                    ]

                    component gen_gain Gain4 {
                        gain = "S"
                    }
                    [
                        position = 7952, 8056
                        rotation = left
                        hide_name = True
                    ]

                    component gen_gain Gain5 {
                        gain = "S"
                    }
                    [
                        position = 8048, 8056
                        rotation = left
                        hide_name = True
                    ]

                    component Subsystem Power_Meas_DQpu {
                        layout = dynamic
                        component gen_c_function S_and_pf {
                            in_terminal_dimensions = "inherit;inherit"
                            in_terminal_dimensions_str = "P inherit;Q inherit"
                            in_terminal_labels = "False;False;"
                            in_terminal_properties = "real P;inherit Q;"
                            init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                            no_feed_inputs = "[u\'\']"
                            no_feed_outputs = "[u\'\']"
                            out_terminal_dimensions = "inherit;inherit"
                            out_terminal_dimensions_str = "S inherit;pf inherit"
                            out_terminal_labels = "False;False;"
                            out_terminal_properties = "inherit S;inherit pf;"
                            output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                        }
                        [
                            position = 8392, 8192
                            size = 0, 0
                        ]

                        component gen_product Product4 {
                        }
                        [
                            position = 8024, 8232
                            hide_name = True
                        ]

                        component gen_product Product3 {
                        }
                        [
                            position = 8024, 8320
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_Q {
                            a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8208, 8272
                        ]

                        component gen_product Product1 {
                        }
                        [
                            position = 8024, 8064
                            hide_name = True
                        ]

                        component gen_sum Sum1 {
                        }
                        [
                            position = 8128, 8112
                            hide_name = True
                        ]

                        component gen_z_domain_transfer LPF_P {
                            a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                            b_coeff = "1"
                            domain = "S-domain"
                            method = "Bilinear"
                        }
                        [
                            position = 8208, 8112
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8024, 8152
                            hide_name = True
                        ]

                        component gen_sum Sum2 {
                            signs = "+-"
                        }
                        [
                            position = 8128, 8272
                            hide_name = True
                        ]

                        port Vd {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7808, 8056
                        ]

                        port Vq {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7808, 8144
                        ]

                        port Id {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7808, 8240
                        ]

                        port Iq {
                            position = left:4
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7808, 8328
                        ]

                        port P {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8312, 8112
                        ]

                        port Q {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8312, 8272
                        ]

                        port S {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8464, 8144
                        ]

                        port pf {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8464, 8240
                        ]

                        junction Junction1 sp
                        [
                            position = 7920, 8240
                        ]

                        junction Junction2 sp
                        [
                            position = 7928, 8328
                        ]

                        junction Junction3 sp
                        [
                            position = 7944, 8144
                        ]

                        junction Junction4 sp
                        [
                            position = 7960, 8056
                        ]

                        junction Junction5 sp
                        [
                            position = 8264, 8112
                        ]

                        junction Junction6 sp
                        [
                            position = 8264, 8272
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                        [
                            position = 8000, 7976
                        ]

                        connect Junction1 Id as Connection49
                        connect Junction1 Product4.in1 as Connection24
                        connect Junction2 Iq as Connection52
                        connect Junction2 Product3.in1 as Connection27
                        connect Junction3 Product2.in as Connection32
                        connect Junction3 Vq as Connection53
                        connect Junction4 Product1.in as Connection35
                        connect Junction4 Vd as Connection50
                        connect Junction5 LPF_P.out as Connection44
                        connect Junction5 P as Connection55
                        connect Junction6 LPF_Q.out as Connection47
                        connect Junction6 Q as Connection56
                        connect LPF_P.in Sum1.out as Connection39
                        connect LPF_Q.in Sum2.out as Connection40
                        connect Product1.in1 Junction1 as Connection25
                        connect Product2.in1 Junction2 as Connection28
                        connect Product3.in Junction4 as Connection36
                        connect Product4.in Junction3 as Connection33
                        connect S_and_pf.P Junction5 as Connection45
                        connect S_and_pf.Q Junction6 as Connection48
                        connect S_and_pf.S S as Connection51
                        connect S_and_pf.pf pf as Connection54
                        connect Sum1.in Product1.out as Connection29
                        connect Sum1.in1 Product2.out as Connection30
                        connect Sum2.in1 Product3.out as Connection38
                        connect Sum2.in Product4.out as Connection37

                        mask {
                            description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                            fc_P {
                                label = "Active power low pass filter cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "1.0"
                                unit = "Hz"
                            }

                            fc_Q {
                                label = "Reactive power low pass filter cut-off freq."
                                widget = edit
                                type = generic
                                default_value = "1.0"
                                unit = "Hz"
                            }

                            CODE open
                                from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                            
                                dialog = RegularComponentPropertiesDialog(
                                    component=component,
                                    property_container=component.masks[-1],
                                    current_diagram=current_diagram
                                )
                                dialog.exec_()
                            
                            ENDCODE
                        }
                    }
                    [
                        position = 7864, 8160
                        size = 72, 128
                    ]

                    port Vd {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7760, 8048
                        rotation = right
                    ]

                    port Vq {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7696, 8048
                        rotation = right
                    ]

                    port Id {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7696, 8248
                        rotation = left
                    ]

                    port Iq {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7760, 8248
                        rotation = left
                    ]

                    port P {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7952, 8000
                        rotation = left
                    ]

                    port Q {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 8000
                        rotation = left
                    ]

                    port S {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8048, 8288
                        rotation = right
                    ]

                    port pf {
                        position = right:4
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 7992, 8288
                        rotation = right
                    ]

                    connect Gain4.out P as Connection10
                    connect Gain4.in Power_Meas_DQpu.P as Connection20
                    connect Gain5.in Power_Meas_DQpu.Q as Connection21
                    connect Gain5.out Q as Connection11
                    connect Gain6.in Power_Meas_DQpu.S as Connection16
                    connect Gain6.out S as Connection13
                    connect Id Power_Meas_DQpu.Id as Connection14
                    connect Iq Power_Meas_DQpu.Iq as Connection17
                    connect Vd Power_Meas_DQpu.Vd as Connection15
                    connect Vq Power_Meas_DQpu.Vq as Connection18
                    connect pf Power_Meas_DQpu.pf as Connection19
                }
                [
                    position = 8456, 7520
                    size = 96, 232
                ]

                component pas_capacitor Cdc {
                    capacitance = "1e-3"
                    initial_voltage = "700"
                }
                [
                    position = 7264, 7992
                    rotation = right
                ]

                component pas_resistor Ri {
                    resistance = "1e-2"
                }
                [
                    position = 7072, 7904
                ]

                component "core/Voltage Measurement" Vdc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7360, 7992
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component gen_probe VDC {
                }
                [
                    position = 7272, 8184
                    scale = -1, 1
                ]

                component src_constant Constant3 {
                    execution_rate = "Ts"
                    value = "700"
                }
                [
                    position = 6712, 7912
                    hide_name = True
                ]

                component src_clock Clock1 {
                    execution_rate = "Ts"
                }
                [
                    position = 9656, 7536
                ]

                component gen_comparator Comparator1 {
                }
                [
                    position = 9776, 7584
                ]

                component gen_logic_op "Logical operator4" {
                }
                [
                    position = 9856, 7688
                    hide_name = True
                ]

                component src_constant Constant4 {
                    execution_rate = "Ts"
                    value = "10"
                }
                [
                    position = 9664, 7608
                    hide_name = True
                ]

                component pas_resistor R17 {
                    resistance = "1e4"
                }
                [
                    position = 9424, 8384
                    rotation = right
                ]

                component pas_resistor R18 {
                    resistance = "1e4"
                }
                [
                    position = 9360, 8384
                    rotation = right
                ]

                component pas_resistor R16 {
                    resistance = "1e4"
                }
                [
                    position = 9488, 8384
                    rotation = right
                ]

                port Vc {
                    label = "Vc"
                    position = top:3
                    kind = pe
                }
                [
                    position = 10648, 8096
                    scale = -1, 1
                ]

                port Vb {
                    label = "Vb"
                    position = top:2
                    kind = pe
                }
                [
                    position = 10648, 8000
                    scale = -1, 1
                ]

                port Ground {
                    label = "Ground"
                    position = bottom:4
                    kind = pe
                }
                [
                    position = 10664, 8688
                    scale = -1, 1
                ]

                port Va {
                    label = "Va"
                    position = top:1
                    kind = pe
                }
                [
                    position = 10648, 7904
                    scale = -1, 1
                ]

                port setpoint_P {
                    position = right:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6464, 7320
                ]

                port setpoint_Q {
                    position = right:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6472, 7152
                ]

                port PCC_status {
                    position = right:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6512, 8336
                ]

                port charge {
                    position = right:4
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 6376, 7592
                ]

                tag Goto39 {
                    value = "Ib1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9112, 7968
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto18 {
                    value = "VDC"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7384, 8184
                    size = 60, 20
                ]

                tag Connect2 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 9616, 7808
                    hide_name = True
                ]

                tag Goto31 {
                    value = "Ic1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9112, 8064
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto35 {
                    value = "Xi_a1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7888, 8160
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Vb_G {
                    value = "VbG"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 10232, 8288
                ]

                tag Goto41 {
                    value = "Ea1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8400, 8144
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto44 {
                    value = "Xi_b1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7888, 8208
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto30 {
                    value = "Ec1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8496, 8352
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Vc_G {
                    value = "VcG"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 10352, 8408
                ]

                tag From2 {
                    value = "modulator"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7256, 7776
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto38 {
                    value = "Xi_c1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7888, 8256
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto33 {
                    value = "E_c1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7920, 8480
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Va_G {
                    value = "VaG"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 10112, 8216
                ]

                tag Goto32 {
                    value = "Ia1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9112, 7872
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto40 {
                    value = "Eb1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8464, 8256
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto42 {
                    value = "E_b1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7792, 8432
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto34 {
                    value = "E_a1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7648, 8384
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Connect6 {
                    value = "INV_sync"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7936, 7552
                    hide_name = True
                ]

                tag From54 {
                    value = "P1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 6464, 7376
                    size = 60, 20
                ]

                tag From55 {
                    value = "Q1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 6472, 7216
                    size = 60, 20
                ]

                tag Goto45 {
                    value = "Island"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 6704, 8336
                    size = 60, 20
                ]

                tag Goto46 {
                    value = "Ibat"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7072, 8200
                    scale = -1, 1
                    size = 60, 20
                ]

                tag From58 {
                    value = "Ea1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8872, 7440
                    hide_name = True
                    size = 37, 20
                ]

                tag From59 {
                    value = "Eb1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8848, 7464
                    hide_name = True
                    size = 37, 20
                ]

                tag From60 {
                    value = "Ec1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8824, 7488
                    hide_name = True
                    size = 37, 20
                ]

                tag From61 {
                    value = "Xi_a1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8824, 7512
                    hide_name = True
                    size = 37, 20
                ]

                tag From62 {
                    value = "Xi_b1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8824, 7536
                    hide_name = True
                    size = 37, 20
                ]

                tag From63 {
                    value = "Xi_c1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8824, 7560
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto48 {
                    value = "charge"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 6552, 7592
                    size = 60, 20
                ]

                tag Goto49 {
                    value = "Q"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8584, 7464
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto50 {
                    value = "P"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8584, 7400
                    hide_name = True
                    size = 0, 0
                ]

                tag Goto51 {
                    value = "pf"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8584, 7592
                    hide_name = True
                    size = 0, 0
                ]

                tag From31 {
                    value = "Eq"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 7488
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto52 {
                    value = "S"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8584, 7528
                    hide_name = True
                    size = 0, 0
                ]

                tag From34 {
                    value = "Xi_d"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 7552
                    hide_name = True
                    size = 60, 20
                ]

                tag From32 {
                    value = "Ed"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 7424
                    hide_name = True
                    size = 60, 20
                ]

                tag From35 {
                    value = "Xi_q"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8328, 7616
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction173 pe
                [
                    position = 8320, 8096
                ]

                junction Junction160 pe
                [
                    position = 8240, 8000
                ]

                junction Junction207 pe
                [
                    position = 8240, 8688
                ]

                junction Junction192 pe
                [
                    position = 8240, 8688
                ]

                junction Junction198 pe
                [
                    position = 8240, 8688
                ]

                junction Junction216 pe
                [
                    position = 8320, 8312
                ]

                junction Junction302 pe
                [
                    position = 10280, 8688
                ]

                junction Junction284 sp
                [
                    position = 8624, 8352
                ]

                junction Junction195 pe
                [
                    position = 8240, 8688
                ]

                junction Junction215 pe
                [
                    position = 8240, 8688
                ]

                junction Junction161 pe
                [
                    position = 8160, 7904
                ]

                junction Junction292 pe
                [
                    position = 8240, 8688
                ]

                junction Junction306 pe
                [
                    position = 10032, 7904
                ]

                junction Junction307 pe
                [
                    position = 10160, 8000
                ]

                junction Junction283 sp
                [
                    position = 8512, 8256
                ]

                junction Junction308 pe
                [
                    position = 10280, 8096
                ]

                junction Junction212 pe
                [
                    position = 8240, 8688
                ]

                junction Junction310 pe
                [
                    position = 10536, 8688
                ]

                junction Junction309 pe
                [
                    position = 10472, 8688
                ]

                junction Junction194 pe
                [
                    position = 8240, 8688
                ]

                junction Junction213 pe
                [
                    position = 8240, 8304
                ]

                junction Junction199 pe
                [
                    position = 8240, 8688
                ]

                junction Junction303 pe
                [
                    position = 10160, 8688
                ]

                junction Junction311 sp
                [
                    position = 8448, 8144
                ]

                junction Junction312 pe
                [
                    position = 8160, 8296
                ]

                junction Junction47 sp
                [
                    position = 7864, 7552
                ]

                junction Junction48 sp
                [
                    position = 7864, 7552
                ]

                junction Junction319 sp
                [
                    position = 6768, 7368
                ]

                junction Junction320 pe
                [
                    position = 8544, 7904
                ]

                junction Junction321 pe
                [
                    position = 8608, 8000
                ]

                junction Junction322 pe
                [
                    position = 8688, 8096
                ]

                junction Junction325 sp
                [
                    position = 6792, 7208
                ]

                junction Junction332 pe
                [
                    position = 10120, 7904
                ]

                junction Junction333 pe
                [
                    position = 10120, 8000
                ]

                junction Junction340 pe
                [
                    position = 10032, 8688
                ]

                junction Junction341 pe
                [
                    position = 8688, 8688
                ]

                junction Junction346 sp
                [
                    position = 7168, 8040
                ]

                junction Junction188 sp
                [
                    position = 8536, 7424
                ]

                junction Junction189 sp
                [
                    position = 8536, 7488
                ]

                junction Junction190 sp
                [
                    position = 8536, 7552
                ]

                junction Junction191 sp
                [
                    position = 8536, 7616
                ]

                junction Junction347 pe
                [
                    position = 7264, 7904
                ]

                junction Junction348 pe
                [
                    position = 7264, 8096
                ]

                junction Junction349 pe
                [
                    position = 7360, 7904
                ]

                junction Junction350 pe
                [
                    position = 7360, 8096
                ]

                junction Junction351 sp
                [
                    position = 7328, 8184
                ]

                junction Junction352 sp
                [
                    position = 6768, 8000
                ]

                junction Junction353 pe
                [
                    position = 9360, 7904
                ]

                junction Junction354 pe
                [
                    position = 9360, 8688
                ]

                junction Junction355 pe
                [
                    position = 9424, 8000
                ]

                junction Junction356 pe
                [
                    position = 9424, 8688
                ]

                junction Junction358 pe
                [
                    position = 9488, 8688
                ]

                junction Junction359 pe
                [
                    position = 9488, 8096
                ]

                connect Ea1.n_node Junction292 as Connection1069
                [
                    breakpoints = 8544, 8224; 8384, 8224; 8384, 8304; 8384, 8688
                ]
                connect Xi_b1.out Goto44 as Connection374
                connect Junction309 Junction310 as Connection1285
                [
                    breakpoints = 10480, 8688
                ]
                connect La1.p_node Ia1.p_node as Connection665
                connect Tr1.n2 Junction310 as Connection1287
                connect Eb_1.in Junction283 as Connection952
                connect S2.a_out Junction306 as Connection1268
                connect Rt0a1.n_node Junction161 as Connection366
                connect R0b1.n_node L0b1.n_node as Connection385
                connect Junction207 Junction215 as Connection1222
                [
                    breakpoints = 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688
                ]
                connect Xi_a1.n_node Junction161 as Connection314
                connect Xi_b1.n_node Junction160 as Connection388
                connect Goto35 Xi_a1.out as Connection342
                connect VbG.n_node Junction303 as Connection1225
                connect Xi_c1.out Goto38 as Connection313
                connect Junction283 Eb1.out as Connection951
                connect Junction192 Junction194 as Connection459
                connect Junction302 Junction303 as Connection1223
                connect Vc2.out Goto33 as Connection617
                [
                    breakpoints = 7984, 8480; 7968, 8480
                ]
                connect Junction213 Cb1.p_node as Connection613
                [
                    breakpoints = 8240, 8304; 8240, 8304; 8240, 8304
                ]
                connect Ic1.out Goto31 as Connection668
                connect Tr1.n1 Junction309 as Connection1284
                connect Lc1.p_node Ic1.p_node as Connection663
                connect Rt0b1.n_node Junction160 as Connection351
                connect Junction194 Ca1.n_node as Connection597
                [
                    breakpoints = 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8544; 8160, 8544
                ]
                connect L0c1.p_node Xi_c1.p_node as Connection328
                connect Va2.out Goto34 as Connection624
                connect VbG.p_node Junction307 as Connection1271
                connect Vb Tr1.sec_2 as Connection1278
                connect Junction306 VaG.p_node as Connection1269
                [
                    breakpoints = 10032, 7904
                ]
                connect R0c1.n_node L0c1.n_node as Connection330
                connect Junction195 Junction194 as Connection463
                connect Junction207 Junction198 as Connection574
                [
                    breakpoints = 8240, 8688
                ]
                connect Cb1.n_node Junction212 as Connection602
                connect VbG.out Vb_G as Connection1126
                connect S2.c_out Junction308 as Connection1274
                connect Vb2.p_node Junction213 as Connection614
                [
                    breakpoints = 8064, 8304; 8240, 8304
                ]
                connect Tr1.prm_2 Junction307 as Connection1279
                connect Eb1.n_node Junction195 as Connection462
                connect Goto39 Ib1.out as Connection669
                connect Vc2.p_node Junction216 as Connection627
                connect Va Tr1.sec_1 as Connection1280
                connect VcG.n_node Junction302 as Connection1221
                connect Lb1.p_node Ib1.p_node as Connection664
                connect Vc2.n_node Junction215 as Connection623
                connect Rc1.n_node Lc1.n_node as Connection399
                connect Goto40 Junction283 as Connection950
                connect L0a1.p_node Xi_a1.p_node as Connection378
                connect Vc Tr1.sec_3 as Connection1276
                connect Junction198 Junction199 as Connection537
                [
                    breakpoints = 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688; 8240, 8688
                ]
                connect Vb2.out Goto42 as Connection616
                connect Xi_c1.n_node Junction173 as Connection304
                connect Junction212 Junction192 as Connection603
                connect Rt0c1.p_node Junction216 as Connection625
                [
                    breakpoints = 8320, 8288
                ]
                connect Ec_1.in Junction284 as Connection956
                [
                    breakpoints = 8624, 8384; 8624, 8352
                ]
                connect La1.n_node Ra1.n_node as Connection401
                connect L0b1.p_node Xi_b1.p_node as Connection372
                connect Junction308 VcG.p_node as Connection1275
                [
                    breakpoints = 10280, 8096
                ]
                connect L0a1.n_node R0a1.n_node as Connection355
                connect Ia1.out Goto32 as Connection666
                connect Rt0b1.p_node Junction213 as Connection612
                connect Rb1.n_node Lb1.n_node as Connection354
                connect Junction302 Junction309 as Connection1282
                [
                    breakpoints = 10280, 8688
                ]
                connect Junction192 Junction292 as Connection1067
                connect Vb2.n_node Junction215 as Connection621
                connect Junction284 Ec1.out as Connection955
                [
                    breakpoints = 8624, 8352; 8624, 8272
                ]
                connect Junction292 Cc1.n_node as Connection1068
                [
                    breakpoints = 8240, 8688; 8240, 8688; 8240, 8544; 8320, 8544
                ]
                connect Goto30 Junction284 as Connection954
                connect Junction310 Ground as Connection1286
                [
                    breakpoints = 10544, 8688
                ]
                connect Junction216 Cc1.p_node as Connection626
                [
                    breakpoints = 8320, 8304; 8320, 8304; 8320, 8304
                ]
                connect Vc_G VcG.out as Connection1127
                connect Rt0c1.n_node Junction173 as Connection327
                connect Junction198 Junction195 as Connection477
                [
                    breakpoints = 8240, 8688; 8240, 8688
                ]
                connect Tr1.prm_3 Junction308 as Connection1277
                connect Goto41 Junction311 as Connection1292
                connect Junction311 Ea1.out as Connection1293
                connect Ea_1.in Junction311 as Connection1294
                connect Rt0a1.p_node Junction312 as Connection1296
                connect Junction312 Ca1.p_node as Connection1297
                connect Va2.p_node Junction312 as Connection1298
                connect "INV_sync OFF.in" "Logical operator1.out" as Connection155
                connect INV_sync.out Junction47 as Connection1299
                connect Junction47 Connect6 as Connection343
                connect "Logical operator1.in" Junction48 as Connection345
                connect Junction48 Junction47 as Connection346
                connect "INV_sync ON.in" Junction48 as Connection347
                connect From55 Gain19.in as Connection1847
                connect Gain19.out "Bus Join4.in1" as Connection1848
                connect From54 Gain20.in as Connection1849
                connect Gain20.out "Bus Join5.in1" as Connection1850
                connect Gain18.in Junction319 as Connection1886
                connect Junction319 Pref_probe.in as Connection1887
                [
                    breakpoints = 6768, 7368
                ]
                connect "C function6.out" Junction319 as Connection1888
                connect "C function6.in" "Bus Join5.out" as Connection1889
                connect setpoint_P "Bus Join5.in" as Connection1890
                connect setpoint_Q "Bus Join4.in" as Connection1891
                connect Gain18.out Controller.U_P as Connection1892
                connect Gain17.out Controller.U_Q as Connection1893
                connect Junction161 Junction320 as Connection1899
                [
                    breakpoints = 8160, 7904
                ]
                connect Junction320 Ea1.p_node as Connection1900
                [
                    breakpoints = 8544, 7904; 8544, 7904; 8544, 7904
                ]
                connect Eb1.p_node Junction321 as Connection1902
                connect Junction321 Junction160 as Connection1903
                [
                    breakpoints = 8608, 8000
                ]
                connect Rb1.p_node Junction321 as Connection1904
                connect Junction173 Junction322 as Connection1905
                [
                    breakpoints = 8320, 8096
                ]
                connect Junction322 Ec1.p_node as Connection1906
                [
                    breakpoints = 8688, 8272; 8688, 8272; 8688, 8096
                ]
                connect Rc1.p_node Junction322 as Connection1907
                connect "Bus Join4.out" "C function7.in" as Connection1915
                connect Gain17.in Junction325 as Connection1916
                connect Junction325 Qref_probe.in as Connection1917
                [
                    breakpoints = 6792, 7208
                ]
                connect "C function7.out" Junction325 as Connection1918
                connect VaG.out Va_G as Connection1919
                connect CONNECT.out "Logical operator2.in" as Connection1939
                connect Junction320 Ra1.p_node as Connection1941
                [
                    breakpoints = 8544, 7904; 8800, 7904
                ]
                connect Tr1.prm_1 Junction332 as Connection1943
                connect Junction332 Junction306 as Connection1944
                connect Vrms.p_node Junction332 as Connection1945
                connect Junction307 Junction333 as Connection1946
                [
                    breakpoints = 10160, 8000
                ]
                connect Junction333 S2.b_out as Connection1947
                connect Vrms.n_node Junction333 as Connection1948
                connect PCC_status "Logical operator3.in" as Connection1953
                connect "Logical operator3.out" Goto45 as Connection1954
                [
                    breakpoints = 6664, 8336
                ]
                connect Connect2 "Rate Transition6.in" as Connection1955
                connect "Rate Transition6.out" "Logical operator2.in1" as Connection1956
                connect From2 "Bus Split1.in" as Connection1978
                connect Constant2.out "Three Phase Inverter.En" as Connection1982
                connect "Core Coupling.a_out" S2.a_in as Connection2008
                connect "Core Coupling.b_out" S2.b_in as Connection2010
                connect "Core Coupling.c_out" S2.c_in as Connection2012
                connect Junction303 Junction340 as Connection2013
                [
                    breakpoints = 10160, 8688; 10160, 8688
                ]
                connect Junction340 VaG.n_node as Connection2014
                [
                    breakpoints = 10032, 8688; 10032, 8688
                ]
                connect "Core Coupling.d_out" Junction340 as Connection2015
                [
                    breakpoints = 9792, 8688; 10000, 8688
                ]
                connect Ec1.n_node Junction341 as Connection2016
                [
                    breakpoints = 8688, 8536
                ]
                connect Junction341 Junction207 as Connection2017
                [
                    breakpoints = 8688, 8688; 8688, 8688; 8688, 8688; 8688, 8688; 8688, 8688; 8240, 8688; 8240, 8688
                ]
                connect "Three Phase Inverter.a_in" R0a1.p_node as Connection2019
                connect "Three Phase Inverter.b_in" R0b1.p_node as Connection2020
                connect "Three Phase Inverter.c_in" R0c1.p_node as Connection2021
                connect From58 "Power Meter.va" as Connection2022
                connect From59 "Power Meter.vb" as Connection2023
                [
                    breakpoints = 8928, 7464; 8928, 7480
                ]
                connect From60 "Power Meter.vc" as Connection2024
                connect From61 "Power Meter.ia" as Connection2025
                connect From62 "Power Meter.ib" as Connection2026
                [
                    breakpoints = 8864, 7528; 8960, 7528
                ]
                connect From63 "Power Meter.ic" as Connection2027
                connect P.in "Power Meter.Pdc" as Connection2028
                connect Q.in "Power Meter.Qdc" as Connection2029
                connect charge Goto48 as Connection2034
                connect Goto46 Limit2.out as Connection2057
                connect Ibat.in Junction346 as Connection2060
                connect Junction346 Idc.out as Connection2061
                [
                    breakpoints = 7168, 8040; 7168, 7968
                ]
                connect Limit2.in Junction346 as Connection2062
                connect From31 Power_Meas.Vq as Connection403
                connect From32 Power_Meas.Vd as Connection402
                connect From34 Power_Meas.Id as Connection404
                connect Goto50 Junction188 as Connection541
                connect Goto49 Junction189 as Connection544
                connect Goto52 Junction190 as Connection547
                connect Goto51 Junction191 as Connection550
                connect Junction188 Power_Meas.P as Connection540
                connect Junction189 Power_Meas.Q as Connection543
                connect Junction190 Power_Meas.S as Connection546
                connect Junction191 Power_Meas.pf as Connection549
                connect P1.in Junction188 as Connection539
                connect Power_Meas.Iq From35 as Connection405
                connect Q1.in Junction189 as Connection542
                connect S.in Junction190 as Connection545
                connect pf.in Junction191 as Connection548
                connect Idc.p_node Junction347 as Connection2063
                connect Cdc.p_node Junction347 as Connection2065
                connect Cdc.n_node Junction348 as Connection2068
                connect Idc.n_node Ri.n_node as Connection2069
                connect Ri.p_node Vbtt.p_node as Connection2070
                connect "Three Phase Inverter.InC" "Bus Split1.out2" as Connection2081
                [
                    breakpoints = 7528, 7792
                ]
                connect "Three Phase Inverter.InA" "Bus Split1.out" as Connection2083
                [
                    breakpoints = 7496, 7864; 7496, 7760; 7448, 7760
                ]
                connect "Bus Split1.out1" "Three Phase Inverter.InB" as Connection2082
                [
                    breakpoints = 7512, 7776
                ]
                connect Junction347 Junction349 as Connection2084
                connect Junction349 "Three Phase Inverter.pos_out" as Connection2085
                connect Vdc.p_node Junction349 as Connection2086
                connect "Three Phase Inverter.neg_out" Junction350 as Connection2087
                connect Junction350 Junction348 as Connection2088
                connect Vdc.n_node Junction350 as Connection2089
                connect Goto18 Junction351 as Connection2092
                connect Junction351 Vdc.out as Connection2093
                connect VDC.in Junction351 as Connection2094
                connect Constant3.out Junction352 as Connection2096
                connect Junction352 Vbtt.in as Connection2097
                connect Vbat.in Junction352 as Connection2098
                connect Vbtt.n_node Junction348 as Connection2099
                [
                    breakpoints = 6976, 8096
                ]
                connect Va2.n_node Junction212 as Connection2100
                [
                    breakpoints = 7744, 8688; 7744, 8688; 8240, 8688
                ]
                connect Clock1.out Comparator1.in1 as Connection2101
                connect Constant4.out Comparator1.in2 as Connection2102
                connect "Logical operator4.in" Comparator1.out as Connection2103
                connect "Logical operator4.in1" "Logical operator2.out" as Connection2104
                connect "Logical operator4.out" S2.ctrl_in as Connection2105
                connect Ia1.n_node Junction353 as Connection2106
                connect Junction353 "Core Coupling.a_in" as Connection2107
                connect R18.p_node Junction353 as Connection2108
                connect Junction354 Junction341 as Connection2110
                [
                    breakpoints = 8720, 8688
                ]
                connect R18.n_node Junction354 as Connection2111
                connect Ib1.n_node Junction355 as Connection2112
                connect R17.p_node Junction355 as Connection2114
                connect Junction356 Junction354 as Connection2116
                connect R17.n_node Junction356 as Connection2117
                connect "Core Coupling.d_in" Junction358 as Connection2121
                [
                    breakpoints = 9720, 8192; 9720, 8688
                ]
                connect Junction358 Junction356 as Connection2122
                connect R16.n_node Junction358 as Connection2123
                connect "Core Coupling.b_in" Junction355 as Connection2124
                [
                    breakpoints = 9488, 8000
                ]
                connect Ic1.n_node Junction359 as Connection2125
                connect Junction359 "Core Coupling.c_in" as Connection2126
                connect R16.p_node Junction359 as Connection2127

                C_s = "5e-6"
                Ki_V = "0.7493"
                Kp_I = "2"
                Kp_V = "0.0033"
                L_i = "5e-3"
                L_o = "1e-3"
                R_i = "0.01"
                R_o = "0.01"
                R_s = "1e-3"

                mask {
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">A grid-forming three-phase inverter with a frequency and voltage droop controller</p></body></html>"

                    S {
                        label = "Rated Power "
                        widget = edit
                        type = generic
                        default_value = "200e3"
                        unit = "VA"
                        group = "1. Three-phase Inverter"
                    }

                    V_ABC {
                        label = "Rated Phase Voltage (RMS)"
                        widget = edit
                        type = generic
                        default_value = "277/np.sqrt(3)"
                        unit = "V"
                        group = "1. Three-phase Inverter"
                    }

                    w_0 {
                        label = "Nominal Frequency"
                        widget = edit
                        type = generic
                        default_value = "2*np.pi*60"
                        unit = "rad/s"
                        group = "1. Three-phase Inverter"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts_ess"
                        unit = "s"
                        group = "1. Three-phase Inverter"
                    }

                    R_i {
                        label = "Input Resistance"
                        widget = edit
                        type = generic
                        default_value = "0.1"
                        unit = ""
                        group = "2. LCL filter"
                    }

                    L_i {
                        label = "Input Inductance"
                        widget = edit
                        type = generic
                        default_value = "6e-3"
                        unit = "H"
                        group = "2. LCL filter"
                    }

                    R_s {
                        label = "Shunt Resistance"
                        widget = edit
                        type = generic
                        default_value = "15e-3"
                        unit = ""
                        group = "2. LCL filter"
                    }

                    C_s {
                        label = "Shunt Capacitance"
                        widget = edit
                        type = generic
                        default_value = "150e-6"
                        unit = "F"
                        group = "2. LCL filter"
                    }

                    R_o {
                        label = "Output Resistance"
                        widget = edit
                        type = generic
                        default_value = "0.03"
                        unit = ""
                        group = "2. LCL filter"
                    }

                    L_o {
                        label = "Output Inductance"
                        widget = edit
                        type = generic
                        default_value = "0.3e-3"
                        unit = "H"
                        group = "2. LCL filter"
                    }

                    R {
                        label = "Resistance"
                        widget = edit
                        type = generic
                        default_value = "1e-3"
                        unit = ""
                        group = "3. Electrical Line"
                    }

                    L {
                        label = "Inductance"
                        widget = edit
                        type = generic
                        default_value = "100e-6"
                        unit = "H"
                        group = "3. Electrical Line"
                    }

                    Kp_I {
                        label = "Inner Loop Proportional Gain"
                        widget = edit
                        type = generic
                        default_value = "1.2"
                        group = "4. Cascaded Controller"
                    }

                    Ki_I {
                        label = "Inner Loop Integral Gain"
                        widget = edit
                        type = generic
                        default_value = "2"
                        group = "4. Cascaded Controller"
                    }

                    Imax {
                        label = "Inner Loop Upper Limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "4. Cascaded Controller"
                    }

                    Imin {
                        label = "Inner Loop Lower Limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "4. Cascaded Controller"
                    }

                    Kp_V {
                        label = "Outer Loop Proportional Gain"
                        widget = edit
                        type = generic
                        default_value = "0.01"
                        group = "4. Cascaded Controller"
                    }

                    Ki_V {
                        label = "Outer Loop Integral Gain"
                        widget = edit
                        type = generic
                        default_value = "2.2478"
                        group = "4. Cascaded Controller"
                    }

                    Vmax {
                        label = "Outer Loop Upper Limit"
                        widget = edit
                        type = generic
                        default_value = "1"
                        group = "4. Cascaded Controller"
                    }

                    Vmin {
                        label = "Outer Loop Lower Limit"
                        widget = edit
                        type = generic
                        default_value = "-1"
                        group = "4. Cascaded Controller"
                    }

                    f_D {
                        label = "Frequency Droop Coefficient"
                        widget = edit
                        type = generic
                        default_value = "3e-3"
                        unit = "%"
                        group = "5. Droop Control"
                    }

                    V_D {
                        label = "Voltage Droop Coefficient"
                        widget = edit
                        type = generic
                        default_value = "5e-3"
                        unit = "%"
                        group = "5. Droop Control"
                    }

                    T_m {
                        label = "Measurement delay"
                        widget = edit
                        type = generic
                        default_value = "0.5"
                        unit = "s"
                        group = "5. Droop Control"
                    }

                    maxV_slip {
                        label = "Maximum slip (voltage)"
                        widget = edit
                        type = generic
                        default_value = "5e-3"
                        unit = "pu"
                        group = "6. Automatic Synchronizer"
                    }

                    minV_slip {
                        label = "Minimum slip (voltage)"
                        widget = edit
                        type = generic
                        default_value = "2.5e-3"
                        unit = "pu"
                        group = "6. Automatic Synchronizer"
                    }

                    maxw_slip {
                        label = "Maximum slip (frequency)"
                        widget = edit
                        type = generic
                        default_value = "10e-3"
                        unit = "pu"
                        group = "6. Automatic Synchronizer"
                    }

                    minw_slip {
                        label = "Minimum slip (frequency)"
                        widget = edit
                        type = generic
                        default_value = "5e-3"
                        unit = "pu"
                        group = "6. Automatic Synchronizer"
                    }

                    maxV_pds {
                        label = "Maximum difference signal (voltage)"
                        widget = edit
                        type = generic
                        default_value = "1e-2"
                        unit = "pu"
                        group = "6. Automatic Synchronizer"
                    }

                    maxw_pds {
                        label = "Maximum difference signal (frequency)"
                        widget = edit
                        type = generic
                        default_value = "5e-1"
                        unit = "pu"
                        group = "6. Automatic Synchronizer"
                    }

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE

                    CODE init
                        S = mdl.get_property_value(mdl.prop(item_handle, "S"))
                        V_ABC = mdl.get_property_value(mdl.prop(item_handle, "V_ABC"))
                        w_0 = mdl.get_property_value(mdl.prop(item_handle, "w_0"))
                        Ts = mdl.get_property_value(mdl.prop(item_handle, "Ts"))
                        R_i = mdl.get_property_value(mdl.prop(item_handle, "R_i"))
                        L_i = mdl.get_property_value(mdl.prop(item_handle, "L_i"))
                        R_s = mdl.get_property_value(mdl.prop(item_handle, "R_s"))
                        C_s = mdl.get_property_value(mdl.prop(item_handle, "C_s"))
                        R_o = mdl.get_property_value(mdl.prop(item_handle, "R_o"))
                        L_o = mdl.get_property_value(mdl.prop(item_handle, "L_o"))
                        R = mdl.get_property_value(mdl.prop(item_handle, "R"))
                        L = mdl.get_property_value(mdl.prop(item_handle, "L"))
                        Kp_I = mdl.get_property_value(mdl.prop(item_handle, "Kp_I"))
                        Ki_I = mdl.get_property_value(mdl.prop(item_handle, "Ki_I"))
                        Imax = mdl.get_property_value(mdl.prop(item_handle, "Imax"))
                        Imin = mdl.get_property_value(mdl.prop(item_handle, "Imin"))
                        Kp_V = mdl.get_property_value(mdl.prop(item_handle, "Kp_V"))
                        Ki_V = mdl.get_property_value(mdl.prop(item_handle, "Ki_V"))
                        Vmax = mdl.get_property_value(mdl.prop(item_handle, "Vmax"))
                        Vmin = mdl.get_property_value(mdl.prop(item_handle, "Vmin"))
                        f_D = mdl.get_property_value(mdl.prop(item_handle, "f_D"))
                        V_D = mdl.get_property_value(mdl.prop(item_handle, "V_D"))
                        T_m = mdl.get_property_value(mdl.prop(item_handle, "T_m"))
                        
                        
                        Tfast = Ts
                        S_DQ = (2/3)*S
                        V_DQ = V_ABC*np.sqrt(2)
                        I_DQ = S_DQ/V_DQ
                        Z_DQ = V_DQ/I_DQ
                        mP = w_0*(f_D/100)
                        nQ = V_DQ*(V_D/100)
                        D_f = 1/mP
                        D_V = 1/nQ
                        Tsync = 1
                        
                        Nb = 300;
                        Inom = 50;
                        Cnom = Nb*Inom*10;
                        Tamb = 30;
                    ENDCODE

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, 'grid_forming_inverter.svg')
                    ENDCODE

                    CODE pre_compile
                        # HEADER START
                        S = mdl.get_property_value(mdl.prop(item_handle, "S"))
                        V_ABC = mdl.get_property_value(mdl.prop(item_handle, "V_ABC"))
                        w_0 = mdl.get_property_value(mdl.prop(item_handle, "w_0"))
                        Ts = mdl.get_property_value(mdl.prop(item_handle, "Ts"))
                        R_i = mdl.get_property_value(mdl.prop(item_handle, "R_i"))
                        L_i = mdl.get_property_value(mdl.prop(item_handle, "L_i"))
                        R_s = mdl.get_property_value(mdl.prop(item_handle, "R_s"))
                        C_s = mdl.get_property_value(mdl.prop(item_handle, "C_s"))
                        R_o = mdl.get_property_value(mdl.prop(item_handle, "R_o"))
                        L_o = mdl.get_property_value(mdl.prop(item_handle, "L_o"))
                        R = mdl.get_property_value(mdl.prop(item_handle, "R"))
                        L = mdl.get_property_value(mdl.prop(item_handle, "L"))
                        Kp_I = mdl.get_property_value(mdl.prop(item_handle, "Kp_I"))
                        Ki_I = mdl.get_property_value(mdl.prop(item_handle, "Ki_I"))
                        Imax = mdl.get_property_value(mdl.prop(item_handle, "Imax"))
                        Imin = mdl.get_property_value(mdl.prop(item_handle, "Imin"))
                        Kp_V = mdl.get_property_value(mdl.prop(item_handle, "Kp_V"))
                        Ki_V = mdl.get_property_value(mdl.prop(item_handle, "Ki_V"))
                        Vmax = mdl.get_property_value(mdl.prop(item_handle, "Vmax"))
                        Vmin = mdl.get_property_value(mdl.prop(item_handle, "Vmin"))
                        f_D = mdl.get_property_value(mdl.prop(item_handle, "f_D"))
                        V_D = mdl.get_property_value(mdl.prop(item_handle, "V_D"))
                        T_m = mdl.get_property_value(mdl.prop(item_handle, "T_m"))
                        maxV_slip = mdl.get_property_value(mdl.prop(item_handle, "maxV_slip"))
                        minV_slip = mdl.get_property_value(mdl.prop(item_handle, "minV_slip"))
                        maxw_slip = mdl.get_property_value(mdl.prop(item_handle, "maxw_slip"))
                        minw_slip = mdl.get_property_value(mdl.prop(item_handle, "minw_slip"))
                        maxV_pds = mdl.get_property_value(mdl.prop(item_handle, "maxV_pds"))
                        maxw_pds = mdl.get_property_value(mdl.prop(item_handle, "maxw_pds"))
                        # HEADER STOP
                        S = mdl.get_property_value(mdl.prop(item_handle, "S"))
                        V_ABC = mdl.get_property_value(mdl.prop(item_handle, "V_ABC"))
                        w_0 = mdl.get_property_value(mdl.prop(item_handle, "w_0"))
                        Ts = mdl.get_property_value(mdl.prop(item_handle, "Ts"))
                        R_i = mdl.get_property_value(mdl.prop(item_handle, "R_i"))
                        L_i = mdl.get_property_value(mdl.prop(item_handle, "L_i"))
                        R_s = mdl.get_property_value(mdl.prop(item_handle, "R_s"))
                        C_s = mdl.get_property_value(mdl.prop(item_handle, "C_s"))
                        R_o = mdl.get_property_value(mdl.prop(item_handle, "R_o"))
                        L_o = mdl.get_property_value(mdl.prop(item_handle, "L_o"))
                        R = mdl.get_property_value(mdl.prop(item_handle, "R"))
                        L = mdl.get_property_value(mdl.prop(item_handle, "L"))
                        Kp_I = mdl.get_property_value(mdl.prop(item_handle, "Kp_I"))
                        Ki_I = mdl.get_property_value(mdl.prop(item_handle, "Ki_I"))
                        Imax = mdl.get_property_value(mdl.prop(item_handle, "Imax"))
                        Imin = mdl.get_property_value(mdl.prop(item_handle, "Imin"))
                        Kp_V = mdl.get_property_value(mdl.prop(item_handle, "Kp_V"))
                        Ki_V = mdl.get_property_value(mdl.prop(item_handle, "Ki_V"))
                        Vmax = mdl.get_property_value(mdl.prop(item_handle, "Vmax"))
                        Vmin = mdl.get_property_value(mdl.prop(item_handle, "Vmin"))
                        f_D = mdl.get_property_value(mdl.prop(item_handle, "f_D"))
                        V_D = mdl.get_property_value(mdl.prop(item_handle, "V_D"))
                        T_m = mdl.get_property_value(mdl.prop(item_handle, "T_m"))
                        
                        
                        Tfast = Ts
                        S_DQ = (2/3)*S
                        V_DQ = V_ABC*np.sqrt(2)
                        I_DQ = S_DQ/V_DQ
                        Z_DQ = V_DQ/I_DQ
                        mP = w_0*(f_D/100)
                        nQ = V_DQ*(V_D/100)
                        D_f = 1/mP
                        D_V = 1/nQ
                        Tsync = 1
                        
                        Nb = 300;
                        Inom = 50;
                        Cnom = Nb*Inom*10;
                        Tamb = 30;
                    ENDCODE
                }
            }
            [
                position = 8040, 8200
                scale = -1, 1
                size = 240, 184
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "Ts_ess"
                init_value = "1"
            }
            [
                position = 7784, 8184
                hide_name = True
                size = 32, 32
            ]

            component src_scada_input charge {
                execution_rate = "20e-6"
                format = "int"
                max = "1"
                min = "0"
                signal_type = "int"
                unit = ""
            }
            [
                position = 7768, 8288
            ]

            port EPC_A {
                position = top:1
                kind = pe
            }
            [
                position = 9088, 8056
                scale = -1, 1
            ]

            port EPC_B {
                position = top:2
                kind = pe
            }
            [
                position = 9088, 8152
                scale = -1, 1
            ]

            port EPC_C {
                position = top:3
                kind = pe
            }
            [
                position = 9088, 8248
                scale = -1, 1
            ]

            tag Goto2 {
                value = "Va"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8368, 8304
                rotation = left
                hide_name = True
            ]

            tag Goto3 {
                value = "Vb"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8440, 8304
                rotation = left
                hide_name = True
            ]

            tag Goto4 {
                value = "Vc"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8512, 8304
                rotation = left
                hide_name = True
            ]

            tag Goto5 {
                value = "Ia"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8920, 7976
                rotation = left
                hide_name = True
            ]

            tag Goto6 {
                value = "Ib"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8872, 7976
                rotation = left
                hide_name = True
            ]

            tag Goto7 {
                value = "Ic"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8824, 7976
                rotation = left
                hide_name = True
            ]

            tag From7 {
                value = "PCC_status"
                scope = global
                kind = sp
                direction = out
            }
            [
                position = 7656, 8184
                hide_name = True
            ]

            junction Junction108 pe
            [
                position = 8400, 8528
            ]

            junction Junction112 pe
            [
                position = 8472, 8528
            ]

            junction Junction113 pe
            [
                position = 8632, 8528
            ]

            junction Junction114 pe
            [
                position = 8568, 8528
            ]

            junction Junction161 pe
            [
                position = 8568, 8056
            ]

            junction Junction162 pe
            [
                position = 8632, 8152
            ]

            junction Junction163 pe
            [
                position = 8696, 8248
            ]

            junction Junction452 pe
            [
                position = 8328, 8056
            ]

            junction Junction453 pe
            [
                position = 8400, 8152
            ]

            junction Junction454 pe
            [
                position = 8472, 8248
            ]

            junction Junction455 pe
            [
                position = 8304, 8528
            ]

            comment Comment3 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Standalone (UPS) load</p></body></html> ENDCOMMENT 
            [
                position = 8216, 8544
            ]

            connect EPC_A ESS_Ia.n_node as Connection1352
            connect EPC_B ESS_Ib.n_node as Connection1354
            connect EPC_C ESS_Ic.n_node as Connection1356
            connect ESS_Ia.p_node Junction161 as Connection1353
            connect ESS_Ib.p_node Junction162 as Connection1355
            connect ESS_Ic.p_node Junction163 as Connection1357
            connect Goto2 Va.out as Connection1358
            connect Goto3 Vb.out as Connection1359
            connect Goto4 Vc.out as Connection1360
            connect Goto5 ESS_Ia.out as Connection1361
            connect Goto6 ESS_Ib.out as Connection1362
            connect Goto7 ESS_Ic.out as Connection1363
            connect Junction112 Junction108 as Connection918
            connect Junction113 Junction114 as Connection923
            connect Junction114 Junction112 as Connection924
            connect Junction163 R16.p_node as Connection1350
            [
                breakpoints = 8696, 8248
            ]
            connect R16.n_node Junction113 as Connection920
            connect R17.n_node Junction113 as Connection922
            connect R17.p_node Junction162 as Connection1346
            connect R18.n_node Junction114 as Connection925
            connect R18.p_node Junction161 as Connection1343
            connect Vb.n_node Junction108 as Connection901
            connect Vc.n_node Junction112 as Connection917
            connect P_ref_ess.out "Grid forming inverter (averaged).setpoint_P" as Connection4319
            connect Q_ref_ess.out "Grid forming inverter (averaged).setpoint_Q" as Connection4320
            connect Va.p_node Junction452 as Connection4321
            [
                breakpoints = 8328, 8080
            ]
            connect Junction452 Junction161 as Connection4322
            [
                breakpoints = 8328, 8056; 8328, 8056; 8568, 8056; 8568, 8056
            ]
            connect "Grid forming inverter (averaged).Va" Junction452 as Connection4323
            connect Vb.p_node Junction453 as Connection4324
            connect Junction453 Junction162 as Connection4325
            [
                breakpoints = 8400, 8152; 8400, 8160; 8400, 8152; 8632, 8152
            ]
            connect "Grid forming inverter (averaged).Vb" Junction453 as Connection4326
            [
                breakpoints = 8040, 8016; 8400, 8016
            ]
            connect Junction163 Junction454 as Connection4327
            [
                breakpoints = 8696, 8248; 8696, 8248
            ]
            connect Junction454 Vc.p_node as Connection4328
            [
                breakpoints = 8472, 8248; 8472, 8248; 8472, 8248; 8472, 8248; 8472, 8248; 8472, 8440
            ]
            connect "Grid forming inverter (averaged).Vc" Junction454 as Connection4329
            [
                breakpoints = 7944, 7976; 8472, 7976
            ]
            connect Junction108 Junction455 as Connection4330
            [
                breakpoints = 8400, 8528; 8400, 8528
            ]
            connect Junction455 Va.n_node as Connection4331
            [
                breakpoints = 8312, 8528; 8320, 8528; 8312, 8528; 8328, 8528
            ]
            connect "Grid forming inverter (averaged).Ground" Junction455 as Connection4332
            connect From7 "Rate Transition1.in" as Connection4333
            connect "Rate Transition1.out" "Grid forming inverter (averaged).PCC_status" as Connection4334
            connect charge.out "Grid forming inverter (averaged).charge" as Connection4335
        }
        [
            position = 5840, 7888
            rotation = right
            size = 144, 56
        ]

        component Subsystem Load {
            layout = dynamic
            component pas_inductor La {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8136
            ]

            component pas_inductor Lc {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8248
            ]

            component pas_resistor Rb {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8192
            ]

            component pas_resistor Ra {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8136
            ]

            component pas_inductor Lb {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8192
            ]

            component pas_resistor Rc {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8248
            ]

            port A {
                label = "A"
                position = left:1
                kind = pe
            }
            [
                position = 8056, 8136
            ]

            port B {
                label = "B"
                position = left:2
                kind = pe
            }
            [
                position = 8056, 8192
            ]

            port C {
                label = "C"
                position = left:3
                kind = pe
            }
            [
                position = 8056, 8248
            ]

            junction Junction1 pe
            [
                position = 8288, 8192
            ]

            connect Junction1 Lc.n_node as Connection17
            connect La.n_node Junction1 as Connection16
            connect Lb.n_node Junction1 as Connection18
            connect Lb.p_node Rb.n_node as Connection13
            connect Ra.p_node A as Connection8
            connect Ra.n_node La.p_node as Connection12
            connect Rb.p_node B as Connection1
            connect Rc.p_node C as Connection10
            connect Rc.n_node Lc.p_node as Connection14

            S = "10e3"

            mask {
                description = "Constant Impedance Load
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Three-phase Y connected RL load.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                R and L values are calculated using the input parameters:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - V: Rated line-to-line voltage
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - S: Rated three-phase power
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - f: Rated frequency
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - pf: Rated power factor
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                None of the parameters can be set to 0."

                V {
                    label = "Voltage"
                    widget = edit
                    type = generic
                    default_value = "480"
                    unit = "V"
                    group = "General"
                }

                S {
                    label = "Power"
                    widget = edit
                    type = generic
                    default_value = "1000e3"
                    unit = "VA"
                    group = "General"
                }

                f {
                    label = "Frequency"
                    widget = edit
                    type = generic
                    default_value = "60"
                    unit = "Hz"
                    group = "General"
                }

                pf {
                    label = "Power Factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                    group = "General"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 6648, 7984
            size = 48, 72
        ]

        component "core/Voltage RMS" Vrms_ess {
            feed_forward = "true"
            frequency = "sys_f"
        }
        [
            position = 6000, 7784
            size = 64, 32
        ]

        component src_ground gnd2 {
        }
        [
            position = 6400, 7112
            rotation = down
            hide_name = True
        ]

        component "core/Three Phase Voltage Source" Vs1 {
            init_frequency = "60.0"
        }
        [
            position = 6400, 7240
            rotation = right
            scale = -1, 1
            size = 62, 256
        ]

        component Subsystem PCC {
            layout = dynamic
            component "core/Triple Pole Single Throw Contactor" S1 {
                ctrl_src = "Model"
            }
            [
                position = 8136, 8184
                rotation = left
                size = 64, 256
            ]

            component gen_sr_ff "SR Flip Flop1" {
            }
            [
                position = 7712, 8392
            ]

            component src_digital_input "Digital Input Close" {
                addr = "8"
                execution_rate = "Ts"
                invert = "true"
            }
            [
                position = 7592, 8376
            ]

            component src_digital_input "Digital Input Trip" {
                addr = "9"
                execution_rate = "Ts"
                invert = "true"
            }
            [
                position = 7592, 8440
            ]

            component gen_data_type_conversion "Data Type Conversion1" {
            }
            [
                position = 7880, 8184
                hide_name = True
                scale = -1, 1
            ]

            component gen_probe P {
            }
            [
                position = 7536, 7928
                scale = -1, 1
            ]

            component gen_probe Q {
            }
            [
                position = 7536, 7872
                scale = -1, 1
            ]

            component gen_gain Gain3 {
                gain = "100"
            }
            [
                position = 7600, 8024
                hide_name = True
                scale = -1, 1
            ]

            component gen_gain Gain2 {
                gain = "10"
            }
            [
                position = 7624, 8000
                hide_name = True
                scale = -1, 1
            ]

            component gen_gain Gain1 {
                gain = "10"
            }
            [
                position = 7664, 7976
                hide_name = True
                scale = -1, -1
            ]

            component gen_gain "W -> kW" {
                gain = ".001"
            }
            [
                position = 7752, 7976
                scale = -1, 1
            ]

            component gen_gain "var -> kvar" {
                gain = ".001"
            }
            [
                position = 7704, 8000
                scale = -1, 1
            ]

            component gen_gain Gain4 {
                gain = "100"
            }
            [
                position = 7648, 8048
                hide_name = True
                scale = -1, 1
            ]

            component Subsystem Meas2 {
                layout = dynamic
                component gen_bus_join "Bus Join1" {
                    inputs = "3"
                }
                [
                    position = 7960, 8120
                    rotation = left
                ]

                component "core/Voltage Measurement" VB {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7648, 8256
                    rotation = right
                ]

                component "core/Voltage Measurement" VC {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7568, 8320
                    rotation = right
                ]

                component "core/Voltage Measurement" VA {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7728, 8192
                    rotation = right
                ]

                port Ground {
                    position = bottom:auto
                    kind = pe
                }
                [
                    position = 7648, 8504
                    rotation = left
                ]

                port A {
                    position = left:1
                    kind = pe
                }
                [
                    position = 7400, 7928
                ]

                port B {
                    position = left:2
                    kind = pe
                }
                [
                    position = 7400, 8024
                ]

                port C {
                    position = left:3
                    kind = pe
                }
                [
                    position = 7400, 8120
                ]

                port a {
                    label = "a"
                    position = right:1
                    kind = pe
                }
                [
                    position = 7800, 7928
                    rotation = down
                ]

                port b {
                    label = "b"
                    position = right:2
                    kind = pe
                }
                [
                    position = 7800, 8024
                    rotation = down
                ]

                port c {
                    label = "c"
                    position = right:3
                    kind = pe
                }
                [
                    position = 7800, 8120
                    rotation = down
                ]

                port V {
                    label = "V"
                    position = top:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7960, 8064
                    rotation = left
                ]

                junction Junction1421 pe
                [
                    position = 7648, 8432
                ]

                junction Junction1469 pe
                [
                    position = 7648, 8432
                ]

                junction Junction1470 pe
                [
                    position = 7728, 7928
                ]

                junction Junction1471 pe
                [
                    position = 7648, 8024
                ]

                junction Junction1472 pe
                [
                    position = 7568, 8120
                ]

                connect A Junction1470 as Connection390
                connect B Junction1471 as Connection393
                connect C Junction1472 as Connection396
                connect Ground Junction1469 as Connection384
                connect Junction1421 Junction1469 as Connection382
                connect Junction1469 VC.n_node as Connection383
                connect Junction1470 VA.p_node as Connection389
                connect Junction1471 b as Connection392
                connect Junction1472 VC.p_node as Connection395
                connect V "Bus Join1.out" as Connection385
                connect VA.out "Bus Join1.in" as Connection397
                connect VA.n_node Junction1421 as Connection237
                connect VB.out "Bus Join1.in1" as Connection398
                connect VB.n_node Junction1421 as Connection203
                connect VB.p_node Junction1471 as Connection391
                connect VC.out "Bus Join1.in2" as Connection399
                connect a Junction1470 as Connection388
                connect c Junction1472 as Connection394
            }
            [
                position = 8136, 8312
                rotation = right
                scale = -1, 1
                size = 112, 232
            ]

            component Subsystem "PCC Measurements" {
                layout = dynamic
                component gen_terminator Termination3 {
                }
                [
                    position = 8008, 8088
                    hide_name = True
                    scale = -1, 1
                ]

                component "core/Three phase PLL" "Three phase PLL1" {
                }
                [
                    position = 8088, 8096
                    scale = -1, 1
                    size = 64, 128
                ]

                component gen_terminator Termination5 {
                }
                [
                    position = 8008, 8136
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_PQ_transform "Power Meter1" {
                }
                [
                    position = 8088, 8360
                    scale = -1, 1
                ]

                component gen_terminator Termination6 {
                }
                [
                    position = 8016, 8352
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_rms_value "RMS value1" {
                }
                [
                    position = 8088, 8192
                    scale = -1, 1
                ]

                component gen_bus_split "Bus Split1" {
                    outputs = "3"
                }
                [
                    position = 8416, 8256
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_comparator Comparator1 {
                }
                [
                    position = 7912, 8272
                    hide_name = True
                    scale = -1, -1
                ]

                component gen_comparator Comparator2 {
                }
                [
                    position = 7912, 8464
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination7 {
                }
                [
                    position = 7976, 8368
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination4 {
                }
                [
                    position = 7968, 8120
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination2 {
                }
                [
                    position = 7968, 8072
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination8 {
                }
                [
                    position = 8016, 8384
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_terminator Termination1 {
                }
                [
                    position = 8008, 8056
                    hide_name = True
                    scale = -1, 1
                ]

                component src_constant Constant1 {
                    execution_rate = "Ts"
                }
                [
                    position = 8040, 8264
                    hide_name = True
                    scale = -1, 1
                ]

                component src_constant Constant2 {
                    execution_rate = "Ts"
                }
                [
                    position = 8040, 8472
                    hide_name = True
                    scale = -1, 1
                ]

                component gen_bus_split "Bus Split2" {
                    outputs = "3"
                }
                [
                    position = 8416, 8184
                    hide_name = True
                    scale = -1, 1
                ]

                port f {
                    label = "Frequency"
                    position = left:4
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7920, 8104
                    scale = -1, 1
                ]

                port P {
                    label = "Real Power"
                    position = left:2
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7976, 8320
                    scale = -1, 1
                ]

                port Q {
                    label = "Reactive Power"
                    position = left:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7936, 8336
                    scale = -1, 1
                ]

                port pf {
                    label = "Power Factor"
                    position = left:6
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7936, 8400
                    scale = -1, 1
                ]

                port I {
                    label = "I"
                    position = right:1
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8488, 8184
                    rotation = down
                ]

                port Vrms {
                    label = "Voltage"
                    position = left:3
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7984, 8192
                    scale = -1, 1
                ]

                port V {
                    label = "V"
                    position = right:2
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 8488, 8256
                    rotation = down
                ]

                port "P direction" {
                    label = "P Import/Exprot"
                    position = left:9
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7848, 8272
                    scale = -1, 1
                ]

                port "pf lead lag" {
                    label = "pf lead/lag"
                    position = left:10
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7848, 8464
                    scale = -1, 1
                ]

                tag Goto2 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8184
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto1 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8160
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto4 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8232
                    hide_name = True
                    scale = -1, 1
                ]

                tag From1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8192, 8064
                    hide_name = True
                    scale = -1, 1
                ]

                tag From2 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8192, 8096
                    hide_name = True
                    scale = -1, 1
                ]

                tag From9 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8400
                    hide_name = True
                    scale = -1, 1
                ]

                tag From8 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8240, 8384
                    hide_name = True
                    scale = -1, 1
                ]

                tag From3 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8192, 8128
                    hide_name = True
                    scale = -1, 1
                ]

                tag From4 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8240, 8352
                    hide_name = True
                    scale = -1, 1
                ]

                tag From10 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8192, 8192
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto6 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8280
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto5 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8256
                    hide_name = True
                    scale = -1, 1
                ]

                tag From5 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8240, 8320
                    hide_name = True
                    scale = -1, 1
                ]

                tag Goto3 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8328, 8208
                    hide_name = True
                    scale = -1, 1
                ]

                tag From6 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8336
                    hide_name = True
                    scale = -1, 1
                ]

                tag From7 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 8368
                    hide_name = True
                    scale = -1, 1
                ]

                junction Junction1 sp
                [
                    position = 8016, 8320
                ]

                junction Junction2 sp
                [
                    position = 7976, 8400
                ]

                connect "Bus Split1.out" Goto4 as Connection27
                connect "Bus Split1.out1" Goto5 as Connection26
                connect "Bus Split1.out2" Goto6 as Connection28
                connect "Bus Split1.in" V as Connection47
                connect "Bus Split2.out" Goto1 as Connection25
                connect "Bus Split2.out2" Goto3 as Connection24
                connect "Bus Split2.in" I as Connection48
                connect Comparator1.in1 Junction1 as Connection57
                connect Comparator2.in1 Junction2 as Connection60
                connect Constant1.out Comparator1.in2 as Connection54
                connect Constant2.out Comparator2.in2 as Connection61
                connect From1 "Three phase PLL1.va" as Connection29
                connect From10 "RMS value1.in" as Connection46
                connect From2 "Three phase PLL1.vb" as Connection30
                connect From3 "Three phase PLL1.vc" as Connection31
                connect From4 "Power Meter1.vc" as Connection37
                connect From5 "Power Meter1.va" as Connection39
                connect From6 "Power Meter1.vb" as Connection38
                connect From7 "Power Meter1.ia" as Connection41
                connect From9 "Power Meter1.ic" as Connection40
                connect Goto2 "Bus Split2.out1" as Connection23
                connect Junction1 P as Connection56
                connect Junction2 pf as Connection59
                connect "P direction" Comparator1.out as Connection62
                connect "Power Meter1.ib" From8 as Connection42
                connect "Power Meter1.Pdc" Junction1 as Connection55
                connect "Power Meter1.k_factor" Junction2 as Connection58
                connect "Power Meter1.Qdc" Q as Connection53
                connect "RMS value1.out" Vrms as Connection50
                connect Termination1.in "Three phase PLL1.d_axis" as Connection32
                connect Termination2.in "Three phase PLL1.q_axis" as Connection33
                connect Termination3.in "Three phase PLL1.zero_axis" as Connection34
                connect Termination4.in "Three phase PLL1.theta" as Connection35
                connect Termination5.in "Three phase PLL1.sin_theta" as Connection36
                connect Termination6.in "Power Meter1.Pac" as Connection43
                connect Termination7.in "Power Meter1.Qac" as Connection44
                connect Termination8.in "Power Meter1.apparent" as Connection45
                connect "Three phase PLL1.freq" f as Connection52
                connect "pf lead lag" Comparator2.out as Connection63
            }
            [
                position = 7864, 8048
                size = 96, 184
            ]

            component Subsystem Meas1 {
                layout = dynamic
                component gen_bus_join "Bus Join1" {
                    inputs = "3"
                }
                [
                    position = 7936, 8168
                    rotation = left
                ]

                component "core/Voltage Measurement" VC {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7568, 8352
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" IA {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7368, 7928
                    size = 64, 32
                ]

                component gen_bus_join "Bus Join2" {
                    inputs = "3"
                }
                [
                    position = 7576, 7784
                ]

                component "core/Current Measurement" IB {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7432, 8024
                    size = 64, 32
                ]

                component "core/Voltage Measurement" VA {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7728, 8224
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" VB {
                    addr = "267"
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7648, 8288
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" IC {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7496, 8120
                    size = 64, 32
                ]

                port Ground {
                    position = bottom:auto
                    kind = pe
                }
                [
                    position = 7648, 8504
                    rotation = left
                ]

                port A {
                    position = left:1
                    kind = pe
                }
                [
                    position = 7288, 7928
                ]

                port B {
                    position = left:2
                    kind = pe
                }
                [
                    position = 7288, 8024
                ]

                port C {
                    position = left:3
                    kind = pe
                }
                [
                    position = 7288, 8120
                ]

                port a {
                    label = "a"
                    position = right:1
                    kind = pe
                }
                [
                    position = 7800, 7928
                    rotation = down
                ]

                port b {
                    label = "b"
                    position = right:2
                    kind = pe
                }
                [
                    position = 7800, 8024
                    rotation = down
                ]

                port c {
                    label = "c"
                    position = right:3
                    kind = pe
                }
                [
                    position = 7800, 8120
                    rotation = down
                ]

                port V {
                    label = "V"
                    position = top:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7936, 8112
                    rotation = left
                ]

                port I {
                    position = top:1
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 7648, 7784
                ]

                junction Junction1421 pe
                [
                    position = 7648, 8432
                ]

                junction Junction1466 pe
                [
                    position = 7728, 7928
                ]

                junction Junction1467 pe
                [
                    position = 7648, 8024
                ]

                junction Junction1468 pe
                [
                    position = 7568, 8120
                ]

                junction Junction1469 pe
                [
                    position = 7648, 8432
                ]

                connect A IA.p_node as Connection379
                connect B IB.p_node as Connection380
                connect "Bus Join1.in1" VB.out as Connection387
                connect "Bus Join1.in2" VC.out as Connection388
                connect "Bus Join2.out" I as Connection393
                connect "Bus Join2.in1" IB.out as Connection391
                connect "Bus Join2.in2" IC.out as Connection392
                connect C IC.p_node as Connection381
                connect Ground Junction1469 as Connection384
                connect IA.out "Bus Join2.in" as Connection390
                connect IA.n_node Junction1466 as Connection377
                connect Junction1421 Junction1469 as Connection382
                connect Junction1466 a as Connection299
                connect Junction1467 IB.n_node as Connection375
                connect Junction1467 b as Connection301
                connect Junction1468 IC.n_node as Connection376
                connect Junction1468 c as Connection302
                connect Junction1469 VC.n_node as Connection383
                connect V "Bus Join1.out" as Connection385
                connect V "Bus Join1.out" as Connection389
                connect VA.out "Bus Join1.in" as Connection386
                connect VA.n_node Junction1421 as Connection237
                connect VA.p_node Junction1466 as Connection240
                connect VB.n_node Junction1421 as Connection203
                connect VB.p_node Junction1467 as Connection243
                connect VC.p_node Junction1468 as Connection246
            }
            [
                position = 8136, 8048
                rotation = right
                scale = -1, 1
                size = 112, 232
            ]

            component src_scada_input Grid_Connect {
                execution_rate = "Ts"
                format = "int"
                max = "1"
                min = "0"
                signal_type = "int"
                unit = ""
            }
            [
                position = 7672, 8248
            ]

            component gen_logic_op "Logical operator2" {
            }
            [
                position = 7840, 8288
                hide_name = True
            ]

            port A {
                label = "A"
                position = top:1
                kind = pe
            }
            [
                position = 8040, 7944
                rotation = right
            ]

            port B {
                label = "B"
                position = top:2
                kind = pe
            }
            [
                position = 8136, 7944
                rotation = right
            ]

            port C {
                label = "C"
                position = top:3
                kind = pe
            }
            [
                position = 8232, 7944
                rotation = right
            ]

            port a {
                label = "a"
                position = bottom:1
                kind = pe
            }
            [
                position = 8040, 8424
                rotation = left
            ]

            port b {
                label = "b"
                position = bottom:2
                kind = pe
            }
            [
                position = 8136, 8424
                rotation = left
            ]

            port c {
                label = "c"
                position = bottom:3
                kind = pe
            }
            [
                position = 8232, 8424
                rotation = left
            ]

            port G {
                label = "G"
                position = right:1
                kind = pe
            }
            [
                position = 8424, 8192
                rotation = down
            ]

            tag Goto2 {
                value = "Q"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8000
                hide_name = True
                scale = -1, 1
            ]

            tag Goto1 {
                value = "P"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 7976
                hide_name = True
                scale = -1, 1
            ]

            tag Goto5 {
                value = "pf"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8072
                hide_name = True
                scale = -1, 1
            ]

            tag Goto4 {
                value = "f"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8048
                hide_name = True
                scale = -1, 1
            ]

            tag Goto6 {
                value = "P sign"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8096
                hide_name = True
                scale = -1, 1
            ]

            tag Goto8 {
                value = "CB Status"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7800, 8184
                hide_name = True
                scale = -1, 1
            ]

            tag Goto7 {
                value = "pf lead/lag"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8120
                hide_name = True
                scale = -1, 1
            ]

            tag Goto3 {
                value = "V"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 7472, 8024
                hide_name = True
                scale = -1, 1
            ]

            tag Goto9 {
                value = "PCC_status"
                scope = global
                kind = sp
                direction = in
            }
            [
                position = 7640, 8320
                hide_name = True
                scale = -1, 1
            ]

            junction Junction1 pe
            [
                position = 8392, 8192
            ]

            junction Junction1506 sp
            [
                position = 7784, 7976
            ]

            junction Junction1507 sp
            [
                position = 7800, 8000
            ]

            junction Junction1508 sp
            [
                position = 7952, 8184
            ]

            junction Junction1509 sp
            [
                position = 7760, 8248
            ]

            connect A Meas1.A as Connection45
            connect "Digital Input Close.out" "SR Flip Flop1.s_in" as Connection1075
            [
                breakpoints = 7664, 8376
            ]
            connect "Digital Input Trip.out" "SR Flip Flop1.r_in" as Connection1066
            connect Gain1.in "W -> kW.out" as Connection1085
            connect Gain2.in "var -> kvar.out" as Connection1088
            connect Gain3.in "PCC Measurements.Vrms" as Connection1091
            connect Gain4.out Goto4 as Connection1093
            connect Goto1 Gain1.out as Connection1094
            [
                breakpoints = 7472, 7976; 7568, 7976
            ]
            connect Goto2 Gain2.out as Connection1095
            [
                breakpoints = 7472, 8000; 7584, 8000
            ]
            connect Goto3 Gain3.out as Connection1090
            connect Goto5 "PCC Measurements.pf" as Connection27
            connect Goto6 "PCC Measurements.P direction" as Connection28
            connect Goto7 "PCC Measurements.pf lead lag" as Connection29
            connect Goto8 "Data Type Conversion1.out" as Connection1076
            connect Junction1 G as Connection19
            connect Junction1506 "PCC Measurements.P" as Connection1101
            connect Junction1507 "PCC Measurements.Q" as Connection1104
            connect Meas1.B B as Connection44
            connect Meas1.C C as Connection43
            connect Meas1.Ground Junction1 as Connection20
            connect Meas1.I "PCC Measurements.I" as Connection52
            connect Meas1.b S1.b_out as Connection41
            connect Meas1.a S1.a_out as Connection40
            connect Meas2.Ground Junction1 as Connection18
            connect Meas2.C S1.c_in as Connection48
            connect Meas2.b b as Connection50
            connect Meas2.c c as Connection49
            connect P.in Junction1506 as Connection1102
            connect "PCC Measurements.f" Gain4.in as Connection1092
            connect "PCC Measurements.V" Meas1.V as Connection53
            connect Q.in Junction1507 as Connection1105
            connect S1.c_out Meas1.c as Connection42
            connect S1.b_in Meas2.B as Connection47
            connect S1.a_in Meas2.A as Connection46
            connect "W -> kW.in" Junction1506 as Connection1100
            connect a Meas2.a as Connection51
            connect "var -> kvar.in" Junction1507 as Connection1103
            [
                breakpoints = 7784, 8000
            ]
            connect "SR Flip Flop1.out" "Logical operator2.in1" as Connection1941
            connect "Data Type Conversion1.in" Junction1508 as Connection1942
            connect Junction1508 S1.ctrl_in as Connection1943
            [
                breakpoints = 7944, 8184; 7944, 8184
            ]
            connect "Logical operator2.out" Junction1508 as Connection1944
            connect Grid_Connect.out Junction1509 as Connection1945
            connect Junction1509 "Logical operator2.in" as Connection1946
            connect Goto9 Junction1509 as Connection1947
        }
        [
            position = 6400, 7712
            size = 80, 48
        ]

        component "core/Voltage RMS" Vrms_grid {
            feed_forward = "true"
            frequency = "sys_f"
        }
        [
            position = 6216, 7320
            scale = -1, 1
            size = 64, 32
        ]

        component pas_resistor Rb {
            resistance = "R"
        }
        [
            position = 6248, 7888
        ]

        component pas_inductor La {
            inductance = "L"
        }
        [
            position = 6144, 7832
            rotation = down
        ]

        component pas_resistor Ra {
            resistance = "R"
        }
        [
            position = 6248, 7832
        ]

        component pas_resistor Rc {
            resistance = "R"
        }
        [
            position = 6248, 7944
        ]

        component pas_inductor Lc {
            inductance = "L"
        }
        [
            position = 6144, 7944
            rotation = down
        ]

        component pas_inductor Lb {
            inductance = "L"
        }
        [
            position = 6144, 7888
            rotation = down
        ]

        component pas_resistor Rb1 {
            resistance = "R"
        }
        [
            position = 6248, 8120
        ]

        component pas_inductor La1 {
            inductance = "L"
        }
        [
            position = 6144, 8064
            rotation = down
        ]

        component pas_resistor Ra1 {
            resistance = "R"
        }
        [
            position = 6248, 8064
        ]

        component pas_resistor Rc1 {
            resistance = "R"
        }
        [
            position = 6248, 8176
        ]

        component pas_inductor Lc1 {
            inductance = "L"
        }
        [
            position = 6144, 8176
            rotation = down
        ]

        component pas_inductor Lb1 {
            inductance = "L"
        }
        [
            position = 6144, 8120
            rotation = down
        ]

        component "core/Voltage RMS" Vrms_pv {
            frequency = "sys_f"
        }
        [
            position = 6000, 8008
            size = 64, 32
        ]

        component Subsystem PV {
            layout = dynamic
            component src_scada_input Q_ref_pv {
                def_value = "30"
                execution_rate = "Ts_pv"
                unit = "kVAr"
            }
            [
                position = 7472, 8040
            ]

            component src_constant Constant1 {
                execution_rate = "Ts_pv"
            }
            [
                position = 7472, 7904
                hide_name = True
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "6"
            }
            [
                position = 7616, 7992
            ]

            component Subsystem "PV Plant (Switching)1" {
                layout = static
                component pas_inductor L2 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8248
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8248, 8504
                    rotation = right
                ]

                component pas_resistor R8 {
                    resistance = "Rres"
                }
                [
                    position = 8328, 8416
                    rotation = right
                ]

                component pas_resistor R0b {
                    resistance = "R0"
                }
                [
                    position = 8024, 8248
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 7544, 8040
                    hide_name = True
                ]

                component pas_inductor L6 {
                    inductance = "L"
                }
                [
                    position = 8824, 8248
                ]

                component pas_resistor R0a {
                    resistance = "R0"
                }
                [
                    position = 8024, 8152
                ]

                component pas_inductor L1 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8152
                ]

                component pas_resistor R0c1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8344
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8416, 8504
                    rotation = right
                ]

                component pas_resistor R4 {
                    resistance = "1e-3"
                }
                [
                    position = 7392, 8152
                ]

                component gen_digital_probe On {
                }
                [
                    position = 7608, 8088
                    rotation = right
                ]

                component gen_c_function delay {
                    global_variables = "real counter;"
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "in inherit"
                    in_terminal_labels = "False;"
                    init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "False;"
                    output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                    parameters = "real Delay;"
                }
                [
                    position = 7448, 8080
                    size = 48, 48
                ]

                component pas_inductor L3 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8344
                ]

                component pas_resistor R7 {
                    resistance = "Rres"
                }
                [
                    position = 8248, 8416
                    rotation = right
                ]

                component pas_capacitor Ca1 {
                    capacitance = "18.8e-2"
                }
                [
                    position = 7472, 8248
                    rotation = right
                ]

                component pas_inductor L4 {
                    inductance = "L"
                }
                [
                    position = 8824, 8344
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8328, 8504
                    rotation = right
                ]

                component gen_digital_probe enable {
                }
                [
                    position = 7432, 7992
                    rotation = left
                ]

                component pas_resistor R0a1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8152
                ]

                component pas_resistor R0b1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8248
                ]

                component pas_inductor L5 {
                    inductance = "L"
                }
                [
                    position = 8824, 8152
                ]

                component pas_resistor R0c {
                    resistance = "R0"
                }
                [
                    position = 8024, 8344
                ]

                component pas_resistor R9 {
                    resistance = "Rres"
                }
                [
                    position = 8416, 8416
                    rotation = right
                ]

                component src_constant VDC {
                    execution_rate = "Ts"
                    value = "Vn_dc"
                }
                [
                    position = 7232, 8248
                ]

                component "core/Voltage Measurement" Vab {
                }
                [
                    position = 7848, 8200
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vdc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7544, 8256
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Va {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8480, 8416
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ia {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8152
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vbc1 {
                }
                [
                    position = 8632, 8296
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8592, 8520
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vab1 {
                }
                [
                    position = 8632, 8200
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vb {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8536, 8472
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8248
                    size = 64, 32
                ]

                component "core/Triple Pole Single Throw Contactor" S1 {
                    ctrl_src = "Model"
                }
                [
                    position = 8944, 8248
                    size = 64, 256
                ]

                component "core/Current Measurement" Ic {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8344
                    size = 64, 32
                ]

                component "core/Current Measurement" Iinv_in {
                }
                [
                    position = 7600, 8152
                    size = 64, 32
                ]

                component Subsystem Input {
                    layout = dynamic
                    component gen_bus_split "Bus Split2" {
                        outputs = "6"
                    }
                    [
                        position = 8136, 8104
                        rotation = right
                        hide_name = True
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8136, 8032
                        rotation = right
                    ]

                    tag Goto27 {
                        value = "Irradiation"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "V_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "Q_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Enable"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8184
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "Q_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8280
                        hide_name = True
                        size = 0, 0
                    ]

                    connect "Bus Split2.out2" Goto27 as Connection757
                    connect "Bus Split2.out3" Goto28 as Connection758
                    connect "Bus Split2.out5" Goto29 as Connection760
                    connect "Bus Split2.out4" Goto30 as Connection759
                    connect "Bus Split2.out1" Goto31 as Connection756
                    connect "Bus Split2.out" Goto32 as Connection755
                    connect "Bus Split2.in" Inputs as Connection761
                }
                [
                    position = 7968, 7672
                    size = 72, 72
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem Grid_follow {
                        layout = dynamic
                        component gen_probe id {
                            addr = "8968"
                        }
                        [
                            position = 9480, 8376
                            rotation = right
                        ]

                        component gen_gain PV_eff {
                            gain = "PV_eff/100.0"
                        }
                        [
                            position = 8216, 8160
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8344, 8192
                            hide_name = True
                        ]

                        component gen_probe Vq {
                        }
                        [
                            position = 8920, 8176
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "NOT"
                        }
                        [
                            position = 8024, 8344
                            rotation = right
                            hide_name = True
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8136, 8160
                            hide_name = True
                        ]

                        component gen_logic_op "Logical operator2" {
                        }
                        [
                            position = 8728, 7928
                            hide_name = True
                        ]

                        component gen_c_function delay {
                            global_variables = "real counter;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "in inherit"
                            in_terminal_labels = "False;"
                            init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "False;"
                            output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                            parameters = "real Delay;"
                        }
                        [
                            position = 8624, 7920
                            size = 48, 48
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn_dc)"
                        }
                        [
                            position = 9696, 7912
                            rotation = right
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_gain Gain2 {
                            gain = "1000.0/Sn"
                        }
                        [
                            position = 8224, 8360
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/Vn"
                        }
                        [
                            position = 7696, 8368
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 7808, 8384
                            hide_name = True
                        ]

                        component gen_probe S {
                        }
                        [
                            position = 9304, 7776
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain to_pu {
                            gain = "1.0/Sn"
                        }
                        [
                            position = 8288, 8160
                        ]

                        component gen_probe Q {
                        }
                        [
                            position = 9304, 7712
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Pref {
                        }
                        [
                            position = 8528, 8136
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Ud_c {
                        }
                        [
                            position = 9816, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8336, 8376
                            hide_name = True
                        ]

                        component src_constant PV_Area_m2 {
                            execution_rate = "Ts"
                            value = "PV_area"
                        }
                        [
                            position = 8024, 8184
                        ]

                        component gen_probe pf {
                        }
                        [
                            position = 9304, 7840
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Id_ref {
                        }
                        [
                            position = 9488, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant Constant2 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8264, 8392
                            hide_name = True
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 7912, 8432
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8408, 8176
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8472, 8416
                            hide_name = True
                        ]

                        component gen_probe P {
                        }
                        [
                            position = 9304, 7648
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Vt_pu {
                        }
                        [
                            position = 8912, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Uq_c {
                        }
                        [
                            position = 9816, 8440
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe wt_pll {
                            addr = "8966"
                        }
                        [
                            position = 9112, 8520
                            rotation = right
                        ]

                        component gen_probe Vd {
                        }
                        [
                            position = 8920, 8096
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_digital_probe Qmode {
                        }
                        [
                            position = 8512, 8320
                        ]

                        component gen_probe w_pu {
                        }
                        [
                            position = 8912, 8336
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe irr_in {
                        }
                        [
                            position = 8000, 8112
                            rotation = left
                        ]

                        component gen_probe Qref {
                        }
                        [
                            position = 8624, 8464
                            rotation = right
                            scale = -1, 1
                        ]

                        component gen_probe iq {
                            addr = "8965"
                        }
                        [
                            position = 9480, 8520
                            rotation = right
                        ]

                        component gen_probe Iq_ref {
                        }
                        [
                            position = 9488, 8168
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant Constant3 {
                            execution_rate = "inherit"
                        }
                        [
                            position = 9128, 7952
                            hide_name = True
                        ]

                        component Subsystem ControlSignal_Calculation {
                            layout = dynamic
                            component gen_product Product1 {
                            }
                            [
                                position = 6984, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8280
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_product Product8 {
                                signs = "*/"
                            }
                            [
                                position = 7488, 8088
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 7144, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum9 {
                            }
                            [
                                position = 7816, 8288
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 6968, 8376
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 7392, 8288
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6880, 8176
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8072
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum8 {
                            }
                            [
                                position = 7816, 8096
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6872, 8384
                                hide_name = True
                            ]

                            component gen_probe Vdc {
                            }
                            [
                                position = 7136, 8424
                            ]

                            component gen_z_domain_transfer LPF_dc {
                                a_coeff = "[1.0/(2*np.pi*1),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 6856, 8472
                            ]

                            component src_constant Damp {
                                execution_rate = "Ts"
                                value = "Damp"
                            }
                            [
                                position = 7616, 8184
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7704, 8216
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 7392, 8080
                                hide_name = True
                            ]

                            component gen_product Product7 {
                                signs = "*/"
                            }
                            [
                                position = 7504, 8296
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7704, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                            }
                            [
                                position = 7136, 8368
                                hide_name = True
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7608, 8088
                                hide_name = True
                            ]

                            component gen_gain Gain11 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7616, 8296
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 6944, 8472
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "0.5"
                            }
                            [
                                position = 7192, 8472
                                hide_name = True
                            ]

                            component Subsystem PI_q {
                                layout = dynamic
                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_gain Kp {
                                    gain = "Iq_Kp"
                                }
                                [
                                    position = 8136, 8176
                                ]

                                component gen_gain Ki {
                                    gain = "Iq_Ki"
                                }
                                [
                                    position = 8008, 8240
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Iq_lowLim"
                                    upper_limit = "Iq_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8208
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8120, 8296
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7968, 8208
                                ]

                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection69
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection70
                                connect Ki.out Sum7.in as Connection66
                                connect Kp.in Junction74 as Connection68
                                connect Kp.out Sum5.in as Connection65
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6936, 8280
                                size = 64, 48
                            ]

                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "Id_lowLim"
                                    upper_limit = "Id_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Id_Kp"
                                }
                                [
                                    position = 8168, 8176
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Id_Ki"
                                }
                                [
                                    position = 7992, 8240
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7848, 8200
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8296
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7912, 8200
                                ]

                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection73
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection74
                                connect Ki.out Sum7.in as Connection71
                                connect Kp.in Junction74 as Connection72
                                connect Kp.out Sum5.in as Connection66
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6904, 8072
                                size = 64, 48
                            ]

                            port Uq {
                                label = "Uq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ud {
                                label = "Ud"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port VDC {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6792, 8472
                                rotation = down
                                scale = -1, 1
                            ]

                            port w {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6496, 8512
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8024
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_meas {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8232
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_meas {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8360
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8152
                                rotation = down
                                scale = -1, 1
                            ]

                            port Reset {
                                position = top:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6848, 8008
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From26 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6816, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From27 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8144
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto3 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6608, 8056
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6600, 8512
                                size = 0, 0
                            ]

                            tag From28 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto4 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6592, 8312
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From23 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6888, 8136
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto2 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6984, 8008
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From25 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6872, 8344
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction145 sp
                            [
                                position = 6592, 8288
                            ]

                            junction Junction146 sp
                            [
                                position = 6640, 8080
                            ]

                            junction Junction150 sp
                            [
                                position = 6544, 8080
                            ]

                            junction Junction151 sp
                            [
                                position = 6536, 8288
                            ]

                            junction Junction155 sp
                            [
                                position = 7440, 8304
                            ]

                            junction Junction164 sp
                            [
                                position = 6904, 8008
                            ]

                            junction Junction165 sp
                            [
                                position = 7656, 8184
                            ]

                            junction Junction166 sp
                            [
                                position = 7072, 8472
                            ]

                            connect Damp.out Junction165 as Connection182
                            connect From23 Product1.in as Connection1
                            connect From25 Product2.in as Connection2
                            connect From26 PI_q.Reset as Connection169
                            connect Gain1.in Junction145 as Connection5
                            connect Gain1.out Product1.in1 as Connection6
                            connect Gain10.out Sum8.in as Connection184
                            connect Gain11.in Product7.out as Connection186
                            connect Gain2.in Junction146 as Connection7
                            connect Gain2.out Product2.in1 as Connection8
                            connect Gain5.in Junction166 as Connection193
                            connect Goto1 w as Connection34
                            connect Goto2 Junction164 as Connection170
                            connect Goto3 Junction150 as Connection66
                            connect Goto4 Junction151 as Connection69
                            connect Junction145 Junction151 as Connection67
                            connect Junction146 Junction150 as Connection64
                            connect Junction146 Sum1.in as Connection11
                            connect Junction150 Id_meas as Connection65
                            connect Junction151 Iq_meas as Connection68
                            connect Junction155 Gain5.out as Connection192
                            connect Junction155 Product7.in1 as Connection116
                            connect Junction164 Reset as Connection171
                            connect Junction165 Product5.in1 as Connection181
                            connect Junction166 Vdc.in as Connection190
                            [
                                position = 0, 0
                            ]
                            connect Limit3.out Junction166 as Connection191
                            connect Limit3.in LPF_dc.out as Connection188
                            connect PI_d.Reset Junction164 as Connection172
                            connect PI_d.In Sum1.out as Connection55
                            connect PI_q.In Sum2.out as Connection165
                            connect Product5.in From27 as Connection101
                            connect Product5.out Sum8.in1 as Connection95
                            connect Product6.in1 From28 as Connection102
                            connect Product6.in Junction165 as Connection180
                            connect Product6.out Sum9.in as Connection96
                            connect Product7.in Sum7.out as Connection145
                            connect Product8.out Gain10.in as Connection183
                            connect Product8.in1 Junction155 as Connection115
                            connect Product8.in Sum3.out as Connection143
                            connect Sum1.in1 Id_ref as Connection20
                            connect Sum2.in1 Iq_ref as Connection22
                            connect Sum2.in Junction145 as Connection21
                            connect Sum3.in PI_d.Out as Connection178
                            connect Sum5.in1 Product1.out as Connection24
                            connect Sum5.out Sum3.in1 as Connection177
                            connect Sum6.in1 Product2.out as Connection26
                            connect Sum7.in PI_q.Out as Connection175
                            connect Sum7.in1 Sum6.out as Connection176
                            connect Sum8.out Ud as Connection173
                            connect Sum9.in1 Gain11.out as Connection185
                            connect Uq Sum9.out as Connection174
                            connect VDC LPF_dc.in as Connection124
                            connect Vd Sum5.in as Connection31
                            connect Vq Sum6.in as Connection32
                        }
                        [
                            position = 9696, 8272
                            scale = -1, 1
                            size = 168, 448
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 9632, 7936
                            rotation = right
                            hide_name = True
                            size = 32, 32
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_product Product7 {
                            }
                            [
                                position = 7512, 8328
                                hide_name = True
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8080
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 7680, 8008
                                hide_name = True
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 7680, 8080
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7680, 8152
                                hide_name = True
                            ]

                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 7792, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7792, 8072
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7680, 8224
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7648, 8328
                                hide_name = True
                            ]

                            port P_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Q_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8216
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8000
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8072
                                rotation = down
                                scale = -1, 1
                            ]

                            port Irq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ird {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8168
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vt {
                                position = right:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8320
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction142 sp
                            [
                                position = 7520, 8072
                            ]

                            junction Junction143 sp
                            [
                                position = 7536, 8000
                            ]

                            junction Junction145 sp
                            [
                                position = 7448, 8320
                            ]

                            junction Junction146 sp
                            [
                                position = 7864, 8176
                            ]

                            junction Junction147 sp
                            [
                                position = 7584, 8144
                            ]

                            junction Junction148 sp
                            [
                                position = 7552, 8216
                            ]

                            connect Irq Product1.out as Connection86
                            connect Junction142 Vd as Connection12
                            connect Junction143 Product3.in as Connection13
                            connect Junction145 Product7.in as Connection64
                            connect Junction146 Product1.in1 as Connection76
                            [
                                position = 0, 0
                                breakpoints = 7864, 8176
                            ]
                            connect Junction147 Product5.in as Connection81
                            [
                                position = 0, 0
                                breakpoints = 7584, 8144
                            ]
                            connect Junction148 Product6.in as Connection84
                            [
                                position = 0, 0
                                breakpoints = 7552, 8216
                            ]
                            connect Limit3.out Junction146 as Connection77
                            connect Limit3.in Product7.out as Connection74
                            connect P_ref Junction147 as Connection82
                            connect Product1.in Sum3.out as Connection23
                            connect Product2.out Ird as Connection87
                            connect Product2.in1 Junction146 as Connection75
                            connect Product2.in Sum4.out as Connection26
                            connect Product3.in1 Junction147 as Connection80
                            connect Product3.out Sum3.in as Connection28
                            connect Product4.in Junction142 as Connection30
                            connect Product4.in1 Junction148 as Connection83
                            connect Product4.out Sum3.in1 as Connection31
                            connect Product5.in1 Junction142 as Connection33
                            connect Product5.out Sum4.in as Connection34
                            connect Product6.in1 Junction143 as Connection36
                            connect Product6.out Sum4.in1 as Connection37
                            connect Product7.in1 Junction145 as Connection65
                            connect Q_ref Junction148 as Connection85
                            connect Vq Junction143 as Connection3
                            connect Vt Junction145 as Connection63
                        }
                        [
                            position = 9352, 8136
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component Subsystem PI_Vt {
                            layout = dynamic
                            component gen_sum Sum7 {
                            }
                            [
                                position = 8080, 8288
                                hide_name = True
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[-1.15]"
                                limit_upper = "[1.15]"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8304
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8312, 8208
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8456, 8208
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7992, 8280
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8256, 8384
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8112, 8200
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8360, 8384
                                hide_name = True
                                scale = -1, 1
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8312
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7880, 8232
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8208
                            ]

                            junction Junction72 sp
                            [
                                position = 8416, 8208
                            ]

                            junction Junction73 sp
                            [
                                position = 8488, 8208
                            ]

                            junction Junction74 sp
                            [
                                position = 7944, 8232
                            ]

                            connect Integrator1.reset Reset as Connection2
                            connect Junction72 Sum6.in as Connection64
                            connect Junction73 Limit1.out as Connection67
                            connect Junction74 In as Connection80
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction74 as Connection81
                            connect Ki.out Sum7.in as Connection78
                            connect Kp.in Junction74 as Connection79
                            connect Kp.out Sum5.in as Connection72
                            connect Limit1.in Junction72 as Connection63
                            connect Out Junction73 as Connection68
                            connect Sum5.in1 Integrator1.out as Connection6
                            connect Sum5.out Junction72 as Connection65
                            connect Sum6.in1 Junction73 as Connection66
                            connect Sum7.out Integrator1.in as Connection69
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 8024, 8432
                            size = 64, 48
                        ]

                        component Subsystem Power_Meas {
                            layout = dynamic
                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_c_function S_and_pf {
                                    in_terminal_dimensions = "inherit;inherit"
                                    in_terminal_dimensions_str = "P inherit;Q inherit"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real P;inherit Q;"
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "S inherit;pf inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit S;inherit pf;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect Junction1 Id as Connection49
                                connect Junction1 Product4.in1 as Connection24
                                connect Junction2 Iq as Connection52
                                connect Junction2 Product3.in1 as Connection27
                                connect Junction3 Product2.in as Connection32
                                connect Junction3 Vq as Connection53
                                connect Junction4 Product1.in as Connection35
                                connect Junction4 Vd as Connection50
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction5 P as Connection55
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction6 Q as Connection56
                                connect LPF_P.in Sum1.out as Connection39
                                connect LPF_Q.in Sum2.out as Connection40
                                connect Product1.in1 Junction1 as Connection25
                                connect Product2.in1 Junction2 as Connection28
                                connect Product3.in Junction4 as Connection36
                                connect Product4.in Junction3 as Connection33
                                connect S_and_pf.P Junction5 as Connection45
                                connect S_and_pf.Q Junction6 as Connection48
                                connect S_and_pf.S S as Connection51
                                connect S_and_pf.pf pf as Connection54
                                connect Sum1.in Product1.out as Connection29
                                connect Sum1.in1 Product2.out as Connection30
                                connect Sum2.in1 Product3.out as Connection38
                                connect Sum2.in Product4.out as Connection37

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                    
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                            connect Gain5.out Q as Connection11
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Gain6.out S as Connection13
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect pf Power_Meas_DQpu.pf as Connection19
                        }
                        [
                            position = 9112, 7744
                            size = 96, 232
                        ]

                        component Subsystem Current_abc_to_dq {
                            layout = dynamic
                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8008
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7864, 8008
                                size = 48, 80
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8008
                            ]

                            connect Gain1.out Id as Connection24
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.q_axis" Gain2.in as Connection27
                            connect "abc to dq1.d_axis" Gain1.in as Connection28
                            connect "abc to dq1.zero_axis" Termination1.in as Connection29
                            connect "abc to dq1.va" Ia as Connection30
                            connect Ib "abc to dq1.vb" as Connection31
                            connect "abc to dq1.vc" Ic as Connection32
                            connect "abc to dq1.wt" wt as Connection33
                        }
                        [
                            position = 9352, 8408
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component Subsystem Limit_PQref {
                            layout = dynamic
                            component tm_delay "Unit Delay2" {
                            }
                            [
                                position = 8200, 8336
                                hide_name = True
                            ]

                            component gen_rate_limiter "S rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8336
                            ]

                            component gen_rate_limiter "Q rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8264
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8200, 8192
                                hide_name = True
                            ]

                            component gen_rate_limiter "P rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8192
                            ]

                            component Subsystem priority_PQlim {
                                layout = dynamic
                                component gen_c_function "PQ limiting with priority" {
                                    global_variables = "real signQ;real signP;real Sref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Smax inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Smax;"
                                    init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit;S inherit"
                                    out_terminal_labels = "False;False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;inherit S;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                    parameters = "real type;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8128
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8192
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8272
                                    rotation = left
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8128
                                    rotation = left
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8192
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8272
                                    rotation = right
                                ]

                                connect "PQ limiting with priority.P" P as Connection5
                                connect "PQ limiting with priority.Pref" Pref as Connection2
                                connect "PQ limiting with priority.Q" Q as Connection6
                                connect "PQ limiting with priority.Qref" Qref as Connection3
                                connect "PQ limiting with priority.S" S as Connection4
                                connect "PQ limiting with priority.Smax" Smax as Connection1
                            }
                            [
                                position = 7872, 8264
                                size = 56, 184
                            ]

                            component Subsystem limS_overPQ {
                                layout = dynamic
                                component gen_c_function "S limiting over PQ" {
                                    global_variables = "real S_PQref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Sref inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Sref;"
                                    init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8112
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8192
                                ]

                                port Sref {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8272
                                    rotation = left
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8120
                                    rotation = left
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8272
                                    rotation = right
                                ]

                                connect "S limiting over PQ.P" P as Connection3
                                connect "S limiting over PQ.Pref" Pref as Connection5
                                connect "S limiting over PQ.Q" Q as Connection2
                                connect "S limiting over PQ.Qref" Qref as Connection1
                                connect "S limiting over PQ.Sref" Sref as Connection4
                            }
                            [
                                position = 8096, 8264
                                size = 56, 184
                            ]

                            port Qlim {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8336
                            ]

                            port Plim {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8192
                            ]

                            port Pref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8192
                            ]

                            port Qref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8264
                            ]

                            port Smax {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8336
                            ]

                            connect "P rate limit.out" limS_overPQ.Pref as Connection166
                            connect "P rate limit.in" priority_PQlim.P as Connection158
                            connect Plim "Unit Delay1.out" as Connection161
                            connect Pref priority_PQlim.Pref as Connection155
                            connect "Q rate limit.out" limS_overPQ.Qref as Connection162
                            connect "Q rate limit.in" priority_PQlim.Q as Connection159
                            connect Qref priority_PQlim.Qref as Connection156
                            connect "S rate limit.out" limS_overPQ.Sref as Connection165
                            connect "S rate limit.in" priority_PQlim.S as Connection157
                            connect Smax priority_PQlim.Smax as Connection154
                            connect "Unit Delay1.in" limS_overPQ.P as Connection164
                            connect "Unit Delay2.out" Qlim as Connection160
                            connect "Unit Delay2.in" limS_overPQ.Q as Connection163

                            type = "1.0"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                type {
                                    label = "Priority type"
                                    widget = edit
                                    type = generic
                                    default_value = "2.0"
                                }

                                ratemax {
                                    label = "Max power rate"
                                    widget = edit
                                    type = generic
                                    default_value = "powerRate"
                                    unit = "pu/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                
                                ENDCODE
                            }
                        }
                        [
                            position = 9240, 8016
                            rotation = right
                            size = 64, 96
                        ]

                        port Ia {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9208, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ic {
                            position = right:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8432
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_d {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8136
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_q {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port w {
                            position = right:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8376
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vt {
                            position = right:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8296
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9696, 7856
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt_in {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8480
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8552
                        ]

                        port Enable {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9632, 7824
                            rotation = right
                            scale = -1, 1
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 7872
                            rotation = right
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9872, 8064
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8480
                        ]

                        tag Goto22 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9488, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From23 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9664, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9224, 8520
                            hide_name = True
                            size = 54, 25
                        ]

                        tag From44 {
                            value = "Irradiation"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7912, 8152
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto18 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8680, 8416
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From45 {
                            value = "V_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7600, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8216
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto33 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7688
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7624
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From27 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9192, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto24 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9568, 7880
                            rotation = down
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From26 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9760, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From43 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From30 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9192, 7896
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto25 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8824, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto35 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7816
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From31 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7712
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From42 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8200
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From47 {
                            value = "Q_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8408, 8320
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto17 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8376
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7960, 8288
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9704, 8552
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag From25 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9728, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto19 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8296
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto34 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7752
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From28 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7656, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From46 {
                            value = "Q_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From38 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto26 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8656, 7872
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From40 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8112
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From34 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7776
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From37 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8600, 7984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto21 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8592, 8176
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto23 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8456
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From32 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7648
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From35 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7840
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction123 sp
                        [
                            position = 9480, 8336
                        ]

                        junction Junction124 sp
                        [
                            position = 9480, 8480
                        ]

                        junction Junction164 sp
                        [
                            position = 9816, 8064
                        ]

                        junction Junction165 sp
                        [
                            position = 9816, 8480
                        ]

                        junction Junction167 sp
                        [
                            position = 9176, 8480
                        ]

                        junction Junction173 sp
                        [
                            position = 9432, 8336
                        ]

                        junction Junction174 sp
                        [
                            position = 9432, 8480
                        ]

                        junction Junction176 sp
                        [
                            position = 9632, 7880
                        ]

                        junction Junction177 sp
                        [
                            position = 7728, 8464
                        ]

                        junction Junction179 sp
                        [
                            position = 9488, 8064
                        ]

                        junction Junction180 sp
                        [
                            position = 9488, 8208
                        ]

                        junction Junction181 sp
                        [
                            position = 8920, 8136
                        ]

                        junction Junction182 sp
                        [
                            position = 8920, 8216
                        ]

                        junction Junction183 sp
                        [
                            position = 9112, 8480
                        ]

                        junction Junction184 sp
                        [
                            position = 8576, 7920
                        ]

                        junction Junction186 sp
                        [
                            position = 8000, 8152
                        ]

                        junction Junction187 sp
                        [
                            position = 8472, 8320
                        ]

                        junction Junction188 sp
                        [
                            position = 9192, 7648
                        ]

                        junction Junction189 sp
                        [
                            position = 9192, 7712
                        ]

                        junction Junction190 sp
                        [
                            position = 9192, 7776
                        ]

                        junction Junction191 sp
                        [
                            position = 9192, 7840
                        ]

                        junction Junction192 sp
                        [
                            position = 8912, 8376
                        ]

                        junction Junction193 sp
                        [
                            position = 8912, 8296
                        ]

                        junction Junction194 sp
                        [
                            position = 8528, 8176
                        ]

                        junction Junction195 sp
                        [
                            position = 8624, 8416
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Apv = P/(n*G)</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">A_pv = area in m</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = power in W</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">n = efficiency</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">G = W/m    </p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Example: A PV Area can be calculated</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">to have a generation of 5MVA with a</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">PV efficiency of 20% and average </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">insolation of 4.5kWh/m/day</p></body></html> ENDCOMMENT 
                        [
                            position = 7976, 7760
                        ]

                        connect Constant1.out "Signal switch2.in1" as Connection423
                        connect Constant2.out "Signal switch3.in1" as Connection424
                        connect Constant3.out Limit_PQref.Smax as Connection571
                        connect ControlSignal_Calculation.VDC Gain3.out as Connection297
                        connect ControlSignal_Calculation.Id_ref Junction179 as Connection463
                        connect ControlSignal_Calculation.Iq_ref Junction180 as Connection466
                        connect Current_abc_to_dq.wt Junction167 as Connection370
                        connect Current_abc_to_dq.Id Junction173 as Connection396
                        connect Current_ref.Vq From3 as Connection475
                        connect Current_ref.Vd From4 as Connection474
                        connect Current_ref.Ird Junction179 as Connection465
                        connect Current_ref.Irq Junction180 as Connection468
                        connect Current_ref.Q_ref Limit_PQref.Qlim as Connection573
                        connect "Edge Detection1.Out1" ControlSignal_Calculation.Reset as Connection410
                        connect "Edge Detection1.In1" Junction176 as Connection427
                        connect From23 ControlSignal_Calculation.w as Connection246
                        connect From25 ControlSignal_Calculation.Vq as Connection248
                        connect From26 ControlSignal_Calculation.Vd as Connection249
                        connect From28 Junction177 as Connection431
                        connect From30 Limit_PQref.Pref as Connection574
                        connect From31 Power_Meas.Vq as Connection403
                        connect From32 Power_Meas.Vd as Connection402
                        connect From34 Power_Meas.Id as Connection404
                        connect From37 "Logical operator2.in1" as Connection470
                        connect From38 "Signal switch3.in2" as Connection422
                        connect From39 "Logical operator1.in" as Connection439
                        connect From40 "Signal switch2.in2" as Connection471
                        connect From42 Current_ref.Vt as Connection487
                        connect From44 Junction186 as Connection529
                        connect From45 Gain4.in as Connection531
                        connect From46 Gain2.in as Connection533
                        connect From47 Junction187 as Connection538
                        connect Gain3.in VDC as Connection298
                        connect Goto21 Junction194 as Connection560
                        connect Goto22 Junction173 as Connection398
                        connect Goto23 Junction174 as Connection401
                        connect Goto24 Junction176 as Connection425
                        connect Goto25 "Logical operator2.out" as Connection472
                        connect Goto26 Junction184 as Connection494
                        connect Goto32 Junction188 as Connection541
                        connect Goto33 Junction189 as Connection544
                        connect Goto34 Junction190 as Connection547
                        connect Goto35 Junction191 as Connection550
                        connect Ia Current_abc_to_dq.Ia as Connection282
                        connect Ib Current_abc_to_dq.Ib as Connection283
                        connect Ic Current_abc_to_dq.Ic as Connection284
                        connect Junction123 ControlSignal_Calculation.Id_meas as Connection74
                        connect Junction124 ControlSignal_Calculation.Iq_meas as Connection76
                        connect Junction124 Junction174 as Connection399
                        connect Junction164 ControlSignal_Calculation.Ud as Connection359
                        connect Junction165 ControlSignal_Calculation.Uq as Connection363
                        connect Junction167 Goto1 as Connection483
                        connect Junction167 Junction183 as Connection484
                        connect Junction173 Junction123 as Connection397
                        connect Junction174 Current_abc_to_dq.Iq as Connection400
                        connect Junction176 Enable as Connection426
                        connect Junction177 Sum1.in1 as Connection432
                        connect Junction179 Id_ref.in as Connection464
                        connect Junction180 Iq_ref.in as Connection467
                        connect Junction181 Goto4 as Connection477
                        connect Junction182 Goto3 as Connection481
                        connect Junction183 wt_in as Connection485
                        connect Junction184 Connected as Connection493
                        connect Junction186 irr_in.in as Connection528
                        connect Junction187 Qmode.in as Connection537
                        connect Junction188 Power_Meas.P as Connection540
                        connect Junction189 Power_Meas.Q as Connection543
                        connect Junction190 Power_Meas.S as Connection546
                        connect Junction191 Power_Meas.pf as Connection549
                        connect Junction192 Goto17 as Connection554
                        connect Junction193 Goto19 as Connection557
                        connect Junction194 Pref.in as Connection561
                        connect Junction195 Goto18 as Connection565
                        connect Limit_PQref.Plim Current_ref.P_ref as Connection572
                        connect Limit_PQref.Qref From27 as Connection575
                        connect "Logical operator1.out" PI_Vt.Reset as Connection521
                        connect "Logical operator2.in" delay.out as Connection505
                        connect P.in Junction188 as Connection539
                        connect PI_Vt.Out "Signal switch1.in1" as Connection519
                        connect PV_Area_m2.out Product2.in1 as Connection379
                        connect PV_eff.out to_pu.in as Connection390
                        connect Power_Meas.Iq From35 as Connection405
                        connect Product2.in Junction186 as Connection527
                        connect Product2.out PV_eff.in as Connection376
                        connect Q.in Junction189 as Connection542
                        connect Qref.in Junction195 as Connection564
                        connect S.in Junction190 as Connection545
                        connect "Signal switch1.in2" Junction187 as Connection536
                        connect "Signal switch1.out" Junction195 as Connection566
                        connect "Signal switch2.out" Junction194 as Connection562
                        connect "Signal switch2.in" to_pu.out as Connection413
                        connect "Signal switch3.in" Gain2.out as Connection419
                        connect "Signal switch3.out" "Signal switch1.in" as Connection420
                        connect "Signal switch4.in2" From43 as Connection518
                        connect "Signal switch4.in" Gain4.out as Connection429
                        connect "Signal switch4.in1" Junction177 as Connection433
                        connect "Signal switch4.out" Sum1.in as Connection430
                        connect Sum1.out PI_Vt.In as Connection330
                        connect Ud_c.in Junction164 as Connection358
                        connect Uq_c.in Junction165 as Connection362
                        connect V_d Junction181 as Connection476
                        connect V_q Junction182 as Connection480
                        connect Vd.in Junction181 as Connection478
                        connect Vq.in Junction182 as Connection482
                        connect Vt Junction193 as Connection556
                        connect Vt_pu.in Junction193 as Connection558
                        connect delay.in Junction184 as Connection506
                        connect id.in Junction123 as Connection186
                        connect iq.in Junction124 as Connection187
                        connect md Junction164 as Connection360
                        connect mq Junction165 as Connection364
                        connect pf.in Junction191 as Connection548
                        connect w Junction192 as Connection553
                        connect w_pu.in Junction192 as Connection555
                        connect wt From1 as Connection392
                        connect wt_pll.in Junction183 as Connection486
                    }
                    [
                        position = 7936, 7576
                        scale = -1, 1
                        size = 216, 264
                    ]

                    component Subsystem duty_cycle {
                        layout = dynamic
                        component gen_probe Da {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8112
                            rotation = left
                        ]

                        component gen_probe Db {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8184
                            rotation = left
                        ]

                        component gen_probe Dc {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8248
                            rotation = left
                        ]

                        component gen_probe Dz_A {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8112
                            rotation = left
                        ]

                        component gen_probe Dz_C {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8248
                            rotation = left
                        ]

                        component gen_probe Dz_B {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8184
                            rotation = left
                        ]

                        component Subsystem ZSM {
                            layout = dynamic
                            component src_constant Constant1 {
                                execution_rate = "inherit"
                                value = "k"
                            }
                            [
                                position = 7336, 8080
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "0"
                                upper_limit = "1"
                            }
                            [
                                position = 7408, 8080
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 7848, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8120
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8176
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "--+"
                            }
                            [
                                position = 7984, 8152
                                hide_name = True
                            ]

                            component gen_probe Z0 {
                            }
                            [
                                position = 8048, 8088
                                rotation = left
                            ]

                            component src_constant Constant3 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7672, 8128
                                hide_name = True
                            ]

                            component gen_minmax "Min Max1" {
                                inputs = "3"
                            }
                            [
                                position = 7584, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 7848, 8152
                                hide_name = True
                            ]

                            component gen_minmax "Min Max2" {
                                inputs = "3"
                                operation = "max"
                            }
                            [
                                position = 7584, 8256
                                hide_name = True
                            ]

                            component src_constant Constant2 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7656, 8288
                                hide_name = True
                            ]

                            component gen_sum Sum8 {
                                signs = "-+"
                            }
                            [
                                position = 7864, 8048
                                hide_name = True
                            ]

                            component src_constant Constant4 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7784, 8064
                                hide_name = True
                            ]

                            port Da {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Db {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dc {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_A {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_B {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8176
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_C {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8264
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From4 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8088
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From2 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7736, 8208
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From5 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8120, 8152
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From3 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From8 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8288
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From6 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8200
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7648, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto4 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8304
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From7 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8256
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8240
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From9 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7760, 8016
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction254 sp
                            [
                                position = 7480, 8144
                            ]

                            junction Junction255 sp
                            [
                                position = 7496, 8208
                            ]

                            junction Junction256 sp
                            [
                                position = 7512, 8272
                            ]

                            junction Junction257 sp
                            [
                                position = 7344, 8144
                            ]

                            junction Junction258 sp
                            [
                                position = 7344, 8208
                            ]

                            junction Junction259 sp
                            [
                                position = 7344, 8272
                            ]

                            junction Junction260 sp
                            [
                                position = 8048, 8152
                            ]

                            connect Constant1.out Limit1.in as Connection1425
                            connect Constant2.out Sum1.in1 as Connection1427
                            connect Constant3.out Sum2.in1 as Connection1434
                            connect Da Junction257 as Connection1474
                            connect Db Junction258 as Connection1477
                            connect Dc Junction259 as Connection1480
                            connect From1 Sum2.in as Connection1440
                            connect From2 Product1.in as Connection1441
                            connect From3 Sum5.in1 as Connection1446
                            connect From4 Sum5.in as Connection1487
                            connect From5 Sum6.in as Connection1489
                            connect From6 Sum6.in1 as Connection1488
                            connect From7 Sum7.in as Connection1493
                            connect From8 Sum7.in1 as Connection1492
                            connect Goto1 Limit1.out as Connection1439
                            connect Goto2 Junction257 as Connection1476
                            connect Goto3 Junction258 as Connection1479
                            connect Goto4 Junction259 as Connection1482
                            connect Goto5 Junction260 as Connection1486
                            connect Junction254 "Min Max2.in" as Connection1466
                            connect Junction255 "Min Max1.in1" as Connection1469
                            connect Junction256 "Min Max1.in2" as Connection1472
                            connect Junction257 Junction254 as Connection1475
                            connect Junction258 Junction255 as Connection1478
                            connect Junction259 Junction256 as Connection1481
                            connect Junction260 Sum3.out as Connection1485
                            connect "Min Max1.in" Junction254 as Connection1465
                            connect "Min Max2.in1" Junction255 as Connection1468
                            connect "Min Max2.in2" Junction256 as Connection1471
                            connect Product1.in1 Sum1.out as Connection1428
                            connect Product1.out Sum3.in2 as Connection1451
                            connect Product2.in1 "Min Max1.out" as Connection1430
                            connect Product2.out Sum3.in1 as Connection1450
                            connect Sum1.in "Min Max2.out" as Connection1426
                            connect Sum2.out Product2.in as Connection1435
                            connect Sum5.out Dz_A as Connection1447
                            connect Sum6.out Dz_B as Connection1490
                            connect Sum7.out Dz_C as Connection1491
                            connect Z0.in Junction260 as Connection1484
                            connect Constant4.out Sum8.in1 as Connection1495
                            connect From9 Sum8.in as Connection1496
                            connect Sum8.out Sum3.in as Connection1497

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                k {
                                    label = "Modulation type coefficent k"
                                    widget = edit
                                    type = generic
                                    default_value = "0.5"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                
                                ENDCODE
                            }
                        }
                        [
                            position = 7776, 8216
                            scale = -1, 1
                            size = 88, 168
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7560, 8088
                            rotation = right
                            size = 48, 80
                        ]

                        component gen_probe m_d {
                            addr = "8969"
                        }
                        [
                            position = 7512, 7888
                            rotation = right
                            scale = 1, -1
                        ]

                        component gen_probe m_q {
                            addr = "8967"
                        }
                        [
                            position = 7552, 7888
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant o_ref {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7512, 8008
                            hide_name = True
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "mod_lowLim"
                            upper_limit = "mod_upLim"
                        }
                        [
                            position = 7464, 7936
                            hide_name = True
                        ]

                        component gen_limiter Limit3 {
                            lower_limit = "-1.1546"
                            upper_limit = "1.1546"
                        }
                        [
                            position = 7464, 7984
                            hide_name = True
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 8032
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 7984
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 7936
                        ]

                        port m_a {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8152
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_b {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_c {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8280
                            rotation = down
                            scale = -1, 1
                        ]

                        junction Junction6 sp
                        [
                            position = 7856, 8280
                        ]

                        junction Junction7 sp
                        [
                            position = 7856, 8216
                        ]

                        junction Junction8 sp
                        [
                            position = 7856, 8152
                        ]

                        junction Junction9 sp
                        [
                            position = 7512, 7936
                        ]

                        junction Junction10 sp
                        [
                            position = 7552, 7984
                        ]

                        junction Junction11 sp
                        [
                            position = 7664, 8152
                        ]

                        junction Junction12 sp
                        [
                            position = 7664, 8216
                        ]

                        junction Junction13 sp
                        [
                            position = 7664, 8280
                        ]

                        connect Dz_A.in Junction8 as Connection2320
                        connect Dz_B.in Junction7 as Connection2317
                        connect Dz_C.in Junction6 as Connection2314
                        connect Junction6 ZSM.Dz_C as Connection2313
                        connect Junction7 m_b as Connection2316
                        connect Junction8 ZSM.Dz_A as Connection2319
                        connect ZSM.Dz_B Junction7 as Connection2315
                        connect m_a Junction8 as Connection2318
                        connect m_c Junction6 as Connection2312
                        connect "dq to abc1.d_input" Junction9 as Connection2328
                        connect Junction10 m_q.in as Connection2330
                        connect o_ref.out "dq to abc1.zero_input" as Connection2332
                        connect Limit3.out Junction10 as Connection2329
                        connect Junction9 Limit2.out as Connection2327
                        connect m_d.in Junction9 as Connection2326
                        connect "dq to abc1.q_input" Junction10 as Connection2331
                        connect ZSM.Da Junction11 as Connection2333
                        connect Junction11 Da.in as Connection2334
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_a" Junction11 as Connection2335
                        connect Db.in Junction12 as Connection2336
                        connect Junction12 ZSM.Db as Connection2337
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_b" Junction12 as Connection2338
                        connect Dc.in Junction13 as Connection2339
                        connect Junction13 ZSM.Dc as Connection2340
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_c" Junction13 as Connection2341
                        connect md Limit2.in as Connection2342
                        connect Limit3.in mq as Connection2343
                        connect wt "dq to abc1.wt" as Connection2344
                    }
                    [
                        position = 8216, 7576
                        scale = -1, 1
                        size = 96, 272
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8184
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8088
                            hide_name = True
                        ]

                        component gen_probe Vt_meas {
                        }
                        [
                            position = 8520, 8160
                            scale = 1, -1
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8160, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain5 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8168, 8320
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 8208, 8088
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8112, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8280
                            hide_name = True
                        ]

                        component gen_probe f_meas {
                        }
                        [
                            position = 8520, 8224
                        ]

                        component "core/Three phase PLL" PLL {
                            enable_pk = "True"
                            enable_sin = "False"
                            enable_zero = "False"
                            low_lim = "0"
                            rate_high = "5*fn"
                            rate_low = "-5*fn"
                            up_lim = "1.4*2*np.pi*fn"
                        }
                        [
                            position = 8064, 8184
                            size = 64, 128
                        ]

                        component src_constant Constant1 {
                            execution_rate = "inherit"
                            value = "0"
                        }
                        [
                            position = 7832, 8336
                            hide_name = True
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8016
                        ]

                        port Vd {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7920
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8168
                        ]

                        port Vq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7968
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8072
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8264
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8200
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7920, 7968
                            rotation = right
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8360
                        ]

                        tag Goto33 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8264, 8136
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8232, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8232
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From3 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8136
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From2 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto34 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7984, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8296
                        ]

                        junction Junction1 sp
                        [
                            position = 8208, 8136
                        ]

                        junction Junction5 sp
                        [
                            position = 7920, 8024
                        ]

                        junction Junction3 sp
                        [
                            position = 7888, 8200
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8272
                        ]

                        connect Goto34 Junction5 as Connection112
                        connect Junction1 Gain1.in as Connection83
                        connect Junction2 Goto32 as Connection87
                        connect PLL.peak Junction2 as Connection88
                        connect Junction3 "Signal switch1.in1" as Connection98
                        connect From4 "Signal switch3.in2" as Connection115
                        connect "Signal switch2.in1" Junction3 as Connection99
                        connect Vt Gain5.out as Connection56
                        connect From2 Vt_meas.in as Connection74
                        connect From1 f_meas.in as Connection73
                        connect PLL.vb "Signal switch2.out" as Connection92
                        connect Gain3.out Vq as Connection54
                        connect "Signal switch1.in" A as Connection89
                        connect Constant1.out Junction4 as Connection100
                        connect "Signal switch3.in1" Junction4 as Connection102
                        connect Gain5.in Junction2 as Connection86
                        connect Vd Gain4.out as Connection55
                        connect From3 "Signal switch2.in2" as Connection113
                        connect Gain1.out f as Connection27
                        connect Gain3.in PLL.q_axis as Connection81
                        connect Junction5 Connected as Connection111
                        connect Goto33 Junction1 as Connection82
                        connect "Signal switch3.out" PLL.vc as Connection114
                        connect "Signal switch1.in2" Junction5 as Connection110
                        connect "Signal switch3.in" C as Connection94
                        connect "Signal switch1.out" PLL.va as Connection91
                        connect PLL.theta wt as Connection85
                        connect B "Signal switch2.in" as Connection95
                        connect Junction4 Junction3 as Connection101
                        connect PLL.freq Junction1 as Connection84
                        connect PLL.d_axis Gain4.in as Connection80
                    }
                    [
                        position = 7432, 7568
                        size = 64, 176
                    ]

                    port Va {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7504
                    ]

                    port Vb {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7568
                    ]

                    port Vc {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7632
                    ]

                    port VDC {
                        position = top:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8024, 7392
                        rotation = right
                    ]

                    port Ic {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7688
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ib {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7712, 7656
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ia {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7624
                        rotation = down
                        scale = -1, 1
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7848, 7392
                        rotation = right
                    ]

                    port Connected {
                        position = top:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 7280
                        rotation = right
                    ]

                    port mc {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7688
                    ]

                    port mb {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7576
                    ]

                    port ma {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7464
                    ]

                    tag Goto14 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From16 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7528
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From17 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7560
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From18 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7592
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto13 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto10 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7568
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7504
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From14 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From15 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7496
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto15 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From19 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7360, 7440
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto16 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8008, 7320
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction1 sp
                    [
                        position = 7936, 7320
                    ]

                    connect Enable Grid_follow.Enable as Connection532
                    connect From14 Grid_follow.V_d as Connection480
                    connect From15 Grid_follow.V_q as Connection481
                    connect From16 Grid_follow.Vt as Connection482
                    connect From17 Grid_follow.w as Connection502
                    connect From18 Grid_follow.wt_in as Connection485
                    connect Goto16 Junction1 as Connection541
                    connect Grid_follow.Connected Junction1 as Connection543
                    connect Ia Grid_follow.Ia as Connection495
                    connect Ib Grid_follow.Ib as Connection496
                    connect Ic Grid_follow.Ic as Connection497
                    connect Junction1 Connected as Connection542
                    connect VDC Grid_follow.VDC as Connection487
                    connect duty_cycle.md Grid_follow.md as Connection544
                    connect duty_cycle.mq Grid_follow.mq as Connection545
                    connect duty_cycle.wt Grid_follow.wt as Connection546
                    connect ma duty_cycle.m_a as Connection547
                    connect mb duty_cycle.m_b as Connection548
                    connect mc duty_cycle.m_c as Connection549
                    connect PLL.A Va as Connection550
                    connect PLL.B Vb as Connection551
                    connect PLL.C Vc as Connection552
                    connect PLL.Vd Goto12 as Connection553
                    connect Goto13 PLL.Vq as Connection554
                    connect PLL.Vt Goto10 as Connection555
                    connect Goto14 PLL.f as Connection556
                    connect PLL.wt Goto15 as Connection557
                    connect PLL.Connected From19 as Connection558
                }
                [
                    position = 8176, 7888
                    size = 128, 208
                ]

                component "core/Three Phase Inverter" "3ph_inverter 1" {
                    carrier_freq = "fsw"
                    ctrl_src = "Internal modulator"
                    d_time = "1e-6"
                }
                [
                    position = 7736, 8248
                    size = 127, 256
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "14"
                    }
                    [
                        position = 8192, 8192
                        rotation = left
                        hide_name = True
                    ]

                    port Outputs {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8192, 8120
                        rotation = left
                    ]

                    port Connected {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8248
                    ]

                    port Inv_On {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8288
                    ]

                    port Va {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8328
                    ]

                    port Vb {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8368
                    ]

                    port Vc {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8408
                    ]

                    port Ia {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8496
                    ]

                    port Ib {
                        position = left:8
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8536
                    ]

                    port Ic {
                        position = left:9
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8576
                    ]

                    tag From30 {
                        value = "P"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8648
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From33 {
                        value = "S"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8696
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8456
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From32 {
                        value = "pf"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8720
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8624
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From31 {
                        value = "Q"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8672
                        hide_name = True
                        size = 60, 20
                    ]

                    connect "Bus Join1.in" Connected as Connection5
                    connect "Bus Join1.in6" Ia as Connection2
                    connect "Bus Join1.in7" Ib as Connection4
                    connect "Bus Join1.in8" Ic as Connection1
                    connect "Bus Join1.in1" Inv_On as Connection9
                    connect "Bus Join1.out" Outputs as Connection6
                    connect "Bus Join1.in2" Va as Connection8
                    connect "Bus Join1.in3" Vb as Connection3
                    connect "Bus Join1.in4" Vc as Connection7
                    connect From29 "Bus Join1.in5" as Connection10
                    connect From30 "Bus Join1.in10" as Connection12
                    connect From31 "Bus Join1.in11" as Connection13
                    connect From32 "Bus Join1.in13" as Connection15
                    connect From33 "Bus Join1.in12" as Connection14
                    connect From34 "Bus Join1.in9" as Connection11
                }
                [
                    position = 8672, 7680
                    rotation = left
                    size = 96, 152
                ]

                component "core/Signal Controlled Voltage Source" Vs2 {
                }
                [
                    position = 7320, 8248
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                }
                [
                    position = 9040, 8152
                    rotation = down
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                }
                [
                    position = 9040, 8248
                    rotation = down
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                }
                [
                    position = 9040, 8344
                    rotation = down
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7968, 7584
                    rotation = right
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8672, 7584
                    rotation = left
                ]

                tag From20 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7936
                    hide_name = True
                    size = 60, 20
                ]

                tag From9 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7840
                    hide_name = True
                    size = 60, 20
                ]

                tag From19 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7904
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto12 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8112
                    hide_name = True
                    size = 60, 20
                ]

                tag From29 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7760
                    hide_name = True
                    size = 60, 20
                ]

                tag From27 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From26 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8856, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag From32 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto14 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag From34 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7904
                    hide_name = True
                    size = 60, 20
                ]

                tag From30 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7856
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto5 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8520
                    hide_name = True
                    size = 60, 20
                ]

                tag From8 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag From31 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag From35 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7880
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto15 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7624, 8256
                    hide_name = True
                    size = 60, 20
                ]

                tag From18 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7928
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag From10 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7872
                    hide_name = True
                    size = 60, 20
                ]

                tag From24 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7336, 8032
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto4 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8472
                    hide_name = True
                    size = 60, 20
                ]

                tag From23 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7336, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag From21 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto16 {
                    value = "Inv_On"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7664, 8000
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto13 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8208
                    hide_name = True
                    size = 60, 20
                ]

                tag From25 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8136, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From28 {
                    value = "Inv_On"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8544, 7784
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto17 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7888
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto3 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto18 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag From37 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7912
                    hide_name = True
                    size = 60, 20
                ]

                tag From38 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7888
                    hide_name = True
                    size = 60, 20
                ]

                tag From36 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7936
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction65 pe
                [
                    position = 8632, 8248
                ]

                junction Junction70 pe
                [
                    position = 8328, 8624
                ]

                junction Junction78 pe
                [
                    position = 8536, 8624
                ]

                junction Junction88 pe
                [
                    position = 7544, 8152
                ]

                junction Junction89 pe
                [
                    position = 7544, 8344
                ]

                junction Junction115 pe
                [
                    position = 8416, 8624
                ]

                junction Junction116 pe
                [
                    position = 8480, 8624
                ]

                junction Junction119 pe
                [
                    position = 7848, 8152
                ]

                junction Junction120 pe
                [
                    position = 7848, 8248
                ]

                junction Junction121 pe
                [
                    position = 8248, 8152
                ]

                junction Junction123 pe
                [
                    position = 8328, 8248
                ]

                junction Junction125 pe
                [
                    position = 8416, 8344
                ]

                junction Junction127 pe
                [
                    position = 7472, 8152
                ]

                junction Junction132 sp
                [
                    position = 7608, 8040
                ]

                junction Junction134 sp
                [
                    position = 7432, 8032
                ]

                junction Junction135 sp
                [
                    position = 7584, 8040
                ]

                junction Junction136 pe
                [
                    position = 8480, 8152
                ]

                junction Junction137 pe
                [
                    position = 8632, 8152
                ]

                junction Junction138 pe
                [
                    position = 8536, 8248
                ]

                junction Junction139 pe
                [
                    position = 8632, 8248
                ]

                junction Junction140 pe
                [
                    position = 8592, 8344
                ]

                junction Junction141 pe
                [
                    position = 8632, 8344
                ]

                junction Junction142 pe
                [
                    position = 7472, 8344
                ]

                connect "3ph_inverter 1.InB" From37 as Connection793
                connect "3ph_inverter 1.a_in" Junction119 as Connection634
                connect "3ph_inverter 1.b_in" Junction120 as Connection637
                connect "3ph_inverter 1.c_in" L3.p_node as Connection640
                connect A S1.a_out as Connection694
                connect B S1.b_out as Connection698
                connect C S1.c_out as Connection696
                connect C1.n_node Junction70 as Connection142
                connect C1.p_node R7.n_node as Connection139
                connect C2.p_node R8.n_node as Connection144
                connect C3.n_node Junction115 as Connection618
                connect Ca1.n_node Junction142 as Connection797
                connect Control.Ic From21 as Connection493
                connect From10 Control.Vc as Connection487
                connect From18 Control.VDC as Connection489
                connect From19 Control.Ia as Connection491
                connect From20 Control.Ib as Connection492
                connect From23 delay.in as Connection734
                connect From24 Junction134 as Connection748
                connect From25 Control.Enable as Connection750
                connect From26 S1.ctrl_in as Connection753
                connect From27 Control.Connected as Connection754
                connect From28 Output.Inv_On as Connection761
                connect From30 Output.Vc as Connection764
                connect From31 Output.Va as Connection762
                connect From32 Output.Vb as Connection763
                connect From33 Output.Ic as Connection767
                connect From34 Output.Ib as Connection766
                connect From35 Output.Ia as Connection765
                connect From36 "3ph_inverter 1.InA" as Connection792
                connect From38 "3ph_inverter 1.InC" as Connection794
                connect From8 Control.Va as Connection485
                connect From9 Control.Vb as Connection486
                connect Goto1 Va.out as Connection367
                connect Goto12 Ia.out as Connection668
                connect Goto13 Ib.out as Connection669
                connect Goto14 Ic.out as Connection670
                connect Goto15 Vdc.out as Connection484
                connect Goto16 Junction135 as Connection758
                connect Goto17 Control.mb as Connection790
                connect Goto18 Control.mc as Connection791
                connect Goto3 Control.ma as Connection789
                connect Goto4 Vb.out as Connection368
                connect Goto5 Vc.out as Connection369
                connect Ia.n_node Junction121 as Connection671
                connect Ib.n_node Junction123 as Connection676
                connect Ic.p_node R0c.n_node as Connection667
                connect Iinv_in.n_node "3ph_inverter 1.pos_out" as Connection28
                connect Iinv_in.p_node Junction88 as Connection470
                connect Inputs Input.Inputs as Connection755
                connect Junction115 Junction116 as Connection622
                connect Junction115 Junction70 as Connection619
                connect Junction116 Va.n_node as Connection621
                connect Junction119 Vab.p_node as Connection635
                connect Junction120 Vab.n_node as Connection638
                connect Junction121 R7.p_node as Connection672
                connect Junction123 R8.p_node as Connection677
                connect Junction125 Ic.n_node as Connection682
                connect Junction127 Ca1.p_node as Connection689
                connect Junction132 "3ph_inverter 1.En" as Connection738
                connect Junction134 "Logical operator1.in" as Connection747
                connect Junction135 Junction132 as Connection757
                connect Junction136 Junction121 as Connection775
                connect Junction136 Junction137 as Connection778
                connect Junction137 R0a1.p_node as Connection777
                connect Junction138 Junction123 as Connection780
                connect Junction138 Junction139 as Connection783
                connect Junction139 R0b1.p_node as Connection782
                connect Junction140 Junction125 as Connection785
                connect Junction140 Junction141 as Connection788
                connect Junction141 Vbc1.n_node as Connection787
                connect Junction142 Junction89 as Connection798
                [
                    position = 0, 0
                ]
                connect Junction65 Junction139 as Connection781
                connect Junction70 C2.n_node as Connection143
                connect Junction78 Junction116 as Connection620
                connect Junction88 Junction127 as Connection688
                connect Junction88 Vdc.p_node as Connection471
                connect Junction89 "3ph_inverter 1.neg_out" as Connection474
                connect L1.p_node Junction119 as Connection636
                connect L2.p_node Junction120 as Connection639
                connect L3.n_node R0c.p_node as Connection614
                connect L5.p_node R0a1.n_node as Connection652
                connect L6.p_node R0b1.n_node as Connection650
                connect "Logical operator1.out" Junction135 as Connection756
                connect On.in Junction132 as Connection739
                connect Output.Connected From29 as Connection760
                connect Outputs Output.Outputs as Connection759
                connect R0a.n_node Ia.p_node as Connection664
                connect R0a.p_node L1.n_node as Connection611
                connect R0b.n_node Ib.p_node as Connection662
                connect R0b.p_node L2.n_node as Connection613
                connect R0c1.p_node Junction141 as Connection786
                connect R0c1.n_node L4.p_node as Connection655
                connect R4.n_node Junction127 as Connection690
                connect R9.n_node C3.p_node as Connection145
                connect R9.p_node Junction125 as Connection681
                connect S1.c_in L4.n_node as Connection697
                connect S1.a_in L5.n_node as Connection695
                connect S1.b_in L6.n_node as Connection699
                connect VDC.out Vs2.in as Connection800
                connect Va.p_node Junction136 as Connection774
                connect Vab1.p_node Junction137 as Connection776
                connect Vab1.n_node Junction65 as Connection119
                connect Vb.p_node Junction138 as Connection779
                connect Vb.n_node Junction78 as Connection363
                connect Vbc1.p_node Junction65 as Connection117
                connect Vc.p_node Junction140 as Connection784
                connect Vc.n_node Junction78 as Connection617
                connect Vdc.n_node Junction89 as Connection473
                connect Vs2.n_node Junction142 as Connection799
                connect Vs2.p_node R4.p_node as Connection796
                connect delay.out "Logical operator1.in1" as Connection735
                connect enable.in Junction134 as Connection749

                C = "150e-6"
                Id_Ki = "60"
                Id_Kp = "0.6"
                Iq_Ki = "60"
                Iq_Kp = "0.6"
                L = "0.3e-3"
                L0 = "6e-3"
                PV_area = "100"
                PV_eff = "15.0"
                R0 = "0.1"
                Rres = "15e-3"
                Sn = "200e3"
                Ts = "Ts_pv"
                V_Ki = "22.4784"
                V_Kp = "0.1"

                mask {
                    icon = "image(\'pv_plant.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">PV plant switching model. </span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Active power output is based on irradiation input. Reactive power output is based on terminal voltage control or direct reactive power setpoints. If the input \"Q_mode\" is high, the reactive power output will be set by the reference given in the input \"Q_ref\", else, the reactive power reference is based on the reference given in the input \"V_ref\".</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">The number of inputs is 6 and of outputs is 14 and they are configured in the following order:</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Inputs: 0 - Connect; 1 - Enable; 2 - Irradiation; 3 - V_ref; 4 - Q_mode; 5 - Q_ref;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q; 12 - S; 13 - pf;</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                    help_file = "pv_plant.html"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    Sn {
                        label = "Nominal power"
                        widget = edit
                        type = generic
                        default_value = "5.0e6"
                        unit = "VA"
                        group = "1 - General"
                    }

                    fn {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    fsw {
                        label = "Inverter switching frequency"
                        widget = edit
                        type = generic
                        default_value = "10000.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    Vn_dc {
                        label = "Nominal DC voltage"
                        widget = edit
                        type = generic
                        default_value = "1000.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    PV_area {
                        label = "PV plant area"
                        widget = edit
                        type = generic
                        default_value = "5556.0"
                        unit = "m"
                        group = "1 - General"
                    }

                    PV_eff {
                        label = "PV plant efficiency"
                        widget = edit
                        type = generic
                        default_value = "20.0"
                        unit = "%"
                        group = "1 - General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "200e-6"
                        unit = "s"
                        group = "1 - General"
                    }

                    L0 {
                        label = "Inverter side inductor"
                        widget = edit
                        type = generic
                        default_value = "79.8e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    R0 {
                        label = "Inductors series resistors"
                        widget = edit
                        type = generic
                        default_value = "1e-6"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    L {
                        label = "Grid side inductor"
                        widget = edit
                        type = generic
                        default_value = "9.6e-6"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    Rres {
                        label = "Shunt resistance"
                        widget = edit
                        type = generic
                        default_value = "0.01568"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    C {
                        label = "Shunt capacitor"
                        widget = edit
                        type = generic
                        default_value = "2.7085e-3"
                        unit = "F"
                        group = "2 - Filter"
                    }

                    V_Kp {
                        label = "Voltage PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "15.0"
                        group = "3 - Adv. 1"
                    }

                    V_Ki {
                        label = "Voltage PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "3 - Adv. 1"
                    }

                    V_upLim {
                        label = "Voltage PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "4.0"
                        group = "3 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Voltage PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-4.0"
                        group = "3 - Adv. 1"
                    }

                    Id_Kp {
                        label = "d current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "4 - Adv. 2"
                    }

                    Id_Ki {
                        label = "d current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "4 - Adv. 2"
                    }

                    Id_upLim {
                        label = "d current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Adv. 2"
                    }

                    Id_lowLim {
                        label = "d current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "4 - Adv. 2"
                    }

                    Iq_Kp {
                        label = "q current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "3.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_Ki {
                        label = "q current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "30.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_upLim {
                        label = "q current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_lowLim {
                        label = "q current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "5 - Adv. 3"
                    }

                    Damp {
                        label = "d and q currents damping"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "6 - Adv. 4"
                    }

                    mod_upLim {
                        label = "Modulation signals upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.1546"
                        group = "6 - Adv. 4"
                    }

                    mod_lowLim {
                        label = "Modulation signals lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.1546"
                        group = "6 - Adv. 4"
                    }

                    Delay {
                        label = "Time delay to turn on after grid connection"
                        widget = edit
                        type = generic
                        default_value = "0.125"
                        unit = "s"
                        group = "6 - Adv. 4"
                    }

                    powerRate {
                        label = "Maximum power reference change rate"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "pu/s"
                        group = "6 - Adv. 4"
                    }

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, "pv_plant.svg")
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7968, 8152
                size = 353, 239
            ]

            component src_constant Constant2 {
                execution_rate = "Ts_pv"
                value = "480"
            }
            [
                position = 7472, 8000
                hide_name = True
            ]

            component gen_bus_split "Bus Split1" {
                outputs = "14"
            }
            [
                position = 8272, 7808
                hide_name = True
            ]

            component gen_probe P {
            }
            [
                position = 8392, 7864
            ]

            component gen_probe Q {
            }
            [
                position = 8392, 7920
            ]

            component gen_probe SI {
            }
            [
                position = 7320, 8144
                scale = -1, 1
            ]

            component Subsystem "Solar irradiance" {
                layout = dynamic
                component gen_c_function "C function2" {
                    global_variables = "real k;"
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "GHI inherit;ETR inherit"
                    in_terminal_labels = "[(\'GHI\', True), (\'ETR\', True)]"
                    in_terminal_properties = "real GHI;real ETR;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit;inherit"
                    out_terminal_dimensions_str = "f inherit;Gdh inherit"
                    out_terminal_labels = "[(\'f\', True), (\'Gdh\', True)]"
                    out_terminal_properties = "real f;real Gdh;"
                    output_fnc = "/*Begin code section*/
if (k<=0.21) f = 0.995-0.081*k;
else if (k>0.76) f = 0.18;
else f = 0.724 + 2.738*k - 8.321*k*k + 4.967*k*k*k;
Gdh = f*GHI;
/*End code section*/"
                    update_fnc = "/*Begin code section*/
k = GHI/ETR;
/*End code section*/"
                }
                [
                    position = 7480, 7976
                    hide_name = True
                    size = 56, 72
                ]

                component src_constant Constant9 {
                    execution_rate = "Ts_pv"
                    value = "GHI"
                }
                [
                    position = 7024, 7920
                    hide_name = True
                ]

                component src_constant Constant10 {
                    execution_rate = "Ts_pv"
                    value = "ETR"
                }
                [
                    position = 7024, 7960
                    hide_name = True
                ]

                component src_constant Constant11 {
                    execution_rate = "Ts_pv"
                    value = "ang"
                }
                [
                    position = 7024, 8000
                    hide_name = True
                ]

                component src_constant Constant12 {
                    execution_rate = "Ts_pv"
                    value = "ang_z"
                }
                [
                    position = 7024, 8040
                    hide_name = True
                ]

                component src_constant Constant13 {
                    execution_rate = "Ts_pv"
                    value = "ang_t"
                }
                [
                    position = 7024, 8080
                    hide_name = True
                ]

                component src_constant Constant14 {
                    execution_rate = "Ts_pv"
                    value = "rho"
                }
                [
                    position = 7024, 8128
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function1" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7904, 7960
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function2" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7904, 8016
                    hide_name = True
                ]

                component gen_sum Sum3 {
                    signs = "+-"
                }
                [
                    position = 7792, 7888
                    hide_name = True
                ]

                component gen_product Product2 {
                    signs = "**/"
                }
                [
                    position = 8040, 7920
                    hide_name = True
                ]

                component gen_sum Sum4 {
                    signs = "+-"
                }
                [
                    position = 7480, 8144
                    hide_name = True
                ]

                component gen_product Product3 {
                    signs = "***"
                }
                [
                    position = 7632, 8160
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function3" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7344, 8152
                    hide_name = True
                ]

                component src_constant Constant15 {
                    execution_rate = "Ts_pv"
                }
                [
                    position = 7336, 8096
                    hide_name = True
                ]

                component gen_product Product4 {
                }
                [
                    position = 7984, 8192
                    hide_name = True
                ]

                component gen_sum Sum5 {
                    signs = "+-"
                }
                [
                    position = 8088, 8168
                    hide_name = True
                ]

                component src_constant Constant17 {
                    execution_rate = "Ts_pv"
                }
                [
                    position = 7944, 8120
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function4" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7408, 8400
                    hide_name = True
                ]

                component gen_gain Gain1 {
                    gain = "0.5"
                }
                [
                    position = 7320, 8400
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function5" {
                }
                [
                    position = 7408, 8464
                    hide_name = True
                ]

                component gen_gain Gain2 {
                    gain = "0.5"
                }
                [
                    position = 7320, 8464
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function6" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7408, 8528
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function7" {
                }
                [
                    position = 7408, 8584
                    hide_name = True
                ]

                component gen_c_function "C function3" {
                    in_terminal_dimensions = "1;1;4"
                    in_terminal_dimensions_str = "Gdh 1;fk 1;x 4"
                    in_terminal_labels = "[(\'Gdh\', True), (\'fk\', True), (\'x\', True)]"
                    in_terminal_properties = "real Gdh;real fk;real x;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "1"
                    out_terminal_dimensions_str = "Gd 1"
                    out_terminal_labels = "[(\'Gd\', True)]"
                    out_terminal_properties = "real Gd;"
                    output_fnc = "/*Begin code section*/
Gd = Gdh*0.5*(1+x[0])*(1+fk*x[1]*x[1]*x[1])*(1+fk*x[2]*x[2]*x[3]*x[3]*x[3]);
/*End code section*/"
                }
                [
                    position = 7736, 8432
                    hide_name = True
                    size = 104, 128
                ]

                component gen_bus_join "Bus Join1" {
                    inputs = "4"
                }
                [
                    position = 7544, 8480
                ]

                component gen_sum Sum6 {
                    signs = "+++"
                }
                [
                    position = 8016, 8416
                    hide_name = True
                ]

                component gen_gain Gain3 {
                    gain = "0.5"
                }
                [
                    position = 7712, 8160
                    hide_name = True
                ]

                port SI {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8176, 8416
                ]

                tag From66 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 7960
                    hide_name = True
                    size = 37, 20
                ]

                tag From67 {
                    value = "ETR"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 7992
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto35 {
                    value = "f"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7608, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto36 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7608, 7992
                    hide_name = True
                    size = 60, 20
                ]

                tag From68 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7784, 7960
                    hide_name = True
                    size = 37, 20
                ]

                tag From69 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7784, 8016
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto37 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto38 {
                    value = "ETR"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto39 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8000
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto40 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8040
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto41 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto42 {
                    value = "rho"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8128
                    hide_name = True
                    size = 60, 20
                ]

                tag From70 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7696, 7880
                    hide_name = True
                    size = 37, 20
                ]

                tag From71 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7696, 7912
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto43 {
                    value = "Gb"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8152, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto44 {
                    value = "Gr"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7800, 8160
                    hide_name = True
                    size = 60, 20
                ]

                tag From74 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7480, 8200
                    hide_name = True
                    size = 37, 20
                ]

                tag From72 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7224, 8152
                    hide_name = True
                    size = 37, 20
                ]

                tag From75 {
                    value = "rho"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7480, 8232
                    hide_name = True
                    size = 37, 20
                ]

                tag From76 {
                    value = "f"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7864, 8184
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto45 {
                    value = "fk"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8216, 8168
                    hide_name = True
                    size = 60, 20
                ]

                tag From78 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7240, 8400
                    hide_name = True
                    size = 37, 20
                ]

                tag From79 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7288, 8528
                    hide_name = True
                    size = 37, 20
                ]

                tag From80 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7288, 8584
                    hide_name = True
                    size = 37, 20
                ]

                tag From81 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7544, 8368
                    hide_name = True
                    size = 37, 20
                ]

                tag From82 {
                    value = "fk"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7544, 8408
                    hide_name = True
                    size = 37, 20
                ]

                tag From83 {
                    value = "Gb"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7920, 8376
                    hide_name = True
                    size = 37, 20
                ]

                tag From84 {
                    value = "Gr"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7920, 8416
                    hide_name = True
                    size = 37, 20
                ]

                junction Junction1 sp
                [
                    position = 7920, 8184
                ]

                junction Junction2 sp
                [
                    position = 7272, 8400
                ]

                connect From66 "C function2.GHI" as Connection61
                connect From67 "C function2.ETR" as Connection62
                connect "C function2.f" Goto35 as Connection63
                connect "C function2.Gdh" Goto36 as Connection64
                connect Goto37 Constant9.out as Connection65
                connect Constant10.out Goto38 as Connection66
                connect Constant11.out Goto39 as Connection67
                connect Constant12.out Goto40 as Connection68
                connect Constant13.out Goto41 as Connection69
                connect Constant14.out Goto42 as Connection70
                connect From68 "Trigonometric function1.in" as Connection71
                connect From69 "Trigonometric function2.in" as Connection72
                connect From70 Sum3.in as Connection73
                connect From71 Sum3.in1 as Connection74
                connect Product2.in Sum3.out as Connection75
                connect Product2.in1 "Trigonometric function1.out" as Connection76
                connect "Trigonometric function2.out" Product2.in2 as Connection77
                connect Product2.out Goto43 as Connection78
                connect Product3.in Sum4.out as Connection83
                connect From72 "Trigonometric function3.in" as Connection79
                connect "Trigonometric function3.out" Sum4.in1 as Connection87
                connect Constant15.out Sum4.in as Connection88
                connect From74 Product3.in1 as Connection90
                [
                    breakpoints = 7528, 8200; 7528, 8160
                ]
                connect From75 Product3.in2 as Connection91
                [
                    breakpoints = 7560, 8232; 7560, 8176
                ]
                connect Constant17.out Sum5.in as Connection92
                connect From76 Junction1 as Connection94
                connect Junction1 Product4.in as Connection95
                connect Product4.in1 Junction1 as Connection96
                connect Product4.out Sum5.in1 as Connection97
                connect Sum5.out Goto45 as Connection98
                connect Gain1.out "Trigonometric function4.in" as Connection103
                connect Gain2.out "Trigonometric function5.in" as Connection104
                connect From79 "Trigonometric function6.in" as Connection105
                connect From80 "Trigonometric function7.in" as Connection106
                connect From78 Junction2 as Connection107
                connect Junction2 Gain1.in as Connection108
                connect Gain2.in Junction2 as Connection109
                connect "Trigonometric function4.out" "Bus Join1.in" as Connection110
                connect "Trigonometric function5.out" "Bus Join1.in1" as Connection111
                connect "Trigonometric function6.out" "Bus Join1.in2" as Connection112
                connect "Trigonometric function7.out" "Bus Join1.in3" as Connection113
                [
                    breakpoints = 7472, 8584; 7472, 8504
                ]
                connect From81 "C function3.Gdh" as Connection114
                connect From82 "C function3.fk" as Connection115
                connect "Bus Join1.out" "C function3.x" as Connection116
                connect "C function3.Gd" Sum6.in2 as Connection117
                connect From83 Sum6.in as Connection118
                connect From84 Sum6.in1 as Connection119
                connect SI Sum6.out as Connection120
                connect Product3.out Gain3.in as Connection121
                connect Gain3.out Goto44 as Connection122
            }
            [
                position = 7136, 8048
                size = 96, 216
            ]

            component "core/Three Phase Core Coupling" "Core Coupling" {
            }
            [
                position = 8264, 8152
                size = 12, 256
            ]

            port EPC_A {
                position = top:1
                kind = pe
            }
            [
                position = 8384, 8056
                scale = -1, 1
            ]

            port EPC_B {
                position = top:2
                kind = pe
            }
            [
                position = 8384, 8152
                scale = -1, 1
            ]

            port EPC_C {
                position = top:3
                kind = pe
            }
            [
                position = 8384, 8248
                scale = -1, 1
            ]

            junction Junction1 sp
            [
                position = 7576, 7952
            ]

            junction Junction2 sp
            [
                position = 7576, 7968
            ]

            junction Junction4 sp
            [
                position = 7312, 8048
            ]

            connect "Bus Join1.out" "PV Plant (Switching)1.Inputs" as Connection4337
            connect Constant1.out Junction1 as Connection4339
            connect Junction1 "Bus Join1.in" as Connection4340
            connect "Bus Join1.in3" Constant2.out as Connection4342
            connect "Bus Join1.in1" Junction2 as Connection4343
            connect Junction2 Junction1 as Connection4344
            connect "Bus Join1.in4" Junction2 as Connection4345
            connect Q_ref_pv.out "Bus Join1.in5" as Connection4346
            connect "Bus Split1.in" "PV Plant (Switching)1.Outputs" as Connection4347
            connect "Bus Join1.in2" Junction4 as Connection4354
            [
                breakpoints = 7504, 7960; 7312, 7960
            ]
            connect "Solar irradiance.SI" Junction4 as Connection4356
            connect Junction4 SI.in as Connection4357
            [
                breakpoints = 7312, 8048; 7312, 8048; 7408, 8048
            ]
            connect "PV Plant (Switching)1.C" "Core Coupling.c_in" as Connection4358
            connect "PV Plant (Switching)1.B" "Core Coupling.b_in" as Connection4359
            connect "PV Plant (Switching)1.A" "Core Coupling.a_in" as Connection4360
            connect "Core Coupling.a_out" EPC_A as Connection4361
            connect "Core Coupling.b_out" EPC_B as Connection4362
            connect "Core Coupling.c_out" EPC_C as Connection4363
            connect "Bus Split1.out10" P.in as Connection4364
            connect Q.in "Bus Split1.out11" as Connection4365
        }
        [
            position = 5840, 8120
            rotation = right
            size = 144, 56
        ]

        component "core/RL Section" "RL Section" {
            length_mile = "0.5"
            resistance_per_l_mile = "1e-2"
        }
        [
            position = 6400, 7512
            rotation = left
            scale = -1, 1
            size = 256, 56
        ]

        tag Tag36 {
            value = "Ground"
            scope = global
            kind = pe
        }
        [
            position = 6496, 7152
            hide_name = True
            scale = -1, 1
        ]

        tag Tag37 {
            value = "Ground"
            scope = global
            kind = pe
        }
        [
            position = 6504, 7712
            hide_name = True
            scale = -1, 1
        ]

        junction Junction495 pe
        [
            position = 6400, 7152
        ]

        junction Junction585 pe
        [
            position = 5928, 7840
        ]

        junction Junction586 pe
        [
            position = 6072, 7888
        ]

        junction Junction589 pe
        [
            position = 6488, 7968
        ]

        junction Junction590 pe
        [
            position = 6528, 7984
        ]

        junction Junction591 pe
        [
            position = 6560, 8000
        ]

        junction Junction593 pe
        [
            position = 6400, 7888
        ]

        junction Junction594 pe
        [
            position = 6416, 8000
        ]

        junction Junction595 pe
        [
            position = 6384, 7832
        ]

        junction Junction599 pe
        [
            position = 5912, 8072
        ]

        junction Junction600 pe
        [
            position = 6056, 8120
        ]

        junction Junction601 pe
        [
            position = 6304, 7320
        ]

        junction Junction602 pe
        [
            position = 6400, 7152
        ]

        connect PCC.G Tag37 as Connection3388
        connect Junction495 Tag36 as Connection4156
        [
            breakpoints = 6400, 7152
        ]
        connect Vs1.n_node Junction495 as Connection4157
        connect Lc.p_node Rc.p_node as Connection1240
        connect La.p_node Ra.p_node as Connection1236
        connect Lb.p_node Rb.p_node as Connection1238
        connect ESS.EPC_C Lc.n_node as Connection4607
        connect ESS.EPC_A Junction585 as Connection4616
        connect Junction585 La.n_node as Connection4617
        connect Vrms_ess.p_node Junction585 as Connection4618
        connect ESS.EPC_B Junction586 as Connection4619
        connect Junction586 Lb.n_node as Connection4620
        connect Vrms_ess.n_node Junction586 as Connection4621
        [
            breakpoints = 6072, 7784; 6072, 7888
        ]
        connect Lc1.p_node Rc1.p_node as Connection4622
        connect La1.p_node Ra1.p_node as Connection4623
        connect Lb1.p_node Rb1.p_node as Connection4624
        connect Load.A Junction589 as Connection4637
        connect Ra1.n_node Junction589 as Connection4639
        [
            breakpoints = 6488, 8064; 6488, 7968
        ]
        connect Load.B Junction590 as Connection4640
        connect Rb1.n_node Junction590 as Connection4642
        connect Load.C Junction591 as Connection4643
        connect Rc1.n_node Junction591 as Connection4645
        connect Junction590 Junction593 as Connection4649
        [
            breakpoints = 6432, 7984; 6432, 7888
        ]
        connect Junction593 Rb.n_node as Connection4650
        connect PCC.b Junction593 as Connection4651
        connect Junction591 Junction594 as Connection4652
        connect Junction594 Rc.n_node as Connection4653
        [
            breakpoints = 6368, 8000; 6368, 7944
        ]
        connect PCC.c Junction594 as Connection4654
        connect Ra.n_node Junction595 as Connection4656
        connect Junction595 Junction589 as Connection4657
        [
            breakpoints = 6384, 7832; 6488, 7832; 6488, 7968
        ]
        connect PCC.a Junction595 as Connection4658
        connect Vrms_pv.p_node Junction599 as Connection4687
        connect Junction599 La1.n_node as Connection4688
        [
            breakpoints = 5912, 8072; 5912, 8072; 5912, 8072; 6080, 8072
        ]
        connect PV.EPC_A Junction599 as Connection4689
        connect Lb1.n_node Junction600 as Connection4690
        connect Junction600 Vrms_pv.n_node as Connection4691
        [
            breakpoints = 6056, 8120; 6056, 8120
        ]
        connect PV.EPC_B Junction600 as Connection4692
        connect PV.EPC_C Lc1.n_node as Connection4693
        connect Vs1.a_node Junction601 as Connection4700
        connect Junction601 "RL Section.P5" as Connection4701
        [
            breakpoints = 6304, 7320; 6304, 7320
        ]
        connect Vrms_grid.p_node Junction601 as Connection4702
        connect Junction495 Junction602 as Connection4703
        connect Junction602 gnd2.node as Connection4704
        [
            breakpoints = 6400, 7152; 6400, 7152
        ]
        connect Vrms_grid.n_node Junction602 as Connection4705
        [
            breakpoints = 6184, 7160
        ]
        connect "RL Section.P3" Vs1.b_node as Connection4706
        connect "RL Section.P1" Vs1.c_node as Connection4707
        connect "RL Section.P6" PCC.A as Connection4708
        connect "RL Section.P4" PCC.B as Connection4709
        connect "RL Section.P2" PCC.C as Connection4710
    }

    default {
        gen_PQ_transform {
            filter_order = "first order"
            filter_cutoff_Hz = "30"
            initial_filter_input = "0"
            initial_filter_output = "0"
            enable_inst_ports = "True"
            enable_zero_ports = "False"
            execution_rate = "inherit"
        }

        gen_abs {
            execution_rate = "inherit"
        }

        gen_bus_join {
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_bus_split {
            outputs = "2"
            execution_rate = "inherit"
        }

        gen_c_function {
            in_terminal_properties = "real in;"
            in_terminal_labels = ""
            out_terminal_properties = "real out;"
            out_terminal_labels = ""
            no_feed_inputs = ""
            no_feed_outputs = ""
            in_terminal_dimensions = ""
            in_terminal_dimensions_str = ""
            out_terminal_dimensions = ""
            out_terminal_dimensions_str = ""
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_comparator {
            execution_rate = "inherit"
        }

        gen_comparator {
            execution_rate = "inherit"
        }

        gen_data_type_conversion {
            output_type = "real"
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_limiter {
            upper_limit = "[\'inf\']"
            lower_limit = "[\'-inf\']"
            execution_rate = "inherit"
        }

        gen_logic_op {
            operator = "AND"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_math_fnc {
            mathematical_fn = "exponential"
            execution_rate = "inherit"
        }

        gen_minmax {
            operation = "min"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_pid_controller {
            controller_type = "PID"
            kp = "1"
            kp_source = "internal"
            ki = "1"
            ki_source = "internal"
            kd = "0"
            kd_source = "internal"
            filt_coef = "100"
            int_init_value = "0"
            filt_init_value = "0"
            enb_output_limit_out = "False"
            upper_sat_lim = "1"
            lower_sat_lim = "-1"
            enb_anti_windup_out = "False"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_product {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_rate_limiter {
            rising_limit = "1"
            falling_limit = "-1"
            execution_rate = "inherit"
        }

        gen_rel_op {
            relational_op = "=="
            execution_rate = "inherit"
        }

        gen_rms_value {
            op_mode = "PLL based"
            frequency = "50"
            period_timeout = "0.5"
            execution_rate = "inherit"
        }

        gen_sr_ff {
            init_value = "0"
            execution_rate = "inherit"
        }

        gen_sum {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_terminator {
            execution_rate = "inherit"
        }

        gen_trigonometric {
            trigonometric_fn = "sin"
            execution_rate = "inherit"
        }

        gen_z_domain_transfer {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1]"
            a_coeff = "[1,-1]"
            init_states = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        pas_capacitor {
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_inductor {
            inductance = "1e-3"
            initial_current = "0.0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_resistor {
            resistance = "1"
        }

        src_clock {
            execution_rate = "100e-6"
        }

        src_clock {
            execution_rate = "100e-6"
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
        }

        src_digital_input {
            addr = "1"
            invert = "false"
            signal_type = "uint"
            execution_rate = "100e-6"
        }

        src_scada_input {
            addr = "0"
            format = "real"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "real"
            min = "-1e6"
            max = "1e6"
            def_value = "0"
            unit = " "
            execution_rate = "100e-6"
        }

        sys_signal_switch {
            criterion = "ctrl >= threshold"
            threshold = "0"
            execution_rate = "inherit"
        }

        tm_delay {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Current Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Edge Detection" {
            edge = "both"
            execution_rate = "inherit"
        }

        "core/Four Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/RL Section" {
            model_def = "R-L"
            unit_sys = "imperial"
            num_of_phases = "3"
            resistance_per_l = "1"
            resistance_per_l_mile = "1"
            inductance_per_l = "1e-3"
            inductance_per_l_mile = "1e-3"
            length = "1.0"
            length_mile = "1.0"
            power = "500.0"
            voltage = "11.0"
            frequency = "50.0"
            R_value = "21.55"
            L_value = "0.00842"
        }

        "core/Rate Transition" {
            init_value = "0.0"
            execution_rate = "100e-6"
        }

        "core/Signal Controlled Voltage Source" {
            execution_rate = "inherit"
        }

        "core/Three Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/Three Phase Inverter" {
            ctrl_src = "Digital input per switch"
            op_mode = "Fixed carrier frequency"
            carrier_freq = "10000.0"
            carr_ph_offset = "0.0"
            d_time = "5e-6"
            ref_sig_min_max = "[-1.0, 1.0]"
            load_mode = "on min"
            execution_rate = "inherit"
            Sa_top = "1"
            Sa_top_logic = "active high"
            Sa_bot = "2"
            Sa_bot_logic = "active high"
            Sb_top = "3"
            Sb_top_logic = "active high"
            Sb_bot = "4"
            Sb_bot_logic = "active high"
            Sc_top = "5"
            Sc_top_logic = "active high"
            Sc_bot = "6"
            Sc_bot_logic = "active high"
            delay_enabled = "False"
            fixed_delay = "1e-6"
            var_delay_lut = "[-10.0, 1e-6, 10.0, 1e-6]"
            preview_var_delay = "Preview"
            Sa_top_I = "False"
            Sa_bot_I = "False"
            Sb_top_I = "False"
            Sb_bot_I = "False"
            Sc_top_I = "False"
            Sc_bot_I = "False"
            losses_estimation = "False"
            Import_igbt_xml = "not selected"
            Import_diode_xml = "not selected"
            Vce = "1.3"
            Rce = "0"
            Vd = "1.2"
            Rd = "0"
            i_sw = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw = "[0.0, 600.0]"
            temp_sw = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            et_on_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*3.8e-3, 0.4*3.8e-3, 0.8*3.8e-3, 0.68*3.8e-3, 0.9*3.8e-3], [0.65*3.8e-3, 0.9*3.8e-3, 1.2*3.8e-3, 1.5*3.8e-3, 1.7*3.8e-3], [0.9*3.8e-3, 1.3*3.8e-3, 1.7*3.8e-3, 1.9*3.8e-3, 2.25*3.8e-3], [1.1*3.8e-3, 1.7*3.8e-3, 2.1*3.8e-3, 2.3*3.8e-3, 2.5*3.8e-3]]"
            et_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.1e-3, 0.4*2.1e-3, 0.8*2.1e-3, 0.68*2.1e-3, 0.9*2.1e-3], [0.65*2.1e-3, 0.9*2.1e-3, 1.2*2.1e-3, 1.5*2.1e-3, 1.7*2.1e-3], [0.9*2.1e-3, 1.3*2.1e-3, 1.7*2.1e-3, 1.9*2.1e-3, 2.25*2.1e-3], [1.1*2.1e-3, 1.7*2.1e-3, 2.1*2.1e-3, 2.3*2.1e-3, 2.5*2.1e-3]]"
            ed_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            temp_estimation = "False"
            thermal_networks_type = "Foster"
            switch_Rth = "[0.159, 0.133, 0.120, 0.038]"
            switch_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            switch_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            diode_Rth = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            loss_exec_rate = "100e-6"
            vout_cmp_pullup_mode = "False"
            show_cnt_out = "False"
            show_monitoring = "false"
            _control_property = "all high"
            dtv_flag_en = "True"
            pwm_enabling = "False"
            pwm_enable_di = "13"
            pwm_enable_inv = "active high"
        }

        "core/Three Phase Two Winding Transformer" {
            input = "SC and OC tests"
            core_sat = "False"
            Sn = "160000.0"
            f = "50.0"
            V1 = "10000.0"
            V2 = "400.0"
            usc1 = "4.0"
            Psc1 = "2350.0"
            ioc1 = "0.7"
            Poc1 = "460.0"
            R1 = "4.58984375"
            L1 = ".0370093710364"
            R2 = ".00734375"
            L2 = "5.92149936583e-05"
            Rm = "217391.304348"
            Lm = "311.709196788"
            flux_vals_SI = "[1910.3, 2419.7]"
            current_vals_SI = "[0.66653, 277.72]"
            r1 = ".00734375"
            l1 = ".0186029389059"
            r2 = ".00734375"
            l2 = ".0186029389059"
            rm = "347.826086957"
            lm = "156.68213163"
            flux_vals_pu = "[1.2, 1.52]"
            current_vals_pu = "[0.0024, 1]"
            flux_vals_SCOC = "[1.2, 1.52]"
            current_vals_SCOC = "[0.0024, 1]"
            import_from_SI2SCOC = "Import from SI"
            import_from_pu2SCOC = "Import from PU"
            import_from_SCOC2SI = "Import from SC OC"
            import_from_pu2SI = "Import from PU"
            import_from_SCOC2pu = "Import from SC OC"
            import_from_SI2pu = "Import from SI"
            winding_1_connection = "Y"
            winding_2_connection = "Y"
            clock_number = "0"
            embedded_cpl = "false"
            coupling_type = "core"
            Rshunt = "inf"
        }

        "core/Three Phase Voltage Source" {
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Three phase PLL" {
            initial_filter_output = "60"
            wn = "157.0796"
            zeta = "0.707"
            rate_high = "12"
            rate_low = "-12"
            freq_unit = "Hz"
            kp = "100"
            ki = "3200"
            kd = "1"
            N = "714.2857"
            initial_pid_output = "376.99111843"
            up_lim = "1e4"
            low_lim = "-1e4"
            kb = "1"
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "False"
            wn_LPFdq = "62.83185307"
            execution_rate = "inherit"
            enable_pk = "False"
            enable_zero = "True"
            enable_sin = "True"
        }

        "core/Triple Pole Single Throw Contactor" {
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
        }

        "core/Voltage Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Voltage RMS" {
            op_mode = "PLL based"
            frequency = "50"
            sig_output = "False"
            execution_rate = "inherit"
            feed_forward = "false"
            nd_msr_estimation = "false"
        }

        "core/abc to dq" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "True"
            initial_filter_output = "0"
            wn_LPFdq = "1000"
            execution_rate = "inherit"
        }

        "core/dq to abc" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            execution_rate = "0"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        Ts = 1e-3
        sys_f = 60.0    # Hz
        sys_w = 2.0*np.pi*sys_f    #rad/s
        Ts_ess = 20e-6
        Ts_pv = 20e-6
        
        # Grid specs
        
        R=1e-2
        L=1e-3
        
        # Solar irradiance model parameters
        ang = 0
        ang_z = 20*np.pi/180
        ang_t = 20*np.pi/180
        rho = 0.2
        GHI = 304
        ETR = 346
    ENDCODE
}
