version = 4.2

//
// Saved by sw version: 2020.1 SP2
// Save timestamp: 29-Jul-2020 @ 06:07:07 PM
//

model "MST_MicroGrid" {
    configuration {
        hil_device = "HIL603"
        hil_configuration_id = 1
        simulation_method = exact
        simulation_time_step = 4e-6
        simulation_discret_scaling = 1.0
        dsp_timer_periods = 100e-6, 50e-3
        ss_calc_method = "systematic elimination"
        enb_pole_shift = True
        enb_gds_oversampling = True
        show_modes = False
        device_ao_limit_enable = True
        cpl_stb = True
        enb_dep_sw_detect = False
        code_section = "external memory"
        data_section = "internal memory"
        sys_sp_rate_1 = 5e-05
        sys_sp_rate_2 = 0.05
        sys_real_type_precision = "default"
        user_real_type_precision = "default"
        sys_cpu_optimization = "high"
        user_cpu_optimization = "high"
    }

    component Subsystem Root {
        component Subsystem Load {
            layout = dynamic
            component pas_inductor La {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8136
            ]

            component pas_inductor Lc {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8248
            ]

            component pas_resistor Rb {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8192
            ]

            component pas_resistor Ra {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8136
            ]

            component pas_inductor Lb {
                inductance = "V**2/S*np.sqrt(1-pf**2)/2.0/np.pi/f"
            }
            [
                position = 8232, 8192
            ]

            component pas_resistor Rc {
                resistance = "V**2/S*pf"
            }
            [
                position = 8136, 8248
            ]

            port A {
                label = "A"
                position = left:1
                kind = pe
            }
            [
                position = 8056, 8136
            ]

            port B {
                label = "B"
                position = left:2
                kind = pe
            }
            [
                position = 8056, 8192
            ]

            port C {
                label = "C"
                position = left:3
                kind = pe
            }
            [
                position = 8056, 8248
            ]

            junction Junction1 pe
            [
                position = 8288, 8192
            ]

            connect Junction1 Lc.n_node as Connection17
            connect La.n_node Junction1 as Connection16
            connect Lb.n_node Junction1 as Connection18
            connect Lb.p_node Rb.n_node as Connection13
            connect Ra.p_node A as Connection8
            connect Ra.n_node La.p_node as Connection12
            connect Rb.p_node B as Connection1
            connect Rc.p_node C as Connection10
            connect Rc.n_node Lc.p_node as Connection14

            S = "10e3"

            mask {
                description = "Constant Impedance Load
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Three-phase Y connected RL load.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                R and L values are calculated using the input parameters:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - V: Rated line-to-line voltage
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - S: Rated three-phase power
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - f: Rated frequency
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    - pf: Rated power factor
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                None of the parameters can be set to 0."

                V {
                    label = "Voltage"
                    widget = edit
                    type = generic
                    default_value = "480"
                    unit = "V"
                    group = "General"
                }

                S {
                    label = "Power"
                    widget = edit
                    type = generic
                    default_value = "1000e3"
                    unit = "VA"
                    group = "General"
                }

                f {
                    label = "Frequency"
                    widget = edit
                    type = generic
                    default_value = "60"
                    unit = "Hz"
                    group = "General"
                }

                pf {
                    label = "Power Factor"
                    widget = edit
                    type = generic
                    default_value = "0.9"
                    group = "General"
                }

                CODE open
                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                
                    dialog = RegularComponentPropertiesDialog(
                        component=component,
                        property_container=component.masks[-1],
                        current_diagram=current_diagram
                    )
                    dialog.exec_()
                    
                ENDCODE
            }
        }
        [
            position = 6648, 7984
            size = 48, 72
        ]

        component src_ground gnd2 {
        }
        [
            position = 6400, 7376
            rotation = down
            hide_name = True
        ]

        component "core/Three Phase Voltage Source" Vs1 {
            init_frequency = "60.0"
        }
        [
            position = 6400, 7504
            rotation = right
            scale = -1, 1
            size = 62, 256
        ]

        component "core/Voltage RMS" Vrms_grid {
            feed_forward = "true"
            frequency = "sys_f"
        }
        [
            position = 6216, 7584
            scale = -1, 1
            size = 64, 32
        ]

        component pas_resistor Rb1 {
            resistance = "R"
        }
        [
            position = 6248, 8120
        ]

        component pas_inductor La1 {
            inductance = "L"
        }
        [
            position = 6144, 8064
            rotation = down
        ]

        component pas_resistor Ra1 {
            resistance = "R"
        }
        [
            position = 6248, 8064
        ]

        component pas_resistor Rc1 {
            resistance = "R"
        }
        [
            position = 6248, 8176
        ]

        component pas_inductor Lc1 {
            inductance = "L"
        }
        [
            position = 6144, 8176
            rotation = down
        ]

        component pas_inductor Lb1 {
            inductance = "L"
        }
        [
            position = 6144, 8120
            rotation = down
        ]

        component "core/Voltage RMS" Vrms_pv {
            frequency = "sys_f"
        }
        [
            position = 6000, 8008
            size = 64, 32
        ]

        component Subsystem PV {
            layout = dynamic
            component src_scada_input Q_ref_pv {
                def_value = "30"
                execution_rate = "0.01"
                unit = "kVAr"
            }
            [
                position = 8368, 7664
            ]

            component src_constant Constant1 {
                execution_rate = "Ts_pv"
            }
            [
                position = 7472, 7904
                hide_name = True
            ]

            component gen_bus_join "Bus Join1" {
                inputs = "6"
            }
            [
                position = 7616, 7992
            ]

            component Subsystem "PV Plant (Switching)1" {
                layout = static
                component pas_inductor L2 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8248
                ]

                component pas_capacitor C1 {
                    capacitance = "C"
                }
                [
                    position = 8248, 8504
                    rotation = right
                ]

                component pas_resistor R8 {
                    resistance = "Rres"
                }
                [
                    position = 8328, 8416
                    rotation = right
                ]

                component pas_resistor R0b {
                    resistance = "R0"
                }
                [
                    position = 8024, 8248
                ]

                component gen_logic_op "Logical operator1" {
                }
                [
                    position = 7544, 8040
                    hide_name = True
                ]

                component pas_inductor L6 {
                    inductance = "L"
                }
                [
                    position = 8824, 8248
                ]

                component pas_resistor R0a {
                    resistance = "R0"
                }
                [
                    position = 8024, 8152
                ]

                component pas_inductor L1 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8152
                ]

                component pas_resistor R0c1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8344
                ]

                component pas_capacitor C3 {
                    capacitance = "C"
                }
                [
                    position = 8416, 8504
                    rotation = right
                ]

                component pas_resistor R4 {
                    resistance = "1e-3"
                }
                [
                    position = 7392, 8152
                ]

                component gen_digital_probe On {
                }
                [
                    position = 7608, 8088
                    rotation = right
                ]

                component gen_c_function delay {
                    global_variables = "real counter;"
                    in_terminal_dimensions = "inherit"
                    in_terminal_dimensions_str = "in inherit"
                    in_terminal_labels = "False;"
                    init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit"
                    out_terminal_dimensions_str = "out inherit"
                    out_terminal_labels = "False;"
                    output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                    parameters = "real Delay;"
                }
                [
                    position = 7448, 8080
                    size = 48, 48
                ]

                component pas_inductor L3 {
                    inductance = "L0"
                }
                [
                    position = 7920, 8344
                ]

                component pas_resistor R7 {
                    resistance = "Rres"
                }
                [
                    position = 8248, 8416
                    rotation = right
                ]

                component pas_capacitor Ca1 {
                    capacitance = "18.8e-2"
                }
                [
                    position = 7472, 8248
                    rotation = right
                ]

                component pas_inductor L4 {
                    inductance = "L"
                }
                [
                    position = 8824, 8344
                ]

                component pas_capacitor C2 {
                    capacitance = "C"
                }
                [
                    position = 8328, 8504
                    rotation = right
                ]

                component gen_digital_probe enable {
                }
                [
                    position = 7432, 7992
                    rotation = left
                ]

                component pas_resistor R0a1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8152
                ]

                component pas_resistor R0b1 {
                    resistance = "R0"
                }
                [
                    position = 8728, 8248
                ]

                component pas_inductor L5 {
                    inductance = "L"
                }
                [
                    position = 8824, 8152
                ]

                component pas_resistor R0c {
                    resistance = "R0"
                }
                [
                    position = 8024, 8344
                ]

                component pas_resistor R9 {
                    resistance = "Rres"
                }
                [
                    position = 8416, 8416
                    rotation = right
                ]

                component src_constant VDC {
                    execution_rate = "Ts"
                    value = "Vn_dc"
                }
                [
                    position = 7232, 8248
                ]

                component "core/Voltage Measurement" Vab {
                }
                [
                    position = 7848, 8200
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vdc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 7544, 8256
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Va {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8480, 8416
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ia {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8152
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vc {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8592, 8520
                    rotation = right
                    size = 64, 32
                ]

                component "core/Voltage Measurement" Vb {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8536, 8472
                    rotation = right
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8248
                    size = 64, 32
                ]

                component "core/Triple Pole Single Throw Contactor" S1 {
                    ctrl_src = "Model"
                }
                [
                    position = 9160, 8248
                    size = 64, 256
                ]

                component "core/Current Measurement" Ic {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8128, 8344
                    size = 64, 32
                ]

                component "core/Current Measurement" Iinv_in {
                }
                [
                    position = 7600, 8152
                    size = 64, 32
                ]

                component Subsystem Input {
                    layout = dynamic
                    component gen_bus_split "Bus Split2" {
                        outputs = "6"
                    }
                    [
                        position = 8136, 8104
                        rotation = right
                        hide_name = True
                    ]

                    port Inputs {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8136, 8032
                        rotation = right
                    ]

                    tag Goto27 {
                        value = "Irradiation"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8208
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto32 {
                        value = "Connect"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8160
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto28 {
                        value = "V_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8232
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto30 {
                        value = "Q_mode"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8256
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto31 {
                        value = "Enable"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8184
                        hide_name = True
                        size = 0, 0
                    ]

                    tag Goto29 {
                        value = "Q_ref"
                        scope = masked_subsystem
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8256, 8280
                        hide_name = True
                        size = 0, 0
                    ]

                    connect "Bus Split2.out2" Goto27 as Connection757
                    connect "Bus Split2.out3" Goto28 as Connection758
                    connect "Bus Split2.out5" Goto29 as Connection760
                    connect "Bus Split2.out4" Goto30 as Connection759
                    connect "Bus Split2.out1" Goto31 as Connection756
                    connect "Bus Split2.out" Goto32 as Connection755
                    connect "Bus Split2.in" Inputs as Connection761
                }
                [
                    position = 7968, 7672
                    size = 72, 72
                ]

                component Subsystem Control {
                    layout = dynamic
                    component Subsystem Grid_follow {
                        layout = dynamic
                        component gen_probe id {
                            addr = "8968"
                        }
                        [
                            position = 9480, 8376
                            rotation = right
                        ]

                        component gen_gain PV_eff {
                            gain = "PV_eff/100.0"
                        }
                        [
                            position = 8216, 8160
                        ]

                        component src_constant Constant1 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8344, 8192
                            hide_name = True
                        ]

                        component gen_probe Vq {
                        }
                        [
                            position = 8920, 8176
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_logic_op "Logical operator1" {
                            operator = "NOT"
                        }
                        [
                            position = 8024, 8344
                            rotation = right
                            hide_name = True
                        ]

                        component gen_product Product2 {
                        }
                        [
                            position = 8136, 8160
                            hide_name = True
                        ]

                        component gen_logic_op "Logical operator2" {
                        }
                        [
                            position = 8728, 7928
                            hide_name = True
                        ]

                        component gen_c_function delay {
                            global_variables = "real counter;"
                            in_terminal_dimensions = "inherit"
                            in_terminal_dimensions_str = "in inherit"
                            in_terminal_labels = "False;"
                            init_fnc = "/*Begin code section*/
out = 0;
counter = 0;
/*End code section*/"
                            no_feed_inputs = "[\'\']"
                            no_feed_outputs = "[\'\']"
                            out_terminal_dimensions = "inherit"
                            out_terminal_dimensions_str = "out inherit"
                            out_terminal_labels = "False;"
                            output_fnc = "/*Begin code section*/
if(out == 0){
    if(in > 0.5){
        counter += execution_rate;
        if(counter>Delay){
            out = 1;
        }
    }
    else{
        counter -= counter;
        out = 0;
    }
}
else{
    counter = 0;
    if(in <= 0.5){
        out = 0;
    }
}
/*End code section*/"
                            parameters = "real Delay;"
                        }
                        [
                            position = 8624, 7920
                            size = 48, 48
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn_dc)"
                        }
                        [
                            position = 9696, 7912
                            rotation = right
                            hide_name = True
                            scale = -1, 1
                        ]

                        component gen_gain Gain2 {
                            gain = "1000.0/Sn"
                        }
                        [
                            position = 8224, 8360
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/Vn"
                        }
                        [
                            position = 7696, 8368
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch4" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 7808, 8384
                            hide_name = True
                        ]

                        component gen_probe S {
                        }
                        [
                            position = 9304, 7776
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_gain to_pu {
                            gain = "1.0/Sn"
                        }
                        [
                            position = 8288, 8160
                        ]

                        component gen_probe Q {
                        }
                        [
                            position = 9304, 7712
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Pref {
                        }
                        [
                            position = 8528, 8136
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Ud_c {
                        }
                        [
                            position = 9816, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8336, 8376
                            hide_name = True
                        ]

                        component src_constant PV_Area_m2 {
                            execution_rate = "Ts"
                            value = "PV_area"
                        }
                        [
                            position = 8024, 8184
                        ]

                        component gen_probe pf {
                        }
                        [
                            position = 9304, 7840
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Id_ref {
                        }
                        [
                            position = 9488, 8024
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant Constant2 {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 8264, 8392
                            hide_name = True
                        ]

                        component gen_sum Sum1 {
                            signs = "+-"
                        }
                        [
                            position = 7912, 8432
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8408, 8176
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                            threshold = "0.5"
                        }
                        [
                            position = 8472, 8416
                            hide_name = True
                        ]

                        component gen_probe P {
                        }
                        [
                            position = 9304, 7648
                            rotation = down
                            scale = -1, 1
                        ]

                        component gen_probe Vt_pu {
                        }
                        [
                            position = 8912, 8256
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe Uq_c {
                        }
                        [
                            position = 9816, 8440
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe wt_pll {
                            addr = "8966"
                        }
                        [
                            position = 9112, 8520
                            rotation = right
                        ]

                        component gen_probe Vd {
                        }
                        [
                            position = 8920, 8096
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_digital_probe Qmode {
                        }
                        [
                            position = 8512, 8320
                        ]

                        component gen_probe w_pu {
                        }
                        [
                            position = 8912, 8336
                            rotation = left
                            scale = -1, 1
                        ]

                        component gen_probe irr_in {
                        }
                        [
                            position = 8000, 8112
                            rotation = left
                        ]

                        component gen_probe Qref {
                        }
                        [
                            position = 8624, 8464
                            rotation = right
                            scale = -1, 1
                        ]

                        component gen_probe iq {
                            addr = "8965"
                        }
                        [
                            position = 9480, 8520
                            rotation = right
                        ]

                        component gen_probe Iq_ref {
                        }
                        [
                            position = 9488, 8168
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant Constant3 {
                            execution_rate = "inherit"
                        }
                        [
                            position = 9128, 7952
                            hide_name = True
                        ]

                        component Subsystem ControlSignal_Calculation {
                            layout = dynamic
                            component gen_product Product1 {
                            }
                            [
                                position = 6984, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8280
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_product Product8 {
                                signs = "*/"
                            }
                            [
                                position = 7488, 8088
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "+-"
                            }
                            [
                                position = 7144, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum9 {
                            }
                            [
                                position = 7816, 8288
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 6968, 8376
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                            }
                            [
                                position = 7392, 8288
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6880, 8176
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 6768, 8072
                                rotation = down
                                hide_name = True
                                scale = -1, 1
                            ]

                            component gen_sum Sum8 {
                            }
                            [
                                position = 7816, 8096
                                hide_name = True
                            ]

                            component gen_gain Gain2 {
                                gain = "L0*(Sn*2*np.pi*fn)/(Vn**2.0)"
                            }
                            [
                                position = 6872, 8384
                                hide_name = True
                            ]

                            component gen_probe Vdc {
                            }
                            [
                                position = 7136, 8424
                            ]

                            component gen_z_domain_transfer LPF_dc {
                                a_coeff = "[1.0/(2*np.pi*1),1]"
                                b_coeff = "1"
                                domain = "S-domain"
                                method = "Bilinear"
                            }
                            [
                                position = 6856, 8472
                            ]

                            component src_constant Damp {
                                execution_rate = "Ts"
                                value = "Damp"
                            }
                            [
                                position = 7616, 8184
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7704, 8216
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                            }
                            [
                                position = 7392, 8080
                                hide_name = True
                            ]

                            component gen_product Product7 {
                                signs = "*/"
                            }
                            [
                                position = 7504, 8296
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7704, 8152
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                            }
                            [
                                position = 7136, 8368
                                hide_name = True
                            ]

                            component gen_gain Gain10 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7608, 8088
                                hide_name = True
                            ]

                            component gen_gain Gain11 {
                                gain = "(Vn*(2.0/3.0)**0.5)/Vn_dc"
                            }
                            [
                                position = 7616, 8296
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 6944, 8472
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "0.5"
                            }
                            [
                                position = 7192, 8472
                                hide_name = True
                            ]

                            component Subsystem PI_q {
                                layout = dynamic
                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_gain Kp {
                                    gain = "Iq_Kp"
                                }
                                [
                                    position = 8136, 8176
                                ]

                                component gen_gain Ki {
                                    gain = "Iq_Ki"
                                }
                                [
                                    position = 8008, 8240
                                ]

                                component gen_limiter Limit1 {
                                    lower_limit = "Iq_lowLim"
                                    upper_limit = "Iq_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7912, 8208
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8120, 8296
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7968, 8208
                                ]

                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection69
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection70
                                connect Ki.out Sum7.in as Connection66
                                connect Kp.in Junction74 as Connection68
                                connect Kp.out Sum5.in as Connection65
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6936, 8280
                                size = 64, 48
                            ]

                            component Subsystem PI_d {
                                layout = dynamic
                                component gen_limiter Limit1 {
                                    lower_limit = "Id_lowLim"
                                    upper_limit = "Id_upLim"
                                }
                                [
                                    position = 8472, 8184
                                    hide_name = True
                                ]

                                component gen_gain Kb {
                                }
                                [
                                    position = 8280, 8344
                                    scale = -1, 1
                                ]

                                component gen_integrator Integrator1 {
                                    limit_lower = "[-1.15]"
                                    limit_upper = "[1.15]"
                                    show_reset = "either"
                                }
                                [
                                    position = 8216, 8256
                                    hide_name = True
                                ]

                                component gen_gain Kp {
                                    gain = "Id_Kp"
                                }
                                [
                                    position = 8168, 8176
                                ]

                                component gen_sum Sum5 {
                                }
                                [
                                    position = 8312, 8184
                                    hide_name = True
                                ]

                                component gen_sum Sum6 {
                                    signs = "-+"
                                }
                                [
                                    position = 8384, 8344
                                    hide_name = True
                                    scale = -1, 1
                                ]

                                component gen_sum Sum7 {
                                }
                                [
                                    position = 8104, 8248
                                    hide_name = True
                                ]

                                component gen_gain Ki {
                                    gain = "Id_Ki"
                                }
                                [
                                    position = 7992, 8240
                                ]

                                port In {
                                    label = "In"
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7848, 8200
                                ]

                                port Out {
                                    label = "Out"
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8576, 8184
                                ]

                                port Reset {
                                    label = "Reset"
                                    position = top:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8136, 8296
                                ]

                                junction Junction72 sp
                                [
                                    position = 8432, 8184
                                ]

                                junction Junction73 sp
                                [
                                    position = 8504, 8184
                                ]

                                junction Junction74 sp
                                [
                                    position = 7912, 8200
                                ]

                                connect Junction72 Limit1.in as Connection57
                                connect Junction73 Limit1.out as Connection60
                                connect Junction74 In as Connection73
                                connect Kb.in Sum6.out as Connection50
                                connect Ki.in Junction74 as Connection74
                                connect Ki.out Sum7.in as Connection71
                                connect Kp.in Junction74 as Connection72
                                connect Kp.out Sum5.in as Connection66
                                connect Out Junction73 as Connection61
                                connect Reset Integrator1.reset as Connection64
                                connect Sum5.in1 Integrator1.out as Connection6
                                connect Sum5.out Junction72 as Connection58
                                connect Sum6.in Junction72 as Connection56
                                connect Sum6.in1 Junction73 as Connection59
                                connect Sum7.out Integrator1.in as Connection63
                                connect Sum7.in1 Kb.out as Connection53
                            }
                            [
                                position = 6904, 8072
                                size = 64, 48
                            ]

                            port Uq {
                                label = "Uq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ud {
                                label = "Ud"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port VDC {
                                position = top:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6792, 8472
                                rotation = down
                                scale = -1, 1
                            ]

                            port w {
                                position = top:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6496, 8512
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8024
                                rotation = down
                                scale = -1, 1
                            ]

                            port Id_meas {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6688, 8232
                                rotation = down
                                scale = -1, 1
                            ]

                            port Iq_meas {
                                position = right:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6488, 8288
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = top:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8360
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7056, 8152
                                rotation = down
                                scale = -1, 1
                            ]

                            port Reset {
                                position = top:5
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 6848, 8008
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From26 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6816, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag From27 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8144
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto3 {
                                value = "Id"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6608, 8056
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6600, 8512
                                size = 0, 0
                            ]

                            tag From28 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7560, 8224
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto4 {
                                value = "Iq"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6592, 8312
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From23 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6888, 8136
                                hide_name = True
                                size = 60, 20
                            ]

                            tag Goto2 {
                                value = "Reset"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 6984, 8008
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From25 {
                                value = "w"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 6872, 8344
                                hide_name = True
                                size = 60, 20
                            ]

                            junction Junction145 sp
                            [
                                position = 6592, 8288
                            ]

                            junction Junction146 sp
                            [
                                position = 6640, 8080
                            ]

                            junction Junction150 sp
                            [
                                position = 6544, 8080
                            ]

                            junction Junction151 sp
                            [
                                position = 6536, 8288
                            ]

                            junction Junction155 sp
                            [
                                position = 7440, 8304
                            ]

                            junction Junction164 sp
                            [
                                position = 6904, 8008
                            ]

                            junction Junction165 sp
                            [
                                position = 7656, 8184
                            ]

                            junction Junction166 sp
                            [
                                position = 7072, 8472
                            ]

                            connect Damp.out Junction165 as Connection182
                            connect From23 Product1.in as Connection1
                            connect From25 Product2.in as Connection2
                            connect From26 PI_q.Reset as Connection169
                            connect Gain1.in Junction145 as Connection5
                            connect Gain1.out Product1.in1 as Connection6
                            connect Gain10.out Sum8.in as Connection184
                            connect Gain11.in Product7.out as Connection186
                            connect Gain2.in Junction146 as Connection7
                            connect Gain2.out Product2.in1 as Connection8
                            connect Gain5.in Junction166 as Connection193
                            connect Goto1 w as Connection34
                            connect Goto2 Junction164 as Connection170
                            connect Goto3 Junction150 as Connection66
                            connect Goto4 Junction151 as Connection69
                            connect Junction145 Junction151 as Connection67
                            connect Junction146 Junction150 as Connection64
                            connect Junction146 Sum1.in as Connection11
                            connect Junction150 Id_meas as Connection65
                            connect Junction151 Iq_meas as Connection68
                            connect Junction155 Gain5.out as Connection192
                            connect Junction155 Product7.in1 as Connection116
                            connect Junction164 Reset as Connection171
                            connect Junction165 Product5.in1 as Connection181
                            connect Junction166 Vdc.in as Connection190
                            [
                                position = 0, 0
                            ]
                            connect Limit3.out Junction166 as Connection191
                            connect Limit3.in LPF_dc.out as Connection188
                            connect PI_d.Reset Junction164 as Connection172
                            connect PI_d.In Sum1.out as Connection55
                            connect PI_q.In Sum2.out as Connection165
                            connect Product5.in From27 as Connection101
                            connect Product5.out Sum8.in1 as Connection95
                            connect Product6.in1 From28 as Connection102
                            connect Product6.in Junction165 as Connection180
                            connect Product6.out Sum9.in as Connection96
                            connect Product7.in Sum7.out as Connection145
                            connect Product8.out Gain10.in as Connection183
                            connect Product8.in1 Junction155 as Connection115
                            connect Product8.in Sum3.out as Connection143
                            connect Sum1.in1 Id_ref as Connection20
                            connect Sum2.in1 Iq_ref as Connection22
                            connect Sum2.in Junction145 as Connection21
                            connect Sum3.in PI_d.Out as Connection178
                            connect Sum5.in1 Product1.out as Connection24
                            connect Sum5.out Sum3.in1 as Connection177
                            connect Sum6.in1 Product2.out as Connection26
                            connect Sum7.in PI_q.Out as Connection175
                            connect Sum7.in1 Sum6.out as Connection176
                            connect Sum8.out Ud as Connection173
                            connect Sum9.in1 Gain11.out as Connection185
                            connect Uq Sum9.out as Connection174
                            connect VDC LPF_dc.in as Connection124
                            connect Vd Sum5.in as Connection31
                            connect Vq Sum6.in as Connection32
                        }
                        [
                            position = 9696, 8272
                            scale = -1, 1
                            size = 168, 448
                        ]

                        component "core/Edge Detection" "Edge Detection1" {
                        }
                        [
                            position = 9632, 7936
                            rotation = right
                            hide_name = True
                            size = 32, 32
                        ]

                        component Subsystem Current_ref {
                            layout = dynamic
                            component gen_product Product7 {
                            }
                            [
                                position = 7512, 8328
                                hide_name = True
                            ]

                            component gen_product Product1 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8080
                                hide_name = True
                            ]

                            component gen_product Product3 {
                            }
                            [
                                position = 7680, 8008
                                hide_name = True
                            ]

                            component gen_product Product4 {
                            }
                            [
                                position = 7680, 8080
                                hide_name = True
                            ]

                            component gen_product Product5 {
                            }
                            [
                                position = 7680, 8152
                                hide_name = True
                            ]

                            component gen_product Product2 {
                                signs = "*/"
                            }
                            [
                                position = 7960, 8168
                                hide_name = True
                            ]

                            component gen_sum Sum4 {
                            }
                            [
                                position = 7792, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "+-"
                            }
                            [
                                position = 7792, 8072
                                hide_name = True
                            ]

                            component gen_product Product6 {
                            }
                            [
                                position = 7680, 8224
                                hide_name = True
                            ]

                            component gen_limiter Limit3 {
                                lower_limit = "0.01"
                            }
                            [
                                position = 7648, 8328
                                hide_name = True
                            ]

                            port P_ref {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Q_ref {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8216
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vq {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8000
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vd {
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8072
                                rotation = down
                                scale = -1, 1
                            ]

                            port Irq {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8080
                                rotation = down
                                scale = -1, 1
                            ]

                            port Ird {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8168
                                rotation = down
                                scale = -1, 1
                            ]

                            port Vt {
                                position = right:6
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7344, 8320
                                rotation = down
                                scale = -1, 1
                            ]

                            junction Junction142 sp
                            [
                                position = 7520, 8072
                            ]

                            junction Junction143 sp
                            [
                                position = 7536, 8000
                            ]

                            junction Junction145 sp
                            [
                                position = 7448, 8320
                            ]

                            junction Junction146 sp
                            [
                                position = 7864, 8176
                            ]

                            junction Junction147 sp
                            [
                                position = 7584, 8144
                            ]

                            junction Junction148 sp
                            [
                                position = 7552, 8216
                            ]

                            connect Irq Product1.out as Connection86
                            connect Junction142 Vd as Connection12
                            connect Junction143 Product3.in as Connection13
                            connect Junction145 Product7.in as Connection64
                            connect Junction146 Product1.in1 as Connection76
                            [
                                position = 0, 0
                                breakpoints = 7864, 8176
                            ]
                            connect Junction147 Product5.in as Connection81
                            [
                                position = 0, 0
                                breakpoints = 7584, 8144
                            ]
                            connect Junction148 Product6.in as Connection84
                            [
                                position = 0, 0
                                breakpoints = 7552, 8216
                            ]
                            connect Limit3.out Junction146 as Connection77
                            connect Limit3.in Product7.out as Connection74
                            connect P_ref Junction147 as Connection82
                            connect Product1.in Sum3.out as Connection23
                            connect Product2.out Ird as Connection87
                            connect Product2.in1 Junction146 as Connection75
                            connect Product2.in Sum4.out as Connection26
                            connect Product3.in1 Junction147 as Connection80
                            connect Product3.out Sum3.in as Connection28
                            connect Product4.in Junction142 as Connection30
                            connect Product4.in1 Junction148 as Connection83
                            connect Product4.out Sum3.in1 as Connection31
                            connect Product5.in1 Junction142 as Connection33
                            connect Product5.out Sum4.in as Connection34
                            connect Product6.in1 Junction143 as Connection36
                            connect Product6.out Sum4.in1 as Connection37
                            connect Product7.in1 Junction145 as Connection65
                            connect Q_ref Junction148 as Connection85
                            connect Vq Junction143 as Connection3
                            connect Vt Junction145 as Connection63
                        }
                        [
                            position = 9352, 8136
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component Subsystem PI_Vt {
                            layout = dynamic
                            component gen_sum Sum7 {
                            }
                            [
                                position = 8080, 8288
                                hide_name = True
                            ]

                            component gen_integrator Integrator1 {
                                limit_lower = "[-1.15]"
                                limit_upper = "[1.15]"
                                show_reset = "either"
                            }
                            [
                                position = 8216, 8304
                            ]

                            component gen_sum Sum5 {
                            }
                            [
                                position = 8312, 8208
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "V_lowLim"
                                upper_limit = "V_upLim"
                            }
                            [
                                position = 8456, 8208
                                hide_name = True
                            ]

                            component gen_gain Ki {
                                gain = "V_Ki"
                            }
                            [
                                position = 7992, 8280
                            ]

                            component gen_gain Kb {
                                gain = "1000.0"
                            }
                            [
                                position = 8256, 8384
                                scale = -1, 1
                            ]

                            component gen_gain Kp {
                                gain = "V_Kp"
                            }
                            [
                                position = 8112, 8200
                            ]

                            component gen_sum Sum6 {
                                signs = "-+"
                            }
                            [
                                position = 8360, 8384
                                hide_name = True
                                scale = -1, 1
                            ]

                            port Reset {
                                label = "Reset"
                                position = top:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 8136, 8312
                            ]

                            port In {
                                label = "In"
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7880, 8232
                            ]

                            port Out {
                                label = "Out"
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8552, 8208
                            ]

                            junction Junction72 sp
                            [
                                position = 8416, 8208
                            ]

                            junction Junction73 sp
                            [
                                position = 8488, 8208
                            ]

                            junction Junction74 sp
                            [
                                position = 7944, 8232
                            ]

                            connect Integrator1.reset Reset as Connection2
                            connect Junction72 Sum6.in as Connection64
                            connect Junction73 Limit1.out as Connection67
                            connect Junction74 In as Connection80
                            connect Kb.in Sum6.out as Connection50
                            connect Ki.in Junction74 as Connection81
                            connect Ki.out Sum7.in as Connection78
                            connect Kp.in Junction74 as Connection79
                            connect Kp.out Sum5.in as Connection72
                            connect Limit1.in Junction72 as Connection63
                            connect Out Junction73 as Connection68
                            connect Sum5.in1 Integrator1.out as Connection6
                            connect Sum5.out Junction72 as Connection65
                            connect Sum6.in1 Junction73 as Connection66
                            connect Sum7.out Integrator1.in as Connection69
                            connect Sum7.in1 Kb.out as Connection53
                        }
                        [
                            position = 8024, 8432
                            size = 64, 48
                        ]

                        component Subsystem Power_Meas {
                            layout = dynamic
                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_c_function S_and_pf {
                                    in_terminal_dimensions = "inherit;inherit"
                                    in_terminal_dimensions_str = "P inherit;Q inherit"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real P;inherit Q;"
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "S inherit;pf inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit S;inherit pf;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect Junction1 Id as Connection49
                                connect Junction1 Product4.in1 as Connection24
                                connect Junction2 Iq as Connection52
                                connect Junction2 Product3.in1 as Connection27
                                connect Junction3 Product2.in as Connection32
                                connect Junction3 Vq as Connection53
                                connect Junction4 Product1.in as Connection35
                                connect Junction4 Vd as Connection50
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction5 P as Connection55
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction6 Q as Connection56
                                connect LPF_P.in Sum1.out as Connection39
                                connect LPF_Q.in Sum2.out as Connection40
                                connect Product1.in1 Junction1 as Connection25
                                connect Product2.in1 Junction2 as Connection28
                                connect Product3.in Junction4 as Connection36
                                connect Product4.in Junction3 as Connection33
                                connect S_and_pf.P Junction5 as Connection45
                                connect S_and_pf.Q Junction6 as Connection48
                                connect S_and_pf.S S as Connection51
                                connect S_and_pf.pf pf as Connection54
                                connect Sum1.in Product1.out as Connection29
                                connect Sum1.in1 Product2.out as Connection30
                                connect Sum2.in1 Product3.out as Connection38
                                connect Sum2.in Product4.out as Connection37

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                    
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                            connect Gain5.out Q as Connection11
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Gain6.out S as Connection13
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect pf Power_Meas_DQpu.pf as Connection19
                        }
                        [
                            position = 9112, 7744
                            size = 96, 232
                        ]

                        component Subsystem Current_abc_to_dq {
                            layout = dynamic
                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8008
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7864, 8008
                                size = 48, 80
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8008
                            ]

                            connect Gain1.out Id as Connection24
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.q_axis" Gain2.in as Connection27
                            connect "abc to dq1.d_axis" Gain1.in as Connection28
                            connect "abc to dq1.zero_axis" Termination1.in as Connection29
                            connect "abc to dq1.va" Ia as Connection30
                            connect Ib "abc to dq1.vb" as Connection31
                            connect "abc to dq1.vc" Ic as Connection32
                            connect "abc to dq1.wt" wt as Connection33
                        }
                        [
                            position = 9352, 8408
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component Subsystem Limit_PQref {
                            layout = dynamic
                            component tm_delay "Unit Delay2" {
                            }
                            [
                                position = 8200, 8336
                                hide_name = True
                            ]

                            component gen_rate_limiter "S rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8336
                            ]

                            component gen_rate_limiter "Q rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8264
                            ]

                            component tm_delay "Unit Delay1" {
                            }
                            [
                                position = 8200, 8192
                                hide_name = True
                            ]

                            component gen_rate_limiter "P rate limit" {
                                falling_limit = "-ratemax"
                                rising_limit = "ratemax"
                            }
                            [
                                position = 7976, 8192
                            ]

                            component Subsystem priority_PQlim {
                                layout = dynamic
                                component gen_c_function "PQ limiting with priority" {
                                    global_variables = "real signQ;real signP;real Sref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Smax inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Smax;"
                                    init_fnc = "/*Begin code section*/
Sref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit;S inherit"
                                    out_terminal_labels = "False;False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;inherit S;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
Sref = sqrt(Pref*Pref+Qref*Qref);

if (Qref>=0) signQ = 1;
else signQ = -1;
if (Pref>=0) signP = 1;
else signP = -1;

if (Sref <= Smax) {
    S = Sref;
    P = Pref;
    Q = Qref;
} else {
    S = Smax;
    if (type==1) {
        // P priority
        if (fabs(Pref) > Smax) {
            P = signP*Smax;
            Q = 0;
        } else {
            P = Pref;
            Q = signQ*sqrt(Smax*Smax - Pref*Pref);
        }
    } else if (type == 2) {
        // Q priority
        if (fabs(Qref) > Smax) {
            Q = signQ*Smax;
            P = 0;
        } else {
            Q = Qref;
            P = signP*sqrt(Smax*Smax-Qref*Qref);
        }
    } else {
        // Preserve Power Factor
        P = (Pref/Sref)*Smax;
        Q = (Qref/Sref)*Smax;
    }
}
/*End code section*/"
                                    parameters = "real type;"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8128
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8032, 8192
                                ]

                                port Smax {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8096, 8272
                                    rotation = left
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8128
                                    rotation = left
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8368, 8192
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8304, 8272
                                    rotation = right
                                ]

                                connect "PQ limiting with priority.P" P as Connection5
                                connect "PQ limiting with priority.Pref" Pref as Connection2
                                connect "PQ limiting with priority.Q" Q as Connection6
                                connect "PQ limiting with priority.Qref" Qref as Connection3
                                connect "PQ limiting with priority.S" S as Connection4
                                connect "PQ limiting with priority.Smax" Smax as Connection1
                            }
                            [
                                position = 7872, 8264
                                size = 56, 184
                            ]

                            component Subsystem limS_overPQ {
                                layout = dynamic
                                component gen_c_function "S limiting over PQ" {
                                    global_variables = "real S_PQref;"
                                    in_terminal_dimensions = "inherit;inherit;inherit"
                                    in_terminal_dimensions_str = "Pref inherit;Qref inherit;Sref inherit"
                                    in_terminal_labels = "False;False;False;"
                                    in_terminal_properties = "inherit Pref;inherit Qref;inherit Sref;"
                                    init_fnc = "/*Begin code section*/
S_PQref = 0;
/*End code section*/"
                                    no_feed_inputs = "[\'\']"
                                    no_feed_outputs = "[\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "P inherit;Q inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit P;inherit Q;"
                                    output_fnc = "/*Begin code section*/
//-----------------------------------------------------------------------------
// Limit Power with P, Q, or pf priority
//-----------------------------------------------------------------------------
S_PQref = sqrt(Pref*Pref+Qref*Qref);

if (S_PQref > Sref) {
    P = (Pref/S_PQref)*Sref;
    Q = (Qref/S_PQref)*Sref;
} else {
    P = Pref;
    Q = Qref;
}
/*End code section*/"
                                }
                                [
                                    position = 8192, 8192
                                    size = 0, 0
                                ]

                                port Pref {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8112
                                    rotation = right
                                ]

                                port Qref {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8040, 8192
                                ]

                                port Sref {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8088, 8272
                                    rotation = left
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8120
                                    rotation = left
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8280, 8272
                                    rotation = right
                                ]

                                connect "S limiting over PQ.P" P as Connection3
                                connect "S limiting over PQ.Pref" Pref as Connection5
                                connect "S limiting over PQ.Q" Q as Connection2
                                connect "S limiting over PQ.Qref" Qref as Connection1
                                connect "S limiting over PQ.Sref" Sref as Connection4
                            }
                            [
                                position = 8096, 8264
                                size = 56, 184
                            ]

                            port Qlim {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8336
                            ]

                            port Plim {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8280, 8192
                            ]

                            port Pref {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8192
                            ]

                            port Qref {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8264
                            ]

                            port Smax {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 8336
                            ]

                            connect "P rate limit.out" limS_overPQ.Pref as Connection166
                            connect "P rate limit.in" priority_PQlim.P as Connection158
                            connect Plim "Unit Delay1.out" as Connection161
                            connect Pref priority_PQlim.Pref as Connection155
                            connect "Q rate limit.out" limS_overPQ.Qref as Connection162
                            connect "Q rate limit.in" priority_PQlim.Q as Connection159
                            connect Qref priority_PQlim.Qref as Connection156
                            connect "S rate limit.out" limS_overPQ.Sref as Connection165
                            connect "S rate limit.in" priority_PQlim.S as Connection157
                            connect Smax priority_PQlim.Smax as Connection154
                            connect "Unit Delay1.in" limS_overPQ.P as Connection164
                            connect "Unit Delay2.out" Qlim as Connection160
                            connect "Unit Delay2.in" limS_overPQ.Q as Connection163

                            type = "1.0"

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Generate Power reference respecting limits defined by maximum apparent power and type of priority.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Choose type parameter to define the behaviour of the block on saturation: Type=0 preserves power factor, Type=1 prioritizes Active Power, Type=2 prioritizes reactive power.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">Limited power outputs \"Plim\" and \"Qlim\" have one sample delay and can be used for higher level controller anti-windup purposes.</span></p></body></html>"

                                type {
                                    label = "Priority type"
                                    widget = edit
                                    type = generic
                                    default_value = "2.0"
                                }

                                ratemax {
                                    label = "Max power rate"
                                    widget = edit
                                    type = generic
                                    default_value = "powerRate"
                                    unit = "pu/s"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                
                                ENDCODE
                            }
                        }
                        [
                            position = 9240, 8016
                            rotation = right
                            size = 64, 96
                        ]

                        component Subsystem Current_abc_to_dq1 {
                            layout = dynamic
                            component gen_gain Gain2 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 8008
                                hide_name = True
                            ]

                            component gen_gain Gain1 {
                                gain = "(Vn/Sn)*((3.0/2.0)**0.5)"
                            }
                            [
                                position = 7976, 7944
                                hide_name = True
                            ]

                            component gen_terminator Termination1 {
                            }
                            [
                                position = 7920, 8080
                                rotation = right
                                hide_name = True
                            ]

                            component "core/abc to dq" "abc to dq1" {
                            }
                            [
                                position = 7864, 8008
                                size = 48, 80
                            ]

                            port wt {
                                label = "wt"
                                position = right:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 8088
                                rotation = left
                            ]

                            port Ia {
                                label = "Ia"
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7800, 7936
                                rotation = right
                            ]

                            port Ib {
                                label = "Ib"
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7752, 7936
                                rotation = right
                            ]

                            port Ic {
                                label = "Ic"
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7744, 8088
                                rotation = left
                            ]

                            port Id {
                                label = "Id"
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 7944
                            ]

                            port Iq {
                                label = "Iq"
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8040, 8008
                            ]

                            connect Gain1.out Id as Connection24
                            connect Iq Gain2.out as Connection26
                            connect "abc to dq1.q_axis" Gain2.in as Connection27
                            connect "abc to dq1.d_axis" Gain1.in as Connection28
                            connect "abc to dq1.zero_axis" Termination1.in as Connection29
                            connect "abc to dq1.va" Ia as Connection30
                            connect Ib "abc to dq1.vb" as Connection31
                            connect "abc to dq1.vc" Ic as Connection32
                            connect "abc to dq1.wt" wt as Connection33
                        }
                        [
                            position = 9360, 8680
                            scale = -1, 1
                            size = 80, 184
                        ]

                        component Subsystem Power_Meas1 {
                            layout = dynamic
                            component gen_gain Gain6 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8232
                                rotation = right
                                hide_name = True
                            ]

                            component gen_gain Gain4 {
                                gain = "Sn"
                            }
                            [
                                position = 7952, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component gen_gain Gain5 {
                                gain = "Sn"
                            }
                            [
                                position = 8048, 8056
                                rotation = left
                                hide_name = True
                            ]

                            component Subsystem Power_Meas_DQpu {
                                layout = dynamic
                                component gen_c_function S_and_pf {
                                    in_terminal_dimensions = "inherit;inherit"
                                    in_terminal_dimensions_str = "P inherit;Q inherit"
                                    in_terminal_labels = "False;False;"
                                    in_terminal_properties = "real P;inherit Q;"
                                    init_fnc = "/*Begin code section*/
P = 0;
Q = 0;
S = 0;
pf = 0;
/*End code section*/"
                                    no_feed_inputs = "[u\'\']"
                                    no_feed_outputs = "[u\'\']"
                                    out_terminal_dimensions = "inherit;inherit"
                                    out_terminal_dimensions_str = "S inherit;pf inherit"
                                    out_terminal_labels = "False;False;"
                                    out_terminal_properties = "inherit S;inherit pf;"
                                    output_fnc = "/*Begin code section*/
S = sqrt(P*P+Q*Q);
if(S>0){
    pf = P/S;
}
else{
    pf = 0;
}
/*End code section*/"
                                }
                                [
                                    position = 8392, 8192
                                    size = 0, 0
                                ]

                                component gen_product Product4 {
                                }
                                [
                                    position = 8024, 8232
                                    hide_name = True
                                ]

                                component gen_product Product3 {
                                }
                                [
                                    position = 8024, 8320
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_Q {
                                    a_coeff = "[1.0/(2*np.pi*fc_Q),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8272
                                ]

                                component gen_product Product1 {
                                }
                                [
                                    position = 8024, 8064
                                    hide_name = True
                                ]

                                component gen_sum Sum1 {
                                }
                                [
                                    position = 8128, 8112
                                    hide_name = True
                                ]

                                component gen_z_domain_transfer LPF_P {
                                    a_coeff = "[1.0/(2*np.pi*fc_P),1]"
                                    b_coeff = "1"
                                    domain = "S-domain"
                                    method = "Bilinear"
                                }
                                [
                                    position = 8208, 8112
                                ]

                                component gen_product Product2 {
                                }
                                [
                                    position = 8024, 8152
                                    hide_name = True
                                ]

                                component gen_sum Sum2 {
                                    signs = "+-"
                                }
                                [
                                    position = 8128, 8272
                                    hide_name = True
                                ]

                                port Vd {
                                    position = left:1
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8056
                                ]

                                port Vq {
                                    position = left:2
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8144
                                ]

                                port Id {
                                    position = left:3
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8240
                                ]

                                port Iq {
                                    position = left:4
                                    kind = sp
                                    direction =  out
                                    sp_type {
                                        default = auto
                                        readonly = True
                                    }
                                }
                                [
                                    position = 7808, 8328
                                ]

                                port P {
                                    position = right:1
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8112
                                ]

                                port Q {
                                    position = right:2
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8312, 8272
                                ]

                                port S {
                                    position = right:3
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8144
                                ]

                                port pf {
                                    position = right:4
                                    kind = sp
                                    direction =  in
                                    sp_type {
                                        default = inherit
                                        readonly = True
                                    }
                                }
                                [
                                    position = 8464, 8240
                                ]

                                junction Junction1 sp
                                [
                                    position = 7920, 8240
                                ]

                                junction Junction2 sp
                                [
                                    position = 7928, 8328
                                ]

                                junction Junction3 sp
                                [
                                    position = 7944, 8144
                                ]

                                junction Junction4 sp
                                [
                                    position = 7960, 8056
                                ]

                                junction Junction5 sp
                                [
                                    position = 8264, 8112
                                ]

                                junction Junction6 sp
                                [
                                    position = 8264, 8272
                                ]

                                comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = Vd*Id+Vq*Iq;</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Q = Vq*Id-Vd*Iq;</p></body></html> ENDCOMMENT 
                                [
                                    position = 8000, 7976
                                ]

                                connect Junction1 Id as Connection49
                                connect Junction1 Product4.in1 as Connection24
                                connect Junction2 Iq as Connection52
                                connect Junction2 Product3.in1 as Connection27
                                connect Junction3 Product2.in as Connection32
                                connect Junction3 Vq as Connection53
                                connect Junction4 Product1.in as Connection35
                                connect Junction4 Vd as Connection50
                                connect Junction5 LPF_P.out as Connection44
                                connect Junction5 P as Connection55
                                connect Junction6 LPF_Q.out as Connection47
                                connect Junction6 Q as Connection56
                                connect LPF_P.in Sum1.out as Connection39
                                connect LPF_Q.in Sum2.out as Connection40
                                connect Product1.in1 Junction1 as Connection25
                                connect Product2.in1 Junction2 as Connection28
                                connect Product3.in Junction4 as Connection36
                                connect Product4.in Junction3 as Connection33
                                connect S_and_pf.P Junction5 as Connection45
                                connect S_and_pf.Q Junction6 as Connection48
                                connect S_and_pf.S S as Connection51
                                connect S_and_pf.pf pf as Connection54
                                connect Sum1.in Product1.out as Connection29
                                connect Sum1.in1 Product2.out as Connection30
                                connect Sum2.in1 Product3.out as Connection38
                                connect Sum2.in Product4.out as Connection37

                                mask {
                                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Power measurement in DQ frame with inputs and outputs in per unit.</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Zero component is not considered in the power calculation, thus this measurement is not suitable for unbalanced systems.</p></body></html>"

                                    fc_P {
                                        label = "Active power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    fc_Q {
                                        label = "Reactive power low pass filter cut-off freq."
                                        widget = edit
                                        type = generic
                                        default_value = "1.0"
                                        unit = "Hz"
                                    }

                                    CODE open
                                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                    
                                        dialog = RegularComponentPropertiesDialog(
                                            component=component,
                                            property_container=component.masks[-1],
                                            current_diagram=current_diagram
                                        )
                                        dialog.exec_()
                                    
                                    ENDCODE
                                }
                            }
                            [
                                position = 7864, 8160
                                size = 72, 128
                            ]

                            port Vd {
                                position = left:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8048
                                rotation = right
                            ]

                            port Vq {
                                position = left:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8048
                                rotation = right
                            ]

                            port Id {
                                position = left:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7696, 8248
                                rotation = left
                            ]

                            port Iq {
                                position = left:4
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7760, 8248
                                rotation = left
                            ]

                            port P {
                                position = right:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7952, 8000
                                rotation = left
                            ]

                            port Q {
                                position = right:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8000
                                rotation = left
                            ]

                            port S {
                                position = right:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8048, 8288
                                rotation = right
                            ]

                            port pf {
                                position = right:4
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 7992, 8288
                                rotation = right
                            ]

                            connect Gain4.out P as Connection10
                            connect Gain4.in Power_Meas_DQpu.P as Connection20
                            connect Gain5.in Power_Meas_DQpu.Q as Connection21
                            connect Gain5.out Q as Connection11
                            connect Gain6.in Power_Meas_DQpu.S as Connection16
                            connect Gain6.out S as Connection13
                            connect Id Power_Meas_DQpu.Id as Connection14
                            connect Iq Power_Meas_DQpu.Iq as Connection17
                            connect Vd Power_Meas_DQpu.Vd as Connection15
                            connect Vq Power_Meas_DQpu.Vq as Connection18
                            connect pf Power_Meas_DQpu.pf as Connection19
                        }
                        [
                            position = 8704, 8712
                            size = 96, 232
                        ]

                        port Ia {
                            position = right:15
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8336
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ib {
                            position = right:16
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9208, 8384
                            rotation = down
                            scale = -1, 1
                        ]

                        port Ic {
                            position = right:17
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9168, 8432
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_d {
                            position = right:10
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8136
                            rotation = down
                            scale = -1, 1
                        ]

                        port V_q {
                            position = right:11
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port w {
                            position = right:13
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8376
                            rotation = down
                            scale = -1, 1
                        ]

                        port Vt {
                            position = right:12
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8296
                            rotation = down
                            scale = -1, 1
                        ]

                        port VDC {
                            position = top:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9696, 7856
                            rotation = right
                            scale = -1, 1
                        ]

                        port wt_in {
                            position = right:14
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8864, 8480
                            rotation = down
                            scale = -1, 1
                        ]

                        port wt {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8552
                        ]

                        port Enable {
                            position = top:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 9632, 7824
                            rotation = right
                            scale = -1, 1
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 8544, 7872
                            rotation = right
                        ]

                        port md {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9872, 8064
                        ]

                        port mq {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 9864, 8480
                        ]

                        tag Goto22 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9488, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From23 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9664, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9224, 8520
                            hide_name = True
                            size = 54, 25
                        ]

                        tag From44 {
                            value = "Irradiation"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7912, 8152
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto18 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8680, 8416
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From45 {
                            value = "V_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7600, 8368
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8216
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto33 {
                            value = "Q"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7688
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "P"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7624
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From27 {
                            value = "Qref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9192, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto24 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9568, 7880
                            rotation = down
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From26 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9760, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From43 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7752, 8304
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From30 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9192, 7896
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto25 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8824, 7928
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto35 {
                            value = "pf"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7816
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From31 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7712
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From42 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8200
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From47 {
                            value = "Q_mode"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8408, 8320
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto17 {
                            value = "w"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8376
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From39 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7960, 8288
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From1 {
                            value = "wt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9704, 8552
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag From25 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9728, 7992
                            rotation = right
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto19 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8976, 8296
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto34 {
                            value = "S"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9240, 7752
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From28 {
                            value = "Vt"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7656, 8464
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From4 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8168
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From46 {
                            value = "Q_ref"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8128, 8360
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From38 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8280, 8312
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto26 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8656, 7872
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From40 {
                            value = "Activate"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8344, 8112
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From34 {
                            value = "Id"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7776
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From37 {
                            value = "Enable"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8600, 7984
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto21 {
                            value = "Pref"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8592, 8176
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto23 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8456
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From32 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7648
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From3 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9248, 8136
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From35 {
                            value = "Iq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8984, 7840
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From48 {
                            value = "Ia1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9232, 8608
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag From49 {
                            value = "Ib1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9232, 8656
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag From50 {
                            value = "Ic1"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 9232, 8704
                            rotation = down
                            hide_name = True
                            scale = -1, 1
                            size = 56, 25
                        ]

                        tag Goto36 {
                            value = "Id1"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9472, 8608
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto37 {
                            value = "Iq1"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 9480, 8752
                            hide_name = True
                            size = 60, 20
                        ]

                        tag Goto38 {
                            value = "Q1"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8888, 8680
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto39 {
                            value = "P1"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8888, 8616
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From51 {
                            value = "Vq"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8576, 8680
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From52 {
                            value = "Id1"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8576, 8744
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From53 {
                            value = "Vd"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8576, 8616
                            hide_name = True
                            size = 60, 20
                        ]

                        tag From54 {
                            value = "Iq1"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8576, 8808
                            hide_name = True
                            size = 60, 20
                        ]

                        junction Junction123 sp
                        [
                            position = 9480, 8336
                        ]

                        junction Junction124 sp
                        [
                            position = 9480, 8480
                        ]

                        junction Junction164 sp
                        [
                            position = 9816, 8064
                        ]

                        junction Junction165 sp
                        [
                            position = 9816, 8480
                        ]

                        junction Junction167 sp
                        [
                            position = 9176, 8480
                        ]

                        junction Junction173 sp
                        [
                            position = 9432, 8336
                        ]

                        junction Junction174 sp
                        [
                            position = 9432, 8480
                        ]

                        junction Junction176 sp
                        [
                            position = 9632, 7880
                        ]

                        junction Junction177 sp
                        [
                            position = 7728, 8464
                        ]

                        junction Junction179 sp
                        [
                            position = 9488, 8064
                        ]

                        junction Junction180 sp
                        [
                            position = 9488, 8208
                        ]

                        junction Junction181 sp
                        [
                            position = 8920, 8136
                        ]

                        junction Junction182 sp
                        [
                            position = 8920, 8216
                        ]

                        junction Junction183 sp
                        [
                            position = 9112, 8480
                        ]

                        junction Junction184 sp
                        [
                            position = 8576, 7920
                        ]

                        junction Junction186 sp
                        [
                            position = 8000, 8152
                        ]

                        junction Junction187 sp
                        [
                            position = 8472, 8320
                        ]

                        junction Junction188 sp
                        [
                            position = 9192, 7648
                        ]

                        junction Junction189 sp
                        [
                            position = 9192, 7712
                        ]

                        junction Junction190 sp
                        [
                            position = 9192, 7776
                        ]

                        junction Junction191 sp
                        [
                            position = 9192, 7840
                        ]

                        junction Junction192 sp
                        [
                            position = 8912, 8376
                        ]

                        junction Junction193 sp
                        [
                            position = 8912, 8296
                        ]

                        junction Junction194 sp
                        [
                            position = 8528, 8176
                        ]

                        junction Junction195 sp
                        [
                            position = 8624, 8416
                        ]

                        junction Junction196 sp
                        [
                            position = 9176, 8520
                        ]

                        comment Comment1 START <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd"><html><head><meta name="qrichtext" content="1" /><style type="text/css">p, li { white-space: pre-wrap; }</style></head><body style=" font-family:'Arial'; font-size:12pt; font-weight:400; font-style:normal;"><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Apv = P/(n*G)</p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">A_pv = area in m²</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">P = power in W</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">n = efficiency</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">G = W/m²    </p><p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Example: A PV Area can be calculated</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">to have a generation of 5MVA with a</p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">PV efficiency of 20% and average </p><p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">insolation of 4.5kWh/m²/day</p></body></html> ENDCOMMENT 
                        [
                            position = 7976, 7760
                        ]

                        connect Constant1.out "Signal switch2.in1" as Connection423
                        connect Constant2.out "Signal switch3.in1" as Connection424
                        connect Constant3.out Limit_PQref.Smax as Connection571
                        connect ControlSignal_Calculation.VDC Gain3.out as Connection297
                        connect ControlSignal_Calculation.Id_ref Junction179 as Connection463
                        connect ControlSignal_Calculation.Iq_ref Junction180 as Connection466
                        connect Current_abc_to_dq.wt Junction167 as Connection370
                        connect Current_abc_to_dq.Id Junction173 as Connection396
                        connect Current_ref.Vq From3 as Connection475
                        connect Current_ref.Vd From4 as Connection474
                        connect Current_ref.Ird Junction179 as Connection465
                        connect Current_ref.Irq Junction180 as Connection468
                        connect Current_ref.Q_ref Limit_PQref.Qlim as Connection573
                        connect "Edge Detection1.Out1" ControlSignal_Calculation.Reset as Connection410
                        connect "Edge Detection1.In1" Junction176 as Connection427
                        connect From23 ControlSignal_Calculation.w as Connection246
                        connect From25 ControlSignal_Calculation.Vq as Connection248
                        connect From26 ControlSignal_Calculation.Vd as Connection249
                        connect From28 Junction177 as Connection431
                        connect From30 Limit_PQref.Pref as Connection574
                        connect From31 Power_Meas.Vq as Connection403
                        connect From32 Power_Meas.Vd as Connection402
                        connect From34 Power_Meas.Id as Connection404
                        connect From37 "Logical operator2.in1" as Connection470
                        connect From38 "Signal switch3.in2" as Connection422
                        connect From39 "Logical operator1.in" as Connection439
                        connect From40 "Signal switch2.in2" as Connection471
                        connect From42 Current_ref.Vt as Connection487
                        connect From44 Junction186 as Connection529
                        connect From45 Gain4.in as Connection531
                        connect From46 Gain2.in as Connection533
                        connect From47 Junction187 as Connection538
                        connect Gain3.in VDC as Connection298
                        connect Goto21 Junction194 as Connection560
                        connect Goto22 Junction173 as Connection398
                        connect Goto23 Junction174 as Connection401
                        connect Goto24 Junction176 as Connection425
                        connect Goto25 "Logical operator2.out" as Connection472
                        connect Goto26 Junction184 as Connection494
                        connect Goto32 Junction188 as Connection541
                        connect Goto33 Junction189 as Connection544
                        connect Goto34 Junction190 as Connection547
                        connect Goto35 Junction191 as Connection550
                        connect Ia Current_abc_to_dq.Ia as Connection282
                        connect Ib Current_abc_to_dq.Ib as Connection283
                        connect Ic Current_abc_to_dq.Ic as Connection284
                        connect Junction123 ControlSignal_Calculation.Id_meas as Connection74
                        connect Junction124 ControlSignal_Calculation.Iq_meas as Connection76
                        connect Junction124 Junction174 as Connection399
                        connect Junction164 ControlSignal_Calculation.Ud as Connection359
                        connect Junction165 ControlSignal_Calculation.Uq as Connection363
                        connect Junction167 Junction183 as Connection484
                        connect Junction173 Junction123 as Connection397
                        connect Junction174 Current_abc_to_dq.Iq as Connection400
                        connect Junction176 Enable as Connection426
                        connect Junction177 Sum1.in1 as Connection432
                        connect Junction179 Id_ref.in as Connection464
                        connect Junction180 Iq_ref.in as Connection467
                        connect Junction181 Goto4 as Connection477
                        connect Junction182 Goto3 as Connection481
                        connect Junction183 wt_in as Connection485
                        connect Junction184 Connected as Connection493
                        connect Junction186 irr_in.in as Connection528
                        connect Junction187 Qmode.in as Connection537
                        connect Junction188 Power_Meas.P as Connection540
                        connect Junction189 Power_Meas.Q as Connection543
                        connect Junction190 Power_Meas.S as Connection546
                        connect Junction191 Power_Meas.pf as Connection549
                        connect Junction192 Goto17 as Connection554
                        connect Junction193 Goto19 as Connection557
                        connect Junction194 Pref.in as Connection561
                        connect Junction195 Goto18 as Connection565
                        connect Limit_PQref.Plim Current_ref.P_ref as Connection572
                        connect Limit_PQref.Qref From27 as Connection575
                        connect "Logical operator1.out" PI_Vt.Reset as Connection521
                        connect "Logical operator2.in" delay.out as Connection505
                        connect P.in Junction188 as Connection539
                        connect PI_Vt.Out "Signal switch1.in1" as Connection519
                        connect PV_Area_m2.out Product2.in1 as Connection379
                        connect PV_eff.out to_pu.in as Connection390
                        connect Power_Meas.Iq From35 as Connection405
                        connect Product2.in Junction186 as Connection527
                        connect Product2.out PV_eff.in as Connection376
                        connect Q.in Junction189 as Connection542
                        connect Qref.in Junction195 as Connection564
                        connect S.in Junction190 as Connection545
                        connect "Signal switch1.in2" Junction187 as Connection536
                        connect "Signal switch1.out" Junction195 as Connection566
                        connect "Signal switch2.out" Junction194 as Connection562
                        connect "Signal switch2.in" to_pu.out as Connection413
                        connect "Signal switch3.in" Gain2.out as Connection419
                        connect "Signal switch3.out" "Signal switch1.in" as Connection420
                        connect "Signal switch4.in2" From43 as Connection518
                        connect "Signal switch4.in" Gain4.out as Connection429
                        connect "Signal switch4.in1" Junction177 as Connection433
                        connect "Signal switch4.out" Sum1.in as Connection430
                        connect Sum1.out PI_Vt.In as Connection330
                        connect Ud_c.in Junction164 as Connection358
                        connect Uq_c.in Junction165 as Connection362
                        connect V_d Junction181 as Connection476
                        connect V_q Junction182 as Connection480
                        connect Vd.in Junction181 as Connection478
                        connect Vq.in Junction182 as Connection482
                        connect Vt Junction193 as Connection556
                        connect Vt_pu.in Junction193 as Connection558
                        connect delay.in Junction184 as Connection506
                        connect id.in Junction123 as Connection186
                        connect iq.in Junction124 as Connection187
                        connect md Junction164 as Connection360
                        connect mq Junction165 as Connection364
                        connect pf.in Junction191 as Connection548
                        connect w Junction192 as Connection553
                        connect w_pu.in Junction192 as Connection555
                        connect wt From1 as Connection392
                        connect wt_pll.in Junction183 as Connection486
                        connect Junction167 Junction196 as Connection576
                        connect Junction196 Goto1 as Connection577
                        connect Current_abc_to_dq1.wt Junction196 as Connection578
                        connect From48 Current_abc_to_dq1.Ia as Connection579
                        connect From49 Current_abc_to_dq1.Ib as Connection580
                        connect From50 Current_abc_to_dq1.Ic as Connection581
                        connect Goto36 Current_abc_to_dq1.Id as Connection582
                        connect Goto37 Current_abc_to_dq1.Iq as Connection583
                        connect From51 Power_Meas1.Vq as Connection584
                        connect From53 Power_Meas1.Vd as Connection585
                        connect From52 Power_Meas1.Id as Connection586
                        connect Power_Meas1.Iq From54 as Connection596
                        connect Goto39 Power_Meas1.P as Connection597
                        connect Goto38 Power_Meas1.Q as Connection598
                    }
                    [
                        position = 7936, 7576
                        scale = -1, 1
                        size = 216, 264
                    ]

                    component Subsystem duty_cycle {
                        layout = dynamic
                        component gen_probe Da {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8112
                            rotation = left
                        ]

                        component gen_probe Db {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8184
                            rotation = left
                        ]

                        component gen_probe Dc {
                            addr = "8968"
                        }
                        [
                            position = 7664, 8248
                            rotation = left
                        ]

                        component gen_probe Dz_A {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8112
                            rotation = left
                        ]

                        component gen_probe Dz_C {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8248
                            rotation = left
                        ]

                        component gen_probe Dz_B {
                            addr = "8968"
                        }
                        [
                            position = 7856, 8184
                            rotation = left
                        ]

                        component Subsystem ZSM {
                            layout = dynamic
                            component src_constant Constant1 {
                                execution_rate = "inherit"
                                value = "k"
                            }
                            [
                                position = 7336, 8080
                                hide_name = True
                            ]

                            component gen_limiter Limit1 {
                                lower_limit = "0"
                                upper_limit = "1"
                            }
                            [
                                position = 7408, 8080
                                hide_name = True
                            ]

                            component gen_product Product1 {
                            }
                            [
                                position = 7848, 8256
                                hide_name = True
                            ]

                            component gen_sum Sum2 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8120
                                hide_name = True
                            ]

                            component gen_sum Sum6 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8176
                                hide_name = True
                            ]

                            component gen_sum Sum7 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum3 {
                                signs = "--+"
                            }
                            [
                                position = 7984, 8152
                                hide_name = True
                            ]

                            component gen_probe Z0 {
                            }
                            [
                                position = 8048, 8088
                                rotation = left
                            ]

                            component src_constant Constant3 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7672, 8128
                                hide_name = True
                            ]

                            component gen_minmax "Min Max1" {
                                inputs = "3"
                            }
                            [
                                position = 7584, 8160
                                hide_name = True
                            ]

                            component gen_sum Sum1 {
                                signs = "-+"
                            }
                            [
                                position = 7752, 8264
                                hide_name = True
                            ]

                            component gen_sum Sum5 {
                                signs = "++"
                            }
                            [
                                position = 8328, 8096
                                hide_name = True
                            ]

                            component gen_product Product2 {
                            }
                            [
                                position = 7848, 8152
                                hide_name = True
                            ]

                            component gen_minmax "Min Max2" {
                                inputs = "3"
                                operation = "max"
                            }
                            [
                                position = 7584, 8256
                                hide_name = True
                            ]

                            component src_constant Constant2 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7656, 8288
                                hide_name = True
                            ]

                            component gen_sum Sum8 {
                                signs = "-+"
                            }
                            [
                                position = 7864, 8048
                                hide_name = True
                            ]

                            component src_constant Constant4 {
                                execution_rate = "inherit"
                            }
                            [
                                position = 7784, 8064
                                hide_name = True
                            ]

                            port Da {
                                position = right:1
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8144
                                rotation = down
                                scale = -1, 1
                            ]

                            port Db {
                                position = right:2
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8208
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dc {
                                position = right:3
                                kind = sp
                                direction =  out
                                sp_type {
                                    default = auto
                                    readonly = True
                                }
                            }
                            [
                                position = 7264, 8272
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_A {
                                position = left:1
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8096
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_B {
                                position = left:2
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8176
                                rotation = down
                                scale = -1, 1
                            ]

                            port Dz_C {
                                position = left:3
                                kind = sp
                                direction =  in
                                sp_type {
                                    default = inherit
                                    readonly = True
                                }
                            }
                            [
                                position = 8416, 8264
                                rotation = down
                                scale = -1, 1
                            ]

                            tag From4 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8088
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From2 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7736, 8208
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From5 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto5 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 8120, 8152
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From3 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8120
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From8 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8288
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto2 {
                                value = "Da"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8168
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From6 {
                                value = "Z0"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8200
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7648, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto4 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8304
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From7 {
                                value = "Dc"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 8240, 8256
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto3 {
                                value = "Db"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7400, 8240
                                hide_name = True
                                size = 0, 0
                            ]

                            tag Goto1 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = in
                            }
                            [
                                position = 7488, 8080
                                hide_name = True
                                size = 0, 0
                            ]

                            tag From9 {
                                value = "k"
                                scope = local
                                kind = sp
                                direction = out
                            }
                            [
                                position = 7760, 8016
                                hide_name = True
                                size = 0, 0
                            ]

                            junction Junction254 sp
                            [
                                position = 7480, 8144
                            ]

                            junction Junction255 sp
                            [
                                position = 7496, 8208
                            ]

                            junction Junction256 sp
                            [
                                position = 7512, 8272
                            ]

                            junction Junction257 sp
                            [
                                position = 7344, 8144
                            ]

                            junction Junction258 sp
                            [
                                position = 7344, 8208
                            ]

                            junction Junction259 sp
                            [
                                position = 7344, 8272
                            ]

                            junction Junction260 sp
                            [
                                position = 8048, 8152
                            ]

                            connect Constant1.out Limit1.in as Connection1425
                            connect Constant2.out Sum1.in1 as Connection1427
                            connect Constant3.out Sum2.in1 as Connection1434
                            connect Da Junction257 as Connection1474
                            connect Db Junction258 as Connection1477
                            connect Dc Junction259 as Connection1480
                            connect From1 Sum2.in as Connection1440
                            connect From2 Product1.in as Connection1441
                            connect From3 Sum5.in1 as Connection1446
                            connect From4 Sum5.in as Connection1487
                            connect From5 Sum6.in as Connection1489
                            connect From6 Sum6.in1 as Connection1488
                            connect From7 Sum7.in as Connection1493
                            connect From8 Sum7.in1 as Connection1492
                            connect Goto1 Limit1.out as Connection1439
                            connect Goto2 Junction257 as Connection1476
                            connect Goto3 Junction258 as Connection1479
                            connect Goto4 Junction259 as Connection1482
                            connect Goto5 Junction260 as Connection1486
                            connect Junction254 "Min Max2.in" as Connection1466
                            connect Junction255 "Min Max1.in1" as Connection1469
                            connect Junction256 "Min Max1.in2" as Connection1472
                            connect Junction257 Junction254 as Connection1475
                            connect Junction258 Junction255 as Connection1478
                            connect Junction259 Junction256 as Connection1481
                            connect Junction260 Sum3.out as Connection1485
                            connect "Min Max1.in" Junction254 as Connection1465
                            connect "Min Max2.in1" Junction255 as Connection1468
                            connect "Min Max2.in2" Junction256 as Connection1471
                            connect Product1.in1 Sum1.out as Connection1428
                            connect Product1.out Sum3.in2 as Connection1451
                            connect Product2.in1 "Min Max1.out" as Connection1430
                            connect Product2.out Sum3.in1 as Connection1450
                            connect Sum1.in "Min Max2.out" as Connection1426
                            connect Sum2.out Product2.in as Connection1435
                            connect Sum5.out Dz_A as Connection1447
                            connect Sum6.out Dz_B as Connection1490
                            connect Sum7.out Dz_C as Connection1491
                            connect Z0.in Junction260 as Connection1484
                            connect Constant4.out Sum8.in1 as Connection1495
                            connect From9 Sum8.in as Connection1496
                            connect Sum8.out Sum3.in as Connection1497

                            mask {
                                description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">This block implements a zero sequence modulator (ZSM).</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">To change the ZSM type, user can adjust the coefficient k. This coefficient is a real number between 0 and 1.</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 0, the modulation type is bottom clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1/2, the modulation type is midpoint clamp;</span></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\"\">For k = 1, the modulation type is top clamp.</span></p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"

                                k {
                                    label = "Modulation type coefficent k"
                                    widget = edit
                                    type = generic
                                    default_value = "0.5"
                                }

                                CODE open
                                    from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                                
                                    dialog = RegularComponentPropertiesDialog(
                                        component=component,
                                        property_container=component.masks[-1],
                                        current_diagram=current_diagram
                                    )
                                    dialog.exec_()
                                
                                ENDCODE
                            }
                        }
                        [
                            position = 7776, 8216
                            scale = -1, 1
                            size = 88, 168
                        ]

                        component "core/dq to abc" "dq to abc1" {
                            execution_rate = "inherit"
                        }
                        [
                            position = 7560, 8088
                            rotation = right
                            size = 48, 80
                        ]

                        component gen_probe m_d {
                            addr = "8969"
                        }
                        [
                            position = 7512, 7888
                            rotation = right
                            scale = 1, -1
                        ]

                        component gen_probe m_q {
                            addr = "8967"
                        }
                        [
                            position = 7552, 7888
                            rotation = left
                            scale = -1, 1
                        ]

                        component src_constant o_ref {
                            execution_rate = "Ts"
                            value = "0"
                        }
                        [
                            position = 7512, 8008
                            hide_name = True
                        ]

                        component gen_limiter Limit2 {
                            lower_limit = "mod_lowLim"
                            upper_limit = "mod_upLim"
                        }
                        [
                            position = 7464, 7936
                            hide_name = True
                        ]

                        component gen_limiter Limit3 {
                            lower_limit = "-1.1546"
                            upper_limit = "1.1546"
                        }
                        [
                            position = 7464, 7984
                            hide_name = True
                        ]

                        port wt {
                            position = right:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 8032
                        ]

                        port mq {
                            position = right:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 7984
                        ]

                        port md {
                            position = right:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7392, 7936
                        ]

                        port m_a {
                            position = left:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8152
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_b {
                            position = left:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8216
                            rotation = down
                            scale = -1, 1
                        ]

                        port m_c {
                            position = left:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 7960, 8280
                            rotation = down
                            scale = -1, 1
                        ]

                        junction Junction6 sp
                        [
                            position = 7856, 8280
                        ]

                        junction Junction7 sp
                        [
                            position = 7856, 8216
                        ]

                        junction Junction8 sp
                        [
                            position = 7856, 8152
                        ]

                        junction Junction9 sp
                        [
                            position = 7512, 7936
                        ]

                        junction Junction10 sp
                        [
                            position = 7552, 7984
                        ]

                        junction Junction11 sp
                        [
                            position = 7664, 8152
                        ]

                        junction Junction12 sp
                        [
                            position = 7664, 8216
                        ]

                        junction Junction13 sp
                        [
                            position = 7664, 8280
                        ]

                        connect Dz_A.in Junction8 as Connection2320
                        connect Dz_B.in Junction7 as Connection2317
                        connect Dz_C.in Junction6 as Connection2314
                        connect Junction6 ZSM.Dz_C as Connection2313
                        connect Junction7 m_b as Connection2316
                        connect Junction8 ZSM.Dz_A as Connection2319
                        connect ZSM.Dz_B Junction7 as Connection2315
                        connect m_a Junction8 as Connection2318
                        connect m_c Junction6 as Connection2312
                        connect "dq to abc1.d_input" Junction9 as Connection2328
                        connect Junction10 m_q.in as Connection2330
                        connect o_ref.out "dq to abc1.zero_input" as Connection2332
                        connect Limit3.out Junction10 as Connection2329
                        connect Junction9 Limit2.out as Connection2327
                        connect m_d.in Junction9 as Connection2326
                        connect "dq to abc1.q_input" Junction10 as Connection2331
                        connect ZSM.Da Junction11 as Connection2333
                        connect Junction11 Da.in as Connection2334
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_a" Junction11 as Connection2335
                        connect Db.in Junction12 as Connection2336
                        connect Junction12 ZSM.Db as Connection2337
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_b" Junction12 as Connection2338
                        connect Dc.in Junction13 as Connection2339
                        connect Junction13 ZSM.Dc as Connection2340
                        [
                            position = 0, 0
                        ]
                        connect "dq to abc1.phase_c" Junction13 as Connection2341
                        connect md Limit2.in as Connection2342
                        connect Limit3.in mq as Connection2343
                        connect wt "dq to abc1.wt" as Connection2344
                    }
                    [
                        position = 8216, 7576
                        scale = -1, 1
                        size = 96, 272
                    ]

                    component Subsystem PLL {
                        layout = dynamic
                        component sys_signal_switch "Signal switch2" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8184
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch1" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8088
                            hide_name = True
                        ]

                        component gen_probe Vt_meas {
                        }
                        [
                            position = 8520, 8160
                            scale = 1, -1
                        ]

                        component gen_gain Gain3 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8160, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain5 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8168, 8320
                            rotation = right
                            hide_name = True
                        ]

                        component gen_gain Gain1 {
                            gain = "1.0/fn"
                        }
                        [
                            position = 8208, 8088
                            rotation = left
                            hide_name = True
                        ]

                        component gen_gain Gain4 {
                            gain = "1.0/(Vn*((2.0/3.0)**0.5))"
                        }
                        [
                            position = 8112, 8080
                            rotation = left
                            hide_name = True
                        ]

                        component sys_signal_switch "Signal switch3" {
                            criterion = "ctrl > threshold"
                        }
                        [
                            position = 7920, 8280
                            hide_name = True
                        ]

                        component gen_probe f_meas {
                        }
                        [
                            position = 8520, 8224
                        ]

                        component "core/Three phase PLL" PLL {
                            enable_pk = "True"
                            enable_sin = "False"
                            enable_zero = "False"
                            low_lim = "0"
                            rate_high = "5*fn"
                            rate_low = "-5*fn"
                            up_lim = "1.4*2*np.pi*fn"
                        }
                        [
                            position = 8064, 8184
                            size = 64, 128
                        ]

                        component src_constant Constant1 {
                            execution_rate = "inherit"
                            value = "0"
                        }
                        [
                            position = 7832, 8336
                            hide_name = True
                        ]

                        port f {
                            position = right:4
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8016
                        ]

                        port Vd {
                            position = right:1
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7920
                        ]

                        port B {
                            position = left:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8168
                        ]

                        port Vq {
                            position = right:2
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 7968
                        ]

                        port A {
                            position = left:1
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8072
                        ]

                        port C {
                            position = left:3
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7784, 8264
                        ]

                        port wt {
                            position = right:5
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8200
                        ]

                        port Connected {
                            position = top:2
                            kind = sp
                            direction =  out
                            sp_type {
                                default = auto
                                readonly = True
                            }
                        }
                        [
                            position = 7920, 7968
                            rotation = right
                        ]

                        port Vt {
                            position = right:3
                            kind = sp
                            direction =  in
                            sp_type {
                                default = inherit
                                readonly = True
                            }
                        }
                        [
                            position = 8280, 8360
                        ]

                        tag Goto33 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8264, 8136
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto32 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = in
                        }
                        [
                            position = 8232, 8272
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From4 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8232
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From3 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = out
                        }
                        [
                            position = 7968, 8136
                            hide_name = True
                            scale = -1, 1
                            size = 0, 0
                        ]

                        tag From2 {
                            value = "Vt"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8160
                            hide_name = True
                            size = 0, 0
                        ]

                        tag From1 {
                            value = "f"
                            scope = masked_subsystem
                            kind = sp
                            direction = out
                        }
                        [
                            position = 8432, 8224
                            hide_name = True
                            size = 0, 0
                        ]

                        tag Goto34 {
                            value = "connected"
                            scope = local
                            kind = sp
                            direction = in
                        }
                        [
                            position = 7984, 8024
                            hide_name = True
                            size = 0, 0
                        ]

                        junction Junction4 sp
                        [
                            position = 7888, 8296
                        ]

                        junction Junction1 sp
                        [
                            position = 8208, 8136
                        ]

                        junction Junction5 sp
                        [
                            position = 7920, 8024
                        ]

                        junction Junction3 sp
                        [
                            position = 7888, 8200
                        ]

                        junction Junction2 sp
                        [
                            position = 8168, 8272
                        ]

                        connect Goto34 Junction5 as Connection112
                        connect Junction1 Gain1.in as Connection83
                        connect Junction2 Goto32 as Connection87
                        connect PLL.peak Junction2 as Connection88
                        connect Junction3 "Signal switch1.in1" as Connection98
                        connect From4 "Signal switch3.in2" as Connection115
                        connect "Signal switch2.in1" Junction3 as Connection99
                        connect Vt Gain5.out as Connection56
                        connect From2 Vt_meas.in as Connection74
                        connect From1 f_meas.in as Connection73
                        connect PLL.vb "Signal switch2.out" as Connection92
                        connect Gain3.out Vq as Connection54
                        connect "Signal switch1.in" A as Connection89
                        connect Constant1.out Junction4 as Connection100
                        connect "Signal switch3.in1" Junction4 as Connection102
                        connect Gain5.in Junction2 as Connection86
                        connect Vd Gain4.out as Connection55
                        connect From3 "Signal switch2.in2" as Connection113
                        connect Gain1.out f as Connection27
                        connect Gain3.in PLL.q_axis as Connection81
                        connect Junction5 Connected as Connection111
                        connect Goto33 Junction1 as Connection82
                        connect "Signal switch3.out" PLL.vc as Connection114
                        connect "Signal switch1.in2" Junction5 as Connection110
                        connect "Signal switch3.in" C as Connection94
                        connect "Signal switch1.out" PLL.va as Connection91
                        connect PLL.theta wt as Connection85
                        connect B "Signal switch2.in" as Connection95
                        connect Junction4 Junction3 as Connection101
                        connect PLL.freq Junction1 as Connection84
                        connect PLL.d_axis Gain4.in as Connection80
                    }
                    [
                        position = 7432, 7568
                        size = 64, 176
                    ]

                    port Va {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7504
                    ]

                    port Vb {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7568
                    ]

                    port Vc {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7352, 7632
                    ]

                    port VDC {
                        position = top:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 8024, 7392
                        rotation = right
                    ]

                    port Ic {
                        position = left:6
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7688
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ib {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7712, 7656
                        rotation = down
                        scale = -1, 1
                    ]

                    port Ia {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7672, 7624
                        rotation = down
                        scale = -1, 1
                    ]

                    port Enable {
                        position = top:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7848, 7392
                        rotation = right
                    ]

                    port Connected {
                        position = top:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7936, 7280
                        rotation = right
                    ]

                    port mc {
                        position = right:3
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7688
                    ]

                    port mb {
                        position = right:2
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7576
                    ]

                    port ma {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8344, 7464
                    ]

                    tag Goto14 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7600
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From16 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7528
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From17 {
                        value = "f"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7560
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From18 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7592
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto13 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7536
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto10 {
                        value = "Vt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7568
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto12 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7504
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From14 {
                        value = "Vd"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7464
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From15 {
                        value = "Vq"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7728, 7496
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto15 {
                        value = "wt"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 7536, 7632
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From19 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7360, 7440
                        hide_name = True
                        size = 60, 20
                    ]

                    tag Goto16 {
                        value = "Connected"
                        scope = local
                        kind = sp
                        direction = in
                    }
                    [
                        position = 8008, 7320
                        hide_name = True
                        size = 60, 20
                    ]

                    junction Junction1 sp
                    [
                        position = 7936, 7320
                    ]

                    connect Enable Grid_follow.Enable as Connection532
                    connect From14 Grid_follow.V_d as Connection480
                    connect From15 Grid_follow.V_q as Connection481
                    connect From16 Grid_follow.Vt as Connection482
                    connect From17 Grid_follow.w as Connection502
                    connect From18 Grid_follow.wt_in as Connection485
                    connect Goto16 Junction1 as Connection541
                    connect Grid_follow.Connected Junction1 as Connection543
                    connect Ia Grid_follow.Ia as Connection495
                    connect Ib Grid_follow.Ib as Connection496
                    connect Ic Grid_follow.Ic as Connection497
                    connect Junction1 Connected as Connection542
                    connect VDC Grid_follow.VDC as Connection487
                    connect duty_cycle.md Grid_follow.md as Connection544
                    connect duty_cycle.mq Grid_follow.mq as Connection545
                    connect duty_cycle.wt Grid_follow.wt as Connection546
                    connect ma duty_cycle.m_a as Connection547
                    connect mb duty_cycle.m_b as Connection548
                    connect mc duty_cycle.m_c as Connection549
                    connect PLL.A Va as Connection550
                    connect PLL.B Vb as Connection551
                    connect PLL.C Vc as Connection552
                    connect PLL.Vd Goto12 as Connection553
                    connect Goto13 PLL.Vq as Connection554
                    connect PLL.Vt Goto10 as Connection555
                    connect Goto14 PLL.f as Connection556
                    connect PLL.wt Goto15 as Connection557
                    connect PLL.Connected From19 as Connection558
                }
                [
                    position = 8176, 7888
                    size = 128, 208
                ]

                component "core/Three Phase Inverter" "3ph_inverter 1" {
                    carrier_freq = "fsw"
                    ctrl_src = "Internal modulator"
                    d_time = "1e-6"
                }
                [
                    position = 7736, 8248
                    size = 127, 256
                ]

                component Subsystem Output {
                    layout = dynamic
                    component gen_bus_join "Bus Join1" {
                        inputs = "12"
                    }
                    [
                        position = 8192, 8192
                        rotation = left
                        hide_name = True
                    ]

                    port Outputs {
                        position = right:1
                        kind = sp
                        direction =  in
                        sp_type {
                            default = inherit
                            readonly = True
                        }
                    }
                    [
                        position = 8192, 8120
                        rotation = left
                    ]

                    port Connected {
                        position = left:1
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8248
                    ]

                    port Inv_On {
                        position = left:2
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8288
                    ]

                    port Va {
                        position = left:3
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8328
                    ]

                    port Vb {
                        position = left:4
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8368
                    ]

                    port Vc {
                        position = left:5
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8408
                    ]

                    port Ia {
                        position = left:7
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8496
                    ]

                    port Ib {
                        position = left:8
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7928, 8536
                    ]

                    port Ic {
                        position = left:9
                        kind = sp
                        direction =  out
                        sp_type {
                            default = auto
                            readonly = True
                        }
                    }
                    [
                        position = 7984, 8576
                    ]

                    tag From30 {
                        value = "P1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8648
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From29 {
                        value = "Vt"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8456
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From34 {
                        value = "f"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8624
                        hide_name = True
                        size = 60, 20
                    ]

                    tag From31 {
                        value = "Q1"
                        scope = masked_subsystem
                        kind = sp
                        direction = out
                    }
                    [
                        position = 7968, 8672
                        hide_name = True
                        size = 60, 20
                    ]

                    connect "Bus Join1.in" Connected as Connection5
                    connect "Bus Join1.in6" Ia as Connection2
                    connect "Bus Join1.in7" Ib as Connection4
                    connect "Bus Join1.in8" Ic as Connection1
                    connect "Bus Join1.in1" Inv_On as Connection9
                    connect "Bus Join1.out" Outputs as Connection6
                    connect "Bus Join1.in2" Va as Connection8
                    connect "Bus Join1.in3" Vb as Connection3
                    connect "Bus Join1.in4" Vc as Connection7
                    connect From29 "Bus Join1.in5" as Connection10
                    connect From30 "Bus Join1.in10" as Connection12
                    connect From31 "Bus Join1.in11" as Connection13
                    connect From34 "Bus Join1.in9" as Connection11
                }
                [
                    position = 8584, 7728
                    rotation = left
                    size = 96, 152
                ]

                component "core/Signal Controlled Voltage Source" Vs2 {
                }
                [
                    position = 7320, 8248
                    rotation = left
                    scale = 1, -1
                    size = 64, 32
                ]

                component "core/Voltage RMS" Vrms1 {
                    sig_output = "True"
                }
                [
                    position = 8424, 8200
                    rotation = right
                    scale = -1, 1
                    size = 64, 32
                ]

                component "core/Current Measurement" Ia1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8960, 8152
                    size = 64, 32
                ]

                component "core/Current Measurement" Ib1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8960, 8248
                    size = 64, 32
                ]

                component "core/Current Measurement" Ic1 {
                    execution_rate = "Ts"
                    sig_output = "True"
                }
                [
                    position = 8960, 8344
                    size = 64, 32
                ]

                port A {
                    position = 180.0, -96.0
                    kind = pe
                }
                [
                    position = 9256, 8152
                    rotation = down
                ]

                port B {
                    position = 180.0, -0.1
                    kind = pe
                }
                [
                    position = 9256, 8248
                    rotation = down
                ]

                port C {
                    position = 180.0, 96.0
                    kind = pe
                }
                [
                    position = 9256, 8344
                    rotation = down
                ]

                port Inputs {
                    position = -152.0, -120.0
                    kind = sp
                    direction =  out
                    sp_type {
                        default = auto
                        readonly = True
                    }
                }
                [
                    position = 7968, 7584
                    rotation = right
                ]

                port Outputs {
                    position = 152.0, -120.0
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8584, 7632
                    rotation = left
                ]

                tag From20 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7936
                    hide_name = True
                    size = 60, 20
                ]

                tag From9 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7840
                    hide_name = True
                    size = 60, 20
                ]

                tag From19 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7904
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto12 {
                    value = "Ia"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8112
                    hide_name = True
                    size = 60, 20
                ]

                tag From29 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag From27 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8176, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From26 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 9072, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag From32 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7880
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto14 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag From34 {
                    value = "Ib1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7952
                    hide_name = True
                    size = 60, 20
                ]

                tag From30 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7904
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto5 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8520
                    hide_name = True
                    size = 60, 20
                ]

                tag From8 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag From31 {
                    value = "Vab_rms"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7856
                    hide_name = True
                    size = 60, 20
                ]

                tag From35 {
                    value = "Ia1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7928
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto15 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7624, 8256
                    hide_name = True
                    size = 60, 20
                ]

                tag From18 {
                    value = "Vdc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8216, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From33 {
                    value = "Ic1"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7976
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto1 {
                    value = "Va"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8416
                    hide_name = True
                    size = 60, 20
                ]

                tag From10 {
                    value = "Vc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7872
                    hide_name = True
                    size = 60, 20
                ]

                tag From24 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7336, 8032
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto4 {
                    value = "Vb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8688, 8472
                    hide_name = True
                    size = 60, 20
                ]

                tag From23 {
                    value = "Connect"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7336, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag From21 {
                    value = "Ic"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8040, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto16 {
                    value = "Inv_On"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 7664, 8000
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto13 {
                    value = "Ib"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8192, 8208
                    hide_name = True
                    size = 60, 20
                ]

                tag From25 {
                    value = "Enable"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 8136, 7712
                    rotation = right
                    hide_name = True
                    size = 60, 20
                ]

                tag From28 {
                    value = "Inv_On"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 8456, 7832
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto17 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7888
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto3 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7808
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto18 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8312, 7968
                    hide_name = True
                    size = 60, 20
                ]

                tag From37 {
                    value = "mb"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7912
                    hide_name = True
                    size = 60, 20
                ]

                tag From38 {
                    value = "mc"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7888
                    hide_name = True
                    size = 60, 20
                ]

                tag From36 {
                    value = "ma"
                    scope = local
                    kind = sp
                    direction = out
                }
                [
                    position = 7640, 7936
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto19 {
                    value = "Vab_rms"
                    scope = local
                    kind = sp
                    direction = in
                }
                [
                    position = 8320, 8200
                    hide_name = True
                    scale = -1, 1
                    size = 60, 20
                ]

                tag Goto20 {
                    value = "Ia1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9032, 8104
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto21 {
                    value = "Ic1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9024, 8304
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto22 {
                    value = "Ib1"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 9032, 8208
                    hide_name = True
                    size = 60, 20
                ]

                junction Junction70 pe
                [
                    position = 8328, 8624
                ]

                junction Junction78 pe
                [
                    position = 8536, 8624
                ]

                junction Junction88 pe
                [
                    position = 7544, 8152
                ]

                junction Junction89 pe
                [
                    position = 7544, 8344
                ]

                junction Junction115 pe
                [
                    position = 8416, 8624
                ]

                junction Junction116 pe
                [
                    position = 8480, 8624
                ]

                junction Junction119 pe
                [
                    position = 7848, 8152
                ]

                junction Junction120 pe
                [
                    position = 7848, 8248
                ]

                junction Junction121 pe
                [
                    position = 8248, 8152
                ]

                junction Junction123 pe
                [
                    position = 8328, 8248
                ]

                junction Junction125 pe
                [
                    position = 8416, 8344
                ]

                junction Junction127 pe
                [
                    position = 7472, 8152
                ]

                junction Junction132 sp
                [
                    position = 7608, 8040
                ]

                junction Junction134 sp
                [
                    position = 7432, 8032
                ]

                junction Junction135 sp
                [
                    position = 7584, 8040
                ]

                junction Junction136 pe
                [
                    position = 8480, 8152
                ]

                junction Junction138 pe
                [
                    position = 8536, 8248
                ]

                junction Junction140 pe
                [
                    position = 8592, 8344
                ]

                junction Junction142 pe
                [
                    position = 7472, 8344
                ]

                junction Junction143 pe
                [
                    position = 8424, 8152
                ]

                junction Junction144 pe
                [
                    position = 8424, 8248
                ]

                connect "3ph_inverter 1.InB" From37 as Connection793
                connect "3ph_inverter 1.a_in" Junction119 as Connection634
                connect "3ph_inverter 1.b_in" Junction120 as Connection637
                connect "3ph_inverter 1.c_in" L3.p_node as Connection640
                connect A S1.a_out as Connection694
                connect B S1.b_out as Connection698
                connect C S1.c_out as Connection696
                connect C1.p_node R7.n_node as Connection139
                connect C2.p_node R8.n_node as Connection144
                connect C3.n_node Junction115 as Connection618
                connect Ca1.n_node Junction142 as Connection797
                connect Control.Ic From21 as Connection493
                connect From10 Control.Vc as Connection487
                connect From18 Control.VDC as Connection489
                connect From19 Control.Ia as Connection491
                connect From20 Control.Ib as Connection492
                connect From23 delay.in as Connection734
                connect From24 Junction134 as Connection748
                connect From25 Control.Enable as Connection750
                connect From26 S1.ctrl_in as Connection753
                connect From27 Control.Connected as Connection754
                connect From28 Output.Inv_On as Connection761
                connect From30 Output.Vc as Connection764
                connect From31 Output.Va as Connection762
                connect From32 Output.Vb as Connection763
                connect From33 Output.Ic as Connection767
                connect From34 Output.Ib as Connection766
                connect From35 Output.Ia as Connection765
                connect From36 "3ph_inverter 1.InA" as Connection792
                connect From38 "3ph_inverter 1.InC" as Connection794
                connect From8 Control.Va as Connection485
                connect From9 Control.Vb as Connection486
                connect Goto1 Va.out as Connection367
                connect Goto12 Ia.out as Connection668
                connect Goto13 Ib.out as Connection669
                connect Goto14 Ic.out as Connection670
                connect Goto15 Vdc.out as Connection484
                connect Goto16 Junction135 as Connection758
                connect Goto17 Control.mb as Connection790
                connect Goto18 Control.mc as Connection791
                connect Goto3 Control.ma as Connection789
                connect Goto4 Vb.out as Connection368
                connect Goto5 Vc.out as Connection369
                connect Ia.n_node Junction121 as Connection671
                connect Ib.n_node Junction123 as Connection676
                connect Ic.p_node R0c.n_node as Connection667
                connect Iinv_in.n_node "3ph_inverter 1.pos_out" as Connection28
                connect Iinv_in.p_node Junction88 as Connection470
                connect Inputs Input.Inputs as Connection755
                connect Junction115 Junction116 as Connection622
                connect Junction115 Junction70 as Connection619
                connect Junction116 Va.n_node as Connection621
                connect Junction119 Vab.p_node as Connection635
                connect Junction120 Vab.n_node as Connection638
                connect Junction123 R8.p_node as Connection677
                connect Junction125 Ic.n_node as Connection682
                connect Junction127 Ca1.p_node as Connection689
                connect Junction132 "3ph_inverter 1.En" as Connection738
                connect Junction134 "Logical operator1.in" as Connection747
                connect Junction135 Junction132 as Connection757
                connect Junction140 Junction125 as Connection785
                connect Junction142 Junction89 as Connection798
                [
                    position = 0, 0
                ]
                connect Junction70 C2.n_node as Connection143
                connect Junction78 Junction116 as Connection620
                connect Junction88 Junction127 as Connection688
                connect Junction88 Vdc.p_node as Connection471
                connect Junction89 "3ph_inverter 1.neg_out" as Connection474
                connect L1.p_node Junction119 as Connection636
                connect L2.p_node Junction120 as Connection639
                connect L3.n_node R0c.p_node as Connection614
                connect L5.p_node R0a1.n_node as Connection652
                connect L6.p_node R0b1.n_node as Connection650
                connect "Logical operator1.out" Junction135 as Connection756
                connect On.in Junction132 as Connection739
                connect Output.Connected From29 as Connection760
                connect Outputs Output.Outputs as Connection759
                connect R0a.n_node Ia.p_node as Connection664
                connect R0a.p_node L1.n_node as Connection611
                connect R0b.n_node Ib.p_node as Connection662
                connect R0b.p_node L2.n_node as Connection613
                connect R0c1.n_node L4.p_node as Connection655
                connect R4.n_node Junction127 as Connection690
                connect R9.n_node C3.p_node as Connection145
                connect R9.p_node Junction125 as Connection681
                connect VDC.out Vs2.in as Connection800
                connect Va.p_node Junction136 as Connection774
                connect Vb.p_node Junction138 as Connection779
                connect Vb.n_node Junction78 as Connection363
                connect Vc.p_node Junction140 as Connection784
                connect Vc.n_node Junction78 as Connection617
                connect Vdc.n_node Junction89 as Connection473
                connect Vs2.n_node Junction142 as Connection799
                connect Vs2.p_node R4.p_node as Connection796
                connect delay.out "Logical operator1.in1" as Connection735
                connect enable.in Junction134 as Connection749
                connect Goto19 Vrms1.out as Connection807
                connect C1.n_node Junction70 as Connection808
                [
                    breakpoints = 8248, 8624
                ]
                connect Junction121 R7.p_node as Connection809
                [
                    breakpoints = 8248, 8152; 8248, 8368
                ]
                connect Junction136 Junction143 as Connection810
                connect Junction143 Junction121 as Connection811
                connect Vrms1.p_node Junction143 as Connection812
                connect Junction138 Junction144 as Connection813
                connect Junction144 Junction123 as Connection814
                connect Vrms1.n_node Junction144 as Connection815
                connect S1.a_in Ia1.n_node as Connection816
                connect Ia1.p_node L5.n_node as Connection817
                connect Goto20 Ia1.out as Connection818
                connect S1.b_in Ib1.n_node as Connection821
                connect Ib1.p_node L6.n_node as Connection822
                connect S1.c_in Ic1.n_node as Connection823
                connect Ic1.p_node L4.n_node as Connection824
                connect Goto21 Ic1.out as Connection825
                connect Goto22 Ib1.out as Connection826
                connect R0c1.p_node Junction140 as Connection827
                [
                    breakpoints = 8632, 8344
                ]
                connect R0a1.p_node Junction136 as Connection829
                [
                    breakpoints = 8632, 8152
                ]
                connect R0b1.p_node Junction138 as Connection830
                [
                    breakpoints = 8632, 8248
                ]

                C = "5e-6"
                L = "3.04e-4"
                L0 = "0.0333"
                Rres = "2.5872"

                mask {
                    icon = "image(\'pv_plant.svg\')"
                    description = "<html><head><meta name=\"qrichtext\" content=\"1\"></meta><style type=\"text/css\">p, li { white-space: pre-wrap; }</style></head><body style=\"\"><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">PV plant switching model. </p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Active power output is based on irradiation input. Reactive power output is based on terminal voltage control or direct reactive power setpoints. If the input \"Q_mode\" is high, the reactive power output will be set by the reference given in the input \"Q_ref\", else, the reactive power reference is based on the reference given in the input \"V_ref\".</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">The number of inputs is 6 and of outputs is 12 and they are configured in the following order:</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Inputs: 0 - Connect; 1 - Enable; 2 - Irradiation; 3 - V_ref; 4 - Q_mode; 5 - Q_ref;</p><p style=\"margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\">Outputs: 0 - Connected; 1 - Inv_On; 2 - Va; 3 - Vb; 4 - Vc; 5 - Vt; 6 - Ia; 7 - Ib; 8 - Ic; 9 - f; 10 - P; 11 - Q;</p><p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br></br></p></body></html>"
                    help_file = "pv_plant.html"

                    Vn {
                        label = "Nominal voltage"
                        widget = edit
                        type = generic
                        default_value = "480.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    Sn {
                        label = "Nominal power"
                        widget = edit
                        type = generic
                        default_value = "10e3"
                        unit = "VA"
                        group = "1 - General"
                    }

                    fn {
                        label = "Nominal frequency"
                        widget = edit
                        type = generic
                        default_value = "60.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    fsw {
                        label = "Inverter switching frequency"
                        widget = edit
                        type = generic
                        default_value = "10000.0"
                        unit = "Hz"
                        group = "1 - General"
                    }

                    Vn_dc {
                        label = "Nominal DC voltage"
                        widget = edit
                        type = generic
                        default_value = "1000.0"
                        unit = "V"
                        group = "1 - General"
                    }

                    PV_area {
                        label = "PV plant area"
                        widget = edit
                        type = generic
                        default_value = "100"
                        unit = "m²"
                        group = "1 - General"
                    }

                    PV_eff {
                        label = "PV plant efficiency"
                        widget = edit
                        type = generic
                        default_value = "15.0"
                        unit = "%"
                        group = "1 - General"
                    }

                    Ts {
                        label = "Execution rate"
                        widget = edit
                        type = generic
                        default_value = "Ts_pv"
                        unit = "s"
                        group = "1 - General"
                    }

                    L0 {
                        label = "Inverter side inductor"
                        widget = edit
                        type = generic
                        default_value = "6e-3"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    R0 {
                        label = "Inductors series resistors"
                        widget = edit
                        type = generic
                        default_value = "0.03"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    L {
                        label = "Grid side inductor"
                        widget = edit
                        type = generic
                        default_value = "0.3e-3"
                        unit = "H"
                        group = "2 - Filter"
                    }

                    Rres {
                        label = "Shunt resistance"
                        widget = edit
                        type = generic
                        default_value = "15e-3"
                        unit = "Ohms"
                        group = "2 - Filter"
                    }

                    C {
                        label = "Shunt capacitor"
                        widget = edit
                        type = generic
                        default_value = "150e-6"
                        unit = "F"
                        group = "2 - Filter"
                    }

                    V_Kp {
                        label = "Voltage PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "0.1004"
                        group = "3 - Adv. 1"
                    }

                    V_Ki {
                        label = "Voltage PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "22.4784"
                        group = "3 - Adv. 1"
                    }

                    V_upLim {
                        label = "Voltage PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "4.0"
                        group = "3 - Adv. 1"
                    }

                    V_lowLim {
                        label = "Voltage PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-4.0"
                        group = "3 - Adv. 1"
                    }

                    Id_Kp {
                        label = "d current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "0.6"
                        group = "4 - Adv. 2"
                    }

                    Id_Ki {
                        label = "d current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "60"
                        group = "4 - Adv. 2"
                    }

                    Id_upLim {
                        label = "d current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "4 - Adv. 2"
                    }

                    Id_lowLim {
                        label = "d current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "4 - Adv. 2"
                    }

                    Iq_Kp {
                        label = "q current PI proportional gain"
                        widget = edit
                        type = generic
                        default_value = "0.6"
                        group = "5 - Adv. 3"
                    }

                    Iq_Ki {
                        label = "q current PI integral gain"
                        widget = edit
                        type = generic
                        default_value = "60"
                        group = "5 - Adv. 3"
                    }

                    Iq_upLim {
                        label = "q current PI upper limit"
                        widget = edit
                        type = generic
                        default_value = "10.0"
                        group = "5 - Adv. 3"
                    }

                    Iq_lowLim {
                        label = "q current PI lower limit"
                        widget = edit
                        type = generic
                        default_value = "-10.0"
                        group = "5 - Adv. 3"
                    }

                    Damp {
                        label = "d and q currents damping"
                        widget = edit
                        type = generic
                        default_value = "0.0"
                        group = "6 - Adv. 4"
                    }

                    mod_upLim {
                        label = "Modulation signals upper limit"
                        widget = edit
                        type = generic
                        default_value = "1.1546"
                        group = "6 - Adv. 4"
                    }

                    mod_lowLim {
                        label = "Modulation signals lower limit"
                        widget = edit
                        type = generic
                        default_value = "-1.1546"
                        group = "6 - Adv. 4"
                    }

                    Delay {
                        label = "Time delay to turn on after grid connection"
                        widget = edit
                        type = generic
                        default_value = "0.125"
                        unit = "s"
                        group = "6 - Adv. 4"
                    }

                    powerRate {
                        label = "Maximum power reference change rate"
                        widget = edit
                        type = generic
                        default_value = "5"
                        unit = "pu/s"
                        group = "6 - Adv. 4"
                    }

                    CODE define_icon
                        mdl.set_component_icon_image(item_handle, "pv_plant.svg")
                    ENDCODE

                    CODE open
                        from typhoon.apps.schematic_editor.dialogs.component_property_dialogs.general import RegularComponentPropertiesDialog
                    
                        dialog = RegularComponentPropertiesDialog(
                            component=component,
                            property_container=component.masks[-1],
                            current_diagram=current_diagram
                        )
                        dialog.exec_()
                        
                    ENDCODE
                }
            }
            [
                position = 7968, 8152
                size = 353, 239
            ]

            component src_constant Constant2 {
                execution_rate = "Ts_pv"
                value = "480"
            }
            [
                position = 7472, 8000
                hide_name = True
            ]

            component gen_bus_split "Bus Split1" {
                outputs = "12"
            }
            [
                position = 8272, 7792
                hide_name = True
            ]

            component gen_probe P {
            }
            [
                position = 8392, 7864
            ]

            component gen_probe Q {
            }
            [
                position = 8392, 7920
            ]

            component gen_probe SI {
            }
            [
                position = 7320, 8144
                scale = -1, 1
            ]

            component Subsystem "Solar irradiance" {
                layout = dynamic
                component gen_c_function "C function2" {
                    global_variables = "real k;"
                    in_terminal_dimensions = "inherit;inherit"
                    in_terminal_dimensions_str = "GHI inherit;ETR inherit"
                    in_terminal_labels = "[(\'GHI\', True), (\'ETR\', True)]"
                    in_terminal_properties = "real GHI;real ETR;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "inherit;inherit"
                    out_terminal_dimensions_str = "f inherit;Gdh inherit"
                    out_terminal_labels = "[(\'f\', True), (\'Gdh\', True)]"
                    out_terminal_properties = "real f;real Gdh;"
                    output_fnc = "/*Begin code section*/
if (k<=0.21) f = 0.995-0.081*k;
else if (k>0.76) f = 0.18;
else f = 0.724 + 2.738*k - 8.321*k*k + 4.967*k*k*k;
Gdh = f*GHI;
/*End code section*/"
                    update_fnc = "/*Begin code section*/
k = GHI/ETR;
/*End code section*/"
                }
                [
                    position = 7480, 7976
                    hide_name = True
                    size = 56, 72
                ]

                component src_constant Constant9 {
                    execution_rate = "Ts_pv"
                    value = "GHI"
                }
                [
                    position = 7024, 7920
                    hide_name = True
                ]

                component src_constant Constant10 {
                    execution_rate = "Ts_pv"
                    value = "ETR"
                }
                [
                    position = 7024, 7960
                    hide_name = True
                ]

                component src_constant Constant11 {
                    execution_rate = "Ts_pv"
                    value = "ang"
                }
                [
                    position = 7024, 8000
                    hide_name = True
                ]

                component src_constant Constant12 {
                    execution_rate = "Ts_pv"
                    value = "ang_z"
                }
                [
                    position = 7024, 8040
                    hide_name = True
                ]

                component src_constant Constant13 {
                    execution_rate = "Ts_pv"
                    value = "ang_t"
                }
                [
                    position = 7024, 8080
                    hide_name = True
                ]

                component src_constant Constant14 {
                    execution_rate = "Ts_pv"
                    value = "rho"
                }
                [
                    position = 7024, 8128
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function1" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7904, 7960
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function2" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7904, 8016
                    hide_name = True
                ]

                component gen_sum Sum3 {
                    signs = "+-"
                }
                [
                    position = 7792, 7888
                    hide_name = True
                ]

                component gen_product Product2 {
                    signs = "**/"
                }
                [
                    position = 8040, 7920
                    hide_name = True
                ]

                component gen_sum Sum4 {
                    signs = "+-"
                }
                [
                    position = 7480, 8144
                    hide_name = True
                ]

                component gen_product Product3 {
                    signs = "***"
                }
                [
                    position = 7632, 8160
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function3" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7344, 8152
                    hide_name = True
                ]

                component src_constant Constant15 {
                    execution_rate = "Ts_pv"
                }
                [
                    position = 7336, 8096
                    hide_name = True
                ]

                component gen_product Product4 {
                }
                [
                    position = 7984, 8192
                    hide_name = True
                ]

                component gen_sum Sum5 {
                    signs = "+-"
                }
                [
                    position = 8088, 8168
                    hide_name = True
                ]

                component src_constant Constant17 {
                    execution_rate = "Ts_pv"
                }
                [
                    position = 7944, 8120
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function4" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7408, 8400
                    hide_name = True
                ]

                component gen_gain Gain1 {
                    gain = "0.5"
                }
                [
                    position = 7320, 8400
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function5" {
                }
                [
                    position = 7408, 8464
                    hide_name = True
                ]

                component gen_gain Gain2 {
                    gain = "0.5"
                }
                [
                    position = 7320, 8464
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function6" {
                    trigonometric_fn = "cos"
                }
                [
                    position = 7408, 8528
                    hide_name = True
                ]

                component gen_trigonometric "Trigonometric function7" {
                }
                [
                    position = 7408, 8584
                    hide_name = True
                ]

                component gen_c_function "C function3" {
                    in_terminal_dimensions = "1;1;4"
                    in_terminal_dimensions_str = "Gdh 1;fk 1;x 4"
                    in_terminal_labels = "[(\'Gdh\', True), (\'fk\', True), (\'x\', True)]"
                    in_terminal_properties = "real Gdh;real fk;real x;"
                    no_feed_inputs = "[\'\']"
                    no_feed_outputs = "[\'\']"
                    out_terminal_dimensions = "1"
                    out_terminal_dimensions_str = "Gd 1"
                    out_terminal_labels = "[(\'Gd\', True)]"
                    out_terminal_properties = "real Gd;"
                    output_fnc = "/*Begin code section*/
Gd = Gdh*0.5*(1+x[0])*(1+fk*x[1]*x[1]*x[1])*(1+fk*x[2]*x[2]*x[3]*x[3]*x[3]);
/*End code section*/"
                }
                [
                    position = 7736, 8432
                    hide_name = True
                    size = 104, 128
                ]

                component gen_bus_join "Bus Join1" {
                    inputs = "4"
                }
                [
                    position = 7544, 8480
                ]

                component gen_sum Sum6 {
                    signs = "+++"
                }
                [
                    position = 8016, 8416
                    hide_name = True
                ]

                component gen_gain Gain3 {
                    gain = "0.5"
                }
                [
                    position = 7712, 8160
                    hide_name = True
                ]

                port SI {
                    position = auto:auto
                    kind = sp
                    direction =  in
                    sp_type {
                        default = inherit
                        readonly = True
                    }
                }
                [
                    position = 8176, 8416
                ]

                tag From66 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 7960
                    hide_name = True
                    size = 37, 20
                ]

                tag From67 {
                    value = "ETR"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7320, 7992
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto35 {
                    value = "f"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7608, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto36 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7608, 7992
                    hide_name = True
                    size = 60, 20
                ]

                tag From68 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7784, 7960
                    hide_name = True
                    size = 37, 20
                ]

                tag From69 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7784, 8016
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto37 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto38 {
                    value = "ETR"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 7960
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto39 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8000
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto40 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8040
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto41 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8080
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto42 {
                    value = "rho"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7120, 8128
                    hide_name = True
                    size = 60, 20
                ]

                tag From70 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7696, 7880
                    hide_name = True
                    size = 37, 20
                ]

                tag From71 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7696, 7912
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto43 {
                    value = "Gb"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8152, 7920
                    hide_name = True
                    size = 60, 20
                ]

                tag Goto44 {
                    value = "Gr"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 7800, 8160
                    hide_name = True
                    size = 60, 20
                ]

                tag From74 {
                    value = "GHI"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7480, 8200
                    hide_name = True
                    size = 37, 20
                ]

                tag From72 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7224, 8152
                    hide_name = True
                    size = 37, 20
                ]

                tag From75 {
                    value = "rho"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7480, 8232
                    hide_name = True
                    size = 37, 20
                ]

                tag From76 {
                    value = "f"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7864, 8184
                    hide_name = True
                    size = 37, 20
                ]

                tag Goto45 {
                    value = "fk"
                    scope = masked_subsystem
                    kind = sp
                    direction = in
                }
                [
                    position = 8216, 8168
                    hide_name = True
                    size = 60, 20
                ]

                tag From78 {
                    value = "ang_t"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7240, 8400
                    hide_name = True
                    size = 37, 20
                ]

                tag From79 {
                    value = "ang"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7288, 8528
                    hide_name = True
                    size = 37, 20
                ]

                tag From80 {
                    value = "ang_z"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7288, 8584
                    hide_name = True
                    size = 37, 20
                ]

                tag From81 {
                    value = "Gdh"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7544, 8368
                    hide_name = True
                    size = 37, 20
                ]

                tag From82 {
                    value = "fk"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7544, 8408
                    hide_name = True
                    size = 37, 20
                ]

                tag From83 {
                    value = "Gb"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7920, 8376
                    hide_name = True
                    size = 37, 20
                ]

                tag From84 {
                    value = "Gr"
                    scope = masked_subsystem
                    kind = sp
                    direction = out
                }
                [
                    position = 7920, 8416
                    hide_name = True
                    size = 37, 20
                ]

                junction Junction1 sp
                [
                    position = 7920, 8184
                ]

                junction Junction2 sp
                [
                    position = 7272, 8400
                ]

                connect From66 "C function2.GHI" as Connection61
                connect From67 "C function2.ETR" as Connection62
                connect "C function2.f" Goto35 as Connection63
                connect "C function2.Gdh" Goto36 as Connection64
                connect Goto37 Constant9.out as Connection65
                connect Constant10.out Goto38 as Connection66
                connect Constant11.out Goto39 as Connection67
                connect Constant12.out Goto40 as Connection68
                connect Constant13.out Goto41 as Connection69
                connect Constant14.out Goto42 as Connection70
                connect From68 "Trigonometric function1.in" as Connection71
                connect From69 "Trigonometric function2.in" as Connection72
                connect From70 Sum3.in as Connection73
                connect From71 Sum3.in1 as Connection74
                connect Product2.in Sum3.out as Connection75
                connect Product2.in1 "Trigonometric function1.out" as Connection76
                connect "Trigonometric function2.out" Product2.in2 as Connection77
                connect Product2.out Goto43 as Connection78
                connect Product3.in Sum4.out as Connection83
                connect From72 "Trigonometric function3.in" as Connection79
                connect "Trigonometric function3.out" Sum4.in1 as Connection87
                connect Constant15.out Sum4.in as Connection88
                connect From74 Product3.in1 as Connection90
                [
                    breakpoints = 7528, 8200; 7528, 8160
                ]
                connect From75 Product3.in2 as Connection91
                [
                    breakpoints = 7560, 8232; 7560, 8176
                ]
                connect Constant17.out Sum5.in as Connection92
                connect From76 Junction1 as Connection94
                connect Junction1 Product4.in as Connection95
                connect Product4.in1 Junction1 as Connection96
                connect Product4.out Sum5.in1 as Connection97
                connect Sum5.out Goto45 as Connection98
                connect Gain1.out "Trigonometric function4.in" as Connection103
                connect Gain2.out "Trigonometric function5.in" as Connection104
                connect From79 "Trigonometric function6.in" as Connection105
                connect From80 "Trigonometric function7.in" as Connection106
                connect From78 Junction2 as Connection107
                connect Junction2 Gain1.in as Connection108
                connect Gain2.in Junction2 as Connection109
                connect "Trigonometric function4.out" "Bus Join1.in" as Connection110
                connect "Trigonometric function5.out" "Bus Join1.in1" as Connection111
                connect "Trigonometric function6.out" "Bus Join1.in2" as Connection112
                connect "Trigonometric function7.out" "Bus Join1.in3" as Connection113
                [
                    breakpoints = 7472, 8584; 7472, 8504
                ]
                connect From81 "C function3.Gdh" as Connection114
                connect From82 "C function3.fk" as Connection115
                connect "Bus Join1.out" "C function3.x" as Connection116
                connect "C function3.Gd" Sum6.in2 as Connection117
                connect From83 Sum6.in as Connection118
                connect From84 Sum6.in1 as Connection119
                connect SI Sum6.out as Connection120
                connect Product3.out Gain3.in as Connection121
                connect Gain3.out Goto44 as Connection122
            }
            [
                position = 7136, 8048
                size = 96, 216
            ]

            component "core/Three Phase Core Coupling" "Core Coupling" {
            }
            [
                position = 8264, 8152
                size = 12, 256
            ]

            component gen_c_function "C functio" {
                global_variables = "real C;"
                in_terminal_dimensions = "1;1"
                in_terminal_dimensions_str = "Qref 1;Vout 1"
                in_terminal_labels = "[(\'Qref\', True), (\'Vout\', True)]"
                in_terminal_properties = "real Qref;real Vout;"
                init_fnc = "/*Begin code section*/
C = 50e-6;
/*End code section*/"
                no_feed_inputs = "[\'\']"
                no_feed_outputs = "[\'\']"
                out_terminal_dimensions = "1"
                out_terminal_dimensions_str = "Qinv 1"
                out_terminal_labels = "[(\'Qinv\', False)]"
                out_terminal_properties = "real Qinv;"
                output_fnc = "/*Begin code section*/
Qinv = Qref - Vout*Vout*C*sys_w*1e-3;
/*End code section*/"
                parameters = "real sys_w;"
            }
            [
                position = 8456, 7672
                hide_name = True
                size = 64, 56
            ]

            component "core/Rate Transition" "Rate Transition1" {
                execution_rate = "0.01"
            }
            [
                position = 8368, 7736
                hide_name = True
                size = 32, 32
            ]

            component tm_delay "Unit Delay1" {
            }
            [
                position = 8536, 7672
            ]

            component "core/Rate Transition" "Rate Transition2" {
                execution_rate = "Ts_pv"
            }
            [
                position = 8600, 7672
                hide_name = True
                size = 32, 32
            ]

            port EPC_A {
                position = top:1
                kind = pe
            }
            [
                position = 8384, 8056
                scale = -1, 1
            ]

            port EPC_B {
                position = top:2
                kind = pe
            }
            [
                position = 8384, 8152
                scale = -1, 1
            ]

            port EPC_C {
                position = top:3
                kind = pe
            }
            [
                position = 8384, 8248
                scale = -1, 1
            ]

            tag Qref {
                value = "Qref"
                scope = local
                kind = sp
                direction = in
            }
            [
                position = 8680, 7672
            ]

            tag From1 {
                value = "Qref"
                scope = local
                kind = sp
                direction = out
            }
            [
                position = 7496, 8032
            ]

            junction Junction1 sp
            [
                position = 7576, 7952
            ]

            junction Junction2 sp
            [
                position = 7576, 7968
            ]

            junction Junction4 sp
            [
                position = 7312, 8048
            ]

            connect "Bus Join1.out" "PV Plant (Switching)1.Inputs" as Connection4337
            connect Constant1.out Junction1 as Connection4339
            connect Junction1 "Bus Join1.in" as Connection4340
            connect "Bus Join1.in3" Constant2.out as Connection4342
            connect "Bus Join1.in1" Junction2 as Connection4343
            connect Junction2 Junction1 as Connection4344
            connect "Bus Join1.in4" Junction2 as Connection4345
            connect "Bus Split1.in" "PV Plant (Switching)1.Outputs" as Connection4347
            connect "Bus Join1.in2" Junction4 as Connection4354
            [
                breakpoints = 7504, 7960; 7312, 7960
            ]
            connect "Solar irradiance.SI" Junction4 as Connection4356
            connect Junction4 SI.in as Connection4357
            [
                breakpoints = 7312, 8048; 7312, 8048; 7408, 8048
            ]
            connect "PV Plant (Switching)1.C" "Core Coupling.c_in" as Connection4358
            connect "PV Plant (Switching)1.B" "Core Coupling.b_in" as Connection4359
            connect "PV Plant (Switching)1.A" "Core Coupling.a_in" as Connection4360
            connect "Core Coupling.a_out" EPC_A as Connection4361
            connect "Core Coupling.b_out" EPC_B as Connection4362
            connect "Core Coupling.c_out" EPC_C as Connection4363
            connect "Bus Split1.out10" P.in as Connection4364
            connect Q.in "Bus Split1.out11" as Connection4365
            connect Q_ref_pv.out "C functio.Qref" as Connection4366
            connect From1 "Bus Join1.in5" as Connection4369
            connect "Bus Split1.out2" "Rate Transition1.in" as Connection4370
            connect "Rate Transition1.out" "C functio.Vout" as Connection4371
            connect "Unit Delay1.in" "C functio.Qinv" as Connection4373
            connect Qref "Rate Transition2.out" as Connection4374
            connect "Rate Transition2.in" "Unit Delay1.out" as Connection4375
        }
        [
            position = 5840, 8120
            rotation = right
            size = 144, 56
        ]

        component "core/RL Section" "RL Section" {
            length_mile = "0.5"
            resistance_per_l_mile = "1e-2"
        }
        [
            position = 6400, 7776
            rotation = left
            scale = -1, 1
            size = 256, 56
        ]

        tag Tag36 {
            value = "Ground"
            scope = global
            kind = pe
        }
        [
            position = 6496, 7416
            hide_name = True
            scale = -1, 1
        ]

        junction Junction495 pe
        [
            position = 6400, 7416
        ]

        junction Junction599 pe
        [
            position = 5912, 8072
        ]

        junction Junction600 pe
        [
            position = 6056, 8120
        ]

        junction Junction601 pe
        [
            position = 6304, 7584
        ]

        junction Junction602 pe
        [
            position = 6400, 7416
        ]

        junction Junction603 pe
        [
            position = 6488, 7968
        ]

        junction Junction604 pe
        [
            position = 6528, 7984
        ]

        junction Junction605 pe
        [
            position = 6560, 8000
        ]

        connect Junction495 Tag36 as Connection4156
        [
            breakpoints = 6400, 7416
        ]
        connect Vs1.n_node Junction495 as Connection4157
        connect Lc1.p_node Rc1.p_node as Connection4622
        connect La1.p_node Ra1.p_node as Connection4623
        connect Lb1.p_node Rb1.p_node as Connection4624
        connect Vrms_pv.p_node Junction599 as Connection4687
        connect Junction599 La1.n_node as Connection4688
        [
            breakpoints = 5912, 8072; 5912, 8072; 5912, 8072; 6080, 8072
        ]
        connect PV.EPC_A Junction599 as Connection4689
        connect Lb1.n_node Junction600 as Connection4690
        connect Junction600 Vrms_pv.n_node as Connection4691
        [
            breakpoints = 6056, 8120; 6056, 8120
        ]
        connect PV.EPC_B Junction600 as Connection4692
        connect PV.EPC_C Lc1.n_node as Connection4693
        connect Vs1.a_node Junction601 as Connection4700
        connect Junction601 "RL Section.P5" as Connection4701
        [
            breakpoints = 6304, 7584; 6304, 7584
        ]
        connect Vrms_grid.p_node Junction601 as Connection4702
        connect Junction495 Junction602 as Connection4703
        connect Junction602 gnd2.node as Connection4704
        [
            breakpoints = 6400, 7416; 6400, 7416
        ]
        connect Vrms_grid.n_node Junction602 as Connection4705
        [
            breakpoints = 6184, 7424
        ]
        connect "RL Section.P3" Vs1.b_node as Connection4706
        connect "RL Section.P1" Vs1.c_node as Connection4707
        connect Ra1.n_node Junction603 as Connection4717
        [
            breakpoints = 6488, 8064
        ]
        connect Junction603 Load.A as Connection4718
        [
            breakpoints = 6488, 7968; 6488, 7968
        ]
        connect "RL Section.P6" Junction603 as Connection4719
        connect Load.B Junction604 as Connection4720
        connect Junction604 Rb1.n_node as Connection4721
        [
            breakpoints = 6528, 7984
        ]
        connect "RL Section.P4" Junction604 as Connection4722
        connect Rc1.n_node Junction605 as Connection4723
        connect Junction605 Load.C as Connection4724
        [
            breakpoints = 6560, 8000
        ]
        connect "RL Section.P2" Junction605 as Connection4725
    }

    default {
        gen_bus_join {
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_bus_split {
            outputs = "2"
            execution_rate = "inherit"
        }

        gen_c_function {
            in_terminal_properties = "real in;"
            in_terminal_labels = ""
            out_terminal_properties = "real out;"
            out_terminal_labels = ""
            no_feed_inputs = ""
            no_feed_outputs = ""
            in_terminal_dimensions = ""
            in_terminal_dimensions_str = ""
            out_terminal_dimensions = ""
            out_terminal_dimensions_str = ""
            output_fnc = ""
            update_fnc = ""
            init_fnc = ""
            global_variables = ""
            parameters = ""
            execution_rate = "inherit"
        }

        gen_digital_probe {
            override_signal_name = "False"
            signal_name = ""
            streaming_en = "False"
            addr = "0"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_gain {
            gain = "1"
            multiplication = "Element-wise(K.*u)"
            execution_rate = "inherit"
        }

        gen_integrator {
            show_reset = "none"
            reset_type = "asynchronous"
            show_init_condition = "internal"
            init_value = "0"
            limit_output = "False"
            limit_upper = "inf"
            limit_lower = "-inf"
            show_state = "False"
            state_port_type = "inherit"
            execution_rate = "inherit"
        }

        gen_limiter {
            upper_limit = "[\'inf\']"
            lower_limit = "[\'-inf\']"
            execution_rate = "inherit"
        }

        gen_logic_op {
            operator = "AND"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_minmax {
            operation = "min"
            inputs = "2"
            execution_rate = "inherit"
        }

        gen_probe {
            addr = "0"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "generic"
            streaming_en = "False"
            streaming_er_idx = "0"
            execution_rate = "inherit"
        }

        gen_product {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_rate_limiter {
            rising_limit = "1"
            falling_limit = "-1"
            execution_rate = "inherit"
        }

        gen_sum {
            signs = "2"
            execution_rate = "inherit"
        }

        gen_terminator {
            execution_rate = "inherit"
        }

        gen_trigonometric {
            trigonometric_fn = "sin"
            execution_rate = "inherit"
        }

        gen_z_domain_transfer {
            domain = "Z-domain"
            method = "Zero-order hold"
            b_coeff = "[1]"
            a_coeff = "[1,-1]"
            init_states = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        pas_capacitor {
            capacitance = "1e-6"
            initial_voltage = "0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_inductor {
            inductance = "1e-3"
            initial_current = "0.0"
            pole_shift_ignore = "False"
            visible = "True"
        }

        pas_resistor {
            resistance = "1"
        }

        src_constant {
            value = "1"
            signal_type = "real"
            execution_rate = "100e-6"
        }

        src_scada_input {
            addr = "0"
            format = "real"
            override_signal_name = "False"
            signal_name = ""
            signal_type = "real"
            min = "-1e6"
            max = "1e6"
            def_value = "0"
            unit = " "
            execution_rate = "100e-6"
        }

        sys_signal_switch {
            criterion = "ctrl >= threshold"
            threshold = "0"
            execution_rate = "inherit"
        }

        tm_delay {
            init_value = "0"
            signal_out_type = "inherit"
            execution_rate = "inherit"
        }

        "core/Current Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Edge Detection" {
            edge = "both"
            execution_rate = "inherit"
        }

        "core/RL Section" {
            model_def = "R-L"
            unit_sys = "imperial"
            num_of_phases = "3"
            resistance_per_l = "1"
            resistance_per_l_mile = "1"
            inductance_per_l = "1e-3"
            inductance_per_l_mile = "1e-3"
            length = "1.0"
            length_mile = "1.0"
            power = "500.0"
            voltage = "11.0"
            frequency = "50.0"
            R_value = "21.55"
            L_value = "0.00842"
        }

        "core/Rate Transition" {
            init_value = "0.0"
            execution_rate = "100e-6"
        }

        "core/Signal Controlled Voltage Source" {
            execution_rate = "inherit"
        }

        "core/Three Phase Core Coupling" {
            snb_type_i = "none"
            R1 = "100e3"
            C1 = "1e-06"
            C2 = "1e-06"
            fixed_snb_i = "false"
            snb_type_u = "none"
            R2 = "0.1"
            L1 = "0.1"
            L2 = "0.1"
            fixed_snb_u = "false"
            cpl_connection = "star"
        }

        "core/Three Phase Inverter" {
            ctrl_src = "Digital input per switch"
            op_mode = "Fixed carrier frequency"
            carrier_freq = "10000.0"
            carr_ph_offset = "0.0"
            d_time = "5e-6"
            ref_sig_min_max = "[-1.0, 1.0]"
            load_mode = "on min"
            execution_rate = "inherit"
            Sa_top = "1"
            Sa_top_logic = "active high"
            Sa_bot = "2"
            Sa_bot_logic = "active high"
            Sb_top = "3"
            Sb_top_logic = "active high"
            Sb_bot = "4"
            Sb_bot_logic = "active high"
            Sc_top = "5"
            Sc_top_logic = "active high"
            Sc_bot = "6"
            Sc_bot_logic = "active high"
            delay_enabled = "False"
            fixed_delay = "1e-6"
            var_delay_lut = "[-10.0, 1e-6, 10.0, 1e-6]"
            preview_var_delay = "Preview"
            Sa_top_I = "False"
            Sa_bot_I = "False"
            Sb_top_I = "False"
            Sb_bot_I = "False"
            Sc_top_I = "False"
            Sc_bot_I = "False"
            losses_estimation = "False"
            Import_igbt_xml = "not selected"
            Import_diode_xml = "not selected"
            Vce = "1.3"
            Rce = "0"
            Vd = "1.2"
            Rd = "0"
            i_sw = "[0.0, 6.0, 12.0, 18.0, 24.0]"
            v_sw = "[0.0, 600.0]"
            temp_sw = "[25.0, 50.0, 75.0, 100.0, 125.0]"
            et_on_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*3.8e-3, 0.4*3.8e-3, 0.8*3.8e-3, 0.68*3.8e-3, 0.9*3.8e-3], [0.65*3.8e-3, 0.9*3.8e-3, 1.2*3.8e-3, 1.5*3.8e-3, 1.7*3.8e-3], [0.9*3.8e-3, 1.3*3.8e-3, 1.7*3.8e-3, 1.9*3.8e-3, 2.25*3.8e-3], [1.1*3.8e-3, 1.7*3.8e-3, 2.1*3.8e-3, 2.3*3.8e-3, 2.5*3.8e-3]]"
            et_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.1e-3, 0.4*2.1e-3, 0.8*2.1e-3, 0.68*2.1e-3, 0.9*2.1e-3], [0.65*2.1e-3, 0.9*2.1e-3, 1.2*2.1e-3, 1.5*2.1e-3, 1.7*2.1e-3], [0.9*2.1e-3, 1.3*2.1e-3, 1.7*2.1e-3, 1.9*2.1e-3, 2.25*2.1e-3], [1.1*2.1e-3, 1.7*2.1e-3, 2.1*2.1e-3, 2.3*2.1e-3, 2.5*2.1e-3]]"
            ed_off_table_out = "[[0.0, 0.0275e-3, 0.15e-3, 0.275e-3, 0.3e-3], [0.35*2.2e-3, 0.4*2.2e-3, 0.8*2.2e-3, 0.68*2.2e-3, 0.9*2.2e-3], [0.65*2.2e-3, 0.9*2.2e-3, 1.2*2.2e-3, 1.5*2.2e-3, 1.7*2.2e-3], [0.9*2.2e-3, 1.3*2.2e-3, 1.7*2.2e-3, 1.9*2.2e-3, 2.25*2.2e-3], [1.1*2.2e-3, 1.7*2.2e-3, 2.1*2.2e-3, 2.3*2.2e-3, 2.5*2.2e-3]]"
            temp_estimation = "False"
            thermal_networks_type = "Foster"
            switch_Rth = "[0.159, 0.133, 0.120, 0.038]"
            switch_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            switch_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            diode_Rth = "[0.159, 0.133, 0.120, 0.038]"
            diode_Tth = "[1.1e-1, 1.56e-2, 1.35e-3, 1.51e-4]"
            diode_Cth = "[0.0029, 0.0097, 0.1068, 0.8500]"
            loss_exec_rate = "100e-6"
            vout_cmp_pullup_mode = "False"
            show_cnt_out = "False"
            show_monitoring = "false"
            _control_property = "all high"
            dtv_flag_en = "True"
            pwm_enabling = "False"
            pwm_enable_di = "13"
            pwm_enable_inv = "active high"
        }

        "core/Three Phase Voltage Source" {
            init_rms_value = "0.0"
            init_frequency = "50.0"
            init_phase = "0.0"
        }

        "core/Three phase PLL" {
            initial_filter_output = "60"
            wn = "157.0796"
            zeta = "0.707"
            rate_high = "12"
            rate_low = "-12"
            freq_unit = "Hz"
            kp = "100"
            ki = "3200"
            kd = "1"
            N = "714.2857"
            initial_pid_output = "376.99111843"
            up_lim = "1e4"
            low_lim = "-1e4"
            kb = "1"
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "False"
            wn_LPFdq = "62.83185307"
            execution_rate = "inherit"
            enable_pk = "False"
            enable_zero = "True"
            enable_sin = "True"
        }

        "core/Triple Pole Single Throw Contactor" {
            ctrl_src = "Digital input"
            Sa = "1"
            Sa_logic = "active high"
            enable_fb_out = "False"
            fb_out_type = "real"
            execution_rate = "inherit"
            initial_state = "off"
            on_delay = "0"
            off_delay = "0"
        }

        "core/Voltage Measurement" {
            bw_limit = "False"
            frequency = "10e3"
            comparator_enable = "False"
            operator = "greater"
            threshold = "0"
            cmp_abs_value = "False"
            feed_forward = "false"
            sig_output = "False"
            execution_rate = "100e-6"
            addr = "0"
            nd_msr_estimation = "false"
            dev_cpl_msr = "false"
            host_device = "0"
            output_to_device = "0"
            dev_cpl_index = "0"
            dev_cpl_var_nb = "0"
            visible = "True"
            override_signal_name = "False"
            signal_name = ""
        }

        "core/Voltage RMS" {
            op_mode = "PLL based"
            frequency = "50"
            sig_output = "False"
            execution_rate = "inherit"
            feed_forward = "false"
            nd_msr_estimation = "false"
        }

        "core/abc to dq" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            disable_filter = "True"
            initial_filter_output = "0"
            wn_LPFdq = "1000"
            execution_rate = "inherit"
        }

        "core/dq to abc" {
            power_form = "variant - Clarke\'s original"
            alignment = "-pi/2"
            execution_rate = "0"
        }
    }

    CODE model_init
        # Numpy module is imported as 'np'
        # Scipy module is imported as 'sp'
        
        Ts = 1e-3
        sys_f = 60.0    # Hz
        sys_w = 2.0*np.pi*sys_f    #rad/s
        Ts_ess = 20e-6
        Ts_pv = 20e-6
        
        # Grid specs
        
        R=1e-3
        L=100e-6
        
        # Solar irradiance model parameters
        ang = 0
        ang_z = 20*np.pi/180
        ang_t = 20*np.pi/180
        rho = 0.2
        GHI = 304
        ETR = 346
    ENDCODE
}
